<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facility Dashboard - Team GoTrotters | GoStar Digital</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
    --orange: #FF6B00;
    --orange-dark: #CC5500;
    --teal: #00D9A5;
    --gold: #FFD700;
    --purple: #9B59B6;
    --blue: #3B82F6;
    --dark: #0a0a0f;
    --darker: #050508;
    --card: #111118;
    --card-hover: #1a1a24;
    --text: #FFFFFF;
    --muted: #8892a0;
    --border: rgba(255,255,255,0.08);
    --success: #00D9A5;
    --danger: #FF4757;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Outfit', sans-serif;
    background: var(--dark);
    color: var(--text);
    min-height: 100vh;
}

body.es .lang-en { display: none !important; }
body.en .lang-es { display: none !important; }

.login-screen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.login-screen.hidden { display: none; }

.login-lang-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    display: flex;
    gap: 4px;
}

.login-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 48px 40px;
    width: 100%;
    max-width: 420px;
    text-align: center;
}

.login-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.5rem;
    letter-spacing: 4px;
    margin-bottom: 10px;
}

.login-logo .go { color: var(--orange); }
.login-logo .trotters { color: var(--teal); }

.login-badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--dark);
    background: var(--teal);
    padding: 5px 15px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 30px;
}

.login-subtitle {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 30px;
}

.form-group {
    margin-bottom: 20px;
    text-align: left;
}

.form-label {
    display: block;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.form-input {
    width: 100%;
    padding: 16px 20px;
    background: var(--darker);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    font-size: 1rem;
    font-family: 'Outfit', sans-serif;
    transition: all 0.2s;
}

.form-input:focus {
    outline: none;
    border-color: var(--orange);
    box-shadow: 0 0 20px rgba(255,107,0,0.2);
}

.login-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--teal), #00b88a);
    color: var(--dark);
    border: none;
    border-radius: 12px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 25px rgba(0,217,165,0.4);
}

.login-error {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 15px;
    display: none;
}

.login-error.show { display: block; }

.dashboard { display: none; min-height: 100vh; }
.dashboard.visible { display: block; }

.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 100;
    padding: 15px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(180deg, rgba(10,10,15,0.98) 0%, rgba(10,10,15,0.9) 100%);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
}

.header-left {
    display: flex;
    align-items: center;
    gap: 20px;
}

.logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    letter-spacing: 3px;
}

.logo .go { color: var(--orange); }
.logo .trotters { color: var(--teal); }

.facility-badge {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 16px;
    background: rgba(0,217,165,0.1);
    border: 1px solid rgba(0,217,165,0.3);
    border-radius: 20px;
}

.facility-icon { font-size: 1.2rem; }
.facility-name { font-weight: 600; font-size: 0.9rem; color: var(--teal); }

.header-right {
    display: flex;
    align-items: center;
    gap: 15px;
}

.lang-toggle {
    display: flex;
    gap: 4px;
}

.lang-btn {
    padding: 6px 12px;
    border: 2px solid var(--orange);
    background: transparent;
    color: var(--orange);
    border-radius: 15px;
    font-weight: 600;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.3s;
}

.lang-btn.active {
    background: var(--orange);
    color: var(--text);
}

.logout-btn {
    padding: 8px 16px;
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    border-radius: 20px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s;
}

.logout-btn:hover {
    border-color: var(--danger);
    color: var(--danger);
}

.main {
    padding: 100px 30px 40px;
    max-width: 1400px;
    margin: 0 auto;
}

.page-header { margin-bottom: 30px; }

.page-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    letter-spacing: 3px;
    margin-bottom: 5px;
}

.page-subtitle {
    font-size: 0.9rem;
    color: var(--muted);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s;
}

.stat-card:hover {
    transform: translateY(-3px);
    border-color: var(--teal);
}

.stat-card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 15px;
}

.stat-card-icon.teal { background: rgba(0,217,165,0.15); }
.stat-card-icon.orange { background: rgba(255,107,0,0.15); }
.stat-card-icon.gold { background: rgba(255,215,0,0.15); }
.stat-card-icon.purple { background: rgba(155,89,182,0.15); }

.stat-card-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.2rem;
    letter-spacing: 2px;
    margin-bottom: 5px;
}

.stat-card-label {
    font-size: 0.8rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.circuit-overview {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.circuit-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
}

.circuit-card-header {
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
}

.circuit-card-header.c1 { background: linear-gradient(135deg, rgba(255,107,0,0.2), transparent); border-bottom: 2px solid var(--orange); }
.circuit-card-header.c2 { background: linear-gradient(135deg, rgba(0,217,165,0.2), transparent); border-bottom: 2px solid var(--teal); }
.circuit-card-header.c3 { background: linear-gradient(135deg, rgba(255,215,0,0.2), transparent); border-bottom: 2px solid var(--gold); }

.circuit-card-icon { font-size: 1.5rem; }
.circuit-card-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; flex: 1; }
.circuit-card-num { font-size: 0.7rem; color: var(--muted); }

.circuit-card-body { padding: 20px; }
.circuit-card-stats { display: flex; gap: 20px; }
.circuit-stat { text-align: center; flex: 1; }
.circuit-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; }
.circuit-stat-label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; }

.table-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 30px;
}

.table-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.table-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 2px;
}

.table-actions { display: flex; gap: 10px; }

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Outfit', sans-serif;
}

.btn-primary { background: var(--teal); color: var(--dark); }
.btn-primary:hover { background: #00c299; }
.btn-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text); }
.btn-secondary:hover { border-color: var(--teal); }

.table-container { overflow-x: auto; }

table { width: 100%; border-collapse: collapse; }

th, td {
    padding: 14px 20px;
    text-align: left;
    border-bottom: 1px solid var(--border);
}

th {
    font-size: 0.75rem;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    background: var(--darker);
}

td { font-size: 0.9rem; }
tr:hover { background: var(--card-hover); }

.tier-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 0.65rem;
    font-weight: 700;
}

.tier-badge.practice { background: rgba(155,89,182,0.2); color: #b57edc; }
.tier-badge.level { background: rgba(255,215,0,0.2); color: var(--gold); }
.tier-badge.master { background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,107,0,0.3)); color: var(--gold); }

.status-badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
}

.status-badge.active { background: rgba(0,217,165,0.15); color: var(--teal); }
.status-badge.inactive { background: rgba(255,71,87,0.15); color: var(--danger); }

.action-btns { display: flex; gap: 6px; }

.action-btn {
    width: 32px;
    height: 32px;
    border: 1px solid var(--border);
    background: transparent;
    border-radius: 8px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

.action-btn:hover { border-color: var(--teal); color: var(--teal); }

.modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}

.modal-overlay.show { display: flex; }

.modal {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    padding: 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
}

.modal-close {
    width: 36px;
    height: 36px;
    border: none;
    background: var(--darker);
    border-radius: 10px;
    color: var(--muted);
    font-size: 1.2rem;
    cursor: pointer;
}

.modal-close:hover { color: var(--danger); }
.modal-body { padding: 24px; }
.modal-footer { padding: 20px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }

.toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--card);
    border: 1px solid var(--teal);
    border-radius: 12px;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s;
    z-index: 2000;
}

.toast.show { transform: translateY(0); opacity: 1; }
.toast.error { border-color: var(--danger); }
.toast-icon { font-size: 1.2rem; }
.toast-text { font-size: 0.9rem; }

@media (max-width: 768px) {
    .header { padding: 15px 20px; }
    .facility-name { display: none; }
    .main { padding: 90px 20px 30px; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body class="en">

<div class="login-screen" id="loginScreen">
    <div class="login-lang-toggle">
        <button class="lang-btn active" id="loginBtnEn">EN</button>
        <button class="lang-btn" id="loginBtnEs">ES</button>
    </div>
    <div class="login-card">
        <div class="login-logo"><span class="go">Go</span><span class="trotters">Trotters</span></div>
        <div class="login-badge">Facility Portal</div>
        <p class="login-subtitle">
            <span class="lang-en">Access your facility dashboard</span>
            <span class="lang-es">Accede al panel de tu instalaci√≥n</span>
        </p>
        <form id="loginForm">
            <div class="form-group">
                <label class="form-label">
                    <span class="lang-en">Facility Code</span>
                    <span class="lang-es">C√≥digo de Instalaci√≥n</span>
                </label>
                <input type="text" class="form-input" id="facilityCode" placeholder="FACILITY123" autocomplete="off">
            </div>
            <div class="form-group">
                <label class="form-label">
                    <span class="lang-en">Admin PIN</span>
                    <span class="lang-es">PIN de Admin</span>
                </label>
                <input type="password" class="form-input" id="adminPin" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" inputmode="numeric">
            </div>
            <button type="submit" class="login-btn">
                <span class="lang-en">ACCESS DASHBOARD</span>
                <span class="lang-es">ACCEDER AL PANEL</span>
            </button>
        </form>
        <p class="login-error" id="loginError">
            <span class="lang-en">Invalid credentials</span>
            <span class="lang-es">Credenciales inv√°lidas</span>
        </p>
    </div>
</div>

<div class="dashboard" id="dashboard">
    <header class="header">
        <div class="header-left">
            <div class="logo"><span class="go">Go</span><span class="trotters">Trotters</span></div>
            <div class="facility-badge">
                <span class="facility-icon">üè¢</span>
                <span class="facility-name" id="facilityNameDisplay">Facility</span>
            </div>
        </div>
        <div class="header-right">
            <div class="lang-toggle">
                <button class="lang-btn active" id="btnEn">EN</button>
                <button class="lang-btn" id="btnEs">ES</button>
            </div>
            <button class="logout-btn" id="logoutBtn">
                üö™ <span class="lang-en">Logout</span><span class="lang-es">Salir</span>
            </button>
        </div>
    </header>

    <main class="main">
        <header class="page-header">
            <h1 class="page-title">TEAM GOTROTTERS</h1>
            <p class="page-subtitle">
                <span class="lang-en">Facility Dashboard ‚Ä¢ The Triad Circuit ‚Ä¢ 10-Tier Structure</span>
                <span class="lang-es">Panel de Instalaci√≥n ‚Ä¢ El Circuito Tr√≠ada ‚Ä¢ Estructura de 10 Niveles</span>
            </p>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-card-icon teal">üë•</div>
                <div class="stat-card-value" id="totalResidents">12</div>
                <div class="stat-card-label">
                    <span class="lang-en">Residents</span>
                    <span class="lang-es">Residentes</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon orange">üìä</div>
                <div class="stat-card-value" id="activeToday">8</div>
                <div class="stat-card-label">
                    <span class="lang-en">Active Today</span>
                    <span class="lang-es">Activos Hoy</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon gold">üèÜ</div>
                <div class="stat-card-value" id="avgTier">4.2</div>
                <div class="stat-card-label">
                    <span class="lang-en">Avg Tier</span>
                    <span class="lang-es">Nivel Promedio</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-card-icon purple">üëë</div>
                <div class="stat-card-value" id="totalMasters">2</div>
                <div class="stat-card-label">MASTER 10</div>
            </div>
        </div>

        <div class="circuit-overview">
            <div class="circuit-card">
                <div class="circuit-card-header c1">
                    <span class="circuit-card-icon">üß†</span>
                    <span class="circuit-card-title"><span class="lang-en">MEMORY</span><span class="lang-es">MEMORIA</span></span>
                    <span class="circuit-card-num"><span class="lang-en">CIRCUIT 1</span><span class="lang-es">CIRCUITO 1</span></span>
                </div>
                <div class="circuit-card-body">
                    <div class="circuit-card-stats">
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c1Sessions">156</div>
                            <div class="circuit-stat-label"><span class="lang-en">Sessions</span><span class="lang-es">Sesiones</span></div>
                        </div>
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c1Avg">4.5</div>
                            <div class="circuit-stat-label"><span class="lang-en">Avg Tier</span><span class="lang-es">Nivel Prom</span></div>
                        </div>
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c1Masters">2</div>
                            <div class="circuit-stat-label">Masters</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="circuit-card">
                <div class="circuit-card-header c2">
                    <span class="circuit-card-icon">‚ö°</span>
                    <span class="circuit-card-title"><span class="lang-en">MENTAL AGILITY</span><span class="lang-es">AGILIDAD MENTAL</span></span>
                    <span class="circuit-card-num"><span class="lang-en">CIRCUIT 2</span><span class="lang-es">CIRCUITO 2</span></span>
                </div>
                <div class="circuit-card-body">
                    <div class="circuit-card-stats">
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c2Sessions">132</div>
                            <div class="circuit-stat-label"><span class="lang-en">Sessions</span><span class="lang-es">Sesiones</span></div>
                        </div>
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c2Avg">3.8</div>
                            <div class="circuit-stat-label"><span class="lang-en">Avg Tier</span><span class="lang-es">Nivel Prom</span></div>
                        </div>
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c2Masters">1</div>
                            <div class="circuit-stat-label">Masters</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="circuit-card">
                <div class="circuit-card-header c3">
                    <span class="circuit-card-icon">üëÅÔ∏è</span>
                    <span class="circuit-card-title"><span class="lang-en">VISUAL TRACKING</span><span class="lang-es">SEGUIMIENTO VISUAL</span></span>
                    <span class="circuit-card-num"><span class="lang-en">CIRCUIT 3</span><span class="lang-es">CIRCUITO 3</span></span>
                </div>
                <div class="circuit-card-body">
                    <div class="circuit-card-stats">
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c3Sessions">98</div>
                            <div class="circuit-stat-label"><span class="lang-en">Sessions</span><span class="lang-es">Sesiones</span></div>
                        </div>
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c3Avg">3.2</div>
                            <div class="circuit-stat-label"><span class="lang-en">Avg Tier</span><span class="lang-es">Nivel Prom</span></div>
                        </div>
                        <div class="circuit-stat">
                            <div class="circuit-stat-value" id="c3Masters">0</div>
                            <div class="circuit-stat-label">Masters</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="table-card">
            <div class="table-header">
                <h3 class="table-title">
                    <span class="lang-en">RESIDENTS</span>
                    <span class="lang-es">RESIDENTES</span>
                </h3>
                <div class="table-actions">
                    <button class="btn btn-primary" id="addResidentBtn">+ 
                        <span class="lang-en">Add Resident</span>
                        <span class="lang-es">Agregar Residente</span>
                    </button>
                    <button class="btn btn-secondary" id="exportBtn">üì• Export</button>
                </div>
            </div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th><span class="lang-en">Name</span><span class="lang-es">Nombre</span></th>
                            <th><span class="lang-en">Room</span><span class="lang-es">Habitaci√≥n</span></th>
                            <th><span class="lang-en">Status</span><span class="lang-es">Estado</span></th>
                            <th>üß†</th>
                            <th>‚ö°</th>
                            <th>üëÅÔ∏è</th>
                            <th><span class="lang-en">Last Active</span><span class="lang-es">√öltima Vez</span></th>
                            <th><span class="lang-en">Actions</span><span class="lang-es">Acciones</span></th>
                        </tr>
                    </thead>
                    <tbody id="residentsTable"></tbody>
                </table>
            </div>
        </div>
    </main>
</div>

<div class="modal-overlay" id="residentModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title" id="residentModalTitle">ADD RESIDENT</h3>
            <button class="modal-close" data-close="residentModal">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="residentId">
            <div class="form-group">
                <label class="form-label"><span class="lang-en">Name</span><span class="lang-es">Nombre</span></label>
                <input type="text" class="form-input" id="residentName" placeholder="Mar√≠a Garc√≠a">
            </div>
            <div class="form-group">
                <label class="form-label"><span class="lang-en">Room Number</span><span class="lang-es">N√∫mero de Habitaci√≥n</span></label>
                <input type="text" class="form-input" id="residentRoom" placeholder="101A">
            </div>
            <div class="form-group">
                <label class="form-label">PIN (4 <span class="lang-en">digits</span><span class="lang-es">d√≠gitos</span>)</label>
                <input type="text" class="form-input" id="residentPin" placeholder="1234" maxlength="4">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="residentModal"><span class="lang-en">Cancel</span><span class="lang-es">Cancelar</span></button>
            <button class="btn btn-primary" id="saveResidentBtn"><span class="lang-en">Save</span><span class="lang-es">Guardar</span></button>
        </div>
    </div>
</div>

<div class="toast" id="toast">
    <span class="toast-icon" id="toastIcon">‚úì</span>
    <span class="toast-text" id="toastText">Saved</span>
</div>

<script>
(function() {
    'use strict';

    var tierList = ['PRACTICE 1','PRACTICE 2','LEVEL 3','LEVEL 4','LEVEL 5','LEVEL 6','LEVEL 7','LEVEL 8','LEVEL 9','MASTER 10'];

    var facilities = {
        'SANJUAN01': { name: 'San Juan Senior Living', pin: '1628' },
        'BAYAMON01': { name: 'Bayam√≥n Care Center', pin: '2024' },
        'DEMO': { name: 'Demo Facility', pin: '0000' }
    };

    var residents = [
        {id:1, name:'Mar√≠a Garc√≠a', room:'101A', pin:'1234', c1:7, c2:5, c3:4, status:'active', lastActive:'2026-01-09'},
        {id:2, name:'Roberto L√≥pez', room:'102B', pin:'5678', c1:10, c2:8, c3:6, status:'active', lastActive:'2026-01-09'},
        {id:3, name:'Carmen Rivera', room:'103A', pin:'9012', c1:10, c2:9, c3:7, status:'active', lastActive:'2026-01-08'},
        {id:4, name:'Jos√© Mart√≠nez', room:'104C', pin:'3456', c1:4, c2:3, c3:2, status:'active', lastActive:'2026-01-09'},
        {id:5, name:'Ana Rodr√≠guez', room:'105B', pin:'7890', c1:3, c2:2, c3:2, status:'inactive', lastActive:'2026-01-05'},
        {id:6, name:'Pedro Santos', room:'106A', pin:'2345', c1:5, c2:4, c3:3, status:'active', lastActive:'2026-01-09'},
        {id:7, name:'Luis Hern√°ndez', room:'107C', pin:'6789', c1:8, c2:7, c3:5, status:'active', lastActive:'2026-01-08'},
        {id:8, name:'Rosa D√≠az', room:'108B', pin:'0123', c1:2, c2:1, c3:1, status:'active', lastActive:'2026-01-09'},
        {id:9, name:'Miguel Torres', room:'109A', pin:'4567', c1:6, c2:5, c3:4, status:'active', lastActive:'2026-01-08'},
        {id:10, name:'Elena Vega', room:'110C', pin:'8901', c1:4, c2:3, c3:3, status:'inactive', lastActive:'2026-01-03'},
        {id:11, name:'Fernando Cruz', room:'111B', pin:'2345', c1:5, c2:4, c3:3, status:'active', lastActive:'2026-01-09'},
        {id:12, name:'Isabel Morales', room:'112A', pin:'6780', c1:3, c2:2, c3:2, status:'active', lastActive:'2026-01-07'}
    ];

    var nextResidentId = 13;
    var currentFacility = null;
    var currentLang = localStorage.getItem('gt-facility-lang') || 'en';

    function init() {
        setLang(currentLang);
        setupEventListeners();
        if (sessionStorage.getItem('gt-facility-auth') === 'true') {
            currentFacility = sessionStorage.getItem('gt-facility-code');
            showDashboard();
        }
    }

    function setLang(lang) {
        currentLang = lang;
        localStorage.setItem('gt-facility-lang', lang);
        document.body.className = lang;
        document.getElementById('btnEn').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('btnEs').className = lang === 'es' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('loginBtnEn').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('loginBtnEs').className = lang === 'es' ? 'lang-btn active' : 'lang-btn';
    }

    function setupEventListeners() {
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            attemptLogin();
        });

        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('btnEn').addEventListener('click', function() { setLang('en'); });
        document.getElementById('btnEs').addEventListener('click', function() { setLang('es'); });
        document.getElementById('loginBtnEn').addEventListener('click', function() { setLang('en'); });
        document.getElementById('loginBtnEs').addEventListener('click', function() { setLang('es'); });

        document.querySelectorAll('[data-close]').forEach(function(btn) {
            btn.addEventListener('click', function() { closeModal(this.dataset.close); });
        });

        document.getElementById('addResidentBtn').addEventListener('click', openAddModal);
        document.getElementById('saveResidentBtn').addEventListener('click', saveResident);
        document.getElementById('exportBtn').addEventListener('click', exportData);

        document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
            overlay.addEventListener('click', function(e) { if (e.target === overlay) overlay.classList.remove('show'); });
        });
    }

    function attemptLogin() {
        var code = document.getElementById('facilityCode').value.toUpperCase().trim();
        var pin = document.getElementById('adminPin').value.trim();

        if (facilities[code] && facilities[code].pin === pin) {
            currentFacility = code;
            sessionStorage.setItem('gt-facility-auth', 'true');
            sessionStorage.setItem('gt-facility-code', code);
            showDashboard();
        } else {
            document.getElementById('loginError').classList.add('show');
            setTimeout(function() { document.getElementById('loginError').classList.remove('show'); }, 3000);
        }
    }

    function showDashboard() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.add('visible');
        document.getElementById('facilityNameDisplay').textContent = facilities[currentFacility].name;
        renderAll();
    }

    function logout() {
        sessionStorage.removeItem('gt-facility-auth');
        sessionStorage.removeItem('gt-facility-code');
        document.getElementById('dashboard').classList.remove('visible');
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('facilityCode').value = '';
        document.getElementById('adminPin').value = '';
    }

    function openModal(id) { document.getElementById(id).classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    function showToast(message, isError) {
        var toast = document.getElementById('toast');
        document.getElementById('toastText').textContent = message;
        document.getElementById('toastIcon').textContent = isError ? '‚úó' : '‚úì';
        toast.classList.toggle('error', isError);
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 3000);
    }

    function getTierBadge(level) {
        var tierClass = level <= 2 ? 'practice' : (level === 10 ? 'master' : 'level');
        return '<span class="tier-badge ' + tierClass + '">' + tierList[level - 1] + '</span>';
    }

    function getStatusBadge(status) {
        return '<span class="status-badge ' + status + '">' + status + '</span>';
    }

    function renderAll() {
        renderStats();
        renderCircuitStats();
        renderResidentsTable();
    }

    function renderStats() {
        var activeToday = residents.filter(function(r) { return r.lastActive === '2026-01-09'; }).length;
        var masters = residents.filter(function(r) { return r.c1 === 10 || r.c2 === 10 || r.c3 === 10; }).length;
        var avgTier = residents.reduce(function(sum, r) { return sum + (r.c1 + r.c2 + r.c3) / 3; }, 0) / residents.length;

        document.getElementById('totalResidents').textContent = residents.length;
        document.getElementById('activeToday').textContent = activeToday;
        document.getElementById('avgTier').textContent = avgTier.toFixed(1);
        document.getElementById('totalMasters').textContent = masters;
    }

    function renderCircuitStats() {
        var c1Sum = residents.reduce(function(s, r) { return s + r.c1; }, 0);
        var c1Masters = residents.filter(function(r) { return r.c1 === 10; }).length;
        document.getElementById('c1Avg').textContent = (c1Sum / residents.length).toFixed(1);
        document.getElementById('c1Masters').textContent = c1Masters;

        var c2Sum = residents.reduce(function(s, r) { return s + r.c2; }, 0);
        var c2Masters = residents.filter(function(r) { return r.c2 === 10; }).length;
        document.getElementById('c2Avg').textContent = (c2Sum / residents.length).toFixed(1);
        document.getElementById('c2Masters').textContent = c2Masters;

        var c3Sum = residents.reduce(function(s, r) { return s + r.c3; }, 0);
        var c3Masters = residents.filter(function(r) { return r.c3 === 10; }).length;
        document.getElementById('c3Avg').textContent = (c3Sum / residents.length).toFixed(1);
        document.getElementById('c3Masters').textContent = c3Masters;
    }

    function renderResidentsTable() {
        var html = '';
        residents.forEach(function(r) {
            html += '<tr><td>' + r.name + '</td><td>' + r.room + '</td><td>' + getStatusBadge(r.status) + '</td><td>' + getTierBadge(r.c1) + '</td><td>' + getTierBadge(r.c2) + '</td><td>' + getTierBadge(r.c3) + '</td><td>' + r.lastActive + '</td><td><div class="action-btns"><button class="action-btn" onclick="window.editResident(' + r.id + ')" title="Edit">‚úèÔ∏è</button></div></td></tr>';
        });
        document.getElementById('residentsTable').innerHTML = html;
    }

    function openAddModal() {
        document.getElementById('residentModalTitle').textContent = currentLang === 'es' ? 'AGREGAR RESIDENTE' : 'ADD RESIDENT';
        document.getElementById('residentId').value = '';
        document.getElementById('residentName').value = '';
        document.getElementById('residentRoom').value = '';
        document.getElementById('residentPin').value = '';
        openModal('residentModal');
    }

    window.editResident = function(id) {
        var r = residents.find(function(res) { return res.id === id; });
        if (!r) return;
        document.getElementById('residentModalTitle').textContent = currentLang === 'es' ? 'EDITAR RESIDENTE' : 'EDIT RESIDENT';
        document.getElementById('residentId').value = id;
        document.getElementById('residentName').value = r.name;
        document.getElementById('residentRoom').value = r.room;
        document.getElementById('residentPin').value = r.pin;
        openModal('residentModal');
    };

    function saveResident() {
        var id = document.getElementById('residentId').value;
        var name = document.getElementById('residentName').value.trim();
        var room = document.getElementById('residentRoom').value.trim();
        var pin = document.getElementById('residentPin').value.trim();

        if (!name || !room || pin.length !== 4) {
            showToast(currentLang === 'es' ? 'Completa todos los campos' : 'Fill all fields', true);
            return;
        }

        if (id) {
            var idx = residents.findIndex(function(r) { return r.id === parseInt(id); });
            if (idx > -1) {
                residents[idx].name = name;
                residents[idx].room = room;
                residents[idx].pin = pin;
            }
        } else {
            residents.push({
                id: nextResidentId++,
                name: name,
                room: room,
                pin: pin,
                c1: 1, c2: 1, c3: 1,
                status: 'active',
                lastActive: new Date().toISOString().split('T')[0]
            });
        }

        closeModal('residentModal');
        renderAll();
        showToast(currentLang === 'es' ? 'Guardado' : 'Saved');
    }

    function exportData() {
        var csv = 'Name,Room,Status,Memory,Agility,Tracking,LastActive\n';
        residents.forEach(function(r) {
            csv += r.name + ',' + r.room + ',' + r.status + ',' + tierList[r.c1 - 1] + ',' + tierList[r.c2 - 1] + ',' + tierList[r.c3 - 1] + ',' + r.lastActive + '\n';
        });
        var blob = new Blob([csv], {type: 'text/csv'});
        var a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'facility-residents-export.csv';
        a.click();
        showToast(currentLang === 'es' ? 'Exportado' : 'Exported');
    }

    init();
})();
</script>
</body>
</html>
