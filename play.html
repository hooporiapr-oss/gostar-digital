<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GoTrottersâ„¢ - Join the Team</title>
<meta name="description" content="Join Team GoTrotters. Start your FREE 7-day trial. Performance training with 3 circuits, 10 tiers. $5/month.">
<meta name="keywords" content="performance training, brain games, memory exercises, senior fitness, mental agility, GoTrotters, Team GoTrotters">
<meta name="author" content="GoStar Digital LLC">
<meta name="robots" content="index, follow">
<meta property="og:type" content="website">
<meta property="og:url" content="https://gotrotter.ai/play.html">
<meta property="og:title" content="GoTrottersâ„¢ - Join the Team">
<meta property="og:description" content="Join Team GoTrotters. Start your FREE 7-day trial. Performance training with 3 circuits, 10 tiers.">
<meta property="og:image" content="https://gotrotter.ai/go_chat.png">
<meta property="og:site_name" content="GoTrotters">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="GoTrottersâ„¢ - Join the Team">
<meta name="twitter:description" content="Join Team GoTrotters. Start your FREE 7-day trial. Performance training with 3 circuits, 10 tiers.">
<meta name="twitter:image" content="https://gotrotter.ai/go_chat.png">
<link rel="canonical" href="https://gotrotter.ai/play.html">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-08WZ11ZC5X"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-08WZ11ZC5X');
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B00;--orange-dark:#CC5500;--teal:#00D9A5;--gold:#FFD700;--blue:#3B82F6;--dark:#0a0a0f;--darker:#050508;--card:#111118;--text:#FFFFFF;--muted:#8892a0;--success:#00D9A5;--danger:#FF4757}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text)}
body.es .lang-en{display:none !important}
body.en .lang-es{display:none !important}
.landing{position:fixed;top:0;left:0;right:0;bottom:0;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px;background:radial-gradient(ellipse at center top,rgba(255,107,0,0.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(0,217,165,0.1) 0%,transparent 40%),var(--dark);z-index:1;transition:opacity 0.4s,transform 0.4s}
.landing.hidden{opacity:0;transform:scale(0.95);pointer-events:none}
.lang-toggle{position:absolute;top:20px;right:20px;display:flex;gap:5px}
.lang-btn{padding:8px 14px;border:2px solid var(--orange);background:transparent;color:var(--orange);border-radius:20px;font-family:'Outfit',sans-serif;font-weight:700;font-size:0.8rem;cursor:pointer;transition:all 0.3s}
.lang-btn.active{background:var(--orange);color:var(--dark)}
.logo-section{margin-bottom:30px}
.logo{font-family:'Bebas Neue',sans-serif;font-size:clamp(3.5rem,12vw,5rem);letter-spacing:4px;line-height:1}
.logo .go{color:var(--orange)}
.logo .trotters{color:var(--teal)}
.tagline{font-family:'Bebas Neue',sans-serif;font-size:clamp(1rem,3vw,1.3rem);letter-spacing:3px;color:var(--gold);margin-top:5px}
.hero-icon{width:100px;height:100px;margin-bottom:20px;animation:bounce 2s infinite;border-radius:50%;object-fit:cover}
@keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
.hero-text{max-width:320px;margin-bottom:40px}
.hero-text p{font-size:1.1rem;color:var(--muted);line-height:1.6}
.hero-text strong{color:var(--text)}
.go-btn{padding:22px 60px;font-family:'Bebas Neue',sans-serif;font-size:1.8rem;letter-spacing:5px;background:linear-gradient(135deg,var(--orange) 0%,var(--orange-dark) 100%);color:var(--text);border:none;border-radius:60px;cursor:pointer;box-shadow:0 10px 40px rgba(255,107,0,0.5);transition:all 0.3s;display:flex;align-items:center;gap:12px}
.go-btn:hover{transform:translateY(-4px) scale(1.02);box-shadow:0 15px 50px rgba(255,107,0,0.6)}
.go-btn:active{transform:translateY(0) scale(0.98)}
.go-btn-icon{width:32px;height:32px;border-radius:50%;object-fit:cover}
.footer-text{position:absolute;bottom:25px;font-size:0.75rem;color:var(--muted)}
.footer-text a{color:var(--teal);text-decoration:none}
.chat-screen{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--dark);display:flex;flex-direction:column;z-index:10;opacity:0;transform:translateY(100%);transition:opacity 0.4s,transform 0.4s;pointer-events:none}
.chat-screen.active{opacity:1;transform:translateY(0);pointer-events:auto}
.chat-header{padding:15px 20px;background:linear-gradient(135deg,rgba(255,107,0,0.1),rgba(0,217,165,0.05));border-bottom:2px solid rgba(255,107,0,0.3);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}
.chat-header-left{display:flex;align-items:center;gap:12px}
.chat-avatar{width:45px;height:45px;border-radius:50%;display:flex;align-items:center;justify-content:center;overflow:hidden;background:transparent}
.chat-avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.chat-title{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:2px}
.chat-title .go{color:var(--orange)}
.chat-title .tr{color:var(--teal)}
.chat-subtitle{font-size:0.65rem;color:var(--muted);letter-spacing:1px}
.chat-status{display:flex;align-items:center;gap:6px;font-size:0.7rem;color:var(--teal)}
.chat-dot{width:8px;height:8px;background:var(--teal);border-radius:50%;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.chat-header-right{display:flex;align-items:center;gap:10px}
.chat-lang-btn{padding:6px 12px;border:2px solid var(--orange);background:transparent;color:var(--orange);border-radius:15px;font-weight:700;font-size:0.7rem;cursor:pointer;transition:all 0.3s}
.chat-lang-btn.active{background:var(--orange);color:var(--dark)}
.chat-close{width:36px;height:36px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;color:var(--muted);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.chat-body{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:15px}
.chat-msg{display:flex;gap:10px;max-width:90%;animation:msgIn 0.3s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.chat-msg.bot{align-self:flex-start}
.chat-msg.user{align-self:flex-end;flex-direction:row-reverse}
.chat-msg-avatar{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;overflow:hidden}
.chat-msg-avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.chat-msg.bot .chat-msg-avatar{background:transparent}
.chat-msg.user .chat-msg-avatar{background:var(--blue)}
.chat-msg-bubble{background:var(--card);border:1px solid rgba(255,255,255,0.1);border-radius:18px;padding:14px 18px;font-size:0.95rem;line-height:1.6}
.chat-msg.user .chat-msg-bubble{background:linear-gradient(135deg,var(--blue),#2563EB);border:none}
.chat-msg-bubble strong{color:var(--orange)}
.chat-msg-bubble .highlight{color:var(--teal)}
.chat-options{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
.chat-option{padding:12px 20px;background:rgba(0,217,165,0.1);border:2px solid rgba(0,217,165,0.4);color:var(--teal);border-radius:25px;font-weight:700;font-size:0.85rem;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;gap:8px}
.chat-option:hover{background:rgba(0,217,165,0.2);transform:scale(1.02)}
.chat-option:active{transform:scale(0.98)}
.chat-option.primary{background:linear-gradient(135deg,var(--orange),var(--orange-dark));border:none;color:var(--text)}
.chat-option.secondary{background:rgba(255,107,0,0.1);border:2px solid rgba(255,107,0,0.4);color:var(--orange)}
.chat-typing{display:flex;gap:5px;padding:10px 0}
.chat-typing span{width:10px;height:10px;background:var(--muted);border-radius:50%;animation:typing 1.4s infinite}
.chat-typing span:nth-child(2){animation-delay:0.2s}
.chat-typing span:nth-child(3){animation-delay:0.4s}
@keyframes typing{0%,100%{transform:translateY(0);opacity:0.5}50%{transform:translateY(-8px);opacity:1}}
.chat-input-area{padding:15px 20px;border-top:1px solid rgba(255,255,255,0.1);background:var(--darker);flex-shrink:0;display:none}
.chat-input-area.visible{display:block}
.chat-input-row{display:flex;gap:10px;align-items:center;background:var(--card);border:2px solid rgba(255,255,255,0.1);border-radius:50px;padding:6px 6px 6px 20px}
.chat-input-row:focus-within{border-color:var(--orange)}
.chat-input{flex:1;background:none;border:none;color:var(--text);font-size:1rem;outline:none;font-family:'Outfit',sans-serif}
.chat-input::placeholder{color:var(--muted)}
.chat-send{width:44px;height:44px;background:linear-gradient(135deg,var(--orange),var(--teal));border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chat-send svg{width:20px;height:20px;fill:var(--text)}
.pin-input-container{display:flex;gap:12px;justify-content:center;margin-top:15px}
.pin-digit{width:50px;height:60px;background:var(--card);border:3px solid rgba(255,255,255,0.2);border-radius:12px;font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--text);text-align:center;outline:none;transition:all 0.2s}
.pin-digit:focus{border-color:var(--orange);box-shadow:0 0 20px rgba(255,107,0,0.3)}
.pin-digit.filled{border-color:var(--teal);background:rgba(0,217,165,0.1)}
.pin-submit{margin-top:20px;padding:14px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;background:linear-gradient(135deg,var(--orange),var(--orange-dark));color:var(--text);border:none;border-radius:30px;cursor:pointer;opacity:0.5;pointer-events:none;transition:all 0.3s}
.pin-submit.ready{opacity:1;pointer-events:auto}
.pin-submit.ready:hover{transform:scale(1.05)}
.plan-cards{display:flex;flex-direction:column;gap:12px;margin-top:15px;width:100%}
.plan-card{background:var(--card);border:2px solid rgba(255,255,255,0.1);border-radius:16px;padding:16px;cursor:pointer;transition:all 0.2s;display:flex;justify-content:space-between;align-items:center}
.plan-card:hover{border-color:var(--orange);transform:translateX(5px)}
.plan-card.selected{border-color:var(--teal);background:rgba(0,217,165,0.1)}
.plan-card.popular{border-color:var(--gold)}
.plan-card-left{text-align:left}
.plan-name{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--text);display:flex;align-items:center;gap:8px}
.plan-name .popular-badge{font-size:0.6rem;background:var(--gold);color:var(--dark);padding:3px 8px;border-radius:10px;font-family:'Outfit',sans-serif;font-weight:700}
.plan-desc{font-size:0.75rem;color:var(--muted);margin-top:4px}
.plan-price{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--orange)}
.plan-price span{font-size:0.8rem;color:var(--muted)}
.billing-toggle{display:flex;gap:8px;margin-top:15px;justify-content:center}
.billing-btn{padding:10px 20px;background:var(--card);border:2px solid rgba(255,255,255,0.1);border-radius:20px;color:var(--muted);font-weight:700;font-size:0.8rem;cursor:pointer;transition:all 0.2s}
.billing-btn.active{border-color:var(--teal);background:rgba(0,217,165,0.1);color:var(--teal)}
.billing-btn .save-badge{font-size:0.65rem;background:var(--success);color:var(--dark);padding:2px 6px;border-radius:8px;margin-left:6px}
.subscribe-btn{margin-top:20px;padding:16px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;background:linear-gradient(135deg,var(--orange),var(--orange-dark));color:var(--text);border:none;border-radius:30px;cursor:pointer;box-shadow:0 5px 25px rgba(255,107,0,0.4);transition:all 0.3s;opacity:0.5;pointer-events:none}
.subscribe-btn.ready{opacity:1;pointer-events:auto}
.subscribe-btn.ready:hover{transform:scale(1.05);box-shadow:0 8px 30px rgba(255,107,0,0.5)}
.subscribe-btn.loading{opacity:0.7;pointer-events:none}
.terms-section{margin-top:20px;text-align:left;font-size:0.85rem}
.terms-check{display:flex;align-items:flex-start;gap:10px;margin-bottom:10px;cursor:pointer}
.terms-check input{display:none}
.terms-checkbox{width:22px;height:22px;border:2px solid var(--muted);border-radius:6px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.2s;background:var(--darker)}
.terms-check input:checked + .terms-checkbox{background:var(--teal);border-color:var(--teal)}
.terms-check input:checked + .terms-checkbox::after{content:'âœ“';color:var(--dark);font-weight:700;font-size:0.9rem}
.terms-label{color:var(--muted);line-height:1.4}
.terms-label a{color:var(--teal);text-decoration:underline}
.terms-label a:hover{color:var(--orange)}
.trial-badge{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);border-radius:20px;font-size:0.8rem;color:var(--gold);margin-top:10px}
.status-badge{display:inline-flex;align-items:center;gap:6px;padding:8px 16px;border-radius:20px;font-size:0.8rem;margin-top:10px}
.status-badge.active{background:rgba(0,217,165,0.1);border:1px solid rgba(0,217,165,0.3);color:var(--teal)}
.status-badge.trialing{background:rgba(255,215,0,0.1);border:1px solid rgba(255,215,0,0.3);color:var(--gold)}
.pin-display{background:linear-gradient(135deg,rgba(0,217,165,0.2),rgba(255,107,0,0.2));border:3px solid var(--teal);border-radius:20px;padding:25px;margin:15px 0;text-align:center}
.pin-display-label{font-size:0.85rem;color:var(--muted);margin-bottom:10px;letter-spacing:1px}
.pin-display-value{font-family:'Bebas Neue',sans-serif;font-size:3.5rem;letter-spacing:15px;color:var(--teal);text-shadow:0 0 30px rgba(0,217,165,0.5)}
.pin-display-note{font-size:0.75rem;color:var(--gold);margin-top:10px}
.email-input-container{margin-top:15px}
.email-input{width:100%;padding:14px 20px;background:var(--card);border:2px solid rgba(255,255,255,0.2);border-radius:12px;font-family:'Outfit',sans-serif;font-size:1rem;color:var(--text);outline:none;transition:all 0.2s}
.email-input:focus{border-color:var(--orange);box-shadow:0 0 20px rgba(255,107,0,0.2)}
.email-input::placeholder{color:var(--muted)}
.email-submit{margin-top:15px;padding:14px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;background:linear-gradient(135deg,var(--orange),var(--orange-dark));color:var(--text);border:none;border-radius:30px;cursor:pointer;transition:all 0.3s}
.email-submit:hover{transform:scale(1.05)}
.email-submit.loading{opacity:0.7;pointer-events:none}
.success-burst{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:6rem;z-index:100;animation:burst 0.8s ease-out forwards;pointer-events:none}
@keyframes burst{0%{opacity:1;transform:translate(-50%,-50%) scale(0.5)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.2)}100%{opacity:0;transform:translate(-50%,-50%) scale(1.5)}}
@media(max-width:400px){
.go-btn{padding:18px 45px;font-size:1.5rem}
.pin-digit{width:45px;height:55px;font-size:1.8rem}
.plan-card{padding:12px}
.pin-display-value{font-size:2.8rem;letter-spacing:10px}
}
</style>
</head>
<body class="en">
<div class="landing" id="landing">
<div class="lang-toggle">
<button class="lang-btn active" data-lang="en">EN</button>
<button class="lang-btn" data-lang="es">ES</button>
</div>
<div class="logo-section">
<div class="logo"><span class="go">GO</span><span class="trotters">TROTTERS</span><sup style="font-size:0.3em;vertical-align:super;">â„¢</sup></div>
<div class="tagline">TEAM GOTROTTERS</div>
</div>
<img src="go_chat.png" alt="GoTrotters" class="hero-icon">
<div class="hero-text">
<p><span class="lang-en"><strong>3 Circuits. 10 Tiers.</strong> Performance Training. $5/month.</span><span class="lang-es"><strong>3 Circuitos. 10 Niveles.</strong> Entrenamiento de Rendimiento. $5/mes.</span></p>
</div>
<button class="go-btn" id="goBtn">
<img src="go_chat.png" alt="" class="go-btn-icon">
<span class="lang-en">JOIN THE TEAM</span><span class="lang-es">ÃšNETE AL EQUIPO</span>
</button>
<div class="footer-text">
<span class="lang-en">Powered by</span><span class="lang-es">Impulsado por</span> <a href="https://gostar.digital">GoStar Digital</a> ğŸŒ´
</div>
</div>
<div class="chat-screen" id="chatScreen">
<div class="chat-header">
<div class="chat-header-left">
<div class="chat-avatar"><img src="go_chat.png" alt="GoTrotter AI" class="chat-avatar-img"></div>
<div>
<div class="chat-title"><span class="go">GO</span><span class="tr">TROTTER</span>â„¢ AI</div>
<div class="chat-subtitle">Coach, Team GoTrotters</div>
<div class="chat-status"><span class="chat-dot"></span><span class="lang-en">Online</span><span class="lang-es">En LÃ­nea</span></div>
</div>
</div>
<div class="chat-header-right">
<button class="chat-lang-btn active" data-lang="en">EN</button>
<button class="chat-lang-btn" data-lang="es">ES</button>
<button class="chat-close" id="chatClose">Ã—</button>
</div>
</div>
<div class="chat-body" id="chatBody"></div>
<div class="chat-input-area" id="chatInputArea">
<div class="chat-input-row">
<input type="text" class="chat-input" id="chatInput" maxlength="100">
<button class="chat-send" id="chatSend">
<svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
</button>
</div>
</div>
</div>
<script>
(function() {
    var lang = localStorage.getItem('gt-lang') || 'en';
    function setLang(l) {
        lang = l;
        localStorage.setItem('gt-lang', l);
        document.body.className = l;
        document.querySelectorAll('.lang-btn, .chat-lang-btn').forEach(function(b) {
            b.classList.toggle('active', b.dataset.lang === l);
        });
    }
    setLang(lang);
    document.querySelectorAll('.lang-btn, .chat-lang-btn').forEach(function(b) {
        b.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            setLang(this.dataset.lang);
        });
    });
    var landing = document.getElementById('landing');
    var chatScreen = document.getElementById('chatScreen');
    var chatBody = document.getElementById('chatBody');
    var chatInputArea = document.getElementById('chatInputArea');
    var chatInput = document.getElementById('chatInput');
    var chatSend = document.getElementById('chatSend');
    var goBtn = document.getElementById('goBtn');
    var chatClose = document.getElementById('chatClose');
    var currentFlow = null;
    var currentStep = null;
    var tempData = {};
    var selectedPlan = 'individual';
    var selectedBilling = 'monthly';
    function getUser() {
        try { return JSON.parse(localStorage.getItem('gotrotter-user')) || null; }
        catch(e) { return null; }
    }
    function saveUser(data) {
        localStorage.setItem('gotrotter-user', JSON.stringify(data));
    }
    function setSession(name, pin) {
        sessionStorage.setItem('gostar-user-pin', pin);
        sessionStorage.setItem('gostar-user-name', name);
    }
    function bi(en, es) {
        return '<span class="lang-en">' + en + '</span><span class="lang-es">' + es + '</span>';
    }
    function addMsg(content, isUser, options) {
        var msg = document.createElement('div');
        msg.className = 'chat-msg ' + (isUser ? 'user' : 'bot');
        var avatarContent = isUser ? 'ğŸ‘¤' : '<img src="go_chat.png" class="chat-msg-avatar-img">';
        var html = '<div class="chat-msg-avatar">' + avatarContent + '</div>';
        html += '<div class="chat-msg-bubble">' + content;
        if (options && options.length) {
            html += '<div class="chat-options">';
            options.forEach(function(opt) {
                var cls = 'chat-option';
                if (opt.primary) cls += ' primary';
                if (opt.secondary) cls += ' secondary';
                var label = opt.labelEn ? bi(opt.labelEn, opt.labelEs) : opt.label;
                html += '<button class="' + cls + '" data-action="' + opt.action + '">' + label + '</button>';
            });
            html += '</div>';
        }
        html += '</div>';
        msg.innerHTML = html;
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
        msg.querySelectorAll('.chat-option').forEach(function(btn) {
            btn.addEventListener('click', function() {
                handleOption(this.dataset.action);
            });
        });
    }
    function addTyping() {
        var msg = document.createElement('div');
        msg.className = 'chat-msg bot';
        msg.id = 'typingMsg';
        msg.innerHTML = '<div class="chat-msg-avatar"><img src="go_chat.png" class="chat-msg-avatar-img"></div><div class="chat-msg-bubble"><div class="chat-typing"><span></span><span></span><span></span></div></div>';
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
    }
    function removeTyping() {
        var t = document.getElementById('typingMsg');
        if (t) t.remove();
    }
    function botSay(content, options, delay) {
        delay = delay || 800;
        addTyping();
        setTimeout(function() {
            removeTyping();
            addMsg(content, false, options);
        }, delay);
    }
    function showInput(placeholderEn, placeholderEs) {
        chatInputArea.classList.add('visible');
        chatInput.placeholder = lang === 'es' ? (placeholderEs || 'Escribe aquÃ­...') : (placeholderEn || 'Type here...');
        chatInput.value = '';
        setTimeout(function() { chatInput.focus(); }, 100);
    }
    function hideInput() {
        chatInputArea.classList.remove('visible');
    }
    function addPinInput() {
        var msg = document.createElement('div');
        msg.className = 'chat-msg bot';
        msg.innerHTML = '<div class="chat-msg-avatar"><img src="go_chat.png" class="chat-msg-avatar-img"></div><div class="chat-msg-bubble">' +
            '<div class="pin-input-container">' +
            '<input type="tel" class="pin-digit" maxlength="1" data-idx="0">' +
            '<input type="tel" class="pin-digit" maxlength="1" data-idx="1">' +
            '<input type="tel" class="pin-digit" maxlength="1" data-idx="2">' +
            '<input type="tel" class="pin-digit" maxlength="1" data-idx="3">' +
            '</div>' +
            '<button class="pin-submit" id="pinSubmit">' + bi("LET'S GO!", "PA'LANTE!") + '</button>' +
            '<div style="margin-top:15px;"><a href="#" class="forgot-pin-link" style="color:var(--muted);font-size:0.8rem;text-decoration:underline;">' + bi('Forgot PIN?', 'Â¿Olvidaste tu PIN?') + '</a></div>' +
            '</div>';
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
        var digits = msg.querySelectorAll('.pin-digit');
        var submitBtn = msg.querySelector('#pinSubmit');
        var forgotLink = msg.querySelector('.forgot-pin-link');
        function checkComplete() {
            var pin = '';
            digits.forEach(function(d) { pin += d.value; });
            submitBtn.classList.toggle('ready', pin.length === 4);
        }
        digits.forEach(function(d, i) {
            d.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                if (this.value && i < 3) digits[i + 1].focus();
                this.classList.toggle('filled', this.value !== '');
                checkComplete();
            });
            d.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && !this.value && i > 0) digits[i - 1].focus();
            });
        });
        submitBtn.addEventListener('click', function() {
            if (!this.classList.contains('ready')) return;
            var pin = '';
            digits.forEach(function(d) { pin += d.value; });
            handlePinSubmit(pin);
        });
        forgotLink.addEventListener('click', function(e) {
            e.preventDefault();
            addForgotPinInput();
        });
        setTimeout(function() { digits[0].focus(); }, 100);
    }
    function addForgotPinInput() {
        var msg = document.createElement('div');
        msg.className = 'chat-msg bot';
        msg.innerHTML = '<div class="chat-msg-avatar"><img src="go_chat.png" class="chat-msg-avatar-img"></div><div class="chat-msg-bubble">' +
            bi(
                'ğŸ”‘ <strong>No problem!</strong><br><br>Enter your email to recover your PIN:',
                'ğŸ”‘ <strong>Â¡No hay problema!</strong><br><br>Ingresa tu email para recuperar tu PIN:'
            ) +
            '<div class="email-input-container">' +
            '<input type="email" class="email-input" id="forgotEmailInput" placeholder="' + (lang === 'es' ? 'tu@email.com' : 'your@email.com') + '">' +
            '<button class="email-submit" id="forgotEmailSubmit">' + bi('RECOVER PIN', 'RECUPERAR PIN') + '</button>' +
            '</div>' +
            '</div>';
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
        var emailInput = msg.querySelector('#forgotEmailInput');
        var emailSubmit = msg.querySelector('#forgotEmailSubmit');
        emailInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') handleForgotPinLookup(this.value);
        });
        emailSubmit.addEventListener('click', function() {
            handleForgotPinLookup(emailInput.value);
        });
        setTimeout(function() { emailInput.focus(); }, 100);
    }
    function handleForgotPinLookup(email) {
        email = email.trim().toLowerCase();
        if (!email || !email.includes('@')) {
            alert(lang === 'es' ? 'Por favor ingresa un email vÃ¡lido' : 'Please enter a valid email');
            return;
        }
        var submitBtn = document.getElementById('forgotEmailSubmit');
        if (submitBtn) {
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = bi('LOADING...', 'CARGANDO...');
        }
        fetch('/api/stripe/status/' + encodeURIComponent(email))
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.subscribed && data.pin) {
                    showPinDisplay(data.pin, email, data.plan_type, data.status);
                } else {
                    botSay(bi(
                        'âŒ No subscription found for that email.<br><br>Make sure you entered the correct email.',
                        'âŒ No se encontrÃ³ suscripciÃ³n para ese email.<br><br>AsegÃºrate de ingresar el email correcto.'
                    ), [
                        {labelEn: 'ğŸ”„ Try Again', labelEs: 'ğŸ”„ Intentar de Nuevo', action: 'forgot_pin'},
                        {labelEn: 'ğŸ†• Subscribe', labelEs: 'ğŸ†• Suscribirme', action: 'new'}
                    ], 600);
                }
            })
            .catch(function(err) {
                console.error('Forgot PIN lookup error:', err);
                botSay(bi('âŒ Connection error. Please try again.', 'âŒ Error de conexiÃ³n. Por favor intenta de nuevo.'), [
                    {labelEn: 'ğŸ”„ Try Again', labelEs: 'ğŸ”„ Intentar de Nuevo', action: 'forgot_pin'}
                ], 600);
            });
    }
    function addEmailInput() {
        var msg = document.createElement('div');
        msg.className = 'chat-msg bot';
        msg.innerHTML = '<div class="chat-msg-avatar"><img src="go_chat.png" class="chat-msg-avatar-img"></div><div class="chat-msg-bubble">' +
            bi(
                'ğŸ‰ <strong>WELCOME TO TEAM GOTROTTERS!</strong><br><br>Your <strong>7-day free trial</strong> has started!<br><br>Enter the email you used at checkout to get your PIN:',
                'ğŸ‰ <strong>Â¡BIENVENIDO A TEAM GOTROTTERS!</strong><br><br>Â¡Tu <strong>prueba gratis de 7 dÃ­as</strong> ha comenzado!<br><br>Ingresa el email que usaste en el pago para obtener tu PIN:'
            ) +
            '<div class="email-input-container">' +
            '<input type="email" class="email-input" id="emailInput" placeholder="' + (lang === 'es' ? 'tu@email.com' : 'your@email.com') + '">' +
            '<button class="email-submit" id="emailSubmit">' + bi('GET MY PIN', 'OBTENER MI PIN') + '</button>' +
            '</div>' +
            '</div>';
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
        var emailInput = msg.querySelector('#emailInput');
        var emailSubmit = msg.querySelector('#emailSubmit');
        emailInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') handleEmailLookup(this.value);
        });
        emailSubmit.addEventListener('click', function() {
            handleEmailLookup(emailInput.value);
        });
        setTimeout(function() { emailInput.focus(); }, 100);
    }
    function handleEmailLookup(email) {
        email = email.trim().toLowerCase();
        if (!email || !email.includes('@')) {
            alert(lang === 'es' ? 'Por favor ingresa un email vÃ¡lido' : 'Please enter a valid email');
            return;
        }
        var submitBtn = document.getElementById('emailSubmit');
        if (submitBtn) {
            submitBtn.classList.add('loading');
            submitBtn.innerHTML = bi('LOADING...', 'CARGANDO...');
        }
        fetch('/api/stripe/status/' + encodeURIComponent(email))
            .then(function(res) { return res.json(); })
            .then(function(data) {
                if (data.subscribed && data.pin) {
                    showPinDisplay(data.pin, email, data.plan, data.status);
                } else {
                    botSay(bi(
                        'âŒ No subscription found for that email.<br><br>Make sure you entered the same email you used at checkout.',
                        'âŒ No se encontrÃ³ suscripciÃ³n para ese email.<br><br>AsegÃºrate de ingresar el mismo email que usaste en el pago.'
                    ), [
                        {labelEn: 'ğŸ”„ Try Again', labelEs: 'ğŸ”„ Intentar de Nuevo', action: 'retry_email'},
                        {labelEn: 'ğŸ†• Subscribe', labelEs: 'ğŸ†• Suscribirme', action: 'new'}
                    ], 600);
                }
            })
            .catch(function(err) {
                console.error('Email lookup error:', err);
                botSay(bi('âŒ Connection error. Please try again.', 'âŒ Error de conexiÃ³n. Por favor intenta de nuevo.'), [
                    {labelEn: 'ğŸ”„ Try Again', labelEs: 'ğŸ”„ Intentar de Nuevo', action: 'retry_email'}
                ], 600);
            });
    }
    function showPinDisplay(pin, email, plan, status) {
        var userData = { email: email, pin: pin, plan: plan, type: 'subscriber' };
        saveUser(userData);
        setSession(email, pin);
        showSuccess('ğŸ‰');
        var statusText = status === 'trialing' ? bi('ğŸ†“ FREE TRIAL ACTIVE', 'ğŸ†“ PRUEBA GRATIS ACTIVA') : bi('âœ… SUBSCRIPTION ACTIVE', 'âœ… SUSCRIPCIÃ“N ACTIVA');
        var msg = document.createElement('div');
        msg.className = 'chat-msg bot';
        msg.innerHTML = '<div class="chat-msg-avatar"><img src="go_chat.png" class="chat-msg-avatar-img"></div><div class="chat-msg-bubble">' +
            '<div class="pin-display">' +
            '<div class="pin-display-label">' + bi('YOUR LOGIN PIN', 'TU PIN DE ACCESO') + '</div>' +
            '<div class="pin-display-value">' + pin + '</div>' +
            '<div class="pin-display-note">ğŸ“ ' + bi('Save this PIN!', 'Â¡Guarda este PIN!') + '</div>' +
            '</div>' +
            '<div class="status-badge ' + status + '">' + statusText + '</div>' +
            '<div class="chat-options">' +
            '<button class="chat-option primary" data-action="start_training">' + bi("ğŸ€ LET'S GO!", "ğŸ€ PA'LANTE!") + '</button>' +
            '</div>' +
            '</div>';
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
        msg.querySelectorAll('.chat-option').forEach(function(btn) {
            btn.addEventListener('click', function() { handleOption(this.dataset.action); });
        });
    }
    function addPlanSelector() {
        var msg = document.createElement('div');
        msg.className = 'chat-msg bot';
        msg.innerHTML = '<div class="chat-msg-avatar"><img src="go_chat.png" class="chat-msg-avatar-img"></div><div class="chat-msg-bubble">' +
            '<div class="billing-toggle">' +
            '<button class="billing-btn active" data-billing="monthly">' + bi('Monthly', 'Mensual') + '</button>' +
            '<button class="billing-btn" data-billing="annual">' + bi('Annual', 'Anual') + '<span class="save-badge">' + bi('SAVE $10', 'AHORRA $10') + '</span></button>' +
            '</div>' +
            '<div class="plan-cards" id="planCards">' +
            '<div class="plan-card selected" data-plan="individual">' +
            '<div class="plan-card-left"><div class="plan-name">ğŸ€ ' + bi('GOTROTTERS', 'GOTROTTERS') + '</div>' +
            '<div class="plan-desc">' + bi('3 circuits â€¢ 10 tiers â€¢ Full access', '3 circuitos â€¢ 10 niveles â€¢ Acceso completo') + '</div></div>' +
            '<div class="plan-price" id="priceIndividual">$5<span>/mo</span></div>' +
            '</div>' +
            '</div>' +
            '<div class="trial-badge">ğŸ†“ ' + bi('7-DAY FREE TRIAL', '7 DÃAS GRATIS') + '</div>' +
            '<div class="terms-section">' +
            '<label class="terms-check"><input type="checkbox" id="termsCheck"><span class="terms-checkbox"></span><span class="terms-label">' + bi('I agree to <a href="/terms.html" target="_blank">Terms</a> & <a href="/privacy.html" target="_blank">Privacy</a>', 'Acepto <a href="/terms.html" target="_blank">TÃ©rminos</a> y <a href="/privacy.html" target="_blank">Privacidad</a>') + '</span></label>' +
            '</div>' +
            '<button class="subscribe-btn" id="subscribeBtn">' + bi('START FREE TRIAL â†’', 'COMENZAR PRUEBA â†’') + '</button>' +
            '</div>';
        chatBody.appendChild(msg);
        chatBody.scrollTop = chatBody.scrollHeight;
        var billingBtns = msg.querySelectorAll('.billing-btn');
        var subscribeBtn = msg.querySelector('#subscribeBtn');
        var priceIndividual = msg.querySelector('#priceIndividual');
        var termsCheck = msg.querySelector('#termsCheck');
        
        termsCheck.addEventListener('change', function() {
            subscribeBtn.classList.toggle('ready', termsCheck.checked);
        });
        
        function updatePrices() {
            priceIndividual.innerHTML = selectedBilling === 'monthly' ? '$5<span>/mo</span>' : '$50<span>/yr</span>';
        }
        billingBtns.forEach(function(btn) {
            btn.addEventListener('click', function() {
                billingBtns.forEach(function(b) { b.classList.remove('active'); });
                this.classList.add('active');
                selectedBilling = this.dataset.billing;
                updatePrices();
            });
        });
        subscribeBtn.addEventListener('click', function() { 
            if (!termsCheck.checked) {
                alert(lang === 'es' ? 'Por favor acepta los TÃ©rminos y Privacidad' : 'Please accept Terms & Privacy');
                return;
            }
            handleSubscribe(); 
        });
    }
    function showSuccess(emoji) {
        var burst = document.createElement('div');
        burst.className = 'success-burst';
        burst.textContent = emoji || 'ğŸ€';
        document.body.appendChild(burst);
        setTimeout(function() { burst.remove(); }, 800);
    }
    function goToGameHub() {
        showSuccess('ğŸ†');
        setTimeout(function() { window.location.href = 'game-hub.html'; }, 1000);
    }
    function handleSubscribe() {
        var subscribeBtn = document.getElementById('subscribeBtn');
        if (subscribeBtn) {
            subscribeBtn.classList.add('loading');
            subscribeBtn.innerHTML = bi('LOADING...', 'CARGANDO...');
        }
        fetch('/api/stripe/checkout', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ plan: selectedPlan, billing: selectedBilling })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.url) {
                window.location.href = data.url;
            } else {
                alert(lang === 'es' ? 'Error al crear la sesiÃ³n de pago' : 'Error creating checkout session');
                if (subscribeBtn) {
                    subscribeBtn.classList.remove('loading');
                    subscribeBtn.innerHTML = bi('START FREE TRIAL', 'COMENZAR PRUEBA GRATIS');
                }
            }
        })
        .catch(function(err) {
            console.error('Checkout error:', err);
            alert(lang === 'es' ? 'Error de conexiÃ³n' : 'Connection error');
            if (subscribeBtn) {
                subscribeBtn.classList.remove('loading');
                subscribeBtn.innerHTML = bi('START FREE TRIAL', 'COMENZAR PRUEBA GRATIS');
            }
        });
    }
    
    // ========== UPDATED: Auto-fetch PIN using session_id ==========
    function checkUrlParams() {
        var params = new URLSearchParams(window.location.search);
        
        if (params.get('success') === 'true') {
            var sessionId = params.get('session_id');
            window.history.replaceState({}, '', window.location.pathname);
            
            setTimeout(function() {
                openChat();
                setTimeout(function() {
                    // Show loading message
                    addMsg(bi(
                        'ğŸ‰ <strong>PAYMENT SUCCESSFUL!</strong><br><br>Loading your account...',
                        'ğŸ‰ <strong>Â¡PAGO EXITOSO!</strong><br><br>Cargando tu cuenta...'
                    ), false);
                    addTyping();
                    
                    // If we have session_id, auto-fetch PIN (no email needed!)
                    if (sessionId) {
                        fetchPinBySession(sessionId);
                    } else {
                        // Fallback to email input
                        removeTyping();
                        addEmailInput();
                    }
                }, 500);
            }, 300);
            return true;
        }
        
        if (params.get('canceled') === 'true') {
            window.history.replaceState({}, '', window.location.pathname);
            setTimeout(function() {
                openChat();
                setTimeout(function() {
                    addMsg(bi('No worries! ğŸ€ You can start anytime.', 'Â¡Sin problema! ğŸ€ Puedes comenzar cuando quieras.'), false, [
                        {labelEn: 'ğŸ€ TELL ME MORE', labelEs: 'ğŸ€ CUÃ‰NTAME MÃS', action: 'learn_more', primary: true},
                        {labelEn: 'ğŸ”‘ I Have PIN', labelEs: 'ğŸ”‘ Tengo PIN', action: 'returning'}
                    ]);
                }, 500);
            }, 300);
            return true;
        }
        return false;
    }
    
    // ========== NEW: Fetch PIN by Stripe Session ID ==========
    function fetchPinBySession(sessionId) {
        var retryCount = 0;
        var maxRetries = 5;
        
        function attemptFetch() {
            fetch('/api/stripe/session/' + sessionId)
                .then(function(res) { return res.json(); })
                .then(function(data) {
                    removeTyping();
                    
                    if (data.success && data.pin) {
                        // SUCCESS! Show PIN automatically
                        showPinDisplay(data.pin, data.email, data.plan_type, data.status);
                    } else if (data.email && !data.success && retryCount < maxRetries) {
                        // Webhook might still be processing, retry
                        retryCount++;
                        addMsg(bi(
                            'â³ Setting up your account... (' + retryCount + '/' + maxRetries + ')',
                            'â³ Configurando tu cuenta... (' + retryCount + '/' + maxRetries + ')'
                        ), false);
                        addTyping();
                        setTimeout(attemptFetch, 2000);
                    } else if (data.email) {
                        // Have email but no subscriber yet - try one more lookup
                        addMsg(bi(
                            'â³ Almost there! Checking your account...',
                            'â³ Â¡Casi listo! Verificando tu cuenta...'
                        ), false);
                        handleEmailLookup(data.email);
                    } else {
                        // No email found - fallback to manual entry
                        addEmailInput();
                    }
                })
                .catch(function(err) {
                    removeTyping();
                    console.error('Session lookup error:', err);
                    // Fallback to email input
                    addEmailInput();
                });
        }
        
        attemptFetch();
    }
    
    function openChat() {
        landing.classList.add('hidden');
        chatScreen.classList.add('active');
        chatBody.innerHTML = '';
        hideInput();
        var user = getUser();
        if (user && user.pin && user.type === 'subscriber') {
            setTimeout(function() {
                addMsg(bi('Hey! ğŸ€ Welcome back to <strong>Team GoTrotters</strong>!', 'Â¡Hola! ğŸ€ Â¡Bienvenido de vuelta a <strong>Team GoTrotters</strong>!'), false);
                currentFlow = 'subscriber';
                currentStep = 'ask_pin';
                botSay(bi('Enter your PIN to continue:', 'Ingresa tu PIN para continuar:'), null, 600);
                setTimeout(addPinInput, 1500);
            }, 400);
        } else {
            setTimeout(function() {
                addMsg(bi('Hey! ğŸ€ I\'m <strong>GoTrotterâ„¢ AI</strong> â€” your Coach.', 'Â¡QuÃ© pasa! ğŸ€ Soy <strong>GoTrotterâ„¢ AI</strong> â€” tu Coach.'), false);
                botSay(bi('Ready to train your mind like an athlete? ğŸ’ª', 'Â¿Listo para entrenar tu mente como atleta? ğŸ’ª'), [
                    {labelEn: 'ğŸ€ TELL ME MORE', labelEs: 'ğŸ€ CUÃ‰NTAME MÃS', action: 'learn_more', primary: true},
                    {labelEn: 'ğŸ”‘ I Have PIN', labelEs: 'ğŸ”‘ Tengo PIN', action: 'returning'}
                ], 600);
            }, 400);
        }
    }
    function handleOption(action) {
        document.querySelectorAll('.chat-option').forEach(function(b) {
            b.style.pointerEvents = 'none';
            b.style.opacity = '0.5';
        });
        switch(action) {
            case 'learn_more':
                currentFlow = 'sales';
                botSay(bi(
                    'ğŸ¯ <strong>GOTROTTERS PERFORMANCE TRAINING</strong><br><br>' +
                    'Train your brain with 3 powerful circuits:<br><br>' +
                    'ğŸ§  <strong>MAP</strong> â€” Memory & patterns<br>' +
                    'âš¡ <strong>MOVE</strong> â€” Speed & recall<br>' +
                    'ğŸ‘ï¸ <strong>MATCH</strong> â€” Focus & sequence<br><br>' +
                    'Progress through <strong>10 tiers</strong> â€” from Rookie to Elite! ğŸ†',
                    'ğŸ¯ <strong>ENTRENAMIENTO GOTROTTERS</strong><br><br>' +
                    'Entrena tu cerebro con 3 circuitos poderosos:<br><br>' +
                    'ğŸ§  <strong>MAP</strong> â€” Memoria y patrones<br>' +
                    'âš¡ <strong>MOVE</strong> â€” Velocidad y memoria<br>' +
                    'ğŸ‘ï¸ <strong>MATCH</strong> â€” Enfoque y secuencia<br><br>' +
                    'Â¡Progresa a travÃ©s de <strong>10 niveles</strong> â€” de Novato a Ã‰lite! ğŸ†'
                ), [
                    {labelEn: 'ğŸ’° WHAT\'S THE PRICE?', labelEs: 'ğŸ’° Â¿CUÃL ES EL PRECIO?', action: 'show_price', primary: true}
                ], 800);
                break;
            case 'show_price':
                currentFlow = 'sales';
                botSay(bi(
                    'ğŸ’ª <strong>SIMPLE PRICING</strong><br><br>' +
                    'â€¢ <strong>$5/month</strong> â€” cancel anytime<br>' +
                    'â€¢ <strong>$50/year</strong> â€” save $10! ğŸ‰<br><br>' +
                    'ğŸ†“ <strong>7-DAY FREE TRIAL</strong> included!<br><br>' +
                    'No credit card until trial ends. Train free for a week!',
                    'ğŸ’ª <strong>PRECIO SIMPLE</strong><br><br>' +
                    'â€¢ <strong>$5/mes</strong> â€” cancela cuando quieras<br>' +
                    'â€¢ <strong>$50/aÃ±o</strong> â€” Â¡ahorra $10! ğŸ‰<br><br>' +
                    'ğŸ†“ <strong>7 DÃAS DE PRUEBA GRATIS</strong> incluidos!<br><br>' +
                    'Sin tarjeta hasta que termine la prueba. Â¡Entrena gratis por una semana!'
                ), [
                    {labelEn: 'ğŸš€ START FREE TRIAL', labelEs: 'ğŸš€ COMENZAR PRUEBA', action: 'new', primary: true},
                    {labelEn: 'â“ I HAVE QUESTIONS', labelEs: 'â“ TENGO PREGUNTAS', action: 'questions'}
                ], 800);
                break;
            case 'questions':
                currentFlow = 'sales';
                botSay(bi(
                    'ğŸ’¬ What would you like to know?',
                    'ğŸ’¬ Â¿QuÃ© te gustarÃ­a saber?'
                ), [
                    {labelEn: 'ğŸ§  How does it work?', labelEs: 'ğŸ§  Â¿CÃ³mo funciona?', action: 'q_how'},
                    {labelEn: 'ğŸ‘´ Is it for seniors?', labelEs: 'ğŸ‘´ Â¿Es para mayores?', action: 'q_who'},
                    {labelEn: 'ğŸ¢ Group pricing?', labelEs: 'ğŸ¢ Â¿Precio grupal?', action: 'q_groups'},
                    {labelEn: 'ğŸš€ Ready to start!', labelEs: 'ğŸš€ Â¡Listo para comenzar!', action: 'new'}
                ], 600);
                break;
            case 'q_how':
                botSay(bi(
                    'ğŸ® <strong>HOW IT WORKS</strong><br><br>' +
                    '1ï¸âƒ£ Pick a circuit (MAP, MOVE, or MATCH)<br>' +
                    '2ï¸âƒ£ Complete challenges at your level<br>' +
                    '3ï¸âƒ£ Earn your way through 10 tiers<br>' +
                    '4ï¸âƒ£ Track your progress<br><br>' +
                    'Each session is 5-10 minutes. Train daily for best results! ğŸ€',
                    'ğŸ® <strong>CÃ“MO FUNCIONA</strong><br><br>' +
                    '1ï¸âƒ£ Elige un circuito (MAP, MOVE o MATCH)<br>' +
                    '2ï¸âƒ£ Completa desafÃ­os a tu nivel<br>' +
                    '3ï¸âƒ£ Gana tu camino por 10 niveles<br>' +
                    '4ï¸âƒ£ Sigue tu progreso<br><br>' +
                    'Cada sesiÃ³n es de 5-10 minutos. Â¡Entrena diario para mejores resultados! ğŸ€'
                ), [
                    {labelEn: 'ğŸš€ START FREE TRIAL', labelEs: 'ğŸš€ COMENZAR PRUEBA', action: 'new', primary: true},
                    {labelEn: 'â“ More questions', labelEs: 'â“ MÃ¡s preguntas', action: 'questions'}
                ], 600);
                break;
            case 'q_who':
                botSay(bi(
                    'ğŸ‘¥ <strong>FOR EVERYONE!</strong><br><br>' +
                    'âœ… Seniors â€” stay sharp<br>' +
                    'âœ… Rehab patients â€” rebuild skills<br>' +
                    'âœ… Students â€” boost focus<br>' +
                    'âœ… Anyone â€” train your brain<br><br>' +
                    'Big buttons. Clear visuals. Bilingual. Easy to use! ğŸ¯',
                    'ğŸ‘¥ <strong>Â¡PARA TODOS!</strong><br><br>' +
                    'âœ… Adultos mayores â€” mantente activo<br>' +
                    'âœ… RehabilitaciÃ³n â€” reconstruye habilidades<br>' +
                    'âœ… Estudiantes â€” mejora el enfoque<br>' +
                    'âœ… Cualquiera â€” entrena tu cerebro<br><br>' +
                    'Botones grandes. Visuales claros. BilingÃ¼e. Â¡FÃ¡cil de usar! ğŸ¯'
                ), [
                    {labelEn: 'ğŸš€ START FREE TRIAL', labelEs: 'ğŸš€ COMENZAR PRUEBA', action: 'new', primary: true},
                    {labelEn: 'â“ More questions', labelEs: 'â“ MÃ¡s preguntas', action: 'questions'}
                ], 600);
                break;
            case 'q_groups':
                botSay(bi(
                    'ğŸ¢ <strong>SAME PRICE FOR EVERYONE!</strong><br><br>' +
                    'â€¢ $5/month per person<br>' +
                    'â€¢ $50/year per person (save $10)<br><br>' +
                    'Rehab center? Senior facility? Homeschool? <br><br>' +
                    'Just sign up each user. Simple! ğŸ’ª',
                    'ğŸ¢ <strong>Â¡MISMO PRECIO PARA TODOS!</strong><br><br>' +
                    'â€¢ $5/mes por persona<br>' +
                    'â€¢ $50/aÃ±o por persona (ahorra $10)<br><br>' +
                    'Â¿Centro de rehabilitaciÃ³n? Â¿Centro de mayores? Â¿Homeschool?<br><br>' +
                    'Â¡Solo registra a cada usuario. Simple! ğŸ’ª'
                ), [
                    {labelEn: 'ğŸš€ START FREE TRIAL', labelEs: 'ğŸš€ COMENZAR PRUEBA', action: 'new', primary: true},
                    {labelEn: 'â“ More questions', labelEs: 'â“ MÃ¡s preguntas', action: 'questions'}
                ], 600);
                break;
            case 'new':
                currentFlow = 'new';
                botSay(bi("Let's get you started! ğŸ‰", 'Â¡Vamos a comenzar! ğŸ‰'), null, 600);
                setTimeout(addPlanSelector, 1000);
                break;
            case 'returning':
                currentFlow = 'subscriber';
                currentStep = 'ask_pin';
                botSay(bi('Welcome back! ğŸ€<br><br>Enter your 4-digit PIN:', 'Â¡Bienvenido! ğŸ€<br><br>Ingresa tu PIN de 4 dÃ­gitos:'), null, 600);
                setTimeout(addPinInput, 1500);
                break;
            case 'start_training':
                goToGameHub();
                break;
            case 'manage_subscription':
                handleManageSubscription();
                break;
            case 'retry_email':
                addEmailInput();
                break;
            case 'forgot_pin':
                addForgotPinInput();
                break;
        }
    }
    function handleTextInput(text) {
        text = text.trim();
        if (!text) return;
        addMsg(text, true);
        hideInput();
    }
    function handlePinSubmit(pin) {
        document.querySelectorAll('.pin-digit').forEach(function(d) { d.disabled = true; });
        var submitBtn = document.getElementById('pinSubmit');
        if (submitBtn) submitBtn.style.opacity = '0.5';
        addMsg('â€¢â€¢â€¢â€¢', true);
        
        fetch('/api/subscriber/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pin: pin })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success) {
                var userData = { email: data.email, pin: pin, plan: data.plan, type: 'subscriber' };
                saveUser(userData);
                setSession(data.email, pin);
                var statusBadge = data.status === 'trialing' ? '<div class="status-badge trialing">ğŸ†“ ' + bi('FREE TRIAL', 'PRUEBA GRATIS') + '</div>' : '<div class="status-badge active">âœ… ' + bi('ACTIVE', 'ACTIVO') + '</div>';
                botSay(bi('ğŸ€ <strong>Welcome back!</strong>', 'ğŸ€ <strong>Â¡Bienvenido!</strong>') + '<br><br>' + statusBadge + '<br><br>' + bi('Ready to train?', 'Â¿Listo para entrenar?'), [
                    {labelEn: "ğŸ€ LET'S GO!", labelEs: "ğŸ€ PA'LANTE!", action: 'start_training', primary: true},
                    {labelEn: 'âš™ï¸ Manage', labelEs: 'âš™ï¸ Gestionar', action: 'manage_subscription', secondary: true}
                ], 800);
            } else {
                botSay(bi('âŒ Invalid PIN. Try again:', 'âŒ PIN invÃ¡lido. Intenta:'), null, 600);
                setTimeout(addPinInput, 1400);
            }
        })
        .catch(function() {
            botSay(bi('âŒ Connection error. Try again:', 'âŒ Error de conexiÃ³n. Intenta:'), null, 600);
            setTimeout(addPinInput, 1400);
        });
    }
    function handleManageSubscription() {
        var user = getUser();
        if (!user || !user.email) {
            botSay(bi('Please login first.', 'Por favor inicia sesiÃ³n primero.'), null, 400);
            return;
        }
        addTyping();
        fetch('/api/stripe/portal', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email: user.email })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            removeTyping();
            if (data.url) window.location.href = data.url;
            else addMsg(bi('âŒ Could not open portal.', 'âŒ No se pudo abrir el portal.'), false);
        })
        .catch(function() {
            removeTyping();
            addMsg(bi('âŒ Connection error.', 'âŒ Error de conexiÃ³n.'), false);
        });
    }
    goBtn.addEventListener('click', openChat);
    chatClose.addEventListener('click', function() {
        chatScreen.classList.remove('active');
        landing.classList.remove('hidden');
    });
    chatSend.addEventListener('click', function() {
        handleTextInput(chatInput.value);
        chatInput.value = '';
    });
    chatInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter') {
            handleTextInput(chatInput.value);
            chatInput.value = '';
        }
    });
    if (!checkUrlParams()) { }
})();
</script>
</body>
</html>
