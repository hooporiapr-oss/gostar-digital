<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>THE MATCH | LaughCourt - Where Joy Meets The Game</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --orange: #FF6B35;
    --gold: #FFD700;
    --teal: #00D9A5;
    --pink: #FF1493;
    --dark: #0a0a0f;
    --card: #111118;
    --hardwood: #C4935A;
    --hardwood-dark: #8B6914;
    --text: #FFFFFF;
    --muted: #8892a0;
    --border: rgba(255,255,255,0.1);
    --nav-height: 84px;
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text);touch-action:manipulation;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}

/* ===== TWO-ROW MINI NAV ===== */
.mini-nav{position:fixed;top:0;left:0;right:0;background:var(--card);border-bottom:1px solid var(--border);padding-top:env(safe-area-inset-top);z-index:1000}
.nav-row-1{display:flex;align-items:center;justify-content:space-between;height:44px;padding:0 12px}
.nav-logo{font-family:'Bebas Neue',sans-serif;font-size:1.15rem;letter-spacing:1px;text-decoration:none;display:flex;align-items:center;gap:5px}
.nav-logo .ball{font-size:1rem}
.nav-logo .laugh{color:var(--gold)}
.nav-logo .court{color:var(--text)}
.nav-right{display:flex;align-items:center;gap:6px}
.nav-lang{display:flex;gap:2px}
.nav-lang-btn{padding:5px 8px;border:1px solid var(--border);background:0;color:var(--muted);border-radius:4px;font-size:0.6rem;font-weight:600;cursor:pointer;min-width:28px;min-height:28px}
.nav-lang-btn.active{border-color:var(--gold);color:var(--gold)}
.settings-wrapper{position:relative}
.settings-btn{width:32px;height:32px;border-radius:6px;background:0;border:1px solid var(--border);color:var(--muted);font-size:1rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.settings-btn.open{background:rgba(255,255,255,0.1);color:var(--gold)}
.settings-dropdown{position:absolute;top:calc(100% + 6px);right:0;width:175px;background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px;display:none;box-shadow:0 10px 40px rgba(0,0,0,0.5)}
.settings-dropdown.show{display:block}
.settings-section{margin-bottom:10px}
.settings-section:last-child{margin-bottom:0}
.settings-label{font-size:0.5rem;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.speed-status{display:flex;gap:4px}
.speed-chip{flex:1;padding:4px 2px;border-radius:4px;font-family:'Bebas Neue',sans-serif;font-size:0.55rem;text-align:center;background:rgba(255,255,255,0.05);color:var(--muted)}
.speed-chip.unlocked{background:rgba(0,217,165,0.15);color:var(--teal)}
.speed-chip.locked{background:rgba(255,215,0,0.1);color:var(--gold)}
.settings-link{display:block;width:100%;padding:8px;border-radius:6px;font-size:0.7rem;text-decoration:none;text-align:center;cursor:pointer;border:none;font-family:'Outfit',sans-serif}
.settings-link.upgrade{background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark);font-weight:600;margin-bottom:6px}
.settings-link.logout{background:0;border:1px solid var(--border);color:var(--muted)}
.nav-row-2{display:flex;align-items:center;justify-content:center;height:40px;padding:0 10px;gap:8px;border-top:1px solid var(--border)}
.nav-tab{flex:1;max-width:140px;padding:7px 10px;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:0.8rem;letter-spacing:1px;text-decoration:none;text-align:center;color:var(--muted);background:0;border:1px solid var(--border);transition:all 0.2s}
.nav-tab.active{color:var(--orange);background:rgba(255,107,53,0.12);border-color:var(--orange)}

/* ===== GAME CONTAINER ===== */
.game-container{width:100%;max-width:420px;height:100dvh;margin:0 auto;padding:5px 10px;padding-top:calc(var(--nav-height) + env(safe-area-inset-top) + 4px);padding-bottom:max(5px,env(safe-area-inset-bottom));display:flex;flex-direction:column;overflow:hidden}
.stats-bar{display:flex;justify-content:center;gap:12px;padding:5px 8px;background:var(--card);border-radius:8px;margin-bottom:4px;flex-shrink:0}
.stat{text-align:center;min-width:40px}
.stat-value{font-family:'Bebas Neue',sans-serif;font-size:1rem;color:var(--gold);line-height:1}
.stat-label{font-size:0.42rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px}
.message-display{background:var(--card);border:2px solid var(--orange);border-radius:8px;padding:7px;margin-bottom:4px;text-align:center;flex-shrink:0;min-height:36px;display:flex;align-items:center;justify-content:center}
.message-text{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px;color:var(--text)}
.message-text.watch{color:var(--gold)}
.message-text.go{color:var(--teal)}
.selectors-row{display:flex;gap:6px;margin-bottom:4px;flex-shrink:0}
.selector-group{flex:1;background:var(--card);border-radius:8px;padding:5px}
.selector-label{text-align:center;font-size:0.45rem;color:var(--muted);letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}
.selector-options{display:flex;gap:3px}
.selector-btn{flex:1;min-height:34px;padding:5px 2px;border:2px solid var(--border);background:0;border-radius:6px;color:var(--muted);font-family:'Bebas Neue',sans-serif;font-size:0.85rem;cursor:pointer;position:relative;display:flex;align-items:center;justify-content:center}
.selector-btn.active{border-color:var(--orange);color:var(--orange);background:rgba(255,107,53,0.1)}
.selector-btn.locked{opacity:0.5}
.selector-btn.locked::after{content:'üîí';position:absolute;top:0;right:2px;font-size:0.4rem}
.court-wrapper{flex:1;display:flex;align-items:center;justify-content:center;min-height:0;overflow:hidden}
.court-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;padding:8px;background:repeating-linear-gradient(90deg,var(--hardwood) 0px,var(--hardwood) 15px,var(--hardwood-dark) 15px,var(--hardwood-dark) 30px);border-radius:10px;border:3px solid var(--text);width:min(100%,calc(100dvh - 330px),300px);height:min(100%,calc(100dvh - 330px),300px);min-width:200px;min-height:200px;aspect-ratio:1;position:relative}
.court-grid::before{content:'';position:absolute;top:50%;left:50%;width:28px;height:28px;border:2px solid rgba(255,255,255,0.2);border-radius:50%;transform:translate(-50%,-50%);pointer-events:none}
.court-grid::after{content:'';position:absolute;top:50%;left:0;right:0;height:2px;background:rgba(255,255,255,0.2);pointer-events:none}
.grid-cell{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:5px;cursor:pointer;background:rgba(255,255,255,0.1);border:2px solid transparent;min-width:32px;min-height:32px}
.grid-cell:nth-child(-n+5){border-color:#FF6B6B}
.grid-cell:nth-child(n+6):nth-child(-n+10){border-color:#FFE66D}
.grid-cell:nth-child(n+11):nth-child(-n+15){border-color:#4ECDC4}
.grid-cell:nth-child(n+16):nth-child(-n+20){border-color:#45B7D1}
.grid-cell:nth-child(n+21){border-color:#96CEB4}
.grid-cell.center{background:rgba(0,0,0,0.4);border:2px solid var(--text);cursor:default}
.grid-cell:active:not(.disabled):not(.center){transform:scale(0.95)}
.color-red{background:#E53935!important}
.color-blue{background:#1E88E5!important}
.color-green{background:#43A047!important}
.color-yellow{background:#FDD835!important}
.color-purple{background:#8E24AA!important}
.color-orange{background:#FB8C00!important}
.color-pink{background:#EC407A!important}
.color-teal{background:#26A69A!important}
.grid-cell.correct{animation:pulse 0.3s;box-shadow:0 0 12px var(--teal)}
.grid-cell.wrong{animation:shake 0.3s;box-shadow:0 0 12px var(--pink)}
.grid-cell.revealed{border:2px solid var(--gold)!important;box-shadow:0 0 10px var(--gold)}
@keyframes pulse{50%{transform:scale(1.1)}}
@keyframes shake{25%{transform:translateX(-4px)}75%{transform:translateX(4px)}}
.division-display{display:flex;justify-content:space-between;align-items:center;padding:5px 10px;background:var(--card);border-radius:8px;margin:4px 0;flex-shrink:0;min-height:34px}
.division-badge{font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:2px;color:var(--orange)}
.matches-counter{font-family:'Bebas Neue',sans-serif;font-size:1rem;color:var(--teal)}
.score-display{font-family:'Bebas Neue',sans-serif;font-size:1.05rem;color:var(--gold)}
.action-btn{width:100%;min-height:46px;padding:11px;border:none;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:1.25rem;letter-spacing:4px;cursor:pointer;background:linear-gradient(135deg,var(--orange),#FF8C00);color:var(--dark);flex-shrink:0}
.action-btn:disabled{opacity:0.5;cursor:not-allowed}
.emoji-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;overflow:hidden}
.burst-emoji{position:absolute;font-size:1.6rem;animation:emojiBurst 1.2s ease-out forwards;pointer-events:none}
@keyframes emojiBurst{0%{opacity:1;transform:translate(-50%,-50%) scale(0.3)}20%{opacity:1;transform:translate(-50%,-50%) scale(1.2)}100%{opacity:0;transform:translate(var(--tx),var(--ty)) scale(0.8) rotate(var(--rot))}}
.burst-emoji.big{font-size:2.2rem}
.burst-emoji.party{font-size:1.8rem;animation-duration:2s}
.court-grid.joy-pulse{animation:joyPulse 0.5s ease-out}
@keyframes joyPulse{0%{box-shadow:0 0 0 0 rgba(255,215,0,0.7)}50%{box-shadow:0 0 20px 6px rgba(255,215,0,0.4)}100%{box-shadow:none}}
.feedback-overlay,.upgrade-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.92);display:none;align-items:center;justify-content:center;z-index:100;padding:20px}
.feedback-overlay.show,.upgrade-overlay.show{display:flex}
.feedback-card,.upgrade-card{background:var(--card);border:2px solid var(--orange);border-radius:14px;padding:20px;text-align:center;max-width:280px;width:100%}
.upgrade-card{border-color:var(--gold)}
.feedback-emoji,.upgrade-icon{font-size:2rem;margin-bottom:6px}
.feedback-title,.upgrade-title{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px;margin-bottom:5px}
.feedback-title{color:var(--teal)}
.upgrade-title{color:var(--gold)}
.feedback-message,.upgrade-text{color:var(--muted);margin-bottom:10px;font-size:0.8rem}
.feedback-stats{display:flex;justify-content:center;gap:20px;margin-bottom:10px}
.feedback-stat-value{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;color:var(--gold)}
.feedback-stat-label{font-size:0.55rem;color:var(--muted);text-transform:uppercase}
.feedback-btn,.upgrade-btn,.upgrade-close{min-height:42px;padding:10px 20px;border:none;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:2px;cursor:pointer;margin:3px}
.feedback-btn.primary{background:linear-gradient(135deg,var(--orange),#FF8C00);color:var(--dark)}
.feedback-btn.secondary{background:0;color:var(--muted);border:1px solid var(--muted)}
.upgrade-btn{display:block;width:100%;background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark);text-decoration:none;margin-bottom:6px}
.upgrade-close{background:0;border:1px solid var(--muted);color:var(--muted)}
.upgrade-speed-preview{display:flex;justify-content:center;gap:5px;margin-bottom:10px}
.upgrade-speed-chip{padding:5px 8px;border-radius:6px;font-family:'Bebas Neue',sans-serif;font-size:0.75rem}
.upgrade-speed-chip.current{background:rgba(0,217,165,0.2);color:var(--teal);border:1px solid var(--teal)}
.upgrade-speed-chip.locked{background:rgba(255,215,0,0.15);color:var(--gold);border:1px solid var(--gold)}
.upgrade-price{font-family:'Bebas Neue',sans-serif;font-size:1.6rem;color:var(--gold);margin-bottom:4px}
.upgrade-price span{font-size:0.75rem;color:var(--muted)}
.coach-message{position:fixed;bottom:70px;left:50%;transform:translateX(-50%) translateY(100px);background:linear-gradient(135deg,var(--orange),var(--gold));color:var(--dark);padding:8px 16px;border-radius:14px;font-weight:700;font-size:0.85rem;opacity:0;transition:all 0.3s;z-index:50}
.coach-message.show{transform:translateX(-50%) translateY(0);opacity:1}
body.en .lang-es{display:none!important}
body.es .lang-en{display:none!important}

/* ===== RESPONSIVE ===== */
@media(min-height:720px){:root{--nav-height:88px}.nav-row-2{height:44px}.stat-value{font-size:1.1rem}.message-text{font-size:0.95rem}.selector-btn{min-height:38px}.court-grid{width:min(100%,calc(100dvh - 340px),320px);height:min(100%,calc(100dvh - 340px),320px)}.action-btn{min-height:50px;font-size:1.35rem}}
@media(max-height:620px){:root{--nav-height:76px}.nav-row-1{height:40px}.nav-row-2{height:36px}.nav-tab{font-size:0.75rem;padding:6px 8px}.stats-bar{padding:4px 6px;gap:10px}.stat-value{font-size:0.9rem}.message-display{padding:5px;min-height:30px}.message-text{font-size:0.8rem}.selector-btn{min-height:30px;font-size:0.75rem}.court-grid{min-width:180px;min-height:180px;width:min(100%,calc(100dvh - 290px),260px);height:min(100%,calc(100dvh - 290px),260px);gap:3px;padding:6px}.grid-cell{min-width:28px;min-height:28px}.division-display{padding:4px 8px;min-height:30px}.action-btn{min-height:42px;font-size:1.1rem}}
@media(max-height:540px){:root{--nav-height:68px}.nav-row-1{height:36px}.nav-row-2{height:32px}.nav-logo{font-size:1rem}.nav-tab{font-size:0.7rem}.stats-bar{padding:3px 5px;margin-bottom:3px}.stat-value{font-size:0.8rem}.stat-label{font-size:0.38rem}.message-display{padding:4px;margin-bottom:3px;min-height:26px}.message-text{font-size:0.7rem}.selectors-row{margin-bottom:3px}.selector-group{padding:3px}.selector-label{font-size:0.4rem;margin-bottom:2px}.selector-btn{min-height:26px;font-size:0.65rem}.court-grid{min-width:150px;min-height:150px;gap:2px;padding:5px}.grid-cell{min-width:24px;min-height:24px}.division-display{padding:3px 6px;min-height:26px;margin:3px 0}.division-badge,.matches-counter{font-size:0.75rem}.score-display{font-size:0.9rem}.action-btn{min-height:38px;padding:8px;font-size:1rem}}
</style>
</head>
<body class="en">
<nav class="mini-nav">
<div class="nav-row-1">
<a href="/play" class="nav-logo"><span class="ball">üèÄ</span> <span class="laugh">LAUGH</span><span class="court">COURT</span></a>
<div class="nav-right">
<div class="nav-lang"><button class="nav-lang-btn active" id="btnEn">EN</button><button class="nav-lang-btn" id="btnEs">ES</button></div>
<div class="settings-wrapper"><button class="settings-btn" id="settingsBtn">‚öôÔ∏è</button>
<div class="settings-dropdown" id="settingsDropdown">
<div class="settings-section"><div class="settings-label"><span class="lang-en">Speed Access</span><span class="lang-es">Velocidad</span></div><div class="speed-status" id="speedStatus"><span class="speed-chip unlocked">‚úì SLOW</span><span class="speed-chip locked">üîí MED</span><span class="speed-chip locked">üîí FAST</span></div></div>
<div class="settings-section" id="upgradeSection"><a href="https://buy.stripe.com/9B6bJ2c9i1qy0Qrbqh00005" class="settings-link upgrade">üöÄ UNLOCK ALL</a></div>
<div class="settings-section"><button class="settings-link logout" id="logoutBtn">‚Üê <span class="lang-en">Log Out</span><span class="lang-es">Salir</span></button></div>
</div></div></div></div>
<div class="nav-row-2"><a href="/the-match" class="nav-tab active">üéØ MATCH</a><a href="/the-sequence" class="nav-tab">üî¢ SEQUENCE</a><a href="/the-starting-five" class="nav-tab">üß° TEAM</a></div>
</nav>
<div class="emoji-container" id="emojiContainer"></div>
<div class="game-container">
<div class="stats-bar">
<div class="stat"><div class="stat-value" id="circuitNum">1</div><div class="stat-label"><span class="lang-en">Circuit</span><span class="lang-es">Circuito</span></div></div>
<div class="stat"><div class="stat-value" id="playsDisplay">0/5</div><div class="stat-label"><span class="lang-en">Plays</span><span class="lang-es">Jugadas</span></div></div>
<div class="stat"><div class="stat-value" id="streakDisplay">0</div><div class="stat-label">üî•</div></div>
<div class="stat"><div class="stat-value" id="scoreDisplay">0</div><div class="stat-label"><span class="lang-en">Score</span><span class="lang-es">Puntos</span></div></div>
</div>
<div class="message-display"><span class="message-text" id="messageText"><span class="lang-en">Select division & GO!</span><span class="lang-es">¬°Selecciona e IR!</span></span></div>
<div class="selectors-row">
<div class="selector-group"><div class="selector-label"><span class="lang-en">Level</span><span class="lang-es">Nivel</span></div><div class="selector-options"><button class="selector-btn active" data-level="1">1</button><button class="selector-btn" data-level="2">2</button><button class="selector-btn" data-level="3">3</button><button class="selector-btn" data-level="4">4</button><button class="selector-btn" data-level="5">5</button></div></div>
<div class="selector-group"><div class="selector-label"><span class="lang-en">Speed</span><span class="lang-es">Velocidad</span></div><div class="selector-options"><button class="selector-btn speed-btn active" data-speed="slow"><span class="lang-en">Slow</span><span class="lang-es">Lento</span></button><button class="selector-btn speed-btn" data-speed="med">Med</button><button class="selector-btn speed-btn" data-speed="fast"><span class="lang-en">Fast</span><span class="lang-es">R√°pido</span></button></div></div>
</div>
<div class="court-wrapper"><div class="court-grid" id="courtGrid"></div></div>
<div class="division-display"><div class="division-badge" id="divisionBadge">L1 SLOW</div><div class="matches-counter" id="matchesCounter">0/1</div><div class="score-display" id="totalScore">0</div></div>
<button class="action-btn" id="actionBtn"><span class="lang-en">GO</span><span class="lang-es">IR</span></button>
</div>
<div class="feedback-overlay" id="feedbackOverlay"><div class="feedback-card"><div class="feedback-emoji" id="feedbackEmoji">üèÜ</div><h2 class="feedback-title"><span class="lang-en">CIRCUIT COMPLETE!</span><span class="lang-es">¬°CIRCUITO!</span></h2><p class="feedback-message" id="feedbackMessage"></p><div class="feedback-stats"><div class="feedback-stat"><div class="feedback-stat-value" id="feedbackScore">0</div><div class="feedback-stat-label"><span class="lang-en">Score</span><span class="lang-es">Puntos</span></div></div><div class="feedback-stat"><div class="feedback-stat-value" id="feedbackStreak">0</div><div class="feedback-stat-label">üî•</div></div></div><button class="feedback-btn primary" id="nextCircuitBtn"><span class="lang-en">NEXT</span><span class="lang-es">SIGUIENTE</span></button><button class="feedback-btn secondary" id="changeDivisionBtn"><span class="lang-en">CHANGE</span><span class="lang-es">CAMBIAR</span></button></div></div>
<div class="upgrade-overlay" id="upgradeOverlay"><div class="upgrade-card"><div class="upgrade-icon">üîì‚ö°</div><h2 class="upgrade-title">UNLOCK ALL SPEEDS</h2><div class="upgrade-speed-preview"><span class="upgrade-speed-chip current">‚úì Slow</span><span class="upgrade-speed-chip locked">üîí Med</span><span class="upgrade-speed-chip locked">üîí Fast</span></div><div class="upgrade-price">$5<span>/mo</span></div><a href="https://buy.stripe.com/9B6bJ2c9i1qy0Qrbqh00005" class="upgrade-btn">UPGRADE üöÄ</a><button class="upgrade-close" id="upgradeClose"><span class="lang-en">CONTINUE SLOW</span><span class="lang-es">CONTINUAR</span></button></div></div>
<div class="coach-message" id="coachMessage"></div>
<script>
(function(){var host=window.location.hostname,isProduction=host.indexOf('laughcourt')>-1||host.indexOf('github.io')>-1;if(isProduction){var user=null;try{user=JSON.parse(localStorage.getItem('lc-user'))}catch(e){}if(!user||!user.pin||user.pin.length<4){window.location.replace('/login');return}var sessionPin=sessionStorage.getItem('lc-pin'),sessionToken=sessionStorage.getItem('lc-token');function validateSession(){if(!sessionPin||!sessionToken){window.location.href='/login';return}fetch('/api/session/validate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pin:sessionPin,token:sessionToken})}).then(function(r){return r.json()}).then(function(d){if(!d.valid){localStorage.removeItem('lc-user');localStorage.removeItem('lc-speed-access');sessionStorage.clear();window.location.href='/login'}}).catch(function(){})}validateSession();setInterval(validateSession,30000)}
var settingsBtn=document.getElementById('settingsBtn'),settingsDropdown=document.getElementById('settingsDropdown');settingsBtn.onclick=function(e){e.stopPropagation();settingsBtn.classList.toggle('open');settingsDropdown.classList.toggle('show')};document.onclick=function(e){if(!settingsDropdown.contains(e.target)){settingsBtn.classList.remove('open');settingsDropdown.classList.remove('show')}};
document.getElementById('logoutBtn').onclick=function(){var p=sessionStorage.getItem('lc-pin'),t=sessionStorage.getItem('lc-token');if(p&&t)fetch('/api/session/destroy',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({pin:p,token:t})}).catch(function(){});localStorage.removeItem('lc-user');localStorage.removeItem('lc-speed-access');sessionStorage.clear();window.location.href='/login'};
var currentLang=localStorage.getItem('laughcourt_lang')||'en';function setLang(l){currentLang=l;localStorage.setItem('laughcourt_lang',l);document.body.className=l;document.getElementById('btnEn').className=l==='en'?'nav-lang-btn active':'nav-lang-btn';document.getElementById('btnEs').className=l==='es'?'nav-lang-btn active':'nav-lang-btn';updateDivisionDisplay()}document.getElementById('btnEn').onclick=function(){setLang('en')};document.getElementById('btnEs').onclick=function(){setLang('es')};
var speedAccess={allSpeeds:false};try{var sa=localStorage.getItem('lc-speed-access');if(sa)speedAccess=JSON.parse(sa)}catch(e){}
function updateSpeedStatusUI(){var ss=document.getElementById('speedStatus'),us=document.getElementById('upgradeSection');if(speedAccess.allSpeeds){ss.innerHTML='<span class="speed-chip unlocked">‚úì SLOW</span><span class="speed-chip unlocked">‚úì MED</span><span class="speed-chip unlocked">‚úì FAST</span>';us.style.display='none'}else{ss.innerHTML='<span class="speed-chip unlocked">‚úì SLOW</span><span class="speed-chip locked">üîí MED</span><span class="speed-chip locked">üîí FAST</span>';us.style.display='block'}}
function initSpeedButtons(){document.querySelectorAll('.speed-btn').forEach(function(b){if(!speedAccess.allSpeeds&&b.dataset.speed!=='slow')b.classList.add('locked');else b.classList.remove('locked')});if(!speedAccess.allSpeeds){state.speed='slow';document.querySelectorAll('.speed-btn').forEach(function(b){b.classList.remove('active')});document.querySelector('.speed-btn[data-speed="slow"]').classList.add('active')}updateSpeedStatusUI()}
function showUpgradeModal(){document.getElementById('upgradeOverlay').classList.add('show')}document.getElementById('upgradeClose').onclick=function(){document.getElementById('upgradeOverlay').classList.remove('show')};
var COLORS=['red','blue','green','yellow','purple','orange','pink','teal'],LEVEL_CONFIG={1:{matches:1,distractors:3},2:{matches:2,distractors:4},3:{matches:3,distractors:5},4:{matches:4,distractors:6},5:{matches:5,distractors:7}},SPEED_CONFIG={slow:2500,med:1500,fast:800},PLAYS_PER_CIRCUIT=5,CENTER_CELL=12,LAUGH_EMOJIS=['üòÇ','üòÜ','ü§£','üòÑ','üòÅ','ü•≥','üòä','üéâ'],PARTY_EMOJIS=['ü•≥','üéâ','üòÇ','ü§£','‚ú®','üí´','üåü','üèÜ'];
var state={level:parseInt(localStorage.getItem('lc-level'))||1,speed:localStorage.getItem('lc-speed')||'slow',score:parseInt(localStorage.getItem('lc-score'))||0,circuitNum:1,playsCompleted:0,streak:parseInt(localStorage.getItem('lc-streak'))||0,matchesFound:0,matchesNeeded:1,targetColor:'',matchCells:[],isPlaying:false,canTap:false,cells:[]};
var courtGrid=document.getElementById('courtGrid'),messageText=document.getElementById('messageText'),actionBtn=document.getElementById('actionBtn'),feedbackOverlay=document.getElementById('feedbackOverlay'),coachMessage=document.getElementById('coachMessage'),emojiContainer=document.getElementById('emojiContainer');
function getCourtCenter(){var r=courtGrid.getBoundingClientRect();return{x:r.left+r.width/2,y:r.top+r.height/2}}
function createBurstEmoji(e,x,y,t){var el=document.createElement('div');el.className='burst-emoji'+(t?' '+t:'');el.textContent=e;var a=Math.random()*Math.PI*2,d=50+Math.random()*80;el.style.cssText='left:'+x+'px;top:'+y+'px;--tx:'+Math.cos(a)*d+'px;--ty:'+Math.sin(a)*d+'px;--rot:'+(Math.random()-0.5)*720+'deg';emojiContainer.appendChild(el);setTimeout(function(){if(el.parentNode)el.remove()},1500)}
function laughCelebration(i){var c=getCourtCenter(),n=i==='party'?8:i==='big'?5:i==='medium'?3:2,em=i==='party'?PARTY_EMOJIS:LAUGH_EMOJIS,t=i==='party'?'party':i==='big'?'big':'';for(var j=0;j<n;j++){(function(idx){setTimeout(function(){createBurstEmoji(em[Math.floor(Math.random()*em.length)],c.x+(Math.random()-0.5)*20,c.y+(Math.random()-0.5)*20,t)},idx*35)})(j)}courtGrid.classList.add('joy-pulse');setTimeout(function(){courtGrid.classList.remove('joy-pulse')},500)}
var audioCtx=null;function getAudioContext(){if(!audioCtx)try{audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}return audioCtx}
function playCorrectSound(){var c=getAudioContext();if(!c)return;try{if(c.state==='suspended')c.resume();var o=c.createOscillator(),g=c.createGain();o.type='sine';o.frequency.value=880;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.3,c.currentTime);g.gain.exponentialRampToValueAtTime(0.01,c.currentTime+0.15);o.start();o.stop(c.currentTime+0.2)}catch(e){}}
function playSuccessSound(){var c=getAudioContext();if(!c)return;try{if(c.state==='suspended')c.resume();[523,659,784].forEach(function(f,i){setTimeout(function(){var o=c.createOscillator(),g=c.createGain();o.type='sine';o.frequency.value=f;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.25,c.currentTime);g.gain.exponentialRampToValueAtTime(0.01,c.currentTime+0.12);o.start();o.stop(c.currentTime+0.15)},i*80)})}catch(e){}}
function playErrorSound(){var c=getAudioContext();if(!c)return;try{if(c.state==='suspended')c.resume();var o=c.createOscillator(),g=c.createGain();o.type='triangle';o.frequency.value=200;o.connect(g);g.connect(c.destination);g.gain.setValueAtTime(0.2,c.currentTime);g.gain.exponentialRampToValueAtTime(0.01,c.currentTime+0.25);o.start();o.stop(c.currentTime+0.3)}catch(e){}}
function initCourt(){courtGrid.innerHTML='';state.cells=[];for(var i=0;i<25;i++){var cell=document.createElement('div');cell.className='grid-cell'+(i===CENTER_CELL?' center':'');cell.dataset.index=i;if(i!==CENTER_CELL)cell.onclick=function(){handleCellTap(parseInt(this.dataset.index))};courtGrid.appendChild(cell);state.cells.push(cell)}}
function shuffleArray(a){for(var i=a.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1)),t=a[i];a[i]=a[j];a[j]=t}}
function updateDivisionDisplay(){var sp=state.speed.toUpperCase();if(currentLang==='es')sp=state.speed==='slow'?'LENTO':state.speed==='med'?'MEDIO':'R√ÅPIDO';document.getElementById('divisionBadge').textContent='L'+state.level+' '+sp;state.matchesNeeded=LEVEL_CONFIG[state.level].matches;updateMatchesDisplay()}
function updateMatchesDisplay(){document.getElementById('matchesCounter').textContent=state.matchesFound+'/'+state.matchesNeeded}
function updateStats(){document.getElementById('circuitNum').textContent=state.circuitNum;document.getElementById('playsDisplay').textContent=state.playsCompleted+'/'+PLAYS_PER_CIRCUIT;document.getElementById('streakDisplay').textContent=state.streak;document.getElementById('scoreDisplay').textContent=state.score;document.getElementById('totalScore').textContent=state.score}
function showCoach(m){coachMessage.textContent=m;coachMessage.classList.add('show');setTimeout(function(){coachMessage.classList.remove('show')},2000)}
function startPlay(){if(state.isPlaying)return;state.isPlaying=true;state.canTap=false;state.matchesFound=0;state.matchCells=[];updateMatchesDisplay();actionBtn.disabled=true;messageText.innerHTML='<span class="lang-en">WATCH...</span><span class="lang-es">MIRA...</span>';messageText.className='message-text watch';state.cells.forEach(function(c,i){c.className=i===CENTER_CELL?'grid-cell center':'grid-cell'});state.targetColor=COLORS[Math.floor(Math.random()*COLORS.length)];var av=[];for(var i=0;i<25;i++)if(i!==CENTER_CELL)av.push(i);shuffleArray(av);var cfg=LEVEL_CONFIG[state.level];state.matchCells=av.slice(0,cfg.matches);var dist=av.slice(cfg.matches,cfg.matches+cfg.distractors);state.cells[CENTER_CELL].classList.add('color-'+state.targetColor);state.matchCells.forEach(function(i){state.cells[i].classList.add('color-'+state.targetColor)});dist.forEach(function(i){var dc;do{dc=COLORS[Math.floor(Math.random()*COLORS.length)]}while(dc===state.targetColor);state.cells[i].classList.add('color-'+dc)});setTimeout(function(){state.cells.forEach(function(c,i){if(i!==CENTER_CELL)COLORS.forEach(function(co){c.classList.remove('color-'+co)})});messageText.innerHTML='<span class="lang-en">FIND!</span><span class="lang-es">¬°BUSCA!</span>';messageText.className='message-text go';state.canTap=true},SPEED_CONFIG[state.speed])}
function handleCellTap(i){if(!state.canTap||!state.isPlaying)return;var c=state.cells[i];if(c.classList.contains('correct')||c.classList.contains('wrong'))return;if(state.matchCells.indexOf(i)!==-1){c.classList.add('correct','color-'+state.targetColor);state.matchesFound++;updateMatchesDisplay();playCorrectSound();state.score+=10*state.level;updateStats();laughCelebration('small');if(state.matchesFound>=state.matchesNeeded){state.score+=25*state.level;state.streak++;updateStats();playSuccessSound();var int=state.streak>=5?'party':state.streak>=3?'big':'medium',msg=state.streak>=5?['üéâ PARTY!','üèÜ LEGEND!']:state.streak>=3?['üòÇ FIRE!','ü§£ WOW!']:['üòÑ NICE!','üòä GREAT!'];laughCelebration(int);showCoach(msg[Math.floor(Math.random()*msg.length)]);setTimeout(completedPlay,500)}}else{c.classList.add('wrong');playErrorSound();state.streak=0;updateStats();setTimeout(function(){state.matchCells.forEach(function(j){if(!state.cells[j].classList.contains('correct'))state.cells[j].classList.add('revealed','color-'+state.targetColor)});setTimeout(completedPlay,1000)},300)}}
function completedPlay(){state.canTap=false;state.isPlaying=false;state.playsCompleted++;updateStats();localStorage.setItem('lc-score',state.score);localStorage.setItem('lc-streak',state.streak);if(state.playsCompleted>=PLAYS_PER_CIRCUIT){laughCelebration('party');showCircuitModal()}else{messageText.innerHTML='<span>'+state.playsCompleted+'/'+PLAYS_PER_CIRCUIT+'</span>';messageText.className='message-text';actionBtn.disabled=false}}
function showCircuitModal(){document.getElementById('feedbackScore').textContent=state.score;document.getElementById('feedbackStreak').textContent=state.streak;document.getElementById('feedbackMessage').textContent='L'+state.level+' '+(state.speed==='slow'?'Slow':state.speed==='med'?'Med':'Fast');document.getElementById('feedbackEmoji').textContent=state.streak>=5?'üèÜ':state.streak>=3?'üéâ':'üòÑ';feedbackOverlay.classList.add('show')}
document.getElementById('nextCircuitBtn').onclick=function(){feedbackOverlay.classList.remove('show');state.playsCompleted=0;state.circuitNum++;updateStats();messageText.innerHTML='<span>Circuit '+state.circuitNum+'</span>';messageText.className='message-text';actionBtn.disabled=false};
document.getElementById('changeDivisionBtn').onclick=function(){feedbackOverlay.classList.remove('show');state.score=0;state.playsCompleted=0;state.circuitNum=1;state.streak=0;localStorage.setItem('lc-score',0);localStorage.setItem('lc-streak',0);updateStats();messageText.innerHTML='<span class="lang-en">Select & GO!</span><span class="lang-es">¬°Selecciona!</span>';messageText.className='message-text';actionBtn.disabled=false};
document.querySelectorAll('[data-level]').forEach(function(b){b.onclick=function(){if(state.isPlaying)return;document.querySelectorAll('[data-level]').forEach(function(x){x.classList.remove('active')});b.classList.add('active');state.level=parseInt(b.dataset.level);localStorage.setItem('lc-level',state.level);updateDivisionDisplay()}});
document.querySelectorAll('.speed-btn').forEach(function(b){b.onclick=function(){if(state.isPlaying)return;if(!speedAccess.allSpeeds&&b.dataset.speed!=='slow'){showUpgradeModal();return}document.querySelectorAll('.speed-btn').forEach(function(x){x.classList.remove('active')});b.classList.add('active');state.speed=b.dataset.speed;localStorage.setItem('lc-speed',state.speed);updateDivisionDisplay()}});
actionBtn.onclick=startPlay;
function loadSavedState(){var sl=localStorage.getItem('lc-level');if(sl){state.level=parseInt(sl);document.querySelectorAll('[data-level]').forEach(function(b){b.classList.remove('active')});var lb=document.querySelector('[data-level="'+state.level+'"]');if(lb)lb.classList.add('active')}var ss=localStorage.getItem('lc-speed');if(ss&&(speedAccess.allSpeeds||ss==='slow')){state.speed=ss;document.querySelectorAll('.speed-btn').forEach(function(b){b.classList.remove('active')});var sb=document.querySelector('.speed-btn[data-speed="'+state.speed+'"]');if(sb)sb.classList.add('active')}}
initCourt();initSpeedButtons();loadSavedState();setLang(currentLang);updateDivisionDisplay();updateStats()})();
</script>
</body>
</html>
