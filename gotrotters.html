<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GoTrotters - The Pistol's Way</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Nunito:wght@400;600;700;800;900&display=swap');
* { margin: 0; padding: 0; box-sizing: border-box; }
html { height: 100%; overflow-y: scroll; }

:root {
    --court-wood: #CD853F;
    --court-dark: #8B4513;
    --court-lines: rgba(255,255,255,0.5);
    --ball-orange: #FF6B00;
    --ball-dark: #CC5500;
    --primary: #1E3A8A;
    --primary-light: #3B82F6;
    --secondary: #FF6B00;
    --secondary-light: #FF8C00;
    --bg-dark: #0a0a12;
    --bg-card: #12121a;
    --text-light: #FFFFFF;
    --text-muted: #8892a0;
    --success: #00D9A5;
    --danger: #FF4757;
    --gold: #FFD700;
    --q1: #22C55E; --q2: #FF6B00; --q3: #F59E0B; --q4: #EF4444;
}

body { font-family: 'Nunito', sans-serif; background: var(--bg-dark); color: var(--text-light); min-height: 100%; }
body[data-lang="es"] .lang-en { display: none !important; }
body[data-lang="en"] .lang-es { display: none !important; }

.court-bg { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(90deg, transparent 49%, rgba(139,69,19,0.03) 49%, rgba(139,69,19,0.03) 51%, transparent 51%), linear-gradient(180deg, var(--bg-dark) 0%, #0d0d18 100%); background-size: 20px 100%, 100% 100%; z-index: -1; }

.top-controls { position: fixed; top: 0; left: 0; right: 0; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 100; background: linear-gradient(180deg, rgba(10,10,18,0.95) 0%, transparent 100%); }
.back-link { padding: 8px 16px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 20px; color: var(--text-muted); text-decoration: none; font-weight: 600; font-size: 0.85rem; transition: all 0.3s ease; }
.back-link:hover { border-color: var(--secondary); color: var(--secondary); }
.lang-toggle { display: flex; gap: 6px; }
.lang-btn { padding: 6px 12px; border: 2px solid var(--secondary); background: transparent; color: var(--secondary); border-radius: 15px; font-family: 'Nunito', sans-serif; font-weight: 600; font-size: 0.8rem; cursor: pointer; transition: all 0.3s ease; }
.lang-btn.active { background: var(--secondary); color: var(--text-light); }

.screen { display: none; flex-direction: column; align-items: center; min-height: 100vh; width: 100%; padding: 80px 20px 40px 20px; text-align: center; }
.screen.active { display: flex; }

/* Welcome */
.pistol-logo { font-family: 'Bebas Neue', sans-serif; font-size: 3.2rem; letter-spacing: 6px; background: linear-gradient(135deg, var(--secondary) 0%, var(--gold) 50%, var(--secondary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 5px; animation: shimmer 3s ease-in-out infinite; }
@keyframes shimmer { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.2); } }
.pistol-subtitle { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 8px; color: var(--text-muted); }
.pistol-icon { font-size: 4rem; margin: 20px 0; animation: ballBounce 1.5s ease-in-out infinite; }
@keyframes ballBounce { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-15px) rotate(10deg); } }

.pistol-quote { max-width: 320px; padding: 20px; background: rgba(255,107,0,0.05); border-left: 4px solid var(--secondary); border-radius: 0 15px 15px 0; margin-bottom: 30px; }
.pistol-quote-text { font-style: italic; color: var(--text-light); font-size: 1rem; line-height: 1.5; margin-bottom: 10px; }
.pistol-quote-attr { font-size: 0.85rem; color: var(--secondary); font-weight: 700; }

.tier-section, .rhythm-section { width: 100%; max-width: 380px; margin-bottom: 25px; }
.section-label { font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; letter-spacing: 4px; color: var(--text-muted); margin-bottom: 15px; }

.tier-grid { display: flex; flex-direction: column; gap: 8px; }
.tier-btn { display: flex; align-items: center; gap: 15px; padding: 14px 18px; background: var(--bg-card); border: 2px solid transparent; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; text-align: left; }
.tier-btn:hover:not(.locked) { border-color: var(--secondary); transform: translateX(5px); }
.tier-btn.selected { border-color: var(--secondary); background: rgba(255,107,0,0.1); }
.tier-btn.locked { opacity: 0.4; cursor: not-allowed; }
.tier-icon { font-size: 1.8rem; min-width: 45px; text-align: center; }
.tier-info { flex: 1; }
.tier-name { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; color: var(--text-light); }
.tier-desc { font-size: 0.75rem; color: var(--text-muted); }
.tier-progress { display: flex; flex-direction: column; align-items: flex-end; gap: 3px; }
.tier-progress-text { font-size: 0.7rem; color: var(--text-muted); }
.tier-progress-bar { width: 60px; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; }
.tier-progress-fill { height: 100%; background: var(--secondary); border-radius: 3px; }
.tier-badge { font-size: 0.65rem; padding: 3px 8px; background: var(--success); color: var(--bg-dark); border-radius: 10px; font-weight: 700; }
.tier-badge.locked-badge { background: rgba(255,255,255,0.1); color: var(--text-muted); }

.rhythm-grid { display: flex; gap: 10px; justify-content: center; }
.rhythm-btn { padding: 12px 18px; background: var(--bg-card); border: 2px solid transparent; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center; gap: 4px; min-width: 90px; }
.rhythm-btn:hover { border-color: var(--primary-light); }
.rhythm-btn.selected { border-color: var(--secondary); background: rgba(255,107,0,0.1); }
.rhythm-icon { font-size: 1.5rem; }
.rhythm-label { font-size: 0.8rem; font-weight: 700; color: var(--text-light); }
.rhythm-bpm { font-size: 0.7rem; color: var(--text-muted); }

.start-btn { padding: 18px 50px; font-family: 'Bebas Neue', sans-serif; font-size: 1.4rem; letter-spacing: 5px; background: linear-gradient(135deg, var(--secondary) 0%, var(--ball-dark) 100%); color: var(--text-light); border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 25px rgba(255,107,0,0.4); }
.start-btn:hover { transform: scale(1.05); box-shadow: 0 8px 35px rgba(255,107,0,0.5); }

.stats-summary { margin-top: 25px; padding: 15px 25px; background: var(--bg-card); border-radius: 15px; display: flex; gap: 30px; }
.stat-item { text-align: center; }
.stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--secondary); }
.stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

/* Countdown */
#countdownScreen { justify-content: center; }
.countdown-tier { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 4px; color: var(--text-muted); margin-bottom: 10px; }
.countdown-number { font-family: 'Bebas Neue', sans-serif; font-size: 8rem; color: var(--secondary); text-shadow: 0 0 50px rgba(255,107,0,0.5); animation: countPulse 0.5s ease-out; }
@keyframes countPulse { 0% { transform: scale(1.3); opacity: 0.5; } 100% { transform: scale(1); opacity: 1; } }
.countdown-text { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 6px; color: var(--text-muted); }

/* Game */
#gameScreen { justify-content: flex-start; padding-top: 70px; }
.scoreboard { width: 100%; max-width: 380px; background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%); border: 3px solid #222; border-radius: 15px; padding: 15px 20px; margin-bottom: 15px; }
.scoreboard-main { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.scoreboard-tier { font-family: 'Bebas Neue', sans-serif; font-size: 0.85rem; letter-spacing: 2px; color: var(--text-muted); padding: 4px 10px; background: rgba(255,255,255,0.05); border-radius: 8px; }
.scoreboard-score { font-family: 'Bebas Neue', sans-serif; font-size: 2.8rem; color: var(--secondary); text-shadow: 0 0 20px rgba(255,107,0,0.4); }
.quarter-display { display: flex; justify-content: center; gap: 8px; margin-bottom: 10px; }
.quarter-dot { width: 45px; height: 8px; border-radius: 4px; background: rgba(255,255,255,0.1); transition: all 0.3s ease; }
.quarter-dot.active { transform: scaleY(1.4); box-shadow: 0 0 10px currentColor; }
.quarter-dot.completed { opacity: 0.4; }
.quarter-dot.q1 { background: var(--q1); } .quarter-dot.q2 { background: var(--q2); } .quarter-dot.q3 { background: var(--q3); } .quarter-dot.q4 { background: var(--q4); }
.quarter-info { display: flex; justify-content: center; gap: 20px; font-size: 0.85rem; color: var(--text-muted); }
.quarter-label { font-family: 'Bebas Neue', sans-serif; font-size: 1rem; letter-spacing: 2px; }
.quarter-label.q1 { color: var(--q1); } .quarter-label.q2 { color: var(--q2); } .quarter-label.q3 { color: var(--q3); } .quarter-label.q4 { color: var(--q4); }

.message-area { height: 45px; display: flex; align-items: center; justify-content: center; margin-bottom: 10px; }
.game-message { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 2px; color: var(--text-light); }
.game-message.watching { animation: pulse 1.2s ease-in-out infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
.game-message.success { color: var(--success); }
.game-message.error { color: var(--danger); }

.court { position: relative; width: min(92vw, 360px); height: min(92vw, 360px); background: linear-gradient(145deg, #C4813A 0%, #A66B2A 50%, #8B5A1B 100%); border-radius: 15px; border: 4px solid #6B4513; overflow: hidden; box-shadow: inset 0 0 60px rgba(0,0,0,0.4), 0 15px 50px rgba(0,0,0,0.6); }
.court-markings { position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none; }
.court-center-line { position: absolute; top: 0; left: 50%; width: 3px; height: 100%; background: var(--court-lines); transform: translateX(-50%); }
.court-center-circle { position: absolute; top: 50%; left: 50%; width: 70px; height: 70px; border: 3px solid var(--court-lines); border-radius: 50%; transform: translate(-50%, -50%); }
.trail-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }
.star-container { position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 10; }

.star-node { position: absolute; width: 52px; height: 52px; transform: translate(-50%, -50%); cursor: pointer; transition: all 0.15s ease; -webkit-tap-highlight-color: transparent; }
.star-node svg { width: 100%; height: 100%; filter: drop-shadow(0 3px 6px rgba(0,0,0,0.5)); transition: all 0.2s ease; }
.star-node svg polygon { transition: fill 0.2s ease; }
.star-node.disabled { pointer-events: none; }

/* Vibrant star colors - always visible */
.star-node.color-0 svg, .star-node.color-0 svg polygon { fill: #FF6B6B; }
.star-node.color-1 svg, .star-node.color-1 svg polygon { fill: #4ECDC4; }
.star-node.color-2 svg, .star-node.color-2 svg polygon { fill: #45B7D1; }
.star-node.color-3 svg, .star-node.color-3 svg polygon { fill: #96CEB4; }
.star-node.color-4 svg, .star-node.color-4 svg polygon { fill: #FFEAA7; }
.star-node.color-5 svg, .star-node.color-5 svg polygon { fill: #DDA0DD; }
.star-node.color-6 svg, .star-node.color-6 svg polygon { fill: #FF8C42; }
.star-node.color-7 svg, .star-node.color-7 svg polygon { fill: #A8E6CF; }

/* Lit state - glowing */
.star-node.lit svg { transform: scale(1.3); }
.star-node.lit.color-0 svg { filter: drop-shadow(0 0 20px #FF6B6B) drop-shadow(0 0 40px #FF6B6B); }
.star-node.lit.color-1 svg { filter: drop-shadow(0 0 20px #4ECDC4) drop-shadow(0 0 40px #4ECDC4); }
.star-node.lit.color-2 svg { filter: drop-shadow(0 0 20px #45B7D1) drop-shadow(0 0 40px #45B7D1); }
.star-node.lit.color-3 svg { filter: drop-shadow(0 0 20px #96CEB4) drop-shadow(0 0 40px #96CEB4); }
.star-node.lit.color-4 svg { filter: drop-shadow(0 0 20px #FFEAA7) drop-shadow(0 0 40px #FFEAA7); }
.star-node.lit.color-5 svg { filter: drop-shadow(0 0 20px #DDA0DD) drop-shadow(0 0 40px #DDA0DD); }
.star-node.lit.color-6 svg { filter: drop-shadow(0 0 20px #FF8C42) drop-shadow(0 0 40px #FF8C42); }
.star-node.lit.color-7 svg { filter: drop-shadow(0 0 20px #A8E6CF) drop-shadow(0 0 40px #A8E6CF); }

/* Completed - success green */
.star-node.completed svg, .star-node.completed svg polygon { fill: var(--success) !important; }
.star-node.completed svg { filter: drop-shadow(0 0 15px var(--success)); }

/* Error - danger red */
.star-node.error svg, .star-node.error svg polygon { fill: var(--danger) !important; }
.star-node.error svg { filter: drop-shadow(0 0 15px var(--danger)); animation: shake 0.3s ease; }
@keyframes shake { 0%, 100% { transform: translate(-50%, -50%) rotate(0deg); } 25% { transform: translate(-50%, -50%) rotate(-15deg); } 75% { transform: translate(-50%, -50%) rotate(15deg); } }

/* Halftime */
#halftimeScreen { justify-content: center; }
.halftime-icon { font-size: 4rem; margin-bottom: 15px; }
.halftime-title { font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; letter-spacing: 5px; color: var(--secondary); margin-bottom: 10px; }
.halftime-score { font-family: 'Bebas Neue', sans-serif; font-size: 4rem; color: var(--text-light); text-shadow: 0 0 30px rgba(255,107,0,0.3); margin-bottom: 25px; }
.halftime-stats { background: var(--bg-card); border-radius: 15px; padding: 20px 30px; margin-bottom: 25px; }
.halftime-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
.halftime-row:last-child { border-bottom: none; }
.halftime-label { color: var(--text-muted); }
.halftime-value { font-weight: 700; color: var(--secondary); }
.continue-btn { padding: 16px 45px; font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 4px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: var(--text-light); border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; }
.continue-btn:hover { transform: scale(1.05); }

/* Final */
#finalScreen { justify-content: flex-start; padding-top: 60px; }
.final-trophy { font-size: 4.5rem; margin-bottom: 15px; animation: trophyFloat 2s ease-in-out infinite; }
@keyframes trophyFloat { 0%, 100% { transform: translateY(0) rotate(-3deg); } 50% { transform: translateY(-10px) rotate(3deg); } }
.final-title { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; letter-spacing: 4px; background: linear-gradient(135deg, var(--secondary) 0%, var(--gold) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 5px; }
.final-tier-badge { font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; letter-spacing: 3px; color: var(--text-muted); margin-bottom: 20px; }
.final-score-box { background: var(--bg-card); border: 3px solid var(--secondary); border-radius: 20px; padding: 25px 45px; margin-bottom: 20px; }
.final-score-label { font-family: 'Bebas Neue', sans-serif; font-size: 0.9rem; letter-spacing: 3px; color: var(--text-muted); }
.final-score-value { font-family: 'Bebas Neue', sans-serif; font-size: 4.5rem; color: var(--secondary); text-shadow: 0 0 30px rgba(255,107,0,0.4); line-height: 1; }
.final-best-badge { margin-top: 10px; padding: 6px 15px; background: var(--success); color: var(--bg-dark); border-radius: 20px; font-size: 0.8rem; font-weight: 700; display: inline-block; }

.tier-progress-box { width: 100%; max-width: 320px; background: var(--bg-card); border-radius: 15px; padding: 20px; margin-bottom: 20px; }
.tier-progress-title { font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px; }
.tier-progress-bar-lg { width: 100%; height: 12px; background: rgba(255,255,255,0.1); border-radius: 6px; overflow: hidden; margin-bottom: 8px; }
.tier-progress-fill-lg { height: 100%; background: linear-gradient(90deg, var(--secondary) 0%, var(--gold) 100%); border-radius: 6px; transition: width 0.5s ease; }
.tier-progress-info { display: flex; justify-content: space-between; font-size: 0.8rem; }
.tier-progress-current { color: var(--secondary); font-weight: 700; }
.tier-progress-goal { color: var(--text-muted); }
.tier-unlock-msg { margin-top: 15px; padding: 12px 20px; background: rgba(0,217,165,0.1); border: 2px solid var(--success); border-radius: 12px; color: var(--success); font-weight: 700; font-size: 0.9rem; }

.quarter-breakdown { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 100%; max-width: 320px; margin-bottom: 20px; }
.quarter-box { background: var(--bg-card); border-radius: 10px; padding: 12px 8px; text-align: center; }
.quarter-box-label { font-size: 0.75rem; margin-bottom: 4px; }
.quarter-box-label.q1 { color: var(--q1); } .quarter-box-label.q2 { color: var(--q2); } .quarter-box-label.q3 { color: var(--q3); } .quarter-box-label.q4 { color: var(--q4); }
.quarter-box-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; color: var(--text-light); }

.final-stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 100%; max-width: 320px; margin-bottom: 25px; }
.final-stat-box { background: var(--bg-card); border-radius: 12px; padding: 15px; text-align: center; }
.final-stat-icon { font-size: 1.4rem; margin-bottom: 5px; }
.final-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; color: var(--text-light); }
.final-stat-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

.action-buttons { display: flex; flex-direction: column; gap: 12px; width: 100%; max-width: 280px; }
.play-again-btn { padding: 16px 40px; font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 3px; background: linear-gradient(135deg, var(--secondary) 0%, var(--ball-dark) 100%); color: var(--text-light); border: none; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 5px 25px rgba(255,107,0,0.3); }
.play-again-btn:hover { transform: scale(1.05); box-shadow: 0 8px 35px rgba(255,107,0,0.4); }
.home-link { padding: 14px 40px; font-family: 'Nunito', sans-serif; font-size: 0.95rem; font-weight: 700; background: transparent; color: var(--text-muted); border: 2px solid rgba(255,255,255,0.15); border-radius: 50px; text-decoration: none; transition: all 0.3s ease; display: inline-block; }
.home-link:hover { border-color: var(--primary-light); color: var(--text-light); }

.rhythm-badge { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.85); border: 2px solid var(--secondary); border-radius: 25px; padding: 8px 18px; display: none; align-items: center; gap: 8px; z-index: 100; }
.rhythm-badge.visible { display: flex; }
.rhythm-badge-icon { font-size: 1rem; }
.rhythm-badge-text { font-size: 0.7rem; color: var(--secondary); font-weight: 700; letter-spacing: 1px; }

@media (max-width: 380px) { .pistol-logo { font-size: 2.6rem; } .court { width: min(88vw, 320px); height: min(88vw, 320px); } .star-node { width: 45px; height: 45px; } .quarter-breakdown { grid-template-columns: repeat(2, 1fr); } }

/* Tutorial Overlay */
.tutorial-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.95);
    z-index: 1000;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}
.tutorial-overlay.active { display: flex; }

.tutorial-container {
    width: 100%;
    max-width: 360px;
    background: var(--bg-card);
    border-radius: 25px;
    padding: 30px 25px;
    text-align: center;
    border: 2px solid rgba(255,107,0,0.3);
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    position: relative;
}

.tutorial-lang-toggle {
    position: absolute;
    top: 15px;
    right: 15px;
    display: flex;
    gap: 5px;
}
.tutorial-lang-btn {
    padding: 5px 10px;
    border: 2px solid var(--secondary);
    background: transparent;
    color: var(--secondary);
    border-radius: 10px;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 0.7rem;
    cursor: pointer;
    transition: all 0.3s ease;
}
.tutorial-lang-btn:hover { background: rgba(255,107,0,0.2); }
body[data-lang="en"] .tutorial-lang-btn[data-lang="en"] { background: var(--secondary); color: var(--text-light); }
body[data-lang="es"] .tutorial-lang-btn[data-lang="es"] { background: var(--secondary); color: var(--text-light); }

.tutorial-progress {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 25px;
}
.tutorial-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    transition: all 0.3s ease;
}
.tutorial-dot.active { background: var(--secondary); transform: scale(1.2); }
.tutorial-dot.completed { background: var(--success); }

.tutorial-slide { display: none; }
.tutorial-slide.active { display: block; animation: fadeIn 0.4s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.tutorial-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    display: block;
}

.tutorial-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    letter-spacing: 3px;
    color: var(--secondary);
    margin-bottom: 15px;
}

.tutorial-text {
    font-size: 1rem;
    color: var(--text-light);
    line-height: 1.6;
    margin-bottom: 20px;
}

.tutorial-demo {
    width: 200px;
    height: 150px;
    margin: 0 auto 25px auto;
    background: linear-gradient(145deg, #C4813A 0%, #8B5A1B 100%);
    border-radius: 15px;
    position: relative;
    overflow: hidden;
    border: 3px solid #6B4513;
}

.demo-star {
    position: absolute;
    width: 35px;
    height: 35px;
    transform: translate(-50%, -50%);
}
.demo-star svg {
    width: 100%;
    height: 100%;
    transition: all 0.3s ease;
}
.demo-star svg polygon { transition: fill 0.3s ease; }
#demoStar1 svg, #demoStar1 svg polygon { fill: #FF6B6B; }
#demoStar2 svg, #demoStar2 svg polygon { fill: #4ECDC4; }
#demoStar3 svg, #demoStar3 svg polygon { fill: #FFEAA7; }
.demo-star.lit svg, .demo-star.lit svg polygon { fill: #FFEAA7 !important; filter: drop-shadow(0 0 15px #FFEAA7); transform: scale(1.2); }
.demo-star.completed svg, .demo-star.completed svg polygon { fill: var(--success) !important; filter: drop-shadow(0 0 10px var(--success)); }
.demo-star.pulse svg { animation: demoPulse 0.6s ease infinite; }
@keyframes demoPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }

.demo-trail {
    position: absolute;
    top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none;
}

.demo-hand {
    position: absolute;
    font-size: 1.8rem;
    transition: all 0.5s ease;
    opacity: 0;
}
.demo-hand.visible { opacity: 1; }

.tutorial-tip {
    background: rgba(255,107,0,0.1);
    border-radius: 12px;
    padding: 12px 15px;
    margin-bottom: 20px;
}
.tutorial-tip-icon { font-size: 1.2rem; margin-right: 8px; }
.tutorial-tip-text { font-size: 0.85rem; color: var(--secondary); }

.tutorial-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.tutorial-btn {
    padding: 12px 25px;
    border-radius: 25px;
    font-family: 'Nunito', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
}
.tutorial-btn-skip {
    background: transparent;
    border: 2px solid rgba(255,255,255,0.2);
    color: var(--text-muted);
}
.tutorial-btn-skip:hover { border-color: rgba(255,255,255,0.4); color: var(--text-light); }
.tutorial-btn-next {
    background: linear-gradient(135deg, var(--secondary) 0%, var(--ball-dark) 100%);
    border: none;
    color: var(--text-light);
}
.tutorial-btn-next:hover { transform: scale(1.05); }
.tutorial-btn-start {
    background: linear-gradient(135deg, var(--success) 0%, #00B389 100%);
    border: none;
    color: var(--bg-dark);
    padding: 14px 35px;
    font-size: 1rem;
}
.tutorial-btn-start:hover { transform: scale(1.05); }

.help-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--bg-card);
    border: 2px solid rgba(255,255,255,0.1);
    color: var(--text-muted);
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 99;
    display: flex;
    align-items: center;
    justify-content: center;
}
.help-btn:hover { border-color: var(--secondary); color: var(--secondary); }
</style>
</head>
<body data-lang="en">
<script>
(function(){if(window.location.hostname.includes('onrender.com')){var p=sessionStorage.getItem('gostar-user-pin'),c=sessionStorage.getItem('gostar-user-code'),n=sessionStorage.getItem('gostar-user-name');if(!p&&!(c&&n))window.location.href='/play';}})();
</script>
<div class="court-bg"></div>
<div class="top-controls"><a href="#" onclick="logout(); return false;" class="back-link"><span class="lang-en">‚Üê Logout</span><span class="lang-es">‚Üê Salir</span></a><div class="lang-toggle"><button class="lang-btn active" onclick="setLang('en')">EN</button><button class="lang-btn" onclick="setLang('es')">ES</button></div></div>

<div class="screen active" id="welcomeScreen">
<div class="pistol-logo">GOTROTTERS</div>
<div class="pistol-subtitle"><span class="lang-en">THE PISTOL'S WAY</span><span class="lang-es">EL CAMINO DEL PISTOL</span></div>
<div class="pistol-icon">üèÄ</div>
<div class="pistol-quote"><div class="pistol-quote-text"><span class="lang-en">"I don't want to play 10 years and then be forgotten. I want to be remembered."</span><span class="lang-es">"No quiero jugar 10 a√±os y que me olviden. Quiero que me recuerden."</span></div><div class="pistol-quote-attr">‚Äî Pistol Pete Maravich</div></div>
<div class="tier-section"><div class="section-label"><span class="lang-en">SELECT YOUR LEVEL</span><span class="lang-es">ESCOGE TU NIVEL</span></div><div class="tier-grid" id="tierGrid"></div></div>
<div class="rhythm-section"><div class="section-label"><span class="lang-en">RHYTHM</span><span class="lang-es">RITMO</span></div><div class="rhythm-grid"><div class="rhythm-btn" data-rhythm="steady" onclick="selectRhythm('steady')"><span class="rhythm-icon">üö∂</span><span class="rhythm-label"><span class="lang-en">Steady</span><span class="lang-es">Suave</span></span><span class="rhythm-bpm">90 BPM</span></div><div class="rhythm-btn selected" data-rhythm="showtime" onclick="selectRhythm('showtime')"><span class="rhythm-icon">‚≠ê</span><span class="rhythm-label">Showtime</span><span class="rhythm-bpm">127 BPM</span></div><div class="rhythm-btn" data-rhythm="pistol" onclick="selectRhythm('pistol')"><span class="rhythm-icon">üî•</span><span class="rhythm-label">Pistol</span><span class="rhythm-bpm">150 BPM</span></div></div></div>
<button class="start-btn" onclick="startGame()"><span class="lang-en">TIP OFF</span><span class="lang-es">¬°DALE!</span></button>
<div class="stats-summary" id="statsSummary"><div class="stat-item"><div class="stat-value" id="totalGames">0</div><div class="stat-label"><span class="lang-en">Games</span><span class="lang-es">Juegos</span></div></div><div class="stat-item"><div class="stat-value" id="bestScore">0</div><div class="stat-label"><span class="lang-en">Best</span><span class="lang-es">Mejor</span></div></div><div class="stat-item"><div class="stat-value" id="currentStreak">0</div><div class="stat-label"><span class="lang-en">Streak</span><span class="lang-es">Racha</span></div></div></div>
</div>

<div class="screen" id="countdownScreen"><div class="countdown-tier" id="countdownTier">ROOKIE</div><div class="pistol-icon" style="animation:none;font-size:3rem;">üèÄ</div><div class="countdown-number" id="countdownNum">3</div><div class="countdown-text"><span class="lang-en">GET READY</span><span class="lang-es">¬°PREP√ÅRATE!</span></div></div>

<div class="screen" id="gameScreen">
<div class="scoreboard"><div class="scoreboard-main"><div class="scoreboard-tier" id="gameTier">ROOKIE</div><div class="scoreboard-score" id="scoreDisplay">0</div></div><div class="quarter-display" id="quarterDots"><div class="quarter-dot q1"></div><div class="quarter-dot q2"></div><div class="quarter-dot q3"></div><div class="quarter-dot q4"></div></div><div class="quarter-info"><span class="quarter-label q1" id="quarterLabel">Q1</span><span id="roundInfo"><span class="lang-en">Round</span><span class="lang-es">Ronda</span> <span id="roundNum">1</span>/<span id="roundTotal">4</span></span></div></div>
<div class="message-area"><div class="game-message watching" id="gameMessage"><span class="lang-en">Watch the trail...</span><span class="lang-es">Mira el camino...</span></div></div>
<div class="court" id="court"><div class="court-markings"><div class="court-center-line"></div><div class="court-center-circle"></div></div><canvas class="trail-canvas" id="trailCanvas"></canvas><div class="star-container" id="starContainer"></div></div>
</div>

<div class="screen" id="halftimeScreen"><div class="halftime-icon">üèÄ</div><div class="halftime-title"><span class="lang-en">HALFTIME</span><span class="lang-es">MEDIO TIEMPO</span></div><div class="halftime-score" id="halftimeScore">0</div><div class="halftime-stats"><div class="halftime-row"><span class="halftime-label">Q1</span><span class="halftime-value" id="htQ1">0</span></div><div class="halftime-row"><span class="halftime-label">Q2</span><span class="halftime-value" id="htQ2">0</span></div><div class="halftime-row"><span class="halftime-label"><span class="lang-en">Accuracy</span><span class="lang-es">Precisi√≥n</span></span><span class="halftime-value" id="htAccuracy">0%</span></div></div><button class="continue-btn" onclick="continueToSecondHalf()"><span class="lang-en">2ND HALF ‚Üí</span><span class="lang-es">¬°PA' LA SEGUNDA! ‚Üí</span></button></div>

<div class="screen" id="finalScreen">
<div class="final-trophy" id="finalTrophy">üèÜ</div><div class="final-title"><span class="lang-en">GAME COMPLETE</span><span class="lang-es">¬°JUEGO COMPLETO!</span></div><div class="final-tier-badge" id="finalTierBadge">ROOKIE</div>
<div class="final-score-box"><div class="final-score-label"><span class="lang-en">FINAL SCORE</span><span class="lang-es">PUNTUACI√ìN FINAL</span></div><div class="final-score-value" id="finalScore">0</div><div class="final-best-badge" id="finalBestBadge" style="display:none;"><span class="lang-en">üéâ NEW BEST!</span><span class="lang-es">üéâ ¬°NUEVO R√âCORD!</span></div></div>
<div class="tier-progress-box" id="tierProgressBox"><div class="tier-progress-title"><span class="lang-en">Progress to Next Level</span><span class="lang-es">Progreso al Pr√≥ximo Nivel</span></div><div class="tier-progress-bar-lg"><div class="tier-progress-fill-lg" id="tierProgressFill" style="width:0%;"></div></div><div class="tier-progress-info"><span class="tier-progress-current" id="tierProgressCurrent">0 / 3</span><span class="tier-progress-goal" id="tierProgressGoal">Unlock: JV</span></div><div class="tier-unlock-msg" id="tierUnlockMsg" style="display:none;"><span class="lang-en">üéâ NEW LEVEL UNLOCKED!</span><span class="lang-es">üéâ ¬°SUBISTE DE NIVEL!</span></div></div>
<div class="quarter-breakdown"><div class="quarter-box"><div class="quarter-box-label q1">Q1</div><div class="quarter-box-value" id="finalQ1">0</div></div><div class="quarter-box"><div class="quarter-box-label q2">Q2</div><div class="quarter-box-value" id="finalQ2">0</div></div><div class="quarter-box"><div class="quarter-box-label q3">Q3</div><div class="quarter-box-value" id="finalQ3">0</div></div><div class="quarter-box"><div class="quarter-box-label q4">Q4</div><div class="quarter-box-value" id="finalQ4">0</div></div></div>
<div class="final-stats-grid"><div class="final-stat-box"><div class="final-stat-icon">üéØ</div><div class="final-stat-value" id="finalAccuracy">0%</div><div class="final-stat-label"><span class="lang-en">Accuracy</span><span class="lang-es">Precisi√≥n</span></div></div><div class="final-stat-box"><div class="final-stat-icon">‚≠ê</div><div class="final-stat-value" id="finalLongest">0</div><div class="final-stat-label"><span class="lang-en">Longest Trail</span><span class="lang-es">Camino M√°s Largo</span></div></div></div>
<div class="action-buttons"><button class="play-again-btn" onclick="playAgain()"><span class="lang-en">PLAY AGAIN</span><span class="lang-es">JUGAR OTRA VEZ</span></button><a href="#" onclick="logout(); return false;" class="home-link"><span class="lang-en">üö™ Logout</span><span class="lang-es">üö™ Salir</span></a></div>
</div>

<div class="rhythm-badge" id="rhythmBadge"><span class="rhythm-badge-icon">üéµ</span><span class="rhythm-badge-text" id="rhythmBadgeText">SHOWTIME ‚Ä¢ 127 BPM</span></div>

<!-- Help Button -->
<button class="help-btn" id="helpBtn" onclick="showTutorial()">?</button>

<!-- Tutorial Overlay -->
<div class="tutorial-overlay" id="tutorialOverlay">
<div class="tutorial-container">
    <!-- Language Toggle in Tutorial -->
    <div class="tutorial-lang-toggle">
        <button class="tutorial-lang-btn" onclick="setLang('en')" data-lang="en">EN</button>
        <button class="tutorial-lang-btn" onclick="setLang('es')" data-lang="es">ES</button>
    </div>
    
    <div class="tutorial-progress">
        <div class="tutorial-dot active" data-slide="0"></div>
        <div class="tutorial-dot" data-slide="1"></div>
        <div class="tutorial-dot" data-slide="2"></div>
        <div class="tutorial-dot" data-slide="3"></div>
    </div>
    
    <!-- Slide 1: Welcome -->
    <div class="tutorial-slide active" data-slide="0">
        <span class="tutorial-icon">üèÄ</span>
        <h2 class="tutorial-title">
            <span class="lang-en">WELCOME TO GOTROTTERS</span>
            <span class="lang-es">BIENVENIDO A GOTROTTERS</span>
        </h2>
        <p class="tutorial-text">
            <span class="lang-en">Train your visual-spatial memory like Pistol Pete trained his legendary handles. Master 8 levels on your path to greatness.</span>
            <span class="lang-es">Entrena tu memoria como Pistol Pete entren√≥ su dribling legendario. Domina los 8 niveles pa' llegar a la grandeza.</span>
        </p>
        <div class="tutorial-buttons">
            <button class="tutorial-btn tutorial-btn-skip" onclick="closeTutorial()">
                <span class="lang-en">Skip</span>
                <span class="lang-es">Saltar</span>
            </button>
            <button class="tutorial-btn tutorial-btn-next" onclick="nextSlide()">
                <span class="lang-en">Next ‚Üí</span>
                <span class="lang-es">Siguiente ‚Üí</span>
            </button>
        </div>
    </div>
    
    <!-- Slide 2: Watch -->
    <div class="tutorial-slide" data-slide="1">
        <h2 class="tutorial-title">
            <span class="lang-en">STEP 1: WATCH</span>
            <span class="lang-es">PASO 1: MIRA</span>
        </h2>
        <div class="tutorial-demo" id="demoWatch">
            <svg class="demo-trail" id="demoTrail1"></svg>
            <div class="demo-star" id="demoStar1" style="left: 30%; top: 30%;"><svg viewBox="0 0 100 100"><polygon fill="#FF6B6B" points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg></div>
            <div class="demo-star" id="demoStar2" style="left: 70%; top: 40%;"><svg viewBox="0 0 100 100"><polygon fill="#4ECDC4" points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg></div>
            <div class="demo-star" id="demoStar3" style="left: 50%; top: 75%;"><svg viewBox="0 0 100 100"><polygon fill="#FFEAA7" points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg></div>
        </div>
        <p class="tutorial-text">
            <span class="lang-en">Stars will light up one by one. Watch carefully and remember the order!</span>
            <span class="lang-es">Las estrellas se prenden una por una. ¬°F√≠jate bien y recuerda el orden!</span>
        </p>
        <div class="tutorial-buttons">
            <button class="tutorial-btn tutorial-btn-skip" onclick="prevSlide()">
                <span class="lang-en">‚Üê Back</span>
                <span class="lang-es">‚Üê Atr√°s</span>
            </button>
            <button class="tutorial-btn tutorial-btn-next" onclick="nextSlide()">
                <span class="lang-en">Next ‚Üí</span>
                <span class="lang-es">Siguiente ‚Üí</span>
            </button>
        </div>
    </div>
    
    <!-- Slide 3: Tap -->
    <div class="tutorial-slide" data-slide="2">
        <h2 class="tutorial-title">
            <span class="lang-en">STEP 2: TAP</span>
            <span class="lang-es">PASO 2: TOCA</span>
        </h2>
        <div class="tutorial-demo" id="demoTap">
            <svg class="demo-trail" id="demoTrail2"></svg>
            <div class="demo-star completed" id="demoTapStar1" style="left: 30%; top: 30%;"><svg viewBox="0 0 100 100"><polygon fill="#00D9A5" points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg></div>
            <div class="demo-star completed" id="demoTapStar2" style="left: 70%; top: 40%;"><svg viewBox="0 0 100 100"><polygon fill="#00D9A5" points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg></div>
            <div class="demo-star pulse" id="demoTapStar3" style="left: 50%; top: 75%;"><svg viewBox="0 0 100 100"><polygon fill="#FFEAA7" points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg></div>
            <div class="demo-hand" id="demoHand" style="left: 50%; top: 80%;">üëÜ</div>
        </div>
        <p class="tutorial-text">
            <span class="lang-en">Tap the stars in the same order. The trail connects as you go. Complete the path to score!</span>
            <span class="lang-es">Toca las estrellas en el mismo orden. El camino se conecta mientras avanzas. ¬°Completa la ruta pa' anotar!</span>
        </p>
        <div class="tutorial-buttons">
            <button class="tutorial-btn tutorial-btn-skip" onclick="prevSlide()">
                <span class="lang-en">‚Üê Back</span>
                <span class="lang-es">‚Üê Atr√°s</span>
            </button>
            <button class="tutorial-btn tutorial-btn-next" onclick="nextSlide()">
                <span class="lang-en">Next ‚Üí</span>
                <span class="lang-es">Siguiente ‚Üí</span>
            </button>
        </div>
    </div>
    
    <!-- Slide 4: Progress -->
    <div class="tutorial-slide" data-slide="3">
        <span class="tutorial-icon">üèÜ</span>
        <h2 class="tutorial-title">
            <span class="lang-en">EARN YOUR WAY UP</span>
            <span class="lang-es">SUBE DE NIVEL</span>
        </h2>
        <p class="tutorial-text">
            <span class="lang-en">Complete games to unlock higher levels. From Rookie to Pistol ‚Äî 8 tiers of mastery await. No shortcuts. Just dedication.</span>
            <span class="lang-es">Completa juegos pa' desbloquear niveles m√°s altos. De Novato a Pistol ‚Äî 8 niveles de maestr√≠a te esperan. Sin atajos. Solo dedicaci√≥n.</span>
        </p>
        <div class="tutorial-tip">
            <span class="tutorial-tip-icon">üí°</span>
            <span class="tutorial-tip-text">
                <span class="lang-en">Tip: Start with "Showtime" rhythm ‚Äî it's the sweet spot!</span>
                <span class="lang-es">Tip: Empieza con el ritmo "Showtime" ‚Äî ¬°es el punto perfecto!</span>
            </span>
        </div>
        <div class="tutorial-buttons">
            <button class="tutorial-btn tutorial-btn-start" onclick="closeTutorial()">
                <span class="lang-en">LET'S GO! üèÄ</span>
                <span class="lang-es">¬°PA'LANTE! üèÄ</span>
            </button>
        </div>
    </div>
</div>
</div>

<script>
var starSVG='<svg viewBox="0 0 100 100"><polygon points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg>';
var audioCtx=null;function getAudioContext(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();return audioCtx;}
var starFreqs=[261.63,293.66,329.63,349.23,392,440,493.88,523.25];
function playStarSound(i){try{var ctx=getAudioContext();if(ctx.state==='suspended')ctx.resume();var f=starFreqs[i%8],o=ctx.createOscillator(),g=ctx.createGain();o.type='sine';o.frequency.value=f;o.connect(g);g.connect(ctx.destination);g.gain.setValueAtTime(0.35,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.25);o.start(ctx.currentTime);o.stop(ctx.currentTime+0.3);var o2=ctx.createOscillator(),g2=ctx.createGain();o2.type='sine';o2.frequency.value=f*2;o2.connect(g2);g2.connect(ctx.destination);g2.gain.setValueAtTime(0.1,ctx.currentTime);g2.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.15);o2.start(ctx.currentTime);o2.stop(ctx.currentTime+0.2);}catch(e){}}
function playSuccessSound(){try{var ctx=getAudioContext();if(ctx.state==='suspended')ctx.resume();[523.25,659.25,783.99,1046.5].forEach(function(f,i){var o=ctx.createOscillator(),g=ctx.createGain();o.type='sine';o.frequency.value=f;o.connect(g);g.connect(ctx.destination);var t=ctx.currentTime+i*0.08;g.gain.setValueAtTime(0.25,t);g.gain.exponentialRampToValueAtTime(0.01,t+0.2);o.start(t);o.stop(t+0.25);});}catch(e){}}
function playErrorSound(){try{var ctx=getAudioContext();if(ctx.state==='suspended')ctx.resume();var o=ctx.createOscillator(),g=ctx.createGain();o.type='sawtooth';o.frequency.value=150;o.connect(g);g.connect(ctx.destination);g.gain.setValueAtTime(0.2,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.25);o.start(ctx.currentTime);o.stop(ctx.currentTime+0.3);}catch(e){}}
function playCountdownBeep(){try{var ctx=getAudioContext();if(ctx.state==='suspended')ctx.resume();var o=ctx.createOscillator(),g=ctx.createGain();o.type='sine';o.frequency.value=440;o.connect(g);g.connect(ctx.destination);g.gain.setValueAtTime(0.25,ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.1);o.start(ctx.currentTime);o.stop(ctx.currentTime+0.15);}catch(e){}}
function playWhistle(){try{var ctx=getAudioContext();if(ctx.state==='suspended')ctx.resume();var o=ctx.createOscillator(),g=ctx.createGain();o.type='sine';o.frequency.setValueAtTime(2500,ctx.currentTime);o.frequency.setValueAtTime(2000,ctx.currentTime+0.1);o.frequency.setValueAtTime(2500,ctx.currentTime+0.2);o.connect(g);g.connect(ctx.destination);g.gain.setValueAtTime(0.15,ctx.currentTime);g.gain.setValueAtTime(0.15,ctx.currentTime+0.25);g.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.35);o.start(ctx.currentTime);o.stop(ctx.currentTime+0.4);}catch(e){}}

var currentLang=localStorage.getItem('gostar-lang')||'en';document.body.setAttribute('data-lang',currentLang);
function setLang(l){currentLang=l;localStorage.setItem('gostar-lang',l);document.body.setAttribute('data-lang',l);document.querySelectorAll('.lang-btn').forEach(function(b){b.classList.toggle('active',b.textContent.trim()===l.toUpperCase());});}

var tierConfig={rookie:{name:'ROOKIE',icon:'üåü',stars:4,seqMin:3,seqMax:4,roundsPerQ:3,unlockReq:0,nextTier:'jv'},jv:{name:'JV',icon:'üèÄ',stars:5,seqMin:4,seqMax:5,roundsPerQ:4,unlockReq:3,nextTier:'varsity'},varsity:{name:'VARSITY',icon:'üéΩ',stars:6,seqMin:5,seqMax:6,roundsPerQ:4,unlockReq:5,nextTier:'college'},college:{name:'COLLEGE',icon:'üéì',stars:7,seqMin:6,seqMax:7,roundsPerQ:5,unlockReq:7,nextTier:'pro'},pro:{name:'PRO',icon:'üí∞',stars:8,seqMin:7,seqMax:8,roundsPerQ:5,unlockReq:10,nextTier:'allstar'},allstar:{name:'ALL-STAR',icon:'‚≠ê',stars:9,seqMin:8,seqMax:9,roundsPerQ:5,unlockReq:15,nextTier:'legend'},legend:{name:'LEGEND',icon:'üèÜ',stars:10,seqMin:9,seqMax:10,roundsPerQ:6,unlockReq:20,nextTier:'pistol'},pistol:{name:'PISTOL',icon:'üî•',stars:12,seqMin:10,seqMax:12,roundsPerQ:6,unlockReq:25,nextTier:null}};
var tierOrder=['rookie','jv','varsity','college','pro','allstar','legend','pistol'];
var rhythmConfig={steady:{bpm:90,noteLength:650,pauseAfter:380,label:'STEADY ‚Ä¢ 90 BPM'},showtime:{bpm:127,noteLength:470,pauseAfter:260,label:'SHOWTIME ‚Ä¢ 127 BPM'},pistol:{bpm:150,noteLength:380,pauseAfter:180,label:'PISTOL ‚Ä¢ 150 BPM'}};

function getProgress(){var s=localStorage.getItem('gotrotters-progress');if(s)return JSON.parse(s);return{completions:{rookie:0,jv:0,varsity:0,college:0,pro:0,allstar:0,legend:0,pistol:0},bestScores:{rookie:0,jv:0,varsity:0,college:0,pro:0,allstar:0,legend:0,pistol:0},totalGames:0,overallBest:0};}
function saveProgress(p){localStorage.setItem('gotrotters-progress',JSON.stringify(p));}
function isTierUnlocked(t){if(t==='rookie')return true;var i=tierOrder.indexOf(t);if(i<=0)return true;var prev=tierOrder[i-1],p=getProgress();return p.completions[prev]>=tierConfig[t].unlockReq;}

var selectedTier='rookie',selectedRhythm='showtime',currentQuarter=1,currentRound=1,score=0,quarterScores=[0,0,0,0],starNodes=[],sequence=[],playerIndex=0,completedStars=[],isShowingSequence=false,correctTotal=0,attemptsTotal=0,longestSequence=0;

function renderTierGrid(){var grid=document.getElementById('tierGrid');grid.innerHTML='';var progress=getProgress();tierOrder.forEach(function(id){var t=tierConfig[id],unlocked=isTierUnlocked(id),comp=progress.completions[id]||0;var btn=document.createElement('div');btn.className='tier-btn'+(id===selectedTier?' selected':'')+(!unlocked?' locked':'');btn.dataset.tier=id;if(unlocked)btn.onclick=function(){selectTier(id);};var nextReq=t.nextTier?tierConfig[t.nextTier].unlockReq:0,pct=t.nextTier?Math.min(100,(comp/nextReq)*100):100;btn.innerHTML='<span class="tier-icon">'+t.icon+'</span><div class="tier-info"><div class="tier-name">'+t.name+'</div><div class="tier-desc">'+t.stars+' stars ‚Ä¢ '+t.seqMin+'-'+t.seqMax+' seq</div></div>'+(unlocked?'<div class="tier-progress"><span class="tier-progress-text">'+comp+' done</span>'+(t.nextTier?'<div class="tier-progress-bar"><div class="tier-progress-fill" style="width:'+pct+'%"></div></div>':'<span class="tier-badge">MAX</span>')+'</div>':'<span class="tier-badge locked-badge">üîí '+tierConfig[id].unlockReq+'</span>');grid.appendChild(btn);});document.getElementById('totalGames').textContent=progress.totalGames;document.getElementById('bestScore').textContent=progress.overallBest;}
function selectTier(t){if(!isTierUnlocked(t))return;selectedTier=t;document.querySelectorAll('.tier-btn').forEach(function(b){b.classList.toggle('selected',b.dataset.tier===t);});}
function selectRhythm(r){selectedRhythm=r;document.querySelectorAll('.rhythm-btn').forEach(function(b){b.classList.toggle('selected',b.dataset.rhythm===r);});}
function showScreen(id){document.querySelectorAll('.screen').forEach(function(s){s.classList.remove('active');});document.getElementById(id).classList.add('active');}

function startGame(){currentQuarter=1;currentRound=1;score=0;quarterScores=[0,0,0,0];correctTotal=0;attemptsTotal=0;longestSequence=0;document.getElementById('rhythmBadgeText').textContent=rhythmConfig[selectedRhythm].label;document.getElementById('rhythmBadge').classList.add('visible');document.getElementById('countdownTier').textContent=tierConfig[selectedTier].name;showScreen('countdownScreen');runCountdown();}
function runCountdown(){var c=3,el=document.getElementById('countdownNum');el.textContent=c;var iv=setInterval(function(){c--;if(c>0){el.textContent=c;el.style.animation='none';el.offsetHeight;el.style.animation='countPulse 0.5s ease-out';playCountdownBeep();}else{clearInterval(iv);playWhistle();showScreen('gameScreen');initGame();}},1000);}
function initGame(){document.getElementById('gameTier').textContent=tierConfig[selectedTier].name;updateQuarterDisplay();updateScore();startRound();}
function updateQuarterDisplay(){var dots=document.querySelectorAll('.quarter-dot');dots.forEach(function(d,i){d.classList.remove('active','completed');if(i<currentQuarter-1)d.classList.add('completed');else if(i===currentQuarter-1)d.classList.add('active');});var lbl=document.getElementById('quarterLabel');lbl.textContent='Q'+currentQuarter;lbl.className='quarter-label q'+currentQuarter;document.getElementById('roundTotal').textContent=tierConfig[selectedTier].roundsPerQ;}
function updateScore(){document.getElementById('scoreDisplay').textContent=score;}
function setMessage(txt,type){var el=document.getElementById('gameMessage');el.textContent=txt;el.className='game-message'+(type?' '+type:'');}

function generateStarPositions(n){var court=document.getElementById('court'),w=court.offsetWidth,h=court.offsetHeight,pad=45;starNodes=[];for(var i=0;i<n;i++){var att=0,x,y,valid;do{x=pad+Math.random()*(w-pad*2);y=pad+Math.random()*(h-pad*2);valid=true;for(var j=0;j<starNodes.length;j++){var dx=x-starNodes[j].x,dy=y-starNodes[j].y;if(Math.sqrt(dx*dx+dy*dy)<55){valid=false;break;}}att++;}while(!valid&&att<100);starNodes.push({x:x,y:y,colorIndex:i%8});}}

var starColors=['#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FFEAA7','#DDA0DD','#FF8C42','#A8E6CF'];

function renderStars(){var c=document.getElementById('starContainer');c.innerHTML='';starNodes.forEach(function(n,i){var s=document.createElement('div');s.className='star-node color-'+n.colorIndex;s.dataset.index=i;s.style.left=n.x+'px';s.style.top=n.y+'px';var color=starColors[n.colorIndex];s.innerHTML='<svg viewBox="0 0 100 100"><polygon fill="'+color+'" points="50,5 61,40 98,40 68,62 79,97 50,75 21,97 32,62 2,40 39,40"/></svg>';s.onclick=function(){handleStarClick(i);};c.appendChild(s);});clearTrailLines();}
function clearTrailLines(){var cv=document.getElementById('trailCanvas'),ct=document.getElementById('court');cv.width=ct.offsetWidth;cv.height=ct.offsetHeight;cv.getContext('2d').clearRect(0,0,cv.width,cv.height);}
function drawTrailLines(){var cv=document.getElementById('trailCanvas'),ct=document.getElementById('court');cv.width=ct.offsetWidth;cv.height=ct.offsetHeight;var ctx=cv.getContext('2d');ctx.clearRect(0,0,cv.width,cv.height);if(completedStars.length<2)return;ctx.strokeStyle='#00D9A5';ctx.lineWidth=4;ctx.lineCap='round';ctx.shadowColor='#00D9A5';ctx.shadowBlur=15;ctx.beginPath();for(var i=0;i<completedStars.length;i++){var n=starNodes[completedStars[i]];if(i===0)ctx.moveTo(n.x,n.y);else ctx.lineTo(n.x,n.y);}ctx.stroke();}
function disableStars(d){document.querySelectorAll('.star-node').forEach(function(s){if(d)s.classList.add('disabled');else s.classList.remove('disabled');});}

function startRound(){document.getElementById('roundNum').textContent=currentRound;playerIndex=0;completedStars=[];var t=tierConfig[selectedTier];generateStarPositions(t.stars);renderStars();var len=t.seqMin+Math.floor(Math.random()*(t.seqMax-t.seqMin+1)),avail=[];for(var i=0;i<starNodes.length;i++)avail.push(i);sequence=[];for(var i=0;i<len;i++){if(avail.length===0)break;var idx=Math.floor(Math.random()*avail.length);sequence.push(avail[idx]);avail.splice(idx,1);}setMessage(currentLang==='es'?'Mira el camino...':'Watch the trail...');document.getElementById('gameMessage').classList.add('watching');disableStars(true);setTimeout(showSequence,700);}
function showSequence(){isShowingSequence=true;var rhy=rhythmConfig[selectedRhythm],i=0;function next(){if(i>0){var prev=sequence[i-1],ps=document.querySelector('.star-node[data-index="'+prev+'"]');if(ps)ps.classList.remove('lit');}if(i>=sequence.length){isShowingSequence=false;setMessage(currentLang==='es'?'¬°Te toca! Conecta las estrellas':'Your turn! Connect the stars');document.getElementById('gameMessage').classList.remove('watching');disableStars(false);return;}var idx=sequence[i],el=document.querySelector('.star-node[data-index="'+idx+'"]');if(el){el.classList.add('lit');playStarSound(starNodes[idx].colorIndex);}i++;setTimeout(next,rhy.noteLength+rhy.pauseAfter);}next();}

function handleStarClick(idx){if(isShowingSequence)return;var el=document.querySelector('.star-node[data-index="'+idx+'"]');if(!el||el.classList.contains('completed'))return;var exp=sequence[playerIndex];if(idx===exp){completedStars.push(idx);el.classList.add('completed');el.querySelector('polygon').setAttribute('fill','#00D9A5');playStarSound(starNodes[idx].colorIndex);drawTrailLines();playerIndex++;if(playerIndex>=sequence.length){correctTotal++;attemptsTotal++;if(sequence.length>longestSequence)longestSequence=sequence.length;var pts=sequence.length*20;score+=pts;quarterScores[currentQuarter-1]+=pts;disableStars(true);updateScore();playSuccessSound();setMessage((currentLang==='es'?'¬°Wepa! +':'Perfect! +')+pts,'success');setTimeout(nextRound,1200);}}else{attemptsTotal++;el.classList.add('error');el.querySelector('polygon').setAttribute('fill','#FF4757');playErrorSound();setTimeout(function(){el.classList.remove('error');el.querySelector('polygon').setAttribute('fill',starColors[starNodes[idx].colorIndex]);},300);var partial=playerIndex*10;if(partial>0){score+=partial;quarterScores[currentQuarter-1]+=partial;updateScore();}setMessage(currentLang==='es'?'¬°Otra vez!':'Try again!','error');setTimeout(nextRound,800);}}

function nextRound(){currentRound++;if(currentRound>tierConfig[selectedTier].roundsPerQ){if(currentQuarter===2){showHalftime();return;}if(currentQuarter===4){endGame();return;}advanceQuarter();return;}setTimeout(startRound,400);}
function advanceQuarter(){currentQuarter++;currentRound=1;updateQuarterDisplay();setMessage('Q'+currentQuarter+(currentLang==='es'?' - ¬°Dale!':' - Let\'s go!'));setTimeout(startRound,1200);}
function showHalftime(){document.getElementById('rhythmBadge').classList.remove('visible');document.getElementById('halftimeScore').textContent=score;document.getElementById('htQ1').textContent=quarterScores[0];document.getElementById('htQ2').textContent=quarterScores[1];var acc=attemptsTotal>0?Math.round((correctTotal/attemptsTotal)*100):0;document.getElementById('htAccuracy').textContent=acc+'%';showScreen('halftimeScreen');}
function continueToSecondHalf(){currentQuarter=3;currentRound=1;document.getElementById('rhythmBadge').classList.add('visible');showScreen('gameScreen');updateQuarterDisplay();setMessage('Q3'+(currentLang==='es'?' - ¬°Pa\' la segunda!':' - Second half!'));setTimeout(startRound,1200);}

function endGame(){document.getElementById('rhythmBadge').classList.remove('visible');var p=getProgress();p.completions[selectedTier]=(p.completions[selectedTier]||0)+1;p.totalGames++;var isNew=false;if(score>(p.bestScores[selectedTier]||0)){p.bestScores[selectedTier]=score;isNew=true;}if(score>p.overallBest)p.overallBest=score;saveProgress(p);var t=tierConfig[selectedTier],justUnlocked=false;if(t.nextTier&&p.completions[selectedTier]===tierConfig[t.nextTier].unlockReq)justUnlocked=true;document.getElementById('finalTierBadge').textContent=t.name;document.getElementById('finalScore').textContent=score;document.getElementById('finalBestBadge').style.display=isNew?'inline-block':'none';document.getElementById('finalQ1').textContent=quarterScores[0];document.getElementById('finalQ2').textContent=quarterScores[1];document.getElementById('finalQ3').textContent=quarterScores[2];document.getElementById('finalQ4').textContent=quarterScores[3];var acc=attemptsTotal>0?Math.round((correctTotal/attemptsTotal)*100):0;document.getElementById('finalAccuracy').textContent=acc+'%';document.getElementById('finalLongest').textContent=longestSequence;if(t.nextTier){var nReq=tierConfig[t.nextTier].unlockReq,cur=p.completions[selectedTier],pct=Math.min(100,(cur/nReq)*100);document.getElementById('tierProgressFill').style.width=pct+'%';document.getElementById('tierProgressCurrent').textContent=cur+' / '+nReq;document.getElementById('tierProgressGoal').textContent=(currentLang==='es'?'Pr√≥ximo: ':'Unlock: ')+tierConfig[t.nextTier].name;document.getElementById('tierProgressBox').style.display='block';document.getElementById('tierUnlockMsg').style.display=justUnlocked?'block':'none';}else{document.getElementById('tierProgressBox').style.display='none';}var trophies={rookie:'‚≠ê',jv:'üèÄ',varsity:'üéΩ',college:'üéì',pro:'üí∞',allstar:'üåü',legend:'üèÜ',pistol:'üî•'};document.getElementById('finalTrophy').textContent=trophies[selectedTier]||'üèÜ';showScreen('finalScreen');recordSession();}
function recordSession(){var pin=sessionStorage.getItem('gostar-user-pin'),code=sessionStorage.getItem('gostar-user-code'),name=sessionStorage.getItem('gostar-user-name');if(!pin&&!(code&&name))return;var payload={game:'gotrotters',score:score,tier:selectedTier};if(pin)payload.pin=pin;else{payload.accessCode=code;payload.username=name;}fetch('/api/game/session',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)}).catch(function(){});}
function playAgain(){renderTierGrid();showScreen('welcomeScreen');}
function logout(){sessionStorage.removeItem('gostar-user-pin');sessionStorage.removeItem('gostar-user-code');sessionStorage.removeItem('gostar-user-name');window.location.href='/play';}

document.querySelectorAll('.lang-btn').forEach(function(b){b.classList.toggle('active',b.textContent.trim()===currentLang.toUpperCase());});

// Tutorial System
var tutorialSlide = 0;
var demoAnimationTimer = null;

function showTutorial() {
    tutorialSlide = 0;
    updateTutorialSlide();
    document.getElementById('tutorialOverlay').classList.add('active');
    startDemoAnimations();
}

function closeTutorial() {
    document.getElementById('tutorialOverlay').classList.remove('active');
    stopDemoAnimations();
    localStorage.setItem('gotrotters-tutorial-seen', 'true');
}

function nextSlide() {
    if (tutorialSlide < 3) {
        tutorialSlide++;
        updateTutorialSlide();
    }
}

function prevSlide() {
    if (tutorialSlide > 0) {
        tutorialSlide--;
        updateTutorialSlide();
    }
}

function updateTutorialSlide() {
    document.querySelectorAll('.tutorial-slide').forEach(function(s, i) {
        s.classList.toggle('active', i === tutorialSlide);
    });
    document.querySelectorAll('.tutorial-dot').forEach(function(d, i) {
        d.classList.remove('active', 'completed');
        if (i < tutorialSlide) d.classList.add('completed');
        else if (i === tutorialSlide) d.classList.add('active');
    });
    startDemoAnimations();
}

function startDemoAnimations() {
    stopDemoAnimations();
    
    if (tutorialSlide === 1) {
        // Watch demo - animate stars lighting up
        var stars = [
            document.getElementById('demoStar1'),
            document.getElementById('demoStar2'),
            document.getElementById('demoStar3')
        ];
        var i = 0;
        
        function animateWatch() {
            stars.forEach(function(s) { s.classList.remove('lit'); });
            if (i < 3) {
                stars[i].classList.add('lit');
                i++;
                demoAnimationTimer = setTimeout(animateWatch, 700);
            } else {
                i = 0;
                demoAnimationTimer = setTimeout(animateWatch, 1000);
            }
        }
        animateWatch();
    }
    
    if (tutorialSlide === 2) {
        // Tap demo - show hand tapping
        var hand = document.getElementById('demoHand');
        var star3 = document.getElementById('demoTapStar3');
        var showing = false;
        
        function animateTap() {
            showing = !showing;
            hand.classList.toggle('visible', showing);
            if (showing) {
                setTimeout(function() {
                    star3.classList.remove('pulse');
                    star3.classList.add('completed');
                }, 300);
            } else {
                star3.classList.add('pulse');
                star3.classList.remove('completed');
            }
            demoAnimationTimer = setTimeout(animateTap, 1500);
        }
        animateTap();
    }
}

function stopDemoAnimations() {
    if (demoAnimationTimer) {
        clearTimeout(demoAnimationTimer);
        demoAnimationTimer = null;
    }
}

// Check if first time
function checkFirstTime() {
    var seen = localStorage.getItem('gotrotters-tutorial-seen');
    if (!seen) {
        setTimeout(showTutorial, 500);
    }
}

renderTierGrid();
checkFirstTime();
</script>
</body>
</html>
