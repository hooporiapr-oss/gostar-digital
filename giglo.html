<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>GIGLO - Laughter Workout | GoTrotters‚Ñ¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B00;--orange-dark:#CC5500;--teal:#00D9A5;--gold:#FFD700;--purple:#9B59B6;--pink:#FF69B4;--dark:#0a0a0f;--darker:#050508;--card:#111118;--text:#FFFFFF;--muted:#8892a0;--success:#00D9A5;--danger:#FF4757}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text)}
body.es .lang-en{display:none !important}
body.en .lang-es{display:none !important}

/* Header */
.game-header{padding:15px 20px;background:linear-gradient(135deg,rgba(155,89,182,0.2),rgba(255,105,180,0.1));border-bottom:2px solid rgba(155,89,182,0.3);display:flex;align-items:center;justify-content:space-between}
.header-left{display:flex;align-items:center;gap:12px}
.coach-header-avatar{width:40px;height:40px;border-radius:50%;overflow:hidden}
.coach-header-img{width:100%;height:100%;object-fit:cover}
.coach-label{font-size:0.65rem;color:var(--muted);letter-spacing:1px}
.back-btn{width:40px;height:40px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;color:var(--text);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.game-title{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:3px}
.game-title .gi{color:var(--purple)}
.game-title .glo{color:var(--pink)}
.tier-badge{background:linear-gradient(135deg,var(--purple),var(--pink));padding:6px 14px;border-radius:20px;font-weight:700;font-size:0.8rem}
.lang-toggle{display:flex;gap:5px}
.lang-btn{padding:6px 12px;border:2px solid var(--purple);background:transparent;color:var(--purple);border-radius:15px;font-weight:700;font-size:0.7rem;cursor:pointer;transition:all 0.3s}
.lang-btn.active{background:var(--purple);color:var(--text)}

/* Main Game Area */
.game-container{height:calc(100vh - 80px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative;overflow:hidden}

/* Intro Screen */
.intro-screen{text-align:center;max-width:400px}
.intro-coach{margin-bottom:15px}
.intro-coach-img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid var(--purple);animation:wiggle 1s infinite}
.intro-coach-name{margin-top:20px;color:var(--muted);font-size:0.9rem}
@keyframes wiggle{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.intro-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:4px;margin-bottom:10px}
.intro-title .gi{color:var(--purple)}
.intro-title .glo{color:var(--pink)}
.intro-subtitle{color:var(--gold);font-family:'Bebas Neue',sans-serif;letter-spacing:2px;margin-bottom:20px}
.intro-desc{color:var(--muted);line-height:1.6;margin-bottom:30px}
.intro-desc strong{color:var(--text)}
.start-btn{padding:18px 50px;font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:4px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;box-shadow:0 8px 30px rgba(155,89,182,0.5);transition:all 0.3s}
.start-btn:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 12px 40px rgba(155,89,182,0.6)}

/* Memorize Phase */
.memorize-screen{text-align:center;width:100%}
.phase-label{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--gold);margin-bottom:20px}
.pair-display{display:flex;align-items:center;justify-content:center;gap:20px;margin:30px 0}
.pair-emoji{font-size:5rem;animation:popIn 0.5s ease}
@keyframes popIn{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}
.pair-plus{font-size:3rem;color:var(--pink)}
.pair-caption{font-size:1.2rem;color:var(--muted);margin-top:10px;font-style:italic}
.timer-bar{width:80%;max-width:300px;height:8px;background:rgba(255,255,255,0.1);border-radius:10px;margin:30px auto;overflow:hidden}
.timer-fill{height:100%;background:linear-gradient(90deg,var(--purple),var(--pink));border-radius:10px;transition:width 0.1s linear}
.pair-counter{color:var(--muted);font-size:0.9rem;margin-top:10px}

/* Recall Phase */
.recall-screen{text-align:center;width:100%}
.recall-question{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px;color:var(--text);margin-bottom:25px}
.pairs-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;max-width:400px;margin:0 auto;padding:0 10px}
.pair-card{background:var(--card);border:3px solid rgba(255,255,255,0.1);border-radius:20px;padding:20px 15px;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:10px}
.pair-card:hover{border-color:var(--purple);transform:scale(1.02)}
.pair-card:active{transform:scale(0.98)}
.pair-card .emoji{font-size:2.5rem}
.pair-card .plus{font-size:1.5rem;color:var(--pink)}
.pair-card.correct{border-color:var(--success);background:rgba(0,217,165,0.2);animation:correctPulse 0.5s ease}
.pair-card.wrong{border-color:var(--danger);background:rgba(255,71,87,0.2);animation:shake 0.5s ease}
@keyframes correctPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-10px)}40%,80%{transform:translateX(10px)}}

/* Score Display */
.score-display{position:absolute;top:100px;right:20px;text-align:right}
.score-label{font-size:0.7rem;color:var(--muted);letter-spacing:1px}
.score-value{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--pink)}
.streak-display{margin-top:5px}
.streak-value{color:var(--gold);font-weight:700}

/* Round Result */
.round-result{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;z-index:100;animation:resultPop 0.5s ease}
@keyframes resultPop{0%{transform:translate(-50%,-50%) scale(0)}50%{transform:translate(-50%,-50%) scale(1.1)}100%{transform:translate(-50%,-50%) scale(1)}}
.result-emoji{font-size:6rem;margin-bottom:10px}
.result-text{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:3px}
.result-text.correct{color:var(--success)}
.result-text.wrong{color:var(--danger)}

/* Game Over Screen */
.gameover-screen{text-align:center;max-width:400px}
.gameover-emoji{font-size:5rem;margin-bottom:20px}
.gameover-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:3px;margin-bottom:10px}
.gameover-score{font-family:'Bebas Neue',sans-serif;font-size:4rem;color:var(--pink);margin:20px 0}
.gameover-msg{color:var(--muted);line-height:1.6;margin-bottom:10px}
.gameover-laughs{color:var(--gold);font-weight:700;margin-bottom:30px}
.gameover-btns{display:flex;flex-direction:column;gap:15px}
.retry-btn{padding:16px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;transition:all 0.3s}
.retry-btn:hover{transform:scale(1.05)}
.home-btn{padding:14px 30px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:transparent;color:var(--muted);border:2px solid var(--muted);border-radius:50px;cursor:pointer;transition:all 0.3s}
.home-btn:hover{border-color:var(--text);color:var(--text)}

/* Coach Message */
.coach-bubble{position:fixed;bottom:20px;left:20px;right:20px;background:var(--card);border:2px solid var(--purple);border-radius:20px;padding:15px 20px;display:flex;align-items:center;gap:15px;animation:slideUp 0.4s ease;z-index:50}
@keyframes slideUp{from{transform:translateY(100px);opacity:0}to{transform:translateY(0);opacity:1}}
.coach-avatar{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--pink));display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0;overflow:hidden}
.coach-avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.coach-text{font-size:0.95rem;line-height:1.5}
.coach-text strong{color:var(--pink)}

/* Tier Complete */
.tier-complete{text-align:center}
.tier-stars{font-size:3rem;margin:20px 0}
.tier-msg{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:2px;color:var(--gold);margin-bottom:20px}
.next-tier-btn{padding:16px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;transition:all 0.3s}

/* Confetti */
.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;overflow:hidden}
.confetti{position:absolute;width:10px;height:10px;top:-10px;animation:confetti-fall 4s linear forwards}
@keyframes confetti-fall{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
.confetti:nth-child(odd){background:var(--purple);border-radius:50%}
.confetti:nth-child(even){background:var(--pink);border-radius:2px}
.confetti:nth-child(3n){background:var(--gold)}
.confetti:nth-child(4n){background:var(--teal)}

/* Hidden */
.hidden{display:none !important}

/* Responsive */
@media(max-width:400px){
.pair-emoji{font-size:4rem}
.pair-card .emoji{font-size:2rem}
.pairs-grid{grid-template-columns:repeat(2,1fr);gap:10px}
}
</style>
</head>
<body class="en">
<div class="confetti-container" id="confettiContainer"></div>

<div class="game-header">
    <div class="header-left">
        <button class="back-btn" id="backBtn">‚Üê</button>
        <div class="coach-header-avatar"><img src="go_chat.png" alt="Coach" class="coach-header-img"></div>
        <div>
            <div class="game-title"><span class="gi">GIG</span><span class="glo">LO</span></div>
            <div class="coach-label">w/ Coach GoTrotter AI</div>
        </div>
        <div class="tier-badge" id="tierBadge">TIER 1</div>
    </div>
    <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="es">ES</button>
    </div>
</div>

<div class="game-container" id="gameContainer">
    <!-- Intro Screen -->
    <div class="intro-screen" id="introScreen">
        <div class="intro-coach"><img src="go_chat.png" alt="Coach GoTrotter AI" class="intro-coach-img"></div>
        <div class="intro-title"><span class="gi">GIG</span><span class="glo">LO</span></div>
        <div class="intro-subtitle">
            <span class="lang-en">JOY & RECOGNITION</span>
            <span class="lang-es">ALEGR√çA Y RECONOCIMIENTO</span>
        </div>
        <div class="intro-desc">
            <span class="lang-en">Remember <strong>silly pairs</strong> ‚Äî then find them again!<br><br>The more absurd, the more you'll laugh. üòÇ<br><br>Laughter + Memory = Brain Power!</span>
            <span class="lang-es">Recuerda <strong>parejas absurdas</strong> ‚Äî ¬°y encu√©ntralas de nuevo!<br><br>M√°s absurdo = m√°s risas. üòÇ<br><br>¬°Risa + Memoria = Poder Mental!</span>
        </div>
        <button class="start-btn" id="startBtn">
            <span class="lang-en">LET'S LAUGH! üòÇ</span>
            <span class="lang-es">¬°A RE√çR! üòÇ</span>
        </button>
        <div class="intro-coach-name">
            <span class="lang-en">with Coach GoTrotter AI üèÄ</span>
            <span class="lang-es">con Coach GoTrotter AI üèÄ</span>
        </div>
    </div>

    <!-- Memorize Screen -->
    <div class="memorize-screen hidden" id="memorizeScreen">
        <div class="phase-label">
            <span class="lang-en">üß† REMEMBER THIS PAIR!</span>
            <span class="lang-es">üß† ¬°RECUERDA ESTA PAREJA!</span>
        </div>
        <div class="pair-display">
            <span class="pair-emoji" id="emoji1">üêò</span>
            <span class="pair-plus">+</span>
            <span class="pair-emoji" id="emoji2">ü©∞</span>
        </div>
        <div class="pair-caption" id="pairCaption">Elephant in ballet shoes</div>
        <div class="timer-bar"><div class="timer-fill" id="timerFill"></div></div>
        <div class="pair-counter" id="pairCounter">Pair 1 of 3</div>
    </div>

    <!-- Recall Screen -->
    <div class="recall-screen hidden" id="recallScreen">
        <div class="recall-question">
            <span class="lang-en">ü§î WHICH PAIR DID YOU SEE?</span>
            <span class="lang-es">ü§î ¬øCU√ÅL PAREJA VISTE?</span>
        </div>
        <div class="pairs-grid" id="pairsGrid"></div>
    </div>

    <!-- Game Over Screen -->
    <div class="gameover-screen hidden" id="gameoverScreen">
        <div class="gameover-emoji" id="gameoverEmoji">üòÇ</div>
        <div class="gameover-title">
            <span class="lang-en">WORKOUT COMPLETE!</span>
            <span class="lang-es">¬°EJERCICIO COMPLETO!</span>
        </div>
        <div class="gameover-score" id="finalScore">0</div>
        <div class="gameover-msg">
            <span class="lang-en">Pairs Remembered</span>
            <span class="lang-es">Parejas Recordadas</span>
        </div>
        <div class="gameover-laughs" id="laughCount">
            <span class="lang-en">üòÇ Laughs earned: 5</span>
            <span class="lang-es">üòÇ Risas ganadas: 5</span>
        </div>
        <div class="gameover-btns">
            <button class="retry-btn" id="retryBtn">
                <span class="lang-en">PLAY AGAIN üòÇ</span>
                <span class="lang-es">JUGAR DE NUEVO üòÇ</span>
            </button>
            <button class="home-btn" id="homeBtn">
                <span class="lang-en">‚Üê BACK</span>
                <span class="lang-es">‚Üê VOLVER</span>
            </button>
        </div>
    </div>

    <!-- Score Display -->
    <div class="score-display" id="scoreDisplay">
        <div class="score-label">SCORE</div>
        <div class="score-value" id="currentScore">0</div>
        <div class="streak-display">
            <span class="lang-en">üî• Streak: </span>
            <span class="lang-es">üî• Racha: </span>
            <span class="streak-value" id="streakValue">0</span>
        </div>
    </div>
</div>

<!-- Coach Bubble -->
<div class="coach-bubble hidden" id="coachBubble">
    <div class="coach-avatar"><img src="go_chat.png" alt="Coach" class="coach-avatar-img"></div>
    <div class="coach-text" id="coachText">Great job!</div>
</div>

<script>
(function() {
    // Language
    var lang = localStorage.getItem('gt-lang') || 'en';
    function setLang(l) {
        lang = l;
        localStorage.setItem('gt-lang', l);
        document.body.className = l;
        document.querySelectorAll('.lang-btn').forEach(function(b) {
            b.classList.toggle('active', b.dataset.lang === l);
        });
    }
    setLang(lang);
    document.querySelectorAll('.lang-btn').forEach(function(b) {
        b.addEventListener('click', function() { setLang(this.dataset.lang); });
    });

    // ============ ABSURD PAIRS DATABASE ============
    var absurdPairs = [
        // Animals + Objects
        { e1: 'üêò', e2: 'ü©∞', captionEn: 'Elephant in ballet shoes', captionEs: 'Elefante en zapatillas de ballet' },
        { e1: 'üê±', e2: 'üíº', captionEn: 'Cat going to work', captionEs: 'Gato yendo al trabajo' },
        { e1: 'üêî', e2: 'üëî', captionEn: 'Chicken in a suit', captionEs: 'Pollo en traje' },
        { e1: 'üêß', e2: 'üèçÔ∏è', captionEn: 'Penguin on motorcycle', captionEs: 'Ping√ºino en motocicleta' },
        { e1: 'ü¶í', e2: 'üß£', captionEn: 'Giraffe with tiny scarf', captionEs: 'Jirafa con bufanda peque√±a' },
        { e1: 'üêô', e2: 'üß§', captionEn: 'Octopus needing gloves', captionEs: 'Pulpo necesitando guantes' },
        { e1: 'ü¶î', e2: 'üéà', captionEn: 'Hedgehog with balloon', captionEs: 'Erizo con globo' },
        { e1: 'üê¢', e2: 'üöÄ', captionEn: 'Turtle astronaut', captionEs: 'Tortuga astronauta' },
        { e1: 'ü¶Ü', e2: 'üëë', captionEn: 'Duck royalty', captionEs: 'Pato de la realeza' },
        { e1: 'üê∏', e2: '‚òï', captionEn: 'Frog having coffee', captionEs: 'Rana tomando caf√©' },
        
        // Food + Situations
        { e1: 'üçï', e2: 'üõÅ', captionEn: 'Pizza in bathtub', captionEs: 'Pizza en la ba√±era' },
        { e1: 'üåÆ', e2: 'üõèÔ∏è', captionEn: 'Taco in bed', captionEs: 'Taco en la cama' },
        { e1: 'üçî', e2: 'üìö', captionEn: 'Burger studying', captionEs: 'Hamburguesa estudiando' },
        { e1: 'üç¶', e2: 'üèãÔ∏è', captionEn: 'Ice cream lifting weights', captionEs: 'Helado levantando pesas' },
        { e1: 'ü•ë', e2: 'üíÖ', captionEn: 'Avocado getting nails done', captionEs: 'Aguacate en el sal√≥n' },
        { e1: 'üç©', e2: 'üéì', captionEn: 'Donut graduating', captionEs: 'Dona gradu√°ndose' },
        { e1: 'üßÅ', e2: 'üèÉ', captionEn: 'Cupcake running marathon', captionEs: 'Cupcake corriendo marat√≥n' },
        { e1: 'ü•ï', e2: 'üé∏', captionEn: 'Carrot rockstar', captionEs: 'Zanahoria rockera' },
        { e1: 'üç≥', e2: 'üé≠', captionEn: 'Egg actor', captionEs: 'Huevo actor' },
        { e1: 'üßÄ', e2: 'üé™', captionEn: 'Cheese at circus', captionEs: 'Queso en el circo' },
        
        // People + Absurd
        { e1: 'üëµ', e2: 'üöÄ', captionEn: 'Grandma in space', captionEs: 'Abuela en el espacio' },
        { e1: 'üë¥', e2: 'üõπ', captionEn: 'Grandpa skateboarding', captionEs: 'Abuelo en patineta' },
        { e1: 'üë∂', e2: 'üíª', captionEn: 'Baby CEO', captionEs: 'Beb√© ejecutivo' },
        { e1: 'üßë‚Äçüç≥', e2: 'üéÆ', captionEn: 'Chef gaming', captionEs: 'Chef jugando videojuegos' },
        { e1: 'üë∏', e2: 'üîß', captionEn: 'Princess mechanic', captionEs: 'Princesa mec√°nica' },
        
        // Objects + Objects
        { e1: 'ü¶∑', e2: 'üé∏', captionEn: 'Tooth playing guitar', captionEs: 'Diente tocando guitarra' },
        { e1: 'üß≤', e2: 'üíÉ', captionEn: 'Magnet dancing', captionEs: 'Im√°n bailando' },
        { e1: 'üîë', e2: 'üéÇ', captionEn: 'Key birthday party', captionEs: 'Llave de cumplea√±os' },
        { e1: 'üì±', e2: 'üèñÔ∏è', captionEn: 'Phone on vacation', captionEs: 'Tel√©fono de vacaciones' },
        { e1: 'üß¶', e2: 'üëì', captionEn: 'Sock wearing glasses', captionEs: 'Calcet√≠n con lentes' },
        { e1: 'üé©', e2: 'üçù', captionEn: 'Top hat eating spaghetti', captionEs: 'Sombrero comiendo espagueti' },
        { e1: 'ü™•', e2: 'üé§', captionEn: 'Toothbrush singing', captionEs: 'Cepillo cantando' },
        { e1: 'üß∏', e2: 'üèÜ', captionEn: 'Teddy bear champion', captionEs: 'Oso de peluche campe√≥n' },
        { e1: 'üéÄ', e2: 'üèà', captionEn: 'Bow playing football', captionEs: 'Mo√±o jugando f√∫tbol' },
        { e1: 'ü™¥', e2: 'üéß', captionEn: 'Plant listening to music', captionEs: 'Planta escuchando m√∫sica' },
        
        // Weather + Items
        { e1: 'üåà', e2: 'üçΩÔ∏è', captionEn: 'Rainbow for dinner', captionEs: 'Arco√≠ris para cenar' },
        { e1: '‚õàÔ∏è', e2: 'üßÅ', captionEn: 'Storm baking', captionEs: 'Tormenta horneando' },
        { e1: 'üåô', e2: 'üõí', captionEn: 'Moon grocery shopping', captionEs: 'Luna de compras' },
        { e1: '‚òÄÔ∏è', e2: 'üéø', captionEn: 'Sun skiing', captionEs: 'Sol esquiando' },
        { e1: '‚ùÑÔ∏è', e2: 'üèÑ', captionEn: 'Snowflake surfing', captionEs: 'Copo de nieve surfeando' }
    ];

    // ============ COACH MESSAGES ============
    var coachMessages = {
        start: {
            en: "Let's exercise your brain AND your smile! üòÇ",
            es: "¬°Ejercitemos tu cerebro Y tu sonrisa! üòÇ"
        },
        showingPair: [
            { en: "Haha! Look at THIS one! üòÇ", es: "¬°Jaja! ¬°Mira ESTA! üòÇ" },
            { en: "Can you believe it?! ü§£", es: "¬°¬øPuedes creerlo?! ü§£" },
            { en: "This is TOO silly! üòÇ", es: "¬°Esto es MUY absurdo! üòÇ" },
            { en: "I can't stop laughing! ü§£", es: "¬°No puedo parar de re√≠r! ü§£" },
            { en: "Wait... WHAT?! üòÇ", es: "Espera... ¬°¬øQU√â?! üòÇ" },
            { en: "Oh this is a good one! üòÑ", es: "¬°Oh esta es buena! üòÑ" },
            { en: "Try not to laugh! ü§≠", es: "¬°Intenta no re√≠r! ü§≠" },
            { en: "Remember this silly one! üòÇ", es: "¬°Recuerda esta tonter√≠a! üòÇ" }
        ],
        recallStart: [
            { en: "Okay, which ones did you see? ü§î", es: "Bien, ¬øcu√°les viste? ü§î" },
            { en: "Time to find the silly pairs! üòÇ", es: "¬°Hora de encontrar las parejas! üòÇ" },
            { en: "Can you remember? Let's see! üß†", es: "¬øPuedes recordar? ¬°Veamos! üß†" },
            { en: "Show me what you remember! üí™", es: "¬°Mu√©strame lo que recuerdas! üí™" }
        ],
        correct: [
            { en: "Ha! You remembered! üòÇ", es: "¬°Ja! ¬°Lo recordaste! üòÇ" },
            { en: "Your brain AND humor are sharp! üß†üòÇ", es: "¬°Tu cerebro Y humor est√°n afilados! üß†üòÇ" },
            { en: "Laughing AND learning! Perfect! üòÇ", es: "¬°Riendo Y aprendiendo! ¬°Perfecto! üòÇ" },
            { en: "That silly pair stuck with you! üòÇ", es: "¬°Esa pareja absurda se qued√≥ contigo! üòÇ" },
            { en: "Memory + Joy = Brain Power! üí™üòÇ", es: "¬°Memoria + Alegr√≠a = Poder Mental! üí™üòÇ" },
            { en: "YES! You got it! üéâ", es: "¬°S√ç! ¬°Lo tienes! üéâ" },
            { en: "That's my player! üèÄüòÇ", es: "¬°Ese es mi jugador! üèÄüòÇ" },
            { en: "Boom! Nailed it! üí•", es: "¬°Boom! ¬°Clavado! üí•" }
        ],
        streak: [
            { en: "You're on FIRE! üî•üòÇ", es: "¬°Est√°s en FUEGO! üî•üòÇ" },
            { en: "STREAK! Keep going! üî•üî•", es: "¬°RACHA! ¬°Sigue as√≠! üî•üî•" },
            { en: "Unstoppable! üí™üòÇ", es: "¬°Imparable! üí™üòÇ" },
            { en: "Nothing can stop you! üöÄ", es: "¬°Nada te detiene! üöÄ" }
        ],
        wrong: [
            { en: "That WAS a silly one! Try again! üòÖ", es: "¬°Esa S√ç era absurda! ¬°Intenta de nuevo! üòÖ" },
            { en: "So many funny pairs to remember! üòÑ", es: "¬°Tantas parejas graciosas para recordar! üòÑ" },
            { en: "Keep laughing, keep trying! üòä", es: "¬°Sigue riendo, sigue intentando! üòä" },
            { en: "Oops! But that one was tricky! üòÖ", es: "¬°Ups! ¬°Pero esa era dif√≠cil! üòÖ" },
            { en: "Close! Stay focused! üëÄ", es: "¬°Cerca! ¬°Mantente enfocado! üëÄ" }
        ],
        tierUp: {
            en: "TIER UP! The pairs get sillier! üòÇüéâ",
            es: "¬°SUBISTE DE NIVEL! ¬°Las parejas son m√°s absurdas! üòÇüéâ"
        },
        newTierIntro: [
            { en: "Get ready... it's getting FUNNIER! üòÇ", es: "Prep√°rate... ¬°se pone M√ÅS GRACIOSO! üòÇ" },
            { en: "More pairs, more laughs! Let's GO! üèÄ", es: "¬°M√°s parejas, m√°s risas! ¬°VAMOS! üèÄ" },
            { en: "Think you can handle this? üòè", es: "¬øCrees que puedes con esto? üòè" }
        ],
        gameOver: {
            en: "What a workout! Your brain got a great laugh! üòÇ",
            es: "¬°Qu√© ejercicio! ¬°Tu cerebro se ri√≥ mucho! üòÇ"
        },
        highScore: {
            en: "AMAZING! That was legendary! üèÜüòÇ",
            es: "¬°INCRE√çBLE! ¬°Eso fue legendario! üèÜüòÇ"
        }
    };

    // ============ GAME STATE ============
    var tier = 1;
    var score = 0;
    var streak = 0;
    var round = 0;
    var roundsPerTier = 5;
    var correctThisRound = 0;
    var pairsToRemember = [];
    var currentPairIndex = 0;
    var timerInterval = null;

    // Tier settings (pairs to remember, time per pair, fake pairs)
    var tierSettings = [
        { pairs: 1, time: 4000, fakes: 1 },  // Tier 1
        { pairs: 1, time: 3500, fakes: 2 },  // Tier 2
        { pairs: 2, time: 3500, fakes: 2 },  // Tier 3
        { pairs: 2, time: 3000, fakes: 2 },  // Tier 4
        { pairs: 2, time: 3000, fakes: 3 },  // Tier 5
        { pairs: 3, time: 3000, fakes: 3 },  // Tier 6
        { pairs: 3, time: 2500, fakes: 3 },  // Tier 7
        { pairs: 3, time: 2500, fakes: 4 },  // Tier 8
        { pairs: 4, time: 2500, fakes: 4 },  // Tier 9
        { pairs: 4, time: 2000, fakes: 4 }   // Tier 10
    ];

    // DOM elements
    var introScreen = document.getElementById('introScreen');
    var memorizeScreen = document.getElementById('memorizeScreen');
    var recallScreen = document.getElementById('recallScreen');
    var gameoverScreen = document.getElementById('gameoverScreen');
    var scoreDisplay = document.getElementById('scoreDisplay');
    var coachBubble = document.getElementById('coachBubble');
    var coachText = document.getElementById('coachText');

    // ============ HELPER FUNCTIONS ============
    function shuffle(arr) {
        var a = arr.slice();
        for (var i = a.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var t = a[i]; a[i] = a[j]; a[j] = t;
        }
        return a;
    }

    function showScreen(screen) {
        [introScreen, memorizeScreen, recallScreen, gameoverScreen].forEach(function(s) {
            s.classList.add('hidden');
        });
        screen.classList.remove('hidden');
    }

    function updateScore() {
        document.getElementById('currentScore').textContent = score;
        document.getElementById('streakValue').textContent = streak;
    }

    function updateTierBadge() {
        document.getElementById('tierBadge').textContent = 'TIER ' + tier;
    }

    function showCoach(msg, duration) {
        coachText.innerHTML = msg;
        coachBubble.classList.remove('hidden');
        setTimeout(function() {
            coachBubble.classList.add('hidden');
        }, duration || 3000);
    }

    function createConfetti() {
        var container = document.getElementById('confettiContainer');
        for (var i = 0; i < 50; i++) {
            setTimeout(function() {
                var confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
                setTimeout(function() {
                    if (confetti.parentNode) confetti.parentNode.removeChild(confetti);
                }, 4000);
            }, i * 50);
        }
    }

    function bi(en, es) {
        return '<span class="lang-en">' + en + '</span><span class="lang-es">' + es + '</span>';
    }

    // ============ GAME LOGIC ============
    function startGame() {
        tier = 1;
        score = 0;
        streak = 0;
        round = 0;
        updateScore();
        updateTierBadge();
        scoreDisplay.classList.remove('hidden');
        showCoach(lang === 'es' ? coachMessages.start.es : coachMessages.start.en, 2500);
        setTimeout(startRound, 2000);
    }

    function startRound() {
        round++;
        correctThisRound = 0;
        currentPairIndex = 0;
        
        var settings = tierSettings[tier - 1];
        var shuffled = shuffle(absurdPairs);
        pairsToRemember = shuffled.slice(0, settings.pairs);
        
        showScreen(memorizeScreen);
        showNextPair();
    }

    function showNextPair() {
        var settings = tierSettings[tier - 1];
        
        if (currentPairIndex >= pairsToRemember.length) {
            // Done memorizing, start recall
            setTimeout(showRecall, 500);
            return;
        }
        
        var pair = pairsToRemember[currentPairIndex];
        document.getElementById('emoji1').textContent = pair.e1;
        document.getElementById('emoji2').textContent = pair.e2;
        document.getElementById('pairCaption').textContent = lang === 'es' ? pair.captionEs : pair.captionEn;
        
        var counterText = lang === 'es' ? 
            'Pareja ' + (currentPairIndex + 1) + ' de ' + pairsToRemember.length :
            'Pair ' + (currentPairIndex + 1) + ' of ' + pairsToRemember.length;
        document.getElementById('pairCounter').textContent = counterText;
        
        // Animate emojis
        document.getElementById('emoji1').style.animation = 'none';
        document.getElementById('emoji2').style.animation = 'none';
        setTimeout(function() {
            document.getElementById('emoji1').style.animation = 'popIn 0.5s ease';
            document.getElementById('emoji2').style.animation = 'popIn 0.5s ease';
        }, 10);
        
        // Coach comments on the silly pair!
        var pairMsg = coachMessages.showingPair[Math.floor(Math.random() * coachMessages.showingPair.length)];
        showCoach(lang === 'es' ? pairMsg.es : pairMsg.en, settings.time - 500);
        
        // Timer
        var timerFill = document.getElementById('timerFill');
        timerFill.style.width = '100%';
        var startTime = Date.now();
        var duration = settings.time;
        
        clearInterval(timerInterval);
        timerInterval = setInterval(function() {
            var elapsed = Date.now() - startTime;
            var remaining = Math.max(0, 100 - (elapsed / duration * 100));
            timerFill.style.width = remaining + '%';
            
            if (remaining <= 0) {
                clearInterval(timerInterval);
                currentPairIndex++;
                showNextPair();
            }
        }, 50);
    }

    function showRecall() {
        showScreen(recallScreen);
        
        // Coach introduces recall phase
        var recallMsg = coachMessages.recallStart[Math.floor(Math.random() * coachMessages.recallStart.length)];
        showCoach(lang === 'es' ? recallMsg.es : recallMsg.en, 2500);
        
        var settings = tierSettings[tier - 1];
        var grid = document.getElementById('pairsGrid');
        grid.innerHTML = '';
        
        // Get fake pairs
        var usedPairs = pairsToRemember.map(function(p) { return p.e1 + p.e2; });
        var availableFakes = absurdPairs.filter(function(p) {
            return usedPairs.indexOf(p.e1 + p.e2) === -1;
        });
        var fakePairs = shuffle(availableFakes).slice(0, settings.fakes);
        
        // Combine and shuffle
        var allPairs = shuffle(pairsToRemember.concat(fakePairs));
        
        // Create cards
        allPairs.forEach(function(pair) {
            var card = document.createElement('div');
            card.className = 'pair-card';
            card.innerHTML = '<span class="emoji">' + pair.e1 + '</span><span class="plus">+</span><span class="emoji">' + pair.e2 + '</span>';
            card.dataset.isCorrect = pairsToRemember.some(function(p) { return p.e1 === pair.e1 && p.e2 === pair.e2; });
            
            card.addEventListener('click', function() {
                handlePairClick(card, pair);
            });
            
            grid.appendChild(card);
        });
    }

    function handlePairClick(card, pair) {
        if (card.classList.contains('correct') || card.classList.contains('wrong')) return;
        
        var isCorrect = card.dataset.isCorrect === 'true';
        
        if (isCorrect) {
            card.classList.add('correct');
            score += 10 + (streak * 2);
            streak++;
            correctThisRound++;
            updateScore();
            
            // Coach reacts - streak messages for hot streaks!
            var msg;
            if (streak >= 3) {
                msg = coachMessages.streak[Math.floor(Math.random() * coachMessages.streak.length)];
            } else {
                msg = coachMessages.correct[Math.floor(Math.random() * coachMessages.correct.length)];
            }
            showCoach(lang === 'es' ? msg.es : msg.en, 2000);
            
            // Check if all correct pairs found
            var allFound = document.querySelectorAll('.pair-card.correct').length === pairsToRemember.length;
            if (allFound) {
                setTimeout(endRound, 1000);
            }
        } else {
            card.classList.add('wrong');
            streak = 0;
            updateScore();
            
            var msg = coachMessages.wrong[Math.floor(Math.random() * coachMessages.wrong.length)];
            showCoach(lang === 'es' ? msg.es : msg.en, 2000);
        }
    }

    function endRound() {
        if (round >= roundsPerTier) {
            // Tier complete
            if (tier >= 10) {
                endGame();
            } else {
                tier++;
                round = 0;
                updateTierBadge();
                createConfetti();
                showCoach(lang === 'es' ? coachMessages.tierUp.es : coachMessages.tierUp.en, 2500);
                
                // Show new tier intro after tier up message
                setTimeout(function() {
                    var introMsg = coachMessages.newTierIntro[Math.floor(Math.random() * coachMessages.newTierIntro.length)];
                    showCoach(lang === 'es' ? introMsg.es : introMsg.en, 2500);
                }, 2500);
                
                setTimeout(startRound, 5000);
            }
        } else {
            setTimeout(startRound, 1000);
        }
    }

    function endGame() {
        showScreen(gameoverScreen);
        scoreDisplay.classList.add('hidden');
        createConfetti();
        
        document.getElementById('finalScore').textContent = score;
        var laughs = Math.floor(score / 20) + 5;
        var laughText = lang === 'es' ? 'üòÇ Risas ganadas: ' + laughs : 'üòÇ Laughs earned: ' + laughs;
        document.getElementById('laughCount').textContent = laughText;
        
        var emoji = score >= 200 ? 'ü§£' : score >= 100 ? 'üòÇ' : 'üòÑ';
        document.getElementById('gameoverEmoji').textContent = emoji;
        
        // Coach end message - special for high scores!
        var endMsg = score >= 150 ? coachMessages.highScore : coachMessages.gameOver;
        showCoach(lang === 'es' ? endMsg.es : endMsg.en, 4000);
    }

    // ============ EVENT LISTENERS ============
    document.getElementById('startBtn').addEventListener('click', function() {
        showScreen(memorizeScreen);
        startGame();
    });

    document.getElementById('retryBtn').addEventListener('click', function() {
        showScreen(memorizeScreen);
        startGame();
    });

    document.getElementById('homeBtn').addEventListener('click', function() {
        showScreen(introScreen);
        scoreDisplay.classList.add('hidden');
    });

    document.getElementById('backBtn').addEventListener('click', function() {
        if (confirm(lang === 'es' ? '¬øSalir del juego?' : 'Exit game?')) {
            showScreen(introScreen);
            scoreDisplay.classList.add('hidden');
            clearInterval(timerInterval);
        }
    });

    // Initialize
    scoreDisplay.classList.add('hidden');
})();
</script>
</body>
</html>
