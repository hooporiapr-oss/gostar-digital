<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LAUGH 2: Goofy Sounds | Laughletico‚Ñ¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B00;--teal:#00D9A5;--gold:#FFD700;--purple:#9B59B6;--pink:#FF69B4;--dark:#0a0a0f;--card:#111118;--text:#FFFFFF;--muted:#8892a0;--success:#00D9A5;--danger:#FF4757}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text)}
body.es .lang-en{display:none!important}
body.en .lang-es{display:none!important}
.game-header{padding:15px 20px;background:linear-gradient(135deg,rgba(155,89,182,0.2),rgba(255,105,180,0.1));border-bottom:2px solid rgba(155,89,182,0.3);display:flex;align-items:center;justify-content:space-between}
.header-left{display:flex;align-items:center;gap:12px}
.coach-header-avatar{width:40px;height:40px;border-radius:50%;overflow:hidden}
.coach-header-img{width:100%;height:100%;object-fit:cover}
.coach-label{font-size:0.65rem;color:var(--muted);letter-spacing:1px}
.back-btn{width:40px;height:40px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;color:var(--text);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.game-title{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px}
.game-title .laugh-title{color:var(--pink)}
.game-title .num{color:var(--gold)}
.tier-badge{background:linear-gradient(135deg,var(--purple),var(--pink));padding:6px 14px;border-radius:20px;font-weight:700;font-size:0.8rem}
.lang-toggle{display:flex;gap:5px}
.lang-btn{padding:6px 12px;border:2px solid var(--purple);background:transparent;color:var(--purple);border-radius:15px;font-weight:700;font-size:0.7rem;cursor:pointer}
.lang-btn.active{background:var(--purple);color:var(--text)}
.game-container{height:calc(100vh - 80px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative}
.intro-screen{text-align:center;max-width:400px}
.intro-coach{margin-bottom:15px}
.intro-coach-img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid var(--purple);animation:wiggle 1s infinite}
@keyframes wiggle{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.intro-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:4px;margin-bottom:5px}
.intro-title .laugh-title{color:var(--pink)}
.intro-title .num{color:var(--gold)}
.intro-circuit{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:3px;margin-bottom:10px}
.intro-subtitle{color:var(--gold);font-family:'Bebas Neue',sans-serif;letter-spacing:2px;margin-bottom:20px}
.intro-desc{color:var(--muted);line-height:1.6;margin-bottom:30px}
.intro-desc strong{color:var(--text)}
.intro-coach-name{margin-top:20px;color:var(--muted);font-size:0.9rem}
.start-btn{padding:18px 50px;font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:4px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;box-shadow:0 8px 30px rgba(155,89,182,0.5)}
.learn-screen{text-align:center;width:100%}
.phase-label{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--gold);margin-bottom:15px}
.sound-card{background:var(--card);border:3px solid var(--purple);border-radius:25px;padding:30px;margin:20px auto;max-width:300px;cursor:pointer;transition:transform 0.2s, box-shadow 0.2s;position:relative}
.sound-card:hover{transform:scale(1.02);box-shadow:0 0 30px rgba(155,89,182,0.4)}
.sound-card:active{transform:scale(0.98)}
.sound-card-hint{font-size:0.75rem;color:var(--muted);margin-top:10px;opacity:0.7}
.sound-text{font-family:'Bebas Neue',sans-serif;font-size:3rem;color:var(--gold);margin-bottom:20px;animation:pulse 0.5s ease}
@keyframes pulse{0%{transform:scale(0.8)}50%{transform:scale(1.1)}100%{transform:scale(1)}}
.sound-emoji{font-size:5rem;margin-bottom:10px}
.sound-label{font-size:1.1rem;color:var(--muted)}
.speaker-icon{font-size:2rem;position:absolute;top:10px;right:15px;animation:speakerPulse 1s infinite}
@keyframes speakerPulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.5;transform:scale(1.1)}}
.timer-bar{width:80%;max-width:300px;height:8px;background:rgba(255,255,255,0.1);border-radius:10px;margin:25px auto;overflow:hidden}
.timer-fill{height:100%;background:linear-gradient(90deg,var(--purple),var(--pink));border-radius:10px;transition:width 0.1s linear}
.counter{color:var(--muted);font-size:0.9rem;margin-top:10px}
.recall-screen{text-align:center;width:100%}
.recall-sound{font-family:'Bebas Neue',sans-serif;font-size:3.5rem;color:var(--gold);margin-bottom:10px;animation:shake 0.3s ease infinite;cursor:pointer}
.recall-sound:hover{text-shadow:0 0 20px var(--gold)}
@keyframes shake{0%,100%{transform:rotate(-2deg)}50%{transform:rotate(2deg)}}
.recall-hint{font-size:0.75rem;color:var(--muted);margin-bottom:10px}
.recall-question{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:2px;margin-bottom:15px}
.recall-timer{width:100%;max-width:350px;height:10px;background:rgba(255,255,255,0.1);border-radius:10px;margin:15px auto;overflow:hidden}
.recall-timer-fill{height:100%;background:var(--success);border-radius:10px;transition:width 0.05s linear}
.recall-timer-fill.danger{background:var(--danger)}
.answers-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;max-width:320px;margin:0 auto}
.answer-btn{background:var(--card);border:3px solid rgba(255,255,255,0.1);border-radius:20px;padding:15px;cursor:pointer;transition:all 0.15s;text-align:center}
.answer-btn:active{transform:scale(0.95)}
.answer-btn .emoji{font-size:3rem;display:block;margin-bottom:5px}
.answer-btn .label{font-size:0.8rem;color:var(--muted)}
.answer-btn.correct{border-color:var(--success);background:rgba(0,217,165,0.2)}
.answer-btn.wrong{border-color:var(--danger);background:rgba(255,71,87,0.2)}
.speed-bonus{position:fixed;top:40%;left:50%;transform:translateX(-50%);font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--gold);animation:floatUp 1s forwards;z-index:100}
@keyframes floatUp{0%{opacity:1;transform:translateX(-50%) translateY(0)}100%{opacity:0;transform:translateX(-50%) translateY(-50px)}}
.score-display{position:absolute;top:100px;right:20px;text-align:right}
.score-label{font-size:0.7rem;color:var(--muted)}
.score-value{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--pink)}
.laugh-counter{position:absolute;top:100px;left:20px;text-align:left}
.laugh-counter-label{font-size:0.7rem;color:var(--muted);letter-spacing:1px}
.laugh-counter-value{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold)}
.gameover-screen{text-align:center;max-width:400px}
.gameover-emoji{font-size:5rem;margin-bottom:20px}
.gameover-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:3px;margin-bottom:10px}
.gameover-score{font-family:'Bebas Neue',sans-serif;font-size:4rem;color:var(--pink);margin:20px 0}
.gameover-stats{color:var(--gold);margin-bottom:30px;font-size:1.2rem}
.retry-btn{padding:16px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;margin-bottom:15px;display:block;width:100%}
.home-btn{padding:14px 30px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:transparent;color:var(--muted);border:2px solid var(--muted);border-radius:50px;cursor:pointer;display:block;width:100%}
.coach-bubble{position:fixed;bottom:20px;left:20px;right:20px;background:var(--card);border:2px solid var(--purple);border-radius:20px;padding:15px;display:flex;align-items:center;gap:15px;z-index:50}
.coach-avatar{width:50px;height:50px;border-radius:50%;overflow:hidden}
.coach-avatar img{width:100%;height:100%;object-fit:cover}
.coach-text{font-size:0.95rem;line-height:1.4}
.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000}
.confetti{position:absolute;width:10px;height:10px;top:-10px;animation:fall 3s linear forwards}
@keyframes fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}
.laugh-pop{position:fixed;pointer-events:none;font-size:2rem;animation:laughFloat 1s ease-out forwards;z-index:999}
@keyframes laughFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-50px) scale(1.5)}}
.hidden{display:none!important}
</style>
</head>
<body class="en">
<div class="confetti-container" id="confettiContainer"></div>

<div class="game-header">
<div class="header-left">
<button class="back-btn" id="backBtn">‚Üê</button>
<div class="coach-header-avatar"><img src="go_chat.png" alt="Coach" class="coach-header-img"></div>
<div>
<div class="game-title"><span class="laugh-title">LAUGH</span> <span class="num">2</span></div>
<div class="coach-label">w/ Coach GoTrotter AI</div>
</div>
<div class="tier-badge" id="tierBadge">TIER 1</div>
</div>
<div class="lang-toggle">
<button class="lang-btn active" data-lang="en">EN</button>
<button class="lang-btn" data-lang="es">ES</button>
</div>
</div>

<div class="game-container">

<div class="intro-screen" id="introScreen">
<div class="intro-coach"><img src="go_chat.png" alt="Coach" class="intro-coach-img"></div>
<div class="intro-title"><span class="laugh-title">LAUGH</span> <span class="num">2</span></div>
<div class="intro-circuit">GOOFY SOUNDS üîä</div>
<div class="intro-subtitle">
<span class="lang-en">SPEED & RECALL</span>
<span class="lang-es">VELOCIDAD Y MEMORIA</span>
</div>
<div class="intro-desc">
<span class="lang-en">Listen to <strong>silly sounds</strong> and remember what makes them!<br><br>Then match them FAST! ‚ö°<br><br>Speed = Bonus Points! üèÜ</span>
<span class="lang-es">Escucha <strong>sonidos tontos</strong> y recuerda qu√© los hace!<br><br>¬°Luego emp√°rejalos R√ÅPIDO! ‚ö°<br><br>¬°Velocidad = Puntos Extra! üèÜ</span>
</div>
<button class="start-btn" id="startBtn">
<span class="lang-en">LET'S HEAR IT! üîä</span>
<span class="lang-es">¬°A ESCUCHAR! üîä</span>
</button>
<button class="test-sound-btn" id="testSoundBtn" style="margin-top:15px;padding:12px 30px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:transparent;color:var(--gold);border:2px solid var(--gold);border-radius:30px;cursor:pointer;">
<span class="lang-en">üîä TEST SOUND</span>
<span class="lang-es">üîä PROBAR SONIDO</span>
</button>
<div class="intro-coach-name">
<span class="lang-en">with Coach GoTrotter AI üèÄ</span>
<span class="lang-es">con Coach GoTrotter AI üèÄ</span>
</div>
</div>

<div class="learn-screen hidden" id="learnScreen">
<div class="phase-label">
<span class="lang-en">üîä LISTEN & LEARN!</span>
<span class="lang-es">üîä ¬°ESCUCHA Y APRENDE!</span>
</div>
<div class="sound-card" id="soundCard">
<span class="speaker-icon">üîä</span>
<div class="sound-text" id="learnSound">BOING!</div>
<div class="sound-emoji" id="learnEmoji">ü¶ò</div>
<div class="sound-label" id="learnLabel">Kangaroo</div>
<div class="sound-card-hint">
<span class="lang-en">üëÜ Tap to hear again</span>
<span class="lang-es">üëÜ Toca para escuchar</span>
</div>
</div>
<div class="timer-bar"><div class="timer-fill" id="timerFill"></div></div>
<div class="counter" id="pairCounter">Sound 1 of 3</div>
</div>

<div class="recall-screen hidden" id="recallScreen">
<div class="recall-sound" id="recallSound">üîä BOING!</div>
<div class="recall-hint">
<span class="lang-en">üëÜ Tap sound to hear again</span>
<span class="lang-es">üëÜ Toca para escuchar</span>
</div>
<div class="recall-question">
<span class="lang-en">ü§î WHAT MAKES THIS SOUND?</span>
<span class="lang-es">ü§î ¬øQU√â HACE ESTE SONIDO?</span>
</div>
<div class="recall-timer"><div class="recall-timer-fill" id="recallTimerFill"></div></div>
<div class="answers-grid" id="answersGrid"></div>
</div>

<div class="gameover-screen hidden" id="gameoverScreen">
<div class="gameover-emoji" id="gameoverEmoji">üîä</div>
<div class="gameover-title">
<span class="lang-en">CIRCUIT COMPLETE!</span>
<span class="lang-es">¬°CIRCUITO COMPLETO!</span>
</div>
<div class="gameover-score" id="finalScore">0</div>
<div class="gameover-stats" id="gameStats">üòÇ Laugh Moments: 0</div>
<button class="retry-btn" id="retryBtn">
<span class="lang-en">PLAY AGAIN üîä</span>
<span class="lang-es">JUGAR DE NUEVO üîä</span>
</button>
<button class="home-btn" id="homeBtn">
<span class="lang-en">‚Üê BACK</span>
<span class="lang-es">‚Üê VOLVER</span>
</button>
</div>

<div class="score-display hidden" id="scoreDisplay">
<div class="score-label">SCORE</div>
<div class="score-value" id="currentScore">0</div>
</div>

<div class="laugh-counter hidden" id="laughCounter">
<div class="laugh-counter-label">üòÇ LAUGHS</div>
<div class="laugh-counter-value" id="laughCounterValue">0</div>
</div>

</div>

<div class="coach-bubble hidden" id="coachBubble">
<div class="coach-avatar"><img src="go_chat.png" alt="Coach"></div>
<div class="coach-text" id="coachText">Great!</div>
</div>

<script>
(function(){
var lang = localStorage.getItem('lw-lang') || 'en';
function setLang(l){
    lang = l;
    localStorage.setItem('lw-lang', l);
    document.body.className = l;
    document.querySelectorAll('.lang-btn').forEach(function(b){
        b.classList.toggle('active', b.dataset.lang === l);
    });
}
setLang(lang);
document.querySelectorAll('.lang-btn').forEach(function(b){
    b.addEventListener('click', function(e){
        e.preventDefault();
        setLang(this.dataset.lang);
    });
});

// ============ AUDIO CONTEXT & SOUND SYNTHESIS ============
var audioCtx = null;
var audioUnlocked = false;

function initAudio() {
    if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
    
    // Play a silent sound to fully unlock audio on iOS/Safari
    if (!audioUnlocked) {
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        gain.gain.value = 0.001; // Nearly silent
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
        audioUnlocked = true;
        console.log('Audio unlocked, context state:', audioCtx.state);
    }
}

// Create noise buffer for various effects
function createNoiseBuffer(duration) {
    var bufferSize = audioCtx.sampleRate * duration;
    var buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    var data = buffer.getChannelData(0);
    for (var i = 0; i < bufferSize; i++) {
        data[i] = Math.random() * 2 - 1;
    }
    return buffer;
}

// Sound synthesis functions for each sound type
var soundFunctions = {
    'BOING!': function() {
        // Bouncy spring sound
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sine';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(600, audioCtx.currentTime + 0.1);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.8, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.4);
    },
    
    'OINK!': function() {
        // Pig oink - nasal oscillation
        var osc = audioCtx.createOscillator();
        var osc2 = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc2.type = 'square';
        osc.frequency.setValueAtTime(200, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(350, audioCtx.currentTime + 0.15);
        osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.3);
        osc2.frequency.setValueAtTime(205, audioCtx.currentTime);
        osc2.frequency.linearRampToValueAtTime(360, audioCtx.currentTime + 0.15);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.35);
        osc.start();
        osc2.start();
        osc.stop(audioCtx.currentTime + 0.35);
        osc2.stop(audioCtx.currentTime + 0.35);
    },
    
    'QUACK!': function() {
        // Duck quack
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(300, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(500, audioCtx.currentTime + 0.05);
        osc.frequency.linearRampToValueAtTime(250, audioCtx.currentTime + 0.2);
        gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.05);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.25);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.25);
    },
    
    'MOO!': function() {
        // Cow moo - low droning
        var osc = audioCtx.createOscillator();
        var osc2 = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc2.type = 'sine';
        osc.frequency.setValueAtTime(120, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.3);
        osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.6);
        osc2.frequency.setValueAtTime(125, audioCtx.currentTime);
        osc2.frequency.linearRampToValueAtTime(155, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.4, audioCtx.currentTime + 0.2);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.7);
        osc.start();
        osc2.start();
        osc.stop(audioCtx.currentTime + 0.7);
        osc2.stop(audioCtx.currentTime + 0.7);
    },
    
    'RIBBIT!': function() {
        // Frog ribbit
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'square';
        // Two quick croaks
        osc.frequency.setValueAtTime(200, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.15);
        // Second croak
        setTimeout(function() {
            var osc2 = audioCtx.createOscillator();
            var gain2 = audioCtx.createGain();
            osc2.connect(gain2);
            gain2.connect(audioCtx.destination);
            osc2.type = 'square';
            osc2.frequency.setValueAtTime(180, audioCtx.currentTime);
            osc2.frequency.exponentialRampToValueAtTime(70, audioCtx.currentTime + 0.15);
            gain2.gain.setValueAtTime(0.35, audioCtx.currentTime);
            gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc2.start();
            osc2.stop(audioCtx.currentTime + 0.2);
        }, 180);
    },
    
    'ROAR!': function() {
        // Lion roar - low rumble
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.8);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(300, audioCtx.currentTime);
        filter.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.5);
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.8, audioCtx.currentTime + 0.2);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.8);
    },
    
    'BUZZ!': function() {
        // Bee buzzing
        var osc = audioCtx.createOscillator();
        var osc2 = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc2.type = 'sawtooth';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc2.frequency.setValueAtTime(152, audioCtx.currentTime);
        // Wobble
        for (var i = 0; i < 8; i++) {
            osc.frequency.setValueAtTime(150 + (i % 2) * 20, audioCtx.currentTime + i * 0.05);
        }
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        osc.start();
        osc2.start();
        osc.stop(audioCtx.currentTime + 0.4);
        osc2.stop(audioCtx.currentTime + 0.4);
    },
    
    'SPLAT!': function() {
        // Splat - noise burst
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.3);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'bandpass';
        filter.frequency.setValueAtTime(1000, audioCtx.currentTime);
        filter.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.2);
        filter.Q.value = 2;
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.3);
    },
    
    'HONK!': function() {
        // Clown honk - two tones
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'square';
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.setValueAtTime(300, audioCtx.currentTime + 0.15);
        gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.3);
    },
    
    'BOOM!': function() {
        // Explosion
        var osc = audioCtx.createOscillator();
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.5);
        var gain = audioCtx.createGain();
        var gain2 = audioCtx.createGain();
        osc.connect(gain);
        noise.connect(gain2);
        gain.connect(audioCtx.destination);
        gain2.connect(audioCtx.destination);
        osc.type = 'sine';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 0.5);
        gain.gain.setValueAtTime(0.8, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        gain2.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        osc.start();
        noise.start();
        osc.stop(audioCtx.currentTime + 0.5);
        noise.stop(audioCtx.currentTime + 0.5);
    },
    
    'DING!': function() {
        // Bell ding
        var osc = audioCtx.createOscillator();
        var osc2 = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sine';
        osc2.type = 'sine';
        osc.frequency.value = 800;
        osc2.frequency.value = 1200;
        gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);
        osc.start();
        osc2.start();
        osc.stop(audioCtx.currentTime + 0.8);
        osc2.stop(audioCtx.currentTime + 0.8);
    },
    
    'WHOOSH!': function() {
        // Rocket whoosh
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.6);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'bandpass';
        filter.frequency.setValueAtTime(200, audioCtx.currentTime);
        filter.frequency.exponentialRampToValueAtTime(2000, audioCtx.currentTime + 0.3);
        filter.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.6);
        filter.Q.value = 5;
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.5, audioCtx.currentTime + 0.3);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.6);
    },
    
    'POP!': function() {
        // Balloon pop
        var osc = audioCtx.createOscillator();
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.1);
        var gain = audioCtx.createGain();
        var gain2 = audioCtx.createGain();
        osc.connect(gain);
        noise.connect(gain2);
        gain.connect(audioCtx.destination);
        gain2.connect(audioCtx.destination);
        osc.type = 'sine';
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        gain2.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
        osc.start();
        noise.start();
        osc.stop(audioCtx.currentTime + 0.1);
        noise.stop(audioCtx.currentTime + 0.1);
    },
    
    'CRUNCH!': function() {
        // Crunchy sound
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.25);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'highpass';
        filter.frequency.value = 1000;
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        // Create crunchy bursts
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        for (var i = 0; i < 5; i++) {
            gain.gain.setValueAtTime(0.5, audioCtx.currentTime + i * 0.05);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime + i * 0.05 + 0.02);
        }
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.25);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.25);
    },
    
    'SIZZLE!': function() {
        // Bacon sizzle
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.5);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'highpass';
        filter.frequency.value = 3000;
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        // Sizzle fluctuation
        for (var i = 0; i < 10; i++) {
            gain.gain.setValueAtTime(0.2 + Math.random() * 0.2, audioCtx.currentTime + i * 0.05);
        }
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.5);
    },
    
    'ACHOO!': function() {
        // Sneeze
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.4);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'bandpass';
        filter.frequency.setValueAtTime(500, audioCtx.currentTime);
        filter.frequency.exponentialRampToValueAtTime(2000, audioCtx.currentTime + 0.1);
        filter.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.4);
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.7, audioCtx.currentTime + 0.1);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.4);
    },
    
    'SLURP!': function() {
        // Slurping noodles
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        // Slurp up and down
        osc.frequency.setValueAtTime(200, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(800, audioCtx.currentTime + 0.2);
        osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.4);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.4);
    },
    
    'CHOMP!': function() {
        // Chomping burger
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.2);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(2000, audioCtx.currentTime);
        filter.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.15);
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.2);
    },
    
    'BONK!': function() {
        // Hammer bonk
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(800, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.15);
        gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.2);
    },
    
    'TOOT!': function() {
        // Trumpet toot
        var osc = audioCtx.createOscillator();
        var osc2 = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc2.type = 'square';
        osc.frequency.setValueAtTime(350, audioCtx.currentTime);
        osc.frequency.setValueAtTime(440, audioCtx.currentTime + 0.1);
        osc2.frequency.setValueAtTime(352, audioCtx.currentTime);
        osc2.frequency.setValueAtTime(442, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        osc.start();
        osc2.start();
        osc.stop(audioCtx.currentTime + 0.4);
        osc2.stop(audioCtx.currentTime + 0.4);
    },
    
    'VROOM!': function() {
        // Race car
        var osc = audioCtx.createOscillator();
        var osc2 = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        osc2.type = 'sawtooth';
        osc.frequency.setValueAtTime(80, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.3);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.5);
        osc2.frequency.setValueAtTime(82, audioCtx.currentTime);
        osc2.frequency.exponentialRampToValueAtTime(202, audioCtx.currentTime + 0.3);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start();
        osc2.start();
        osc.stop(audioCtx.currentTime + 0.5);
        osc2.stop(audioCtx.currentTime + 0.5);
    },
    
    'BEEP!': function() {
        // Robot beep
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'square';
        osc.frequency.setValueAtTime(880, audioCtx.currentTime);
        osc.frequency.setValueAtTime(660, audioCtx.currentTime + 0.1);
        osc.frequency.setValueAtTime(880, audioCtx.currentTime + 0.2);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.3);
    },
    
    'KABOOM!': function() {
        // Fireworks
        soundFunctions['BOOM!']();
        setTimeout(function() {
            var noise = audioCtx.createBufferSource();
            noise.buffer = createNoiseBuffer(0.3);
            var filter = audioCtx.createBiquadFilter();
            filter.type = 'highpass';
            filter.frequency.value = 2000;
            var gain = audioCtx.createGain();
            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            noise.start();
            noise.stop(audioCtx.currentTime + 0.3);
        }, 200);
    },
    
    'SPLASH!': function() {
        // Water splash
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.5);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'bandpass';
        filter.frequency.setValueAtTime(1500, audioCtx.currentTime);
        filter.frequency.exponentialRampToValueAtTime(300, audioCtx.currentTime + 0.5);
        filter.Q.value = 3;
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.6, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.5);
    },
    
    'SNAP!': function() {
        // Crab snap
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.05);
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.08);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.08);
    },
    
    'ZZZZZ!': function() {
        // Snoring
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sawtooth';
        // Snore in and out
        osc.frequency.setValueAtTime(80, audioCtx.currentTime);
        osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.3);
        osc.frequency.linearRampToValueAtTime(60, audioCtx.currentTime + 0.6);
        gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.3, audioCtx.currentTime + 0.3);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.6);
    },
    
    'POOF!': function() {
        // Magic poof
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.3);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'bandpass';
        filter.frequency.setValueAtTime(500, audioCtx.currentTime);
        filter.frequency.exponentialRampToValueAtTime(2000, audioCtx.currentTime + 0.1);
        filter.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.3);
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.3);
        // Add sparkle
        var osc = audioCtx.createOscillator();
        var g2 = audioCtx.createGain();
        osc.connect(g2);
        g2.connect(audioCtx.destination);
        osc.type = 'sine';
        osc.frequency.value = 2000;
        g2.gain.setValueAtTime(0.2, audioCtx.currentTime);
        g2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.2);
    },
    
    'CLICK!': function() {
        // Camera click
        var osc = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'square';
        osc.frequency.value = 1000;
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.05);
        // Second click
        setTimeout(function() {
            var osc2 = audioCtx.createOscillator();
            var g2 = audioCtx.createGain();
            osc2.connect(g2);
            g2.connect(audioCtx.destination);
            osc2.type = 'square';
            osc2.frequency.value = 800;
            g2.gain.setValueAtTime(0.4, audioCtx.currentTime);
            g2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.03);
            osc2.start();
            osc2.stop(audioCtx.currentTime + 0.03);
        }, 80);
    },
    
    'BLING!': function() {
        // Diamond sparkle
        var osc = audioCtx.createOscillator();
        var osc2 = audioCtx.createOscillator();
        var gain = audioCtx.createGain();
        osc.connect(gain);
        osc2.connect(gain);
        gain.connect(audioCtx.destination);
        osc.type = 'sine';
        osc2.type = 'sine';
        osc.frequency.setValueAtTime(1200, audioCtx.currentTime);
        osc.frequency.setValueAtTime(1600, audioCtx.currentTime + 0.1);
        osc.frequency.setValueAtTime(2000, audioCtx.currentTime + 0.2);
        osc2.frequency.setValueAtTime(1800, audioCtx.currentTime);
        osc2.frequency.setValueAtTime(2200, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
        osc.start();
        osc2.start();
        osc.stop(audioCtx.currentTime + 0.5);
        osc2.stop(audioCtx.currentTime + 0.5);
    },
    
    'CRASH!': function() {
        // Vase crash
        var noise = audioCtx.createBufferSource();
        noise.buffer = createNoiseBuffer(0.4);
        var filter = audioCtx.createBiquadFilter();
        filter.type = 'highpass';
        filter.frequency.value = 2000;
        var gain = audioCtx.createGain();
        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);
        gain.gain.setValueAtTime(0.7, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        noise.start();
        noise.stop(audioCtx.currentTime + 0.4);
        // Add tinkling
        for (var i = 0; i < 5; i++) {
            setTimeout(function() {
                var osc = audioCtx.createOscillator();
                var g = audioCtx.createGain();
                osc.connect(g);
                g.connect(audioCtx.destination);
                osc.type = 'sine';
                osc.frequency.value = 2000 + Math.random() * 2000;
                g.gain.setValueAtTime(0.15, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            }, i * 50);
        }
    }
};

function playSound(soundName) {
    if (!audioCtx) {
        initAudio();
    }
    if (audioCtx.state === 'suspended') {
        audioCtx.resume();
    }
    console.log('Playing sound:', soundName, 'Context state:', audioCtx.state);
    if (soundFunctions[soundName]) {
        try {
            soundFunctions[soundName]();
        } catch(e) {
            console.error('Sound error:', e);
        }
    } else {
        console.warn('Sound not found:', soundName);
    }
}

// ============ LAUGH TRACKING SYSTEM ============
var circuitLaughs = 0;

function getDateString(date) {
    return date.toISOString().split('T')[0];
}

function getWeekStart(date) {
    var d = new Date(date);
    var day = d.getDay();
    var diff = d.getDate() - day + (day === 0 ? -6 : 1);
    d.setDate(diff);
    return getDateString(d);
}

function addLaughs(count) {
    circuitLaughs += count;
    updateLaughDisplay();
    
    var today = getDateString(new Date());
    var weekStart = getWeekStart(new Date());
    
    // Update today's laughs
    var todayData = JSON.parse(localStorage.getItem('lw-laughs-today') || '{}');
    if (todayData.date !== today) {
        todayData = { date: today, count: 0 };
    }
    todayData.count += count;
    localStorage.setItem('lw-laughs-today', JSON.stringify(todayData));
    
    // Update week's laughs
    var weekData = JSON.parse(localStorage.getItem('lw-laughs-week') || '{}');
    if (weekData.weekStart !== weekStart) {
        weekData = { weekStart: weekStart, count: 0 };
    }
    weekData.count += count;
    localStorage.setItem('lw-laughs-week', JSON.stringify(weekData));
    
    // Update total laughs
    var total = parseInt(localStorage.getItem('lw-laughs-total') || '0');
    total += count;
    localStorage.setItem('lw-laughs-total', total.toString());
    
    // Show floating laugh emoji
    showLaughPop(count);
}

function updateLaughDisplay() {
    document.getElementById('laughCounterValue').textContent = circuitLaughs;
}

function showLaughPop(count) {
    for (var i = 0; i < Math.min(count, 3); i++) {
        setTimeout(function() {
            var pop = document.createElement('div');
            pop.className = 'laugh-pop';
            pop.textContent = 'üòÇ';
            pop.style.left = (20 + Math.random() * 60) + '%';
            pop.style.top = (30 + Math.random() * 40) + '%';
            document.body.appendChild(pop);
            setTimeout(function() {
                if (pop.parentNode) pop.parentNode.removeChild(pop);
            }, 1000);
        }, i * 150);
    }
}

// ============ SOUND PAIRS DATABASE ============
var soundPairs = [
    {sound:'BOING!',emoji:'ü¶ò',en:'Kangaroo',es:'Canguro'},
    {sound:'OINK!',emoji:'üê∑',en:'Pig',es:'Cerdo'},
    {sound:'QUACK!',emoji:'ü¶Ü',en:'Duck',es:'Pato'},
    {sound:'MOO!',emoji:'üêÑ',en:'Cow',es:'Vaca'},
    {sound:'RIBBIT!',emoji:'üê∏',en:'Frog',es:'Rana'},
    {sound:'ROAR!',emoji:'ü¶Å',en:'Lion',es:'Le√≥n'},
    {sound:'BUZZ!',emoji:'üêù',en:'Bee',es:'Abeja'},
    {sound:'SPLAT!',emoji:'üçÖ',en:'Tomato',es:'Tomate'},
    {sound:'HONK!',emoji:'ü§°',en:'Clown',es:'Payaso'},
    {sound:'BOOM!',emoji:'üí•',en:'Explosion',es:'Explosi√≥n'},
    {sound:'DING!',emoji:'üîî',en:'Bell',es:'Campana'},
    {sound:'WHOOSH!',emoji:'üöÄ',en:'Rocket',es:'Cohete'},
    {sound:'POP!',emoji:'üéà',en:'Balloon',es:'Globo'},
    {sound:'CRUNCH!',emoji:'ü•ï',en:'Carrot',es:'Zanahoria'},
    {sound:'SIZZLE!',emoji:'ü•ì',en:'Bacon',es:'Tocino'},
    {sound:'ACHOO!',emoji:'ü§ß',en:'Sneeze',es:'Estornudo'},
    {sound:'SLURP!',emoji:'üçú',en:'Noodles',es:'Fideos'},
    {sound:'CHOMP!',emoji:'üçî',en:'Burger',es:'Hamburguesa'},
    {sound:'BONK!',emoji:'üî®',en:'Hammer',es:'Martillo'},
    {sound:'TOOT!',emoji:'üé∫',en:'Trumpet',es:'Trompeta'},
    {sound:'VROOM!',emoji:'üèéÔ∏è',en:'Race Car',es:'Auto'},
    {sound:'BEEP!',emoji:'ü§ñ',en:'Robot',es:'Robot'},
    {sound:'KABOOM!',emoji:'üéÜ',en:'Fireworks',es:'Fuegos'},
    {sound:'SPLASH!',emoji:'üèä',en:'Swimmer',es:'Nadador'},
    {sound:'SNAP!',emoji:'ü¶Ä',en:'Crab',es:'Cangrejo'},
    {sound:'ZZZZZ!',emoji:'üò¥',en:'Sleeping',es:'Durmiendo'},
    {sound:'POOF!',emoji:'üßô',en:'Wizard',es:'Mago'},
    {sound:'CLICK!',emoji:'üì∏',en:'Camera',es:'C√°mara'},
    {sound:'BLING!',emoji:'üíé',en:'Diamond',es:'Diamante'},
    {sound:'CRASH!',emoji:'üè∫',en:'Vase',es:'Jarr√≥n'}
];

var coachMsgs = {
    start:{en:"Listen up! Goofy sounds incoming! üîäüòÇ",es:"¬°Atenci√≥n! ¬°Vienen sonidos graciosos! üîäüòÇ"},
    learn:[
        {en:"Haha! Listen to THAT! üòÇ",es:"¬°Jaja! ¬°Escucha ESO! üòÇ"},
        {en:"What a silly sound! üîä",es:"¬°Qu√© sonido tonto! üîä"},
        {en:"Remember this one! üß†",es:"¬°Recuerda este! üß†"}
    ],
    recall:[
        {en:"SPEED ROUND! Go fast! ‚ö°",es:"¬°RONDA R√ÅPIDA! ¬°Ve r√°pido! ‚ö°"},
        {en:"Quick! Match it! üèÉ",es:"¬°R√°pido! ¬°Empar√©jalo! üèÉ"}
    ],
    correct:[
        {en:"YES! Nailed it! ‚ö°",es:"¬°S√ç! ¬°Clavado! ‚ö°"},
        {en:"You heard it right! üëÇ",es:"¬°Lo escuchaste bien! üëÇ"},
        {en:"BOOM! üí•",es:"¬°BOOM! üí•"}
    ],
    speed:[
        {en:"SPEED BONUS! +5! üî•",es:"¬°BONO VELOCIDAD! +5! üî•"},
        {en:"LIGHTNING FAST! ‚ö°",es:"¬°VELOZ! ‚ö°"}
    ],
    wrong:[
        {en:"That was tricky! üòÖ",es:"¬°Esa era dif√≠cil! üòÖ"},
        {en:"Keep trying! üëÇ",es:"¬°Sigue intentando! üëÇ"}
    ],
    timeout:{en:"Too slow! ‚è∞",es:"¬°Muy lento! ‚è∞"},
    tierUp:{en:"TIER UP! Faster now! üîä‚ö°",es:"¬°SUBISTE! ¬°M√°s r√°pido! üîä‚ö°"},
    gameOver:{en:"Great circuit! üîäüß†",es:"¬°Gran circuito! üîäüß†"}
};

var tier=1,score=0,speedBonuses=0,correctCount=0,round=0;
var soundsToLearn=[],currentIdx=0,recallIdx=0;
var learnTimer=null,recallTimer=null,recallStart=0;
var currentLearnPair = null;
var currentRecallPair = null;

var tierSettings=[
    {sounds:2,learnTime:3500,recallTime:4500},
    {sounds:2,learnTime:3200,recallTime:4000},
    {sounds:3,learnTime:3000,recallTime:3700},
    {sounds:3,learnTime:2800,recallTime:3500},
    {sounds:3,learnTime:2600,recallTime:3200},
    {sounds:4,learnTime:2600,recallTime:3000},
    {sounds:4,learnTime:2400,recallTime:2800},
    {sounds:4,learnTime:2400,recallTime:2600},
    {sounds:5,learnTime:2200,recallTime:2400},
    {sounds:5,learnTime:2000,recallTime:2200}
];

var introScreen=document.getElementById('introScreen');
var learnScreen=document.getElementById('learnScreen');
var recallScreen=document.getElementById('recallScreen');
var gameoverScreen=document.getElementById('gameoverScreen');
var scoreDisplay=document.getElementById('scoreDisplay');
var laughCounter=document.getElementById('laughCounter');
var coachBubble=document.getElementById('coachBubble');
var coachText=document.getElementById('coachText');
var soundCard=document.getElementById('soundCard');
var recallSoundEl=document.getElementById('recallSound');

function shuffle(a){
    var arr=a.slice();
    for(var i=arr.length-1;i>0;i--){
        var j=Math.floor(Math.random()*(i+1));
        var t=arr[i];arr[i]=arr[j];arr[j]=t;
    }
    return arr;
}

function showScreen(s){
    introScreen.classList.add('hidden');
    learnScreen.classList.add('hidden');
    recallScreen.classList.add('hidden');
    gameoverScreen.classList.add('hidden');
    s.classList.remove('hidden');
}

function updateScore(){
    document.getElementById('currentScore').textContent=score;
}

function updateTier(){
    document.getElementById('tierBadge').textContent='TIER '+tier;
}

function showCoach(msg,dur){
    coachText.textContent=msg;
    coachBubble.classList.remove('hidden');
    setTimeout(function(){coachBubble.classList.add('hidden');},dur||2500);
}

function showSpeedBonus(){
    var b=document.createElement('div');
    b.className='speed-bonus';
    b.textContent='+5 SPEED!';
    document.body.appendChild(b);
    setTimeout(function(){if(b.parentNode)b.remove();},1000);
}

function confetti(){
    var c=document.getElementById('confettiContainer');
    for(var i=0;i<40;i++){
        setTimeout(function(){
            var p=document.createElement('div');
            p.className='confetti';
            p.style.left=Math.random()*100+'vw';
            p.style.background=['#9B59B6','#FF69B4','#FFD700','#00D9A5'][Math.floor(Math.random()*4)];
            p.style.animationDuration=(2+Math.random()*2)+'s';
            c.appendChild(p);
            setTimeout(function(){if(p.parentNode)p.remove();},4000);
        },i*40);
    }
}

// Sound card tap to replay
soundCard.addEventListener('click', function() {
    if (currentLearnPair) {
        playSound(currentLearnPair.sound);
    }
});

// Recall sound tap to replay
recallSoundEl.addEventListener('click', function() {
    if (currentRecallPair) {
        playSound(currentRecallPair.sound);
    }
});

function startGame(){
    initAudio();
    tier=1;score=0;speedBonuses=0;correctCount=0;round=0;
    circuitLaughs=0;
    updateScore();updateTier();updateLaughDisplay();
    scoreDisplay.classList.remove('hidden');
    laughCounter.classList.remove('hidden');
    var m=coachMsgs.start;
    showCoach(lang==='es'?m.es:m.en,2500);
    setTimeout(startRound,2000);
}

function startRound(){
    round++;
    currentIdx=0;
    var s=tierSettings[tier-1];
    soundsToLearn=shuffle(soundPairs).slice(0,s.sounds);
    showScreen(learnScreen);
    showNextLearn();
}

function showNextLearn(){
    if(currentIdx>=soundsToLearn.length){
        setTimeout(startRecall,500);
        return;
    }
    var s=tierSettings[tier-1];
    var pair=soundsToLearn[currentIdx];
    currentLearnPair = pair;
    
    // +1 laugh for seeing silly sound
    addLaughs(1);
    
    document.getElementById('learnSound').textContent=pair.sound;
    document.getElementById('learnEmoji').textContent=pair.emoji;
    document.getElementById('learnLabel').textContent=lang==='es'?pair.es:pair.en;
    document.getElementById('pairCounter').textContent=(lang==='es'?'Sonido ':'Sound ')+(currentIdx+1)+' / '+soundsToLearn.length;
    
    // Play the sound!
    setTimeout(function() {
        playSound(pair.sound);
    }, 300);
    
    var msg=coachMsgs.learn[Math.floor(Math.random()*coachMsgs.learn.length)];
    showCoach(lang==='es'?msg.es:msg.en,s.learnTime-500);
    
    var fill=document.getElementById('timerFill');
    fill.style.width='100%';
    var start=Date.now();
    clearInterval(learnTimer);
    learnTimer=setInterval(function(){
        var pct=Math.max(0,100-((Date.now()-start)/s.learnTime*100));
        fill.style.width=pct+'%';
        if(pct<=0){
            clearInterval(learnTimer);
            currentIdx++;
            showNextLearn();
        }
    },50);
}

function startRecall(){
    recallIdx=0;
    soundsToLearn=shuffle(soundsToLearn);
    var msg=coachMsgs.recall[Math.floor(Math.random()*coachMsgs.recall.length)];
    showCoach(lang==='es'?msg.es:msg.en,1500);
    setTimeout(showNextRecall,1500);
}

function showNextRecall(){
    if(recallIdx>=soundsToLearn.length){
        endRound();
        return;
    }
    showScreen(recallScreen);
    var s=tierSettings[tier-1];
    var correct=soundsToLearn[recallIdx];
    currentRecallPair = correct;
    document.getElementById('recallSound').textContent='üîä ' + correct.sound;
    
    // Play the sound!
    setTimeout(function() {
        playSound(correct.sound);
    }, 200);
    
    var grid=document.getElementById('answersGrid');
    grid.innerHTML='';
    var wrongs=shuffle(soundPairs.filter(function(p){return p.emoji!==correct.emoji;})).slice(0,3);
    var opts=shuffle([correct].concat(wrongs));
    
    opts.forEach(function(opt){
        var btn=document.createElement('div');
        btn.className='answer-btn';
        btn.innerHTML='<span class="emoji">'+opt.emoji+'</span><span class="label">'+(lang==='es'?opt.es:opt.en)+'</span>';
        btn.dataset.correct=opt.emoji===correct.emoji?'1':'0';
        btn.onclick=function(){handleAnswer(btn,correct);};
        grid.appendChild(btn);
    });
    
    recallStart=Date.now();
    var fill=document.getElementById('recallTimerFill');
    fill.style.width='100%';
    fill.classList.remove('danger');
    clearInterval(recallTimer);
    recallTimer=setInterval(function(){
        var pct=Math.max(0,100-((Date.now()-recallStart)/s.recallTime*100));
        fill.style.width=pct+'%';
        if(pct<30)fill.classList.add('danger');
        if(pct<=0){
            clearInterval(recallTimer);
            handleTimeout(correct);
        }
    },50);
}

function handleAnswer(btn,correct){
    clearInterval(recallTimer);
    document.querySelectorAll('.answer-btn').forEach(function(b){b.onclick=null;});
    var isCorrect=btn.dataset.correct==='1';
    var time=Date.now()-recallStart;
    var s=tierSettings[tier-1];
    
    if(isCorrect){
        btn.classList.add('correct');
        correctCount++;
        
        // +1 laugh for correct answer
        addLaughs(1);
        
        var pts=10;
        if(time<s.recallTime*0.4){
            pts+=5;
            speedBonuses++;
            // +2 extra laughs for speed bonus
            addLaughs(2);
            showSpeedBonus();
            var m=coachMsgs.speed[Math.floor(Math.random()*coachMsgs.speed.length)];
            showCoach(lang==='es'?m.es:m.en,1500);
        }else{
            var m=coachMsgs.correct[Math.floor(Math.random()*coachMsgs.correct.length)];
            showCoach(lang==='es'?m.es:m.en,1500);
        }
        score+=pts;
        updateScore();
    }else{
        btn.classList.add('wrong');
        document.querySelectorAll('.answer-btn').forEach(function(b){
            if(b.dataset.correct==='1')b.classList.add('correct');
        });
        var m=coachMsgs.wrong[Math.floor(Math.random()*coachMsgs.wrong.length)];
        showCoach(lang==='es'?m.es:m.en,1500);
    }
    recallIdx++;
    setTimeout(showNextRecall,1500);
}

function handleTimeout(correct){
    document.querySelectorAll('.answer-btn').forEach(function(b){
        b.onclick=null;
        if(b.dataset.correct==='1')b.classList.add('correct');
    });
    var m=coachMsgs.timeout;
    showCoach(lang==='es'?m.es:m.en,1500);
    recallIdx++;
    setTimeout(showNextRecall,1500);
}

function endRound(){
    if(round>=5){
        if(tier>=10){
            endGame();
        }else{
            tier++;round=0;
            updateTier();
            confetti();
            // +3 laughs for tier up
            addLaughs(3);
            var m=coachMsgs.tierUp;
            showCoach(lang==='es'?m.es:m.en,2500);
            setTimeout(startRound,3000);
        }
    }else{
        setTimeout(startRound,1000);
    }
}

function endGame(){
    // +5 laughs for circuit complete
    addLaughs(5);
    
    showScreen(gameoverScreen);
    scoreDisplay.classList.add('hidden');
    laughCounter.classList.add('hidden');
    confetti();
    document.getElementById('finalScore').textContent=score;
    
    // Show laugh moments
    var laughText = lang === 'es' ? 
        'üòÇ Momentos de Risa: ' + circuitLaughs : 
        'üòÇ Laugh Moments: ' + circuitLaughs;
    document.getElementById('gameStats').textContent = laughText;
    
    var m=coachMsgs.gameOver;
    showCoach(lang==='es'?m.es:m.en,3000);
}

document.getElementById('startBtn').onclick=function() {
    initAudio();
    startGame();
};
document.getElementById('testSoundBtn').onclick=function() {
    initAudio();
    // Play a fun test sound
    playSound('BOING!');
    setTimeout(function(){ playSound('HONK!'); }, 500);
};
document.getElementById('retryBtn').onclick=startGame;
document.getElementById('homeBtn').onclick=function(){
    window.location.href='laugh-hub.html';
};
document.getElementById('backBtn').onclick=function(){
    if(confirm(lang==='es'?'¬øSalir?':'Exit?')){
        clearInterval(learnTimer);
        clearInterval(recallTimer);
        window.location.href='laugh-hub.html';
    }
};
})();
</script>
</body>
</html>
