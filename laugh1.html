<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LAUGH 1: Silly Scenes | Laughter Workouts‚Ñ¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B00;--orange-dark:#CC5500;--teal:#00D9A5;--gold:#FFD700;--purple:#9B59B6;--pink:#FF69B4;--dark:#0a0a0f;--darker:#050508;--card:#111118;--text:#FFFFFF;--muted:#8892a0;--success:#00D9A5;--danger:#FF4757}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text)}
body.es .lang-en{display:none !important}
body.en .lang-es{display:none !important}

/* Header */
.game-header{padding:15px 20px;background:linear-gradient(135deg,rgba(155,89,182,0.2),rgba(255,105,180,0.1));border-bottom:2px solid rgba(155,89,182,0.3);display:flex;align-items:center;justify-content:space-between}
.header-left{display:flex;align-items:center;gap:12px}
.coach-header-avatar{width:40px;height:40px;border-radius:50%;overflow:hidden}
.coach-header-img{width:100%;height:100%;object-fit:cover}
.coach-label{font-size:0.65rem;color:var(--muted);letter-spacing:1px}
.back-btn{width:40px;height:40px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;color:var(--text);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.game-title{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px}
.game-title .laugh-title{color:var(--pink)}
.game-title .num{color:var(--gold)}
.tier-badge{background:linear-gradient(135deg,var(--purple),var(--pink));padding:6px 14px;border-radius:20px;font-weight:700;font-size:0.8rem}
.lang-toggle{display:flex;gap:5px}
.lang-btn{padding:6px 12px;border:2px solid var(--purple);background:transparent;color:var(--purple);border-radius:15px;font-weight:700;font-size:0.7rem;cursor:pointer;transition:all 0.3s}
.lang-btn.active{background:var(--purple);color:var(--text)}

/* Main Game Area */
.game-container{height:calc(100vh - 80px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative;overflow:hidden}

/* Intro Screen */
.intro-screen{text-align:center;max-width:400px}
.intro-coach{margin-bottom:15px}
.intro-coach-img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid var(--purple);animation:wiggle 1s infinite}
.intro-coach-name{margin-top:20px;color:var(--muted);font-size:0.9rem}
@keyframes wiggle{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.intro-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:4px;margin-bottom:5px}
.intro-title .laugh-title{color:var(--pink)}
.intro-title .num{color:var(--gold)}
.intro-workout{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:3px;color:var(--text);margin-bottom:10px}
.intro-subtitle{color:var(--gold);font-family:'Bebas Neue',sans-serif;letter-spacing:2px;margin-bottom:20px}
.intro-desc{color:var(--muted);line-height:1.6;margin-bottom:30px}
.intro-desc strong{color:var(--text)}
.start-btn{padding:18px 50px;font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:4px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;box-shadow:0 8px 30px rgba(155,89,182,0.5);transition:all 0.3s}
.start-btn:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 12px 40px rgba(155,89,182,0.6)}

/* Scene Display */
.scene-screen{text-align:center;width:100%}
.phase-label{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--gold);margin-bottom:15px}
.scene-display{background:var(--card);border:3px solid var(--purple);border-radius:25px;padding:30px 20px;margin:20px auto;max-width:350px}
.scene-emojis{font-size:4rem;margin-bottom:15px;display:flex;justify-content:center;gap:10px;animation:popIn 0.5s ease}
@keyframes popIn{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}
.scene-caption{font-size:1.3rem;color:var(--text);line-height:1.5;font-weight:600}
.scene-caption .highlight{color:var(--pink)}
.timer-bar{width:80%;max-width:300px;height:8px;background:rgba(255,255,255,0.1);border-radius:10px;margin:25px auto;overflow:hidden}
.timer-fill{height:100%;background:linear-gradient(90deg,var(--purple),var(--pink));border-radius:10px;transition:width 0.1s linear}
.scene-counter{color:var(--muted);font-size:0.9rem;margin-top:10px}

/* Question Screen */
.question-screen{text-align:center;width:100%}
.question-text{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:2px;color:var(--text);margin-bottom:10px}
.question-subject{font-size:3rem;margin:15px 0}
.answers-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;max-width:350px;margin:20px auto;padding:0 10px}
.answer-card{background:var(--card);border:3px solid rgba(255,255,255,0.1);border-radius:20px;padding:20px;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:8px}
.answer-card:hover{border-color:var(--purple);transform:scale(1.02)}
.answer-card:active{transform:scale(0.98)}
.answer-card .emoji{font-size:3rem}
.answer-card .label{font-size:0.85rem;color:var(--muted)}
.answer-card.correct{border-color:var(--success);background:rgba(0,217,165,0.2);animation:correctPulse 0.5s ease}
.answer-card.wrong{border-color:var(--danger);background:rgba(255,71,87,0.2);animation:shake 0.5s ease}
@keyframes correctPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
@keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-10px)}40%,80%{transform:translateX(10px)}}

/* Score Display */
.score-display{position:absolute;top:100px;right:20px;text-align:right}
.score-label{font-size:0.7rem;color:var(--muted);letter-spacing:1px}
.score-value{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--pink)}
.streak-display{margin-top:5px}
.streak-value{color:var(--gold);font-weight:700}

/* Game Over Screen */
.gameover-screen{text-align:center;max-width:400px}
.gameover-emoji{font-size:5rem;margin-bottom:20px}
.gameover-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:3px;margin-bottom:10px}
.gameover-score{font-family:'Bebas Neue',sans-serif;font-size:4rem;color:var(--pink);margin:20px 0}
.gameover-msg{color:var(--muted);line-height:1.6;margin-bottom:10px}
.gameover-laughs{color:var(--gold);font-weight:700;margin-bottom:30px}
.gameover-btns{display:flex;flex-direction:column;gap:15px}
.retry-btn{padding:16px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;transition:all 0.3s}
.retry-btn:hover{transform:scale(1.05)}
.home-btn{padding:14px 30px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:transparent;color:var(--muted);border:2px solid var(--muted);border-radius:50px;cursor:pointer;transition:all 0.3s}
.home-btn:hover{border-color:var(--text);color:var(--text)}

/* Coach Bubble */
.coach-bubble{position:fixed;bottom:20px;left:20px;right:20px;background:var(--card);border:2px solid var(--purple);border-radius:20px;padding:15px 20px;display:flex;align-items:center;gap:15px;animation:slideUp 0.4s ease;z-index:50}
@keyframes slideUp{from{transform:translateY(100px);opacity:0}to{transform:translateY(0);opacity:1}}
.coach-avatar{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--purple),var(--pink));display:flex;align-items:center;justify-content:center;font-size:1.5rem;flex-shrink:0;overflow:hidden}
.coach-avatar-img{width:100%;height:100%;object-fit:cover;border-radius:50%}
.coach-text{font-size:0.95rem;line-height:1.5}
.coach-text strong{color:var(--pink)}

/* Confetti */
.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000;overflow:hidden}
.confetti{position:absolute;width:10px;height:10px;top:-10px;animation:confetti-fall 4s linear forwards}
@keyframes confetti-fall{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
.confetti:nth-child(odd){background:var(--purple);border-radius:50%}
.confetti:nth-child(even){background:var(--pink);border-radius:2px}
.confetti:nth-child(3n){background:var(--gold)}
.confetti:nth-child(4n){background:var(--teal)}

/* Hidden */
.hidden{display:none !important}

/* Responsive */
@media(max-width:400px){
.scene-emojis{font-size:3rem}
.scene-caption{font-size:1.1rem}
.answer-card .emoji{font-size:2.5rem}
.answers-grid{gap:10px}
.question-subject{font-size:2.5rem}
}
</style>
</head>
<body class="en">
<div class="confetti-container" id="confettiContainer"></div>

<div class="game-header">
    <div class="header-left">
        <button class="back-btn" id="backBtn">‚Üê</button>
        <div class="coach-header-avatar"><img src="go_chat.png" alt="Coach" class="coach-header-img"></div>
        <div>
            <div class="game-title"><span class="laugh-title">LAUGH</span> <span class="num">1</span></div>
            <div class="coach-label">w/ Coach GoTrotter AI</div>
        </div>
        <div class="tier-badge" id="tierBadge">TIER 1</div>
    </div>
    <div class="lang-toggle">
        <button class="lang-btn active" data-lang="en">EN</button>
        <button class="lang-btn" data-lang="es">ES</button>
    </div>
</div>

<div class="game-container" id="gameContainer">
    <!-- Intro Screen -->
    <div class="intro-screen" id="introScreen">
        <div class="intro-coach"><img src="go_chat.png" alt="Coach GoTrotter AI" class="intro-coach-img"></div>
        <div class="intro-title"><span class="laugh-title">LAUGH</span> <span class="num">1</span></div>
        <div class="intro-workout">SILLY SCENES üé≠</div>
        <div class="intro-subtitle">
            <span class="lang-en">MEMORY & LAUGHTER</span>
            <span class="lang-es">MEMORIA Y RISA</span>
        </div>
        <div class="intro-desc">
            <span class="lang-en">Watch <strong>ridiculous scenes</strong> ‚Äî then remember what happened!<br><br>Who was doing what? And where? ü§î<br><br>The sillier the scene, the harder you'll laugh! üòÇ</span>
            <span class="lang-es">Mira <strong>escenas rid√≠culas</strong> ‚Äî ¬°y recuerda qu√© pas√≥!<br><br>¬øQui√©n hac√≠a qu√©? ¬øY d√≥nde? ü§î<br><br>¬°M√°s absurda la escena, m√°s te reir√°s! üòÇ</span>
        </div>
        <button class="start-btn" id="startBtn">
            <span class="lang-en">START SCENES! üé≠</span>
            <span class="lang-es">¬°VER ESCENAS! üé≠</span>
        </button>
        <div class="intro-coach-name">
            <span class="lang-en">with Coach GoTrotter AI üèÄ</span>
            <span class="lang-es">con Coach GoTrotter AI üèÄ</span>
        </div>
    </div>

    <!-- Scene Display Screen -->
    <div class="scene-screen hidden" id="sceneScreen">
        <div class="phase-label">
            <span class="lang-en">üé≠ WATCH THIS SCENE!</span>
            <span class="lang-es">üé≠ ¬°MIRA ESTA ESCENA!</span>
        </div>
        <div class="scene-display">
            <div class="scene-emojis" id="sceneEmojis">üëµ üèÑ üåô</div>
            <div class="scene-caption" id="sceneCaption">
                <span class="highlight">Grandma</span> surfing at <span class="highlight">night</span>
            </div>
        </div>
        <div class="timer-bar"><div class="timer-fill" id="timerFill"></div></div>
        <div class="scene-counter" id="sceneCounter">Scene 1 of 3</div>
    </div>

    <!-- Question Screen -->
    <div class="question-screen hidden" id="questionScreen">
        <div class="question-text" id="questionText">
            <span class="lang-en">ü§î WHERE WAS GRANDMA?</span>
            <span class="lang-es">ü§î ¬øD√ìNDE ESTABA LA ABUELA?</span>
        </div>
        <div class="question-subject" id="questionSubject">üëµ</div>
        <div class="answers-grid" id="answersGrid"></div>
    </div>

    <!-- Game Over Screen -->
    <div class="gameover-screen hidden" id="gameoverScreen">
        <div class="gameover-emoji" id="gameoverEmoji">üé≠</div>
        <div class="gameover-title">
            <span class="lang-en">SCENES COMPLETE!</span>
            <span class="lang-es">¬°ESCENAS COMPLETAS!</span>
        </div>
        <div class="gameover-score" id="finalScore">0</div>
        <div class="gameover-msg">
            <span class="lang-en">Silly Scenes Remembered</span>
            <span class="lang-es">Escenas Absurdas Recordadas</span>
        </div>
        <div class="gameover-laughs" id="laughCount">
            <span class="lang-en">üé≠ Scenes witnessed: 10</span>
            <span class="lang-es">üé≠ Escenas vistas: 10</span>
        </div>
        <div class="gameover-btns">
            <button class="retry-btn" id="retryBtn">
                <span class="lang-en">PLAY AGAIN üé≠</span>
                <span class="lang-es">JUGAR DE NUEVO üé≠</span>
            </button>
            <button class="home-btn" id="homeBtn">
                <span class="lang-en">‚Üê BACK</span>
                <span class="lang-es">‚Üê VOLVER</span>
            </button>
        </div>
    </div>

    <!-- Score Display -->
    <div class="score-display hidden" id="scoreDisplay">
        <div class="score-label">SCORE</div>
        <div class="score-value" id="currentScore">0</div>
        <div class="streak-display">
            <span class="lang-en">üî• Streak: </span>
            <span class="lang-es">üî• Racha: </span>
            <span class="streak-value" id="streakValue">0</span>
        </div>
    </div>
</div>

<!-- Coach Bubble -->
<div class="coach-bubble hidden" id="coachBubble">
    <div class="coach-avatar"><img src="go_chat.png" alt="Coach" class="coach-avatar-img"></div>
    <div class="coach-text" id="coachText">Great job!</div>
</div>

<script>
(function() {
    // Language
    var lang = localStorage.getItem('gt-lang') || 'en';
    function setLang(l) {
        lang = l;
        localStorage.setItem('gt-lang', l);
        document.body.className = l;
        document.querySelectorAll('.lang-btn').forEach(function(b) {
            b.classList.toggle('active', b.dataset.lang === l);
        });
    }
    setLang(lang);
    document.querySelectorAll('.lang-btn').forEach(function(b) {
        b.addEventListener('click', function() { setLang(this.dataset.lang); });
    });

    // ============ SILLY SCENES DATABASE ============
    
    // Characters (WHO)
    var characters = [
        { emoji: 'üëµ', en: 'Grandma', es: 'Abuela' },
        { emoji: 'üë¥', en: 'Grandpa', es: 'Abuelo' },
        { emoji: 'üë∂', en: 'Baby', es: 'Beb√©' },
        { emoji: 'üßë‚Äçüç≥', en: 'Chef', es: 'Chef' },
        { emoji: 'üë∏', en: 'Princess', es: 'Princesa' },
        { emoji: 'ü§¥', en: 'Prince', es: 'Pr√≠ncipe' },
        { emoji: 'üßô', en: 'Wizard', es: 'Mago' },
        { emoji: 'ü¶∏', en: 'Superhero', es: 'Superh√©roe' },
        { emoji: 'ü§†', en: 'Cowboy', es: 'Vaquero' },
        { emoji: 'üë®‚ÄçüöÄ', en: 'Astronaut', es: 'Astronauta' },
        { emoji: 'üßú‚Äç‚ôÄÔ∏è', en: 'Mermaid', es: 'Sirena' },
        { emoji: 'üßõ', en: 'Vampire', es: 'Vampiro' },
        { emoji: 'ü§ñ', en: 'Robot', es: 'Robot' },
        { emoji: 'üéÖ', en: 'Santa', es: 'Santa' },
        { emoji: 'üëª', en: 'Ghost', es: 'Fantasma' }
    ];
    
    // Actions (WHAT)
    var actions = [
        { emoji: 'üèÑ', en: 'surfing', es: 'surfeando' },
        { emoji: 'üíÉ', en: 'dancing', es: 'bailando' },
        { emoji: 'üé∏', en: 'playing guitar', es: 'tocando guitarra' },
        { emoji: 'üç≥', en: 'cooking', es: 'cocinando' },
        { emoji: 'üìö', en: 'reading', es: 'leyendo' },
        { emoji: 'üéÆ', en: 'gaming', es: 'jugando videojuegos' },
        { emoji: 'üßò', en: 'doing yoga', es: 'haciendo yoga' },
        { emoji: 'üé§', en: 'singing', es: 'cantando' },
        { emoji: 'üõπ', en: 'skateboarding', es: 'patinando' },
        { emoji: 'üé®', en: 'painting', es: 'pintando' },
        { emoji: 'üèãÔ∏è', en: 'lifting weights', es: 'levantando pesas' },
        { emoji: 'üéπ', en: 'playing piano', es: 'tocando piano' },
        { emoji: 'üßπ', en: 'sweeping', es: 'barriendo' },
        { emoji: 'üì±', en: 'taking selfies', es: 'tomando selfies' },
        { emoji: 'üé£', en: 'fishing', es: 'pescando' }
    ];
    
    // Locations (WHERE)
    var locations = [
        { emoji: 'üåô', en: 'at night', es: 'de noche' },
        { emoji: 'üèñÔ∏è', en: 'on the beach', es: 'en la playa' },
        { emoji: 'üåã', en: 'on a volcano', es: 'en un volc√°n' },
        { emoji: 'üöÄ', en: 'in space', es: 'en el espacio' },
        { emoji: 'üõÅ', en: 'in a bathtub', es: 'en la ba√±era' },
        { emoji: 'üé¢', en: 'on a rollercoaster', es: 'en monta√±a rusa' },
        { emoji: '‚òÅÔ∏è', en: 'on a cloud', es: 'en una nube' },
        { emoji: 'üè∞', en: 'in a castle', es: 'en un castillo' },
        { emoji: 'üåà', en: 'on a rainbow', es: 'en un arco√≠ris' },
        { emoji: 'ü¶ñ', en: 'with dinosaurs', es: 'con dinosaurios' },
        { emoji: 'üé™', en: 'at the circus', es: 'en el circo' },
        { emoji: 'üèîÔ∏è', en: 'on a mountain', es: 'en la monta√±a' },
        { emoji: 'üåä', en: 'underwater', es: 'bajo el agua' },
        { emoji: 'üéÑ', en: 'at Christmas', es: 'en Navidad' },
        { emoji: 'üå∫', en: 'in a garden', es: 'en un jard√≠n' }
    ];

    // ============ COACH MESSAGES ============
    var coachMessages = {
        start: {
            en: "Get ready for some RIDICULOUS scenes! üé≠üòÇ",
            es: "¬°Prep√°rate para escenas RID√çCULAS! üé≠üòÇ"
        },
        showingScene: [
            { en: "Look at THIS! üòÇ", es: "¬°Mira ESTO! üòÇ" },
            { en: "Can you BELIEVE it?! ü§£", es: "¬°¬øPuedes CREERLO?! ü§£" },
            { en: "This is TOO much! üòÇ", es: "¬°Esto es DEMASIADO! üòÇ" },
            { en: "What is happening?! ü§£", es: "¬°¬øQu√© est√° pasando?! ü§£" },
            { en: "I can't stop laughing! üòÇ", es: "¬°No puedo parar de re√≠r! üòÇ" },
            { en: "Remember this craziness! üé≠", es: "¬°Recuerda esta locura! üé≠" },
            { en: "Okay this is hilarious! üòÇ", es: "¬°Esto es gracios√≠simo! üòÇ" },
            { en: "Watch carefully! üëÄüòÇ", es: "¬°Mira con cuidado! üëÄüòÇ" }
        ],
        questionTime: [
            { en: "Now... do you remember? ü§î", es: "Ahora... ¬ørecuerdas? ü§î" },
            { en: "Let's see what you remember! üß†", es: "¬°Veamos qu√© recuerdas! üß†" },
            { en: "Time to test your memory! üí™", es: "¬°Hora de probar tu memoria! üí™" },
            { en: "Can you recall that silliness? üòÇ", es: "¬øRecuerdas esa tonter√≠a? üòÇ" }
        ],
        correct: [
            { en: "YES! You remembered! üéâ", es: "¬°S√ç! ¬°Lo recordaste! üéâ" },
            { en: "That scene stuck with you! üòÇ", es: "¬°Esa escena se qued√≥ contigo! üòÇ" },
            { en: "Your memory is SHARP! üß†", es: "¬°Tu memoria est√° AFILADA! üß†" },
            { en: "Nothing gets past you! üí™", es: "¬°Nada se te escapa! üí™" },
            { en: "Laughing AND remembering! üòÇüß†", es: "¬°Riendo Y recordando! üòÇüß†" },
            { en: "That's my player! üèÄ", es: "¬°Ese es mi jugador! üèÄ" },
            { en: "BOOM! Nailed it! üí•", es: "¬°BOOM! ¬°Clavado! üí•" }
        ],
        streak: [
            { en: "You're on FIRE! üî•üî•", es: "¬°Est√°s en FUEGO! üî•üî•" },
            { en: "STREAK! Unstoppable! üî•", es: "¬°RACHA! ¬°Imparable! üî•" },
            { en: "Memory CHAMPION! üèÜ", es: "¬°CAMPE√ìN de memoria! üèÜ" },
            { en: "Can't touch this! üí™üî•", es: "¬°Intocable! üí™üî•" }
        ],
        wrong: [
            { en: "That scene WAS crazy! üòÖ", es: "¬°Esa escena S√ç era loca! üòÖ" },
            { en: "So many silly scenes! üòÑ", es: "¬°Tantas escenas absurdas! üòÑ" },
            { en: "Keep trying, keep laughing! üòä", es: "¬°Sigue intentando, sigue riendo! üòä" },
            { en: "Close! Think silly! ü§™", es: "¬°Cerca! ¬°Piensa absurdo! ü§™" }
        ],
        tierUp: {
            en: "TIER UP! Scenes get CRAZIER! üé≠üî•",
            es: "¬°SUBISTE! ¬°Escenas m√°s LOCAS! üé≠üî•"
        },
        newTierIntro: [
            { en: "Ready for MORE madness? üòÇ", es: "¬øListo para M√ÅS locura? üòÇ" },
            { en: "The scenes are getting wilder! üé≠", es: "¬°Las escenas son m√°s salvajes! üé≠" },
            { en: "Can your memory handle THIS? üòè", es: "¬øTu memoria puede con ESTO? üòè" }
        ],
        gameOver: {
            en: "What a show! Your brain loved it! üé≠üòÇ",
            es: "¬°Qu√© show! ¬°Tu cerebro lo am√≥! üé≠üòÇ"
        },
        highScore: {
            en: "LEGENDARY performance! üèÜüé≠",
            es: "¬°Actuaci√≥n LEGENDARIA! üèÜüé≠"
        }
    };

    // ============ GAME STATE ============
    var tier = 1;
    var score = 0;
    var streak = 0;
    var round = 0;
    var roundsPerTier = 5;
    var scenesToRemember = [];
    var currentSceneIndex = 0;
    var currentQuestion = null;
    var timerInterval = null;
    var totalScenesWatched = 0;

    // Tier settings
    var tierSettings = [
        { scenes: 1, time: 5000, questions: 1 },  // Tier 1
        { scenes: 1, time: 4500, questions: 1 },  // Tier 2
        { scenes: 2, time: 4500, questions: 2 },  // Tier 3
        { scenes: 2, time: 4000, questions: 2 },  // Tier 4
        { scenes: 2, time: 4000, questions: 2 },  // Tier 5
        { scenes: 3, time: 4000, questions: 3 },  // Tier 6
        { scenes: 3, time: 3500, questions: 3 },  // Tier 7
        { scenes: 3, time: 3500, questions: 3 },  // Tier 8
        { scenes: 4, time: 3500, questions: 4 },  // Tier 9
        { scenes: 4, time: 3000, questions: 4 }   // Tier 10
    ];

    // DOM elements
    var introScreen = document.getElementById('introScreen');
    var sceneScreen = document.getElementById('sceneScreen');
    var questionScreen = document.getElementById('questionScreen');
    var gameoverScreen = document.getElementById('gameoverScreen');
    var scoreDisplay = document.getElementById('scoreDisplay');
    var coachBubble = document.getElementById('coachBubble');
    var coachText = document.getElementById('coachText');

    // ============ HELPER FUNCTIONS ============
    function shuffle(arr) {
        var a = arr.slice();
        for (var i = a.length - 1; i > 0; i--) {
            var j = Math.floor(Math.random() * (i + 1));
            var t = a[i]; a[i] = a[j]; a[j] = t;
        }
        return a;
    }

    function showScreen(screen) {
        [introScreen, sceneScreen, questionScreen, gameoverScreen].forEach(function(s) {
            s.classList.add('hidden');
        });
        screen.classList.remove('hidden');
    }

    function updateScore() {
        document.getElementById('currentScore').textContent = score;
        document.getElementById('streakValue').textContent = streak;
    }

    function updateTierBadge() {
        document.getElementById('tierBadge').textContent = 'TIER ' + tier;
    }

    function showCoach(msg, duration) {
        coachText.innerHTML = msg;
        coachBubble.classList.remove('hidden');
        setTimeout(function() {
            coachBubble.classList.add('hidden');
        }, duration || 3000);
    }

    function createConfetti() {
        var container = document.getElementById('confettiContainer');
        for (var i = 0; i < 50; i++) {
            setTimeout(function() {
                var confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                container.appendChild(confetti);
                setTimeout(function() {
                    if (confetti.parentNode) confetti.parentNode.removeChild(confetti);
                }, 4000);
            }, i * 50);
        }
    }

    function generateScene() {
        var char = characters[Math.floor(Math.random() * characters.length)];
        var action = actions[Math.floor(Math.random() * actions.length)];
        var location = locations[Math.floor(Math.random() * locations.length)];
        
        return {
            character: char,
            action: action,
            location: location
        };
    }

    // ============ GAME LOGIC ============
    function startGame() {
        tier = 1;
        score = 0;
        streak = 0;
        round = 0;
        totalScenesWatched = 0;
        updateScore();
        updateTierBadge();
        scoreDisplay.classList.remove('hidden');
        showCoach(lang === 'es' ? coachMessages.start.es : coachMessages.start.en, 2500);
        setTimeout(startRound, 2000);
    }

    function startRound() {
        round++;
        currentSceneIndex = 0;
        
        var settings = tierSettings[tier - 1];
        scenesToRemember = [];
        
        for (var i = 0; i < settings.scenes; i++) {
            scenesToRemember.push(generateScene());
        }
        
        showScreen(sceneScreen);
        showNextScene();
    }

    function showNextScene() {
        var settings = tierSettings[tier - 1];
        
        if (currentSceneIndex >= scenesToRemember.length) {
            setTimeout(startQuestions, 500);
            return;
        }
        
        var scene = scenesToRemember[currentSceneIndex];
        totalScenesWatched++;
        
        // Display scene
        var emojis = scene.character.emoji + ' ' + scene.action.emoji + ' ' + scene.location.emoji;
        document.getElementById('sceneEmojis').textContent = emojis;
        
        var captionEn = '<span class="highlight">' + scene.character.en + '</span> ' + scene.action.en + ' <span class="highlight">' + scene.location.en + '</span>';
        var captionEs = '<span class="highlight">' + scene.character.es + '</span> ' + scene.action.es + ' <span class="highlight">' + scene.location.es + '</span>';
        document.getElementById('sceneCaption').innerHTML = lang === 'es' ? captionEs : captionEn;
        
        var counterText = lang === 'es' ? 
            'Escena ' + (currentSceneIndex + 1) + ' de ' + scenesToRemember.length :
            'Scene ' + (currentSceneIndex + 1) + ' of ' + scenesToRemember.length;
        document.getElementById('sceneCounter').textContent = counterText;
        
        // Animate
        document.getElementById('sceneEmojis').style.animation = 'none';
        setTimeout(function() {
            document.getElementById('sceneEmojis').style.animation = 'popIn 0.5s ease';
        }, 10);
        
        // Coach comments
        var sceneMsg = coachMessages.showingScene[Math.floor(Math.random() * coachMessages.showingScene.length)];
        showCoach(lang === 'es' ? sceneMsg.es : sceneMsg.en, settings.time - 500);
        
        // Timer
        var timerFill = document.getElementById('timerFill');
        timerFill.style.width = '100%';
        var startTime = Date.now();
        var duration = settings.time;
        
        clearInterval(timerInterval);
        timerInterval = setInterval(function() {
            var elapsed = Date.now() - startTime;
            var remaining = Math.max(0, 100 - (elapsed / duration * 100));
            timerFill.style.width = remaining + '%';
            
            if (remaining <= 0) {
                clearInterval(timerInterval);
                currentSceneIndex++;
                showNextScene();
            }
        }, 50);
    }

    var questionsAsked = 0;
    var questionsToAsk = [];

    function startQuestions() {
        questionsAsked = 0;
        questionsToAsk = [];
        
        // Generate questions for each scene
        scenesToRemember.forEach(function(scene, idx) {
            var questionTypes = ['character', 'action', 'location'];
            var qType = questionTypes[Math.floor(Math.random() * questionTypes.length)];
            questionsToAsk.push({ scene: scene, type: qType, sceneIdx: idx });
        });
        
        questionsToAsk = shuffle(questionsToAsk);
        
        var qMsg = coachMessages.questionTime[Math.floor(Math.random() * coachMessages.questionTime.length)];
        showCoach(lang === 'es' ? qMsg.es : qMsg.en, 2000);
        
        setTimeout(showNextQuestion, 1500);
    }

    function showNextQuestion() {
        if (questionsAsked >= questionsToAsk.length) {
            endRound();
            return;
        }
        
        showScreen(questionScreen);
        
        var q = questionsToAsk[questionsAsked];
        currentQuestion = q;
        
        var questionTextEl = document.getElementById('questionText');
        var questionSubjectEl = document.getElementById('questionSubject');
        var answersGrid = document.getElementById('answersGrid');
        answersGrid.innerHTML = '';
        
        var correctAnswer, wrongAnswers, questionHTML, subjectEmoji;
        
        if (q.type === 'character') {
            // Ask: What was [character] doing? OR Where was [character]?
            var askLocation = Math.random() > 0.5;
            if (askLocation) {
                questionHTML = lang === 'es' ? 
                    'ü§î ¬øD√ìNDE ESTABA ' + q.scene.character.es.toUpperCase() + '?' :
                    'ü§î WHERE WAS ' + q.scene.character.en.toUpperCase() + '?';
                subjectEmoji = q.scene.character.emoji;
                correctAnswer = q.scene.location;
                wrongAnswers = shuffle(locations.filter(function(l) { return l.emoji !== correctAnswer.emoji; })).slice(0, 3);
            } else {
                questionHTML = lang === 'es' ? 
                    'ü§î ¬øQU√â HAC√çA ' + q.scene.character.es.toUpperCase() + '?' :
                    'ü§î WHAT WAS ' + q.scene.character.en.toUpperCase() + ' DOING?';
                subjectEmoji = q.scene.character.emoji;
                correctAnswer = q.scene.action;
                wrongAnswers = shuffle(actions.filter(function(a) { return a.emoji !== correctAnswer.emoji; })).slice(0, 3);
            }
        } else if (q.type === 'action') {
            // Ask: Who was [action]?
            questionHTML = lang === 'es' ? 
                'ü§î ¬øQUI√âN ESTABA ' + q.scene.action.es.toUpperCase() + '?' :
                'ü§î WHO WAS ' + q.scene.action.en.toUpperCase() + '?';
            subjectEmoji = q.scene.action.emoji;
            correctAnswer = q.scene.character;
            wrongAnswers = shuffle(characters.filter(function(c) { return c.emoji !== correctAnswer.emoji; })).slice(0, 3);
        } else {
            // Ask: Who was at [location]? OR What happened at [location]?
            var askWho = Math.random() > 0.5;
            if (askWho) {
                questionHTML = lang === 'es' ? 
                    'ü§î ¬øQUI√âN ESTABA ' + q.scene.location.es.toUpperCase() + '?' :
                    'ü§î WHO WAS ' + q.scene.location.en.toUpperCase() + '?';
                subjectEmoji = q.scene.location.emoji;
                correctAnswer = q.scene.character;
                wrongAnswers = shuffle(characters.filter(function(c) { return c.emoji !== correctAnswer.emoji; })).slice(0, 3);
            } else {
                questionHTML = lang === 'es' ? 
                    'ü§î ¬øQU√â PAS√ì ' + q.scene.location.es.toUpperCase() + '?' :
                    'ü§î WHAT HAPPENED ' + q.scene.location.en.toUpperCase() + '?';
                subjectEmoji = q.scene.location.emoji;
                correctAnswer = q.scene.action;
                wrongAnswers = shuffle(actions.filter(function(a) { return a.emoji !== correctAnswer.emoji; })).slice(0, 3);
            }
        }
        
        questionTextEl.innerHTML = questionHTML;
        questionSubjectEl.textContent = subjectEmoji;
        
        // Create answer cards
        var allAnswers = shuffle([correctAnswer].concat(wrongAnswers));
        
        allAnswers.forEach(function(ans) {
            var card = document.createElement('div');
            card.className = 'answer-card';
            card.innerHTML = '<span class="emoji">' + ans.emoji + '</span><span class="label">' + (lang === 'es' ? ans.es : ans.en) + '</span>';
            card.dataset.isCorrect = (ans.emoji === correctAnswer.emoji) ? 'true' : 'false';
            
            card.addEventListener('click', function() {
                handleAnswer(card);
            });
            
            answersGrid.appendChild(card);
        });
    }

    function handleAnswer(card) {
        if (card.classList.contains('correct') || card.classList.contains('wrong')) return;
        
        // Disable all cards
        document.querySelectorAll('.answer-card').forEach(function(c) {
            c.style.pointerEvents = 'none';
        });
        
        var isCorrect = card.dataset.isCorrect === 'true';
        
        if (isCorrect) {
            card.classList.add('correct');
            score += 10 + (streak * 2);
            streak++;
            updateScore();
            
            var msg;
            if (streak >= 3) {
                msg = coachMessages.streak[Math.floor(Math.random() * coachMessages.streak.length)];
            } else {
                msg = coachMessages.correct[Math.floor(Math.random() * coachMessages.correct.length)];
            }
            showCoach(lang === 'es' ? msg.es : msg.en, 1500);
        } else {
            card.classList.add('wrong');
            // Highlight correct answer
            document.querySelectorAll('.answer-card').forEach(function(c) {
                if (c.dataset.isCorrect === 'true') c.classList.add('correct');
            });
            streak = 0;
            updateScore();
            
            var msg = coachMessages.wrong[Math.floor(Math.random() * coachMessages.wrong.length)];
            showCoach(lang === 'es' ? msg.es : msg.en, 1500);
        }
        
        questionsAsked++;
        setTimeout(showNextQuestion, 1500);
    }

    function endRound() {
        if (round >= roundsPerTier) {
            if (tier >= 10) {
                endGame();
            } else {
                tier++;
                round = 0;
                updateTierBadge();
                createConfetti();
                showCoach(lang === 'es' ? coachMessages.tierUp.es : coachMessages.tierUp.en, 2500);
                
                setTimeout(function() {
                    var introMsg = coachMessages.newTierIntro[Math.floor(Math.random() * coachMessages.newTierIntro.length)];
                    showCoach(lang === 'es' ? introMsg.es : introMsg.en, 2500);
                }, 2500);
                
                setTimeout(startRound, 5000);
            }
        } else {
            setTimeout(startRound, 1000);
        }
    }

    function endGame() {
        showScreen(gameoverScreen);
        scoreDisplay.classList.add('hidden');
        createConfetti();
        
        document.getElementById('finalScore').textContent = score;
        var scenesText = lang === 'es' ? 'üé≠ Escenas vistas: ' + totalScenesWatched : 'üé≠ Scenes witnessed: ' + totalScenesWatched;
        document.getElementById('laughCount').textContent = scenesText;
        
        var emoji = score >= 200 ? 'ü§©' : score >= 100 ? 'üé≠' : 'üòÑ';
        document.getElementById('gameoverEmoji').textContent = emoji;
        
        var endMsg = score >= 150 ? coachMessages.highScore : coachMessages.gameOver;
        showCoach(lang === 'es' ? endMsg.es : endMsg.en, 4000);
    }

    // ============ EVENT LISTENERS ============
    document.getElementById('startBtn').addEventListener('click', function() {
        startGame();
    });

    document.getElementById('retryBtn').addEventListener('click', function() {
        startGame();
    });

    document.getElementById('homeBtn').addEventListener('click', function() {
        showScreen(introScreen);
        scoreDisplay.classList.add('hidden');
    });

    document.getElementById('backBtn').addEventListener('click', function() {
        if (confirm(lang === 'es' ? '¬øSalir del juego?' : 'Exit game?')) {
            showScreen(introScreen);
            scoreDisplay.classList.add('hidden');
            clearInterval(timerInterval);
        }
    });

    // Initialize
    scoreDisplay.classList.add('hidden');
})();
</script>
</body>
</html>
