<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LAUGH 1: Silly Scenes | Laughletico‚Ñ¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B00;--teal:#00D9A5;--gold:#FFD700;--purple:#9B59B6;--pink:#FF69B4;--dark:#0a0a0f;--card:#111118;--text:#FFFFFF;--muted:#8892a0;--success:#00D9A5;--danger:#FF4757;--laugh1:#E74C3C}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text)}
body.es .lang-en{display:none!important}
body.en .lang-es{display:none!important}
.game-header{padding:15px 20px;background:linear-gradient(135deg,rgba(231,76,60,0.2),rgba(255,105,180,0.1));border-bottom:2px solid rgba(231,76,60,0.3);display:flex;align-items:center;justify-content:space-between}
.header-left{display:flex;align-items:center;gap:12px}
.coach-header-avatar{width:40px;height:40px;border-radius:50%;overflow:hidden}
.coach-header-img{width:100%;height:100%;object-fit:cover}
.coach-label{font-size:0.65rem;color:var(--muted);letter-spacing:1px}
.back-btn{width:40px;height:40px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;color:var(--text);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.game-title{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px}
.game-title .laugh-title{color:var(--laugh1)}
.game-title .num{color:var(--gold)}
.tier-badge{background:linear-gradient(135deg,var(--laugh1),var(--pink));padding:6px 14px;border-radius:20px;font-weight:700;font-size:0.8rem}
.lang-toggle{display:flex;gap:5px}
.lang-btn{padding:6px 12px;border:2px solid var(--laugh1);background:transparent;color:var(--laugh1);border-radius:15px;font-weight:700;font-size:0.7rem;cursor:pointer}
.lang-btn.active{background:var(--laugh1);color:var(--text)}
.game-container{height:calc(100vh - 80px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative}
.intro-screen{text-align:center;max-width:400px}
.intro-coach{margin-bottom:15px}
.intro-coach-img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid var(--laugh1);animation:wiggle 1s infinite}
@keyframes wiggle{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.intro-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:4px;margin-bottom:5px}
.intro-title .laugh-title{color:var(--laugh1)}
.intro-title .num{color:var(--gold)}
.intro-circuit{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:3px;margin-bottom:10px}
.intro-subtitle{color:var(--gold);font-family:'Bebas Neue',sans-serif;letter-spacing:2px;margin-bottom:20px}
.intro-desc{color:var(--muted);line-height:1.6;margin-bottom:25px}
.intro-desc strong{color:var(--text)}
.intro-coach-name{margin-top:20px;color:var(--muted);font-size:0.9rem}
.start-btn{padding:18px 50px;font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:4px;background:linear-gradient(135deg,var(--laugh1),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;box-shadow:0 8px 30px rgba(231,76,60,0.5)}

.mastery-display{background:var(--card);border:2px solid var(--laugh1);border-radius:20px;padding:20px;margin-bottom:25px}
.mastery-title{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;color:var(--gold);margin-bottom:15px}
.mastery-tier{display:flex;align-items:center;justify-content:center;gap:15px;margin-bottom:15px}
.mastery-tier-label{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--laugh1)}
.mastery-stars{display:flex;gap:8px}
.mastery-star{font-size:1.8rem;opacity:0.3;transition:all 0.3s}
.mastery-star.earned{opacity:1}
.mastery-info{font-size:0.8rem;color:var(--muted)}
.mastery-info strong{color:var(--success)}
.tier-progress{display:flex;justify-content:center;gap:6px;flex-wrap:wrap;margin-top:15px}
.tier-dot{width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:700;color:var(--muted);border:2px solid transparent}
.tier-dot.unlocked{background:var(--success);color:var(--dark);border-color:var(--success)}
.tier-dot.current{background:var(--laugh1);color:var(--text);border-color:var(--gold);animation:pulse 1s infinite}
.tier-dot.locked{opacity:0.4}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}

.scene-screen{text-align:center;width:100%}
.phase-label{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--gold);margin-bottom:15px}
.scene-display{background:var(--card);border:3px solid var(--laugh1);border-radius:25px;padding:30px 20px;margin:20px auto;max-width:350px}
.scene-emojis{font-size:4rem;margin-bottom:15px;display:flex;justify-content:center;gap:10px;animation:popIn 0.5s ease}
@keyframes popIn{0%{transform:scale(0);opacity:0}50%{transform:scale(1.2)}100%{transform:scale(1);opacity:1}}
.scene-caption{font-size:1.3rem;color:var(--text);line-height:1.5;font-weight:600}
.scene-caption .highlight{color:var(--laugh1)}
.timer-bar{width:80%;max-width:300px;height:8px;background:rgba(255,255,255,0.1);border-radius:10px;margin:25px auto;overflow:hidden}
.timer-fill{height:100%;background:linear-gradient(90deg,var(--laugh1),var(--pink));border-radius:10px;transition:width 0.1s linear}
.scene-counter{color:var(--muted);font-size:0.9rem;margin-top:10px}

.question-screen{text-align:center;width:100%}
.question-text{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:2px;color:var(--text);margin-bottom:10px}
.question-subject{font-size:3rem;margin:15px 0}
.answers-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;max-width:350px;margin:20px auto;padding:0 10px}
.answer-card{background:var(--card);border:3px solid rgba(255,255,255,0.1);border-radius:20px;padding:20px;cursor:pointer;transition:all 0.2s;display:flex;flex-direction:column;align-items:center;gap:8px}
.answer-card:active{transform:scale(0.98)}
.answer-card .emoji{font-size:3rem}
.answer-card .label{font-size:0.85rem;color:var(--muted)}
.answer-card.correct{border-color:var(--success);background:rgba(0,217,165,0.2)}
.answer-card.wrong{border-color:var(--danger);background:rgba(255,71,87,0.2)}

.score-display{position:absolute;top:100px;right:20px;text-align:right}
.score-label{font-size:0.7rem;color:var(--muted)}
.score-value{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--laugh1)}
.streak-display{margin-top:5px}
.streak-value{color:var(--gold);font-weight:700}

.laugh-counter{position:absolute;top:100px;left:20px;text-align:left}
.laugh-counter-label{font-size:0.7rem;color:var(--muted);letter-spacing:1px}
.laugh-counter-value{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold)}

.gameover-screen{text-align:center;max-width:400px}
.gameover-emoji{font-size:5rem;margin-bottom:20px}
.gameover-title{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:3px;margin-bottom:10px}
.gameover-score{font-family:'Bebas Neue',sans-serif;font-size:3rem;color:var(--laugh1);margin:15px 0}
.gameover-stats{color:var(--gold);margin-bottom:20px;font-size:1.1rem}
.gameover-mastery{background:var(--card);border:2px solid var(--gold);border-radius:15px;padding:15px;margin-bottom:20px}
.gameover-mastery-title{font-family:'Bebas Neue',sans-serif;color:var(--gold);margin-bottom:10px}
.gameover-stars{font-size:2rem}
.gameover-mastery-text{font-size:0.85rem;color:var(--muted);margin-top:10px}
.gameover-mastery-text strong{color:var(--success)}
.retry-btn{padding:16px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;background:linear-gradient(135deg,var(--laugh1),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;margin-bottom:15px;display:block;width:100%}
.home-btn{padding:14px 30px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:transparent;color:var(--muted);border:2px solid var(--muted);border-radius:50px;cursor:pointer;display:block;width:100%}

.coach-bubble{position:fixed;bottom:20px;left:20px;right:20px;background:var(--card);border:2px solid var(--laugh1);border-radius:20px;padding:15px;display:flex;align-items:center;gap:15px;z-index:50}
.coach-avatar{width:50px;height:50px;border-radius:50%;overflow:hidden}
.coach-avatar img{width:100%;height:100%;object-fit:cover}
.coach-text{font-size:0.95rem;line-height:1.4}

.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000}
.confetti{position:absolute;width:10px;height:10px;top:-10px;animation:fall 3s linear forwards}
@keyframes fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}

.laugh-pop{position:fixed;pointer-events:none;font-size:2rem;animation:laughFloat 1s ease-out forwards;z-index:999}
@keyframes laughFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-50px) scale(1.5)}}

.tier-up-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.9);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:2000}
.tier-up-content{text-align:center;animation:tierUpAppear 0.5s ease}
@keyframes tierUpAppear{0%{transform:scale(0);opacity:0}100%{transform:scale(1);opacity:1}}
.tier-up-emoji{font-size:5rem;margin-bottom:20px}
.tier-up-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;color:var(--gold);letter-spacing:4px;margin-bottom:10px}
.tier-up-subtitle{font-size:1.2rem;color:var(--muted);margin-bottom:30px}
.tier-up-btn{padding:15px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;background:linear-gradient(135deg,var(--laugh1),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer}

.hidden{display:none!important}
</style>
</head>
<body class="en">
<div class="confetti-container" id="confettiContainer"></div>

<div class="game-header">
<div class="header-left">
<button class="back-btn" id="backBtn">‚Üê</button>
<div class="coach-header-avatar"><img src="go_chat.png" alt="Coach" class="coach-header-img"></div>
<div>
<div class="game-title"><span class="laugh-title">LAUGH</span> <span class="num">1</span></div>
<div class="coach-label">w/ Coach GoTrotter AI</div>
</div>
<div class="tier-badge" id="tierBadge">TIER 1</div>
</div>
<div class="lang-toggle">
<button class="lang-btn active" data-lang="en">EN</button>
<button class="lang-btn" data-lang="es">ES</button>
</div>
</div>

<div class="game-container">

<div class="intro-screen" id="introScreen">
<div class="intro-coach"><img src="go_chat.png" alt="Coach" class="intro-coach-img"></div>
<div class="intro-title"><span class="laugh-title">LAUGH</span> <span class="num">1</span></div>
<div class="intro-circuit">SILLY SCENES üé≠</div>
<div class="intro-subtitle">
<span class="lang-en">MEMORY & LAUGHTER</span>
<span class="lang-es">MEMORIA Y RISA</span>
</div>

<div class="mastery-display" id="masteryDisplay">
<div class="mastery-title">
<span class="lang-en">YOUR JOURNEY</span>
<span class="lang-es">TU PROGRESO</span>
</div>
<div class="mastery-tier">
<span class="mastery-tier-label" id="currentTierLabel">TIER 1</span>
<div class="mastery-stars">
<span class="mastery-star" id="star1">‚≠ê</span>
<span class="mastery-star" id="star2">‚≠ê</span>
</div>
</div>
<div class="mastery-info">
<span class="lang-en"><strong>2 perfect rounds</strong> to unlock next tier</span>
<span class="lang-es"><strong>2 rondas perfectas</strong> para desbloquear</span>
</div>
<div class="tier-progress" id="tierProgress"></div>
</div>

<div class="intro-desc">
<span class="lang-en">Watch <strong>ridiculous scenes</strong> ‚Äî then remember what happened! ü§îüòÇ</span>
<span class="lang-es">Mira <strong>escenas rid√≠culas</strong> ‚Äî ¬°y recuerda qu√© pas√≥! ü§îüòÇ</span>
</div>
<button class="start-btn" id="startBtn">
<span class="lang-en">START SCENES! üé≠</span>
<span class="lang-es">¬°VER ESCENAS! üé≠</span>
</button>
<div class="intro-coach-name">
<span class="lang-en">with Coach GoTrotter AI üèÄ</span>
<span class="lang-es">con Coach GoTrotter AI üèÄ</span>
</div>
</div>

<div class="scene-screen hidden" id="sceneScreen">
<div class="phase-label">
<span class="lang-en">üé≠ WATCH THIS SCENE!</span>
<span class="lang-es">üé≠ ¬°MIRA ESTA ESCENA!</span>
</div>
<div class="scene-display">
<div class="scene-emojis" id="sceneEmojis">üëµ üèÑ üåô</div>
<div class="scene-caption" id="sceneCaption"><span class="highlight">Grandma</span> surfing at <span class="highlight">night</span></div>
</div>
<div class="timer-bar"><div class="timer-fill" id="timerFill"></div></div>
<div class="scene-counter" id="sceneCounter">Scene 1 of 3</div>
</div>

<div class="question-screen hidden" id="questionScreen">
<div class="question-text" id="questionText">ü§î WHERE WAS GRANDMA?</div>
<div class="question-subject" id="questionSubject">üëµ</div>
<div class="answers-grid" id="answersGrid"></div>
</div>

<div class="gameover-screen hidden" id="gameoverScreen">
<div class="gameover-emoji" id="gameoverEmoji">üé≠</div>
<div class="gameover-title">
<span class="lang-en">ROUND COMPLETE!</span>
<span class="lang-es">¬°RONDA COMPLETA!</span>
</div>
<div class="gameover-score" id="finalScore">0</div>
<div class="gameover-stats" id="gameStats">üòÇ Laugh Moments: 0</div>
<div class="gameover-mastery" id="gameoverMastery">
<div class="gameover-mastery-title">TIER <span id="gameoverTier">1</span> <span class="lang-en">PROGRESS</span><span class="lang-es">PROGRESO</span></div>
<div class="gameover-stars" id="gameoverStars">‚≠ê‚≠ê</div>
<div class="gameover-mastery-text" id="gameoverMasteryText"></div>
</div>
<button class="retry-btn" id="retryBtn">
<span class="lang-en">CONTINUE üé≠</span>
<span class="lang-es">CONTINUAR üé≠</span>
</button>
<button class="home-btn" id="homeBtn">
<span class="lang-en">‚Üê BACK</span>
<span class="lang-es">‚Üê VOLVER</span>
</button>
</div>

<div class="score-display hidden" id="scoreDisplay">
<div class="score-label">SCORE</div>
<div class="score-value" id="currentScore">0</div>
<div class="streak-display">üî• <span class="streak-value" id="streakValue">0</span></div>
</div>

<div class="laugh-counter hidden" id="laughCounter">
<div class="laugh-counter-label">üòÇ LAUGHS</div>
<div class="laugh-counter-value" id="laughCounterValue">0</div>
</div>

</div>

<div class="tier-up-overlay hidden" id="tierUpOverlay">
<div class="tier-up-content">
<div class="tier-up-emoji">üèÜ</div>
<div class="tier-up-title">TIER UP!</div>
<div class="tier-up-subtitle" id="tierUpSubtitle">You've unlocked Tier 2!</div>
<button class="tier-up-btn" id="tierUpBtn">CONTINUE!</button>
</div>
</div>

<div class="coach-bubble hidden" id="coachBubble">
<div class="coach-avatar"><img src="go_chat.png" alt="Coach"></div>
<div class="coach-text" id="coachText">Great!</div>
</div>

<script>
(function(){
var lang = localStorage.getItem('lw-lang') || 'en';
function setLang(l){
    lang = l;
    localStorage.setItem('lw-lang', l);
    document.body.className = l;
    document.querySelectorAll('.lang-btn').forEach(function(b){
        b.classList.toggle('active', b.dataset.lang === l);
    });
}
setLang(lang);
document.querySelectorAll('.lang-btn').forEach(function(b){
    b.addEventListener('click', function(e){
        e.preventDefault();
        setLang(this.dataset.lang);
    });
});

// ============ MASTERY SYSTEM ============
var GAME_KEY = 'laugh1';
var MAX_TIER = 10;

function getMasteryData() {
    var data = JSON.parse(localStorage.getItem(GAME_KEY + '-mastery') || '{}');
    if (!data.currentTier) data.currentTier = 1;
    if (!data.stars) data.stars = 0;
    if (!data.unlockedTiers) data.unlockedTiers = [1];
    return data;
}

function saveMasteryData(data) {
    localStorage.setItem(GAME_KEY + '-mastery', JSON.stringify(data));
}

function addStar() {
    var data = getMasteryData();
    data.stars++;
    if (data.stars >= 2 && data.currentTier < MAX_TIER) {
        data.currentTier++;
        data.stars = 0;
        if (data.unlockedTiers.indexOf(data.currentTier) === -1) {
            data.unlockedTiers.push(data.currentTier);
        }
        saveMasteryData(data);
        return { tierUp: true, newTier: data.currentTier };
    }
    saveMasteryData(data);
    return { tierUp: false };
}

function updateMasteryDisplay() {
    var data = getMasteryData();
    document.getElementById('currentTierLabel').textContent = 'TIER ' + data.currentTier;
    document.getElementById('tierBadge').textContent = 'TIER ' + data.currentTier;
    
    document.getElementById('star1').classList.toggle('earned', data.stars >= 1);
    document.getElementById('star2').classList.toggle('earned', data.stars >= 2);
    
    var progressHtml = '';
    for (var i = 1; i <= MAX_TIER; i++) {
        var cls = 'tier-dot';
        if (data.unlockedTiers.indexOf(i) !== -1) cls += ' unlocked';
        if (i === data.currentTier) cls += ' current';
        if (data.unlockedTiers.indexOf(i) === -1 && i !== data.currentTier) cls += ' locked';
        progressHtml += '<div class="' + cls + '">' + i + '</div>';
    }
    document.getElementById('tierProgress').innerHTML = progressHtml;
}

// ============ LAUGH TRACKING ============
var circuitLaughs = 0;

function getDateString(date) { return date.toISOString().split('T')[0]; }

function getWeekStart(date) {
    var d = new Date(date);
    var day = d.getDay();
    var diff = d.getDate() - day + (day === 0 ? -6 : 1);
    d.setDate(diff);
    return getDateString(d);
}

function addLaughs(count) {
    circuitLaughs += count;
    updateLaughDisplay();
    var today = getDateString(new Date());
    var weekStart = getWeekStart(new Date());
    var todayData = JSON.parse(localStorage.getItem('lw-laughs-today') || '{}');
    if (todayData.date !== today) todayData = { date: today, count: 0 };
    todayData.count += count;
    localStorage.setItem('lw-laughs-today', JSON.stringify(todayData));
    var weekData = JSON.parse(localStorage.getItem('lw-laughs-week') || '{}');
    if (weekData.weekStart !== weekStart) weekData = { weekStart: weekStart, count: 0 };
    weekData.count += count;
    localStorage.setItem('lw-laughs-week', JSON.stringify(weekData));
    var total = parseInt(localStorage.getItem('lw-laughs-total') || '0');
    localStorage.setItem('lw-laughs-total', (total + count).toString());
    showLaughPop(count);
}

function updateLaughDisplay() {
    document.getElementById('laughCounterValue').textContent = circuitLaughs;
}

function showLaughPop(count) {
    for (var i = 0; i < Math.min(count, 3); i++) {
        setTimeout(function() {
            var pop = document.createElement('div');
            pop.className = 'laugh-pop';
            pop.textContent = 'üòÇ';
            pop.style.left = (20 + Math.random() * 60) + '%';
            pop.style.top = (30 + Math.random() * 40) + '%';
            document.body.appendChild(pop);
            setTimeout(function() { if (pop.parentNode) pop.remove(); }, 1000);
        }, i * 150);
    }
}

// ============ SCENES DATABASE ============
var characters = [
    {emoji:'üëµ',en:'Grandma',es:'Abuela'},{emoji:'üë¥',en:'Grandpa',es:'Abuelo'},
    {emoji:'üë∂',en:'Baby',es:'Beb√©'},{emoji:'üßë‚Äçüç≥',en:'Chef',es:'Chef'},
    {emoji:'üë∏',en:'Princess',es:'Princesa'},{emoji:'ü§¥',en:'Prince',es:'Pr√≠ncipe'},
    {emoji:'üßô',en:'Wizard',es:'Mago'},{emoji:'ü¶∏',en:'Superhero',es:'Superh√©roe'},
    {emoji:'ü§†',en:'Cowboy',es:'Vaquero'},{emoji:'üë®‚ÄçüöÄ',en:'Astronaut',es:'Astronauta'},
    {emoji:'üßú‚Äç‚ôÄÔ∏è',en:'Mermaid',es:'Sirena'},{emoji:'üßõ',en:'Vampire',es:'Vampiro'},
    {emoji:'ü§ñ',en:'Robot',es:'Robot'},{emoji:'üéÖ',en:'Santa',es:'Santa'},
    {emoji:'üëª',en:'Ghost',es:'Fantasma'}
];

var actions = [
    {emoji:'üèÑ',en:'surfing',es:'surfeando'},{emoji:'üíÉ',en:'dancing',es:'bailando'},
    {emoji:'üé∏',en:'playing guitar',es:'tocando guitarra'},{emoji:'üç≥',en:'cooking',es:'cocinando'},
    {emoji:'üìö',en:'reading',es:'leyendo'},{emoji:'üéÆ',en:'gaming',es:'jugando'},
    {emoji:'üßò',en:'doing yoga',es:'haciendo yoga'},{emoji:'üé§',en:'singing',es:'cantando'},
    {emoji:'üõπ',en:'skateboarding',es:'patinando'},{emoji:'üé®',en:'painting',es:'pintando'},
    {emoji:'üèãÔ∏è',en:'lifting weights',es:'levantando pesas'},{emoji:'üéπ',en:'playing piano',es:'tocando piano'},
    {emoji:'üßπ',en:'sweeping',es:'barriendo'},{emoji:'üì±',en:'taking selfies',es:'tomando selfies'},
    {emoji:'üé£',en:'fishing',es:'pescando'}
];

var locations = [
    {emoji:'üåô',en:'at night',es:'de noche'},{emoji:'üèñÔ∏è',en:'on the beach',es:'en la playa'},
    {emoji:'üåã',en:'on a volcano',es:'en un volc√°n'},{emoji:'üöÄ',en:'in space',es:'en el espacio'},
    {emoji:'üõÅ',en:'in a bathtub',es:'en la ba√±era'},{emoji:'üé¢',en:'on a rollercoaster',es:'en monta√±a rusa'},
    {emoji:'‚òÅÔ∏è',en:'on a cloud',es:'en una nube'},{emoji:'üè∞',en:'in a castle',es:'en un castillo'},
    {emoji:'üåà',en:'on a rainbow',es:'en un arco√≠ris'},{emoji:'ü¶ñ',en:'with dinosaurs',es:'con dinosaurios'},
    {emoji:'üé™',en:'at the circus',es:'en el circo'},{emoji:'üèîÔ∏è',en:'on a mountain',es:'en la monta√±a'},
    {emoji:'üåä',en:'underwater',es:'bajo el agua'},{emoji:'üéÑ',en:'at Christmas',es:'en Navidad'},
    {emoji:'üå∫',en:'in a garden',es:'en un jard√≠n'}
];

var coachMsgs = {
    start:{en:"Get ready for RIDICULOUS scenes! üé≠üòÇ",es:"¬°Prep√°rate para escenas RID√çCULAS! üé≠üòÇ"},
    showingScene:[
        {en:"Look at THIS! üòÇ",es:"¬°Mira ESTO! üòÇ"},
        {en:"Can you BELIEVE it?! ü§£",es:"¬°¬øPuedes CREERLO?! ü§£"},
        {en:"This is TOO much! üòÇ",es:"¬°Esto es DEMASIADO! üòÇ"},
        {en:"Remember this! üß†",es:"¬°Recuerda esto! üß†"}
    ],
    questionTime:[{en:"Now... do you remember? ü§î",es:"Ahora... ¬ørecuerdas? ü§î"}],
    correct:[
        {en:"YES! You remembered! üéâ",es:"¬°S√ç! ¬°Lo recordaste! üéâ"},
        {en:"Your memory is SHARP! üß†",es:"¬°Tu memoria est√° AFILADA! üß†"},
        {en:"BOOM! Nailed it! üí•",es:"¬°BOOM! ¬°Clavado! üí•"}
    ],
    streak:[{en:"You're on FIRE! üî•üî•",es:"¬°Est√°s en FUEGO! üî•üî•"}],
    wrong:[{en:"That scene WAS crazy! üòÖ",es:"¬°Esa escena S√ç era loca! üòÖ"},{en:"Keep trying! üòä",es:"¬°Sigue intentando! üòä"}],
    perfect:{en:"PERFECT ROUND! ‚≠ê Star earned!",es:"¬°RONDA PERFECTA! ‚≠ê ¬°Estrella ganada!"},
    notPerfect:{en:"Keep practicing for that ‚≠ê!",es:"¬°Sigue practicando para esa ‚≠ê!"},
    tierUp:{en:"TIER UP! üèÜ",es:"¬°SUBISTE DE NIVEL! üèÜ"}
};

// ============ GAME STATE ============
var score = 0, streak = 0, questionsCorrect = 0, questionsTotal = 0;
var scenesToRemember = [], currentSceneIndex = 0;
var timerInterval = null;
var questionsAsked = 0, questionsToAsk = [];

var tierSettings = [
    {scenes:1,time:5000},{scenes:1,time:4500},{scenes:2,time:4500},{scenes:2,time:4000},
    {scenes:2,time:4000},{scenes:3,time:4000},{scenes:3,time:3500},{scenes:3,time:3500},
    {scenes:4,time:3500},{scenes:4,time:3000}
];

var introScreen = document.getElementById('introScreen');
var sceneScreen = document.getElementById('sceneScreen');
var questionScreen = document.getElementById('questionScreen');
var gameoverScreen = document.getElementById('gameoverScreen');
var scoreDisplay = document.getElementById('scoreDisplay');
var laughCounter = document.getElementById('laughCounter');
var coachBubble = document.getElementById('coachBubble');
var coachText = document.getElementById('coachText');
var tierUpOverlay = document.getElementById('tierUpOverlay');

function shuffle(arr) {
    var a = arr.slice();
    for (var i = a.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var t = a[i]; a[i] = a[j]; a[j] = t;
    }
    return a;
}

function showScreen(screen) {
    [introScreen, sceneScreen, questionScreen, gameoverScreen].forEach(function(s) { s.classList.add('hidden'); });
    screen.classList.remove('hidden');
}

function updateScore() {
    document.getElementById('currentScore').textContent = score;
    document.getElementById('streakValue').textContent = streak;
}

function showCoach(msg, dur) {
    coachText.innerHTML = msg;
    coachBubble.classList.remove('hidden');
    setTimeout(function() { coachBubble.classList.add('hidden'); }, dur || 2500);
}

function confetti() {
    var c = document.getElementById('confettiContainer');
    for (var i = 0; i < 50; i++) {
        setTimeout(function() {
            var p = document.createElement('div');
            p.className = 'confetti';
            p.style.left = Math.random() * 100 + 'vw';
            p.style.background = ['#E74C3C','#FF69B4','#FFD700','#00D9A5'][Math.floor(Math.random()*4)];
            p.style.animationDuration = (2 + Math.random() * 2) + 's';
            c.appendChild(p);
            setTimeout(function() { if (p.parentNode) p.remove(); }, 4000);
        }, i * 40);
    }
}

function generateScene() {
    return {
        character: characters[Math.floor(Math.random() * characters.length)],
        action: actions[Math.floor(Math.random() * actions.length)],
        location: locations[Math.floor(Math.random() * locations.length)]
    };
}

function startGame() {
    var data = getMasteryData();
    score = 0; streak = 0; questionsCorrect = 0; questionsTotal = 0; circuitLaughs = 0;
    updateScore(); updateLaughDisplay(); updateMasteryDisplay();
    scoreDisplay.classList.remove('hidden');
    laughCounter.classList.remove('hidden');
    document.getElementById('tierBadge').textContent = 'TIER ' + data.currentTier;
    showCoach(lang === 'es' ? coachMsgs.start.es : coachMsgs.start.en, 2500);
    setTimeout(startRound, 2000);
}

function startRound() {
    var data = getMasteryData();
    var settings = tierSettings[data.currentTier - 1];
    currentSceneIndex = 0;
    scenesToRemember = [];
    for (var i = 0; i < settings.scenes; i++) scenesToRemember.push(generateScene());
    showScreen(sceneScreen);
    showNextScene();
}

function showNextScene() {
    var data = getMasteryData();
    var settings = tierSettings[data.currentTier - 1];
    
    if (currentSceneIndex >= scenesToRemember.length) {
        setTimeout(startQuestions, 500);
        return;
    }
    
    var scene = scenesToRemember[currentSceneIndex];
    addLaughs(1);
    
    document.getElementById('sceneEmojis').textContent = scene.character.emoji + ' ' + scene.action.emoji + ' ' + scene.location.emoji;
    
    var caption = lang === 'es' ?
        '<span class="highlight">' + scene.character.es + '</span> ' + scene.action.es + ' <span class="highlight">' + scene.location.es + '</span>' :
        '<span class="highlight">' + scene.character.en + '</span> ' + scene.action.en + ' <span class="highlight">' + scene.location.en + '</span>';
    document.getElementById('sceneCaption').innerHTML = caption;
    document.getElementById('sceneCounter').textContent = (lang === 'es' ? 'Escena ' : 'Scene ') + (currentSceneIndex + 1) + ' / ' + scenesToRemember.length;
    
    document.getElementById('sceneEmojis').style.animation = 'none';
    setTimeout(function() { document.getElementById('sceneEmojis').style.animation = 'popIn 0.5s ease'; }, 10);
    
    var msg = coachMsgs.showingScene[Math.floor(Math.random() * coachMsgs.showingScene.length)];
    showCoach(lang === 'es' ? msg.es : msg.en, settings.time - 500);
    
    var timerFill = document.getElementById('timerFill');
    timerFill.style.width = '100%';
    var startTime = Date.now();
    clearInterval(timerInterval);
    timerInterval = setInterval(function() {
        var pct = Math.max(0, 100 - ((Date.now() - startTime) / settings.time * 100));
        timerFill.style.width = pct + '%';
        if (pct <= 0) {
            clearInterval(timerInterval);
            currentSceneIndex++;
            showNextScene();
        }
    }, 50);
}

function startQuestions() {
    questionsAsked = 0;
    questionsToAsk = [];
    scenesToRemember.forEach(function(scene) {
        var types = ['character', 'action', 'location'];
        questionsToAsk.push({ scene: scene, type: types[Math.floor(Math.random() * types.length)] });
    });
    questionsToAsk = shuffle(questionsToAsk);
    questionsTotal = questionsToAsk.length;
    var msg = coachMsgs.questionTime[0];
    showCoach(lang === 'es' ? msg.es : msg.en, 2000);
    setTimeout(showNextQuestion, 1500);
}

function showNextQuestion() {
    if (questionsAsked >= questionsToAsk.length) { endRound(); return; }
    
    showScreen(questionScreen);
    var q = questionsToAsk[questionsAsked];
    var answersGrid = document.getElementById('answersGrid');
    answersGrid.innerHTML = '';
    
    var correctAnswer, wrongAnswers, questionHTML, subjectEmoji;
    
    if (q.type === 'character') {
        var askLocation = Math.random() > 0.5;
        if (askLocation) {
            questionHTML = lang === 'es' ? 'ü§î ¬øD√ìNDE ESTABA ' + q.scene.character.es.toUpperCase() + '?' : 'ü§î WHERE WAS ' + q.scene.character.en.toUpperCase() + '?';
            subjectEmoji = q.scene.character.emoji;
            correctAnswer = q.scene.location;
            wrongAnswers = shuffle(locations.filter(function(l) { return l.emoji !== correctAnswer.emoji; })).slice(0, 3);
        } else {
            questionHTML = lang === 'es' ? 'ü§î ¬øQU√â HAC√çA ' + q.scene.character.es.toUpperCase() + '?' : 'ü§î WHAT WAS ' + q.scene.character.en.toUpperCase() + ' DOING?';
            subjectEmoji = q.scene.character.emoji;
            correctAnswer = q.scene.action;
            wrongAnswers = shuffle(actions.filter(function(a) { return a.emoji !== correctAnswer.emoji; })).slice(0, 3);
        }
    } else if (q.type === 'action') {
        questionHTML = lang === 'es' ? 'ü§î ¬øQUI√âN ESTABA ' + q.scene.action.es.toUpperCase() + '?' : 'ü§î WHO WAS ' + q.scene.action.en.toUpperCase() + '?';
        subjectEmoji = q.scene.action.emoji;
        correctAnswer = q.scene.character;
        wrongAnswers = shuffle(characters.filter(function(c) { return c.emoji !== correctAnswer.emoji; })).slice(0, 3);
    } else {
        var askWho = Math.random() > 0.5;
        if (askWho) {
            questionHTML = lang === 'es' ? 'ü§î ¬øQUI√âN ESTABA ' + q.scene.location.es.toUpperCase() + '?' : 'ü§î WHO WAS ' + q.scene.location.en.toUpperCase() + '?';
            subjectEmoji = q.scene.location.emoji;
            correctAnswer = q.scene.character;
            wrongAnswers = shuffle(characters.filter(function(c) { return c.emoji !== correctAnswer.emoji; })).slice(0, 3);
        } else {
            questionHTML = lang === 'es' ? 'ü§î ¬øQU√â PAS√ì ' + q.scene.location.es.toUpperCase() + '?' : 'ü§î WHAT HAPPENED ' + q.scene.location.en.toUpperCase() + '?';
            subjectEmoji = q.scene.location.emoji;
            correctAnswer = q.scene.action;
            wrongAnswers = shuffle(actions.filter(function(a) { return a.emoji !== correctAnswer.emoji; })).slice(0, 3);
        }
    }
    
    document.getElementById('questionText').innerHTML = questionHTML;
    document.getElementById('questionSubject').textContent = subjectEmoji;
    
    shuffle([correctAnswer].concat(wrongAnswers)).forEach(function(ans) {
        var card = document.createElement('div');
        card.className = 'answer-card';
        card.innerHTML = '<span class="emoji">' + ans.emoji + '</span><span class="label">' + (lang === 'es' ? ans.es : ans.en) + '</span>';
        card.dataset.isCorrect = (ans.emoji === correctAnswer.emoji) ? 'true' : 'false';
        card.addEventListener('click', function() { handleAnswer(card); });
        answersGrid.appendChild(card);
    });
}

function handleAnswer(card) {
    if (card.classList.contains('correct') || card.classList.contains('wrong')) return;
    document.querySelectorAll('.answer-card').forEach(function(c) { c.style.pointerEvents = 'none'; });
    var isCorrect = card.dataset.isCorrect === 'true';
    
    if (isCorrect) {
        card.classList.add('correct');
        score += 10 + (streak * 2);
        streak++;
        questionsCorrect++;
        updateScore();
        addLaughs(1);
        if (streak >= 3) addLaughs(2);
        var msg = streak >= 3 ? coachMsgs.streak[0] : coachMsgs.correct[Math.floor(Math.random() * coachMsgs.correct.length)];
        showCoach(lang === 'es' ? msg.es : msg.en, 1500);
    } else {
        card.classList.add('wrong');
        document.querySelectorAll('.answer-card').forEach(function(c) { if (c.dataset.isCorrect === 'true') c.classList.add('correct'); });
        streak = 0;
        updateScore();
        var msg = coachMsgs.wrong[Math.floor(Math.random() * coachMsgs.wrong.length)];
        showCoach(lang === 'es' ? msg.es : msg.en, 1500);
    }
    
    questionsAsked++;
    setTimeout(showNextQuestion, 1500);
}

function endRound() {
    var data = getMasteryData();
    var isPerfect = questionsCorrect === questionsTotal;
    addLaughs(3);
    
    showScreen(gameoverScreen);
    scoreDisplay.classList.add('hidden');
    laughCounter.classList.add('hidden');
    
    document.getElementById('finalScore').textContent = score;
    document.getElementById('gameStats').textContent = (lang === 'es' ? 'üòÇ Momentos de Risa: ' : 'üòÇ Laugh Moments: ') + circuitLaughs;
    document.getElementById('gameoverTier').textContent = data.currentTier;
    
    if (isPerfect) {
        confetti();
        var result = addStar();
        data = getMasteryData();
        
        if (result.tierUp) {
            addLaughs(5);
            document.getElementById('gameoverStars').textContent = '‚≠ê‚≠ê';
            document.getElementById('gameoverMasteryText').innerHTML = lang === 'es' ? '<strong>¬°PERFECTO!</strong> ¬°Desbloqueaste Tier ' + result.newTier + '!' : '<strong>PERFECT!</strong> You unlocked Tier ' + result.newTier + '!';
            
            setTimeout(function() {
                tierUpOverlay.classList.remove('hidden');
                document.getElementById('tierUpSubtitle').textContent = lang === 'es' ? '¬°Desbloqueaste Tier ' + result.newTier + '!' : "You've unlocked Tier " + result.newTier + '!';
                confetti();
            }, 1000);
        } else {
            document.getElementById('gameoverStars').textContent = data.stars >= 1 ? '‚≠ê‚òÜ' : '‚òÜ‚òÜ';
            document.getElementById('gameoverMasteryText').innerHTML = lang === 'es' ? '<strong>¬°PERFECTO!</strong> ' + data.stars + '/2 estrellas para Tier ' + (data.currentTier + 1) : '<strong>PERFECT!</strong> ' + data.stars + '/2 stars toward Tier ' + (data.currentTier + 1);
        }
        showCoach(lang === 'es' ? coachMsgs.perfect.es : coachMsgs.perfect.en, 3000);
    } else {
        document.getElementById('gameoverStars').textContent = data.stars >= 1 ? '‚≠ê‚òÜ' : '‚òÜ‚òÜ';
        document.getElementById('gameoverMasteryText').innerHTML = lang === 'es' ? 'Necesitas <strong>100% correcto</strong> para ganar ‚≠ê' : 'Need <strong>100% correct</strong> to earn ‚≠ê';
        showCoach(lang === 'es' ? coachMsgs.notPerfect.es : coachMsgs.notPerfect.en, 3000);
    }
    
    document.getElementById('gameoverEmoji').textContent = isPerfect ? 'üåü' : 'üé≠';
    
    if (data.currentTier >= MAX_TIER && data.stars >= 2) {
        document.getElementById('gameoverMasteryText').innerHTML = lang === 'es' ? '<strong>¬°LEGENDARIO!</strong> ¬°Dominaste todos los niveles! üëë' : '<strong>LEGENDARY!</strong> You\'ve mastered all tiers! üëë';
    }
}

document.getElementById('startBtn').onclick = function() { updateMasteryDisplay(); startGame(); };
document.getElementById('retryBtn').onclick = function() { updateMasteryDisplay(); startGame(); };
document.getElementById('tierUpBtn').onclick = function() { tierUpOverlay.classList.add('hidden'); updateMasteryDisplay(); };
document.getElementById('homeBtn').onclick = function() { window.location.href = 'laugh-hub.html'; };
document.getElementById('backBtn').onclick = function() { if (confirm(lang === 'es' ? '¬øSalir?' : 'Exit?')) { clearInterval(timerInterval); window.location.href = 'laugh-hub.html'; } };

updateMasteryDisplay();
})();
</script>
</body>
</html>
