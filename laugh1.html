<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Laughleticoâ„¢ - LAUGH 1: Emoji Shuffle</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--purple:#6B21A8;--purple-dark:#581C87;--purple-light:#9333EA;--gold:#FFD700;--teal:#00D9A5;--dark:#0a0a0f;--darker:#050508;--card:#111118;--text:#FFFFFF;--muted:#8892a0;--success:#00D9A5;--danger:#FF4757}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text)}
body.es .lang-en{display:none!important}
body.en .lang-es{display:none!important}

.top-bar{position:fixed;top:0;left:0;right:0;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;z-index:100;background:linear-gradient(180deg,rgba(10,10,15,0.95) 0%,transparent 100%)}
.back-btn{padding:8px 16px;background:rgba(255,255,255,0.05);border:2px solid rgba(255,255,255,0.1);border-radius:20px;color:var(--muted);font-weight:600;font-size:0.85rem;cursor:pointer;text-decoration:none}
.lang-toggle{display:flex;gap:6px}
.lang-btn{padding:6px 12px;border:2px solid var(--gold);background:transparent;color:var(--gold);border-radius:15px;font-weight:700;font-size:0.75rem;cursor:pointer}
.lang-btn.active{background:var(--gold);color:var(--dark)}

.screen{display:none;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:80px 20px 40px;text-align:center}
.screen.active{display:flex}

.logo{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:3px;margin-bottom:5px}
.logo .laugh{color:var(--gold)}
.logo .letico{color:var(--text)}
.game-badge{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:3px;color:var(--purple-light);margin-bottom:15px}
.game-icon{font-size:4rem;margin-bottom:15px}
.mastery-badge{background:linear-gradient(135deg,var(--purple),var(--purple-dark));color:var(--text);padding:10px 20px;border-radius:25px;font-weight:700;font-size:0.8rem;margin-bottom:20px;border:2px solid var(--gold)}

.game-desc{max-width:320px;padding:15px;background:rgba(107,33,168,0.1);border-left:4px solid var(--purple);border-radius:0 15px 15px 0;margin-bottom:25px;text-align:left}
.game-desc p{font-size:0.9rem;color:var(--muted);line-height:1.5;margin-bottom:8px}
.game-desc strong{color:var(--text)}

.tier-section{width:100%;max-width:350px;margin-bottom:20px}
.section-label{font-family:'Bebas Neue',sans-serif;font-size:0.85rem;letter-spacing:3px;color:var(--muted);margin-bottom:10px}
.tier-grid{display:flex;flex-direction:column;gap:6px;max-height:180px;overflow-y:auto;padding-right:5px}
.tier-btn{display:flex;align-items:center;gap:12px;padding:12px 15px;background:var(--card);border:2px solid transparent;border-radius:12px;cursor:pointer;transition:all 0.2s;text-align:left}
.tier-btn:hover:not(.locked){border-color:var(--purple);transform:translateX(5px)}
.tier-btn.selected{border-color:var(--gold);background:rgba(255,215,0,0.1)}
.tier-btn.locked{opacity:0.4;cursor:not-allowed}
.tier-btn.mastered{border-color:var(--success);background:rgba(0,217,165,0.1)}
.tier-icon{font-size:1.3rem}
.tier-info{flex:1}
.tier-name{font-family:'Bebas Neue',sans-serif;font-size:0.95rem;letter-spacing:2px;color:var(--text)}
.tier-desc{font-size:0.7rem;color:var(--muted)}
.tier-status{font-size:0.65rem;padding:3px 8px;border-radius:8px;font-weight:700}
.tier-status.mastered{background:var(--success);color:var(--dark)}
.tier-status.current{background:var(--gold);color:var(--dark)}
.tier-status.locked{background:rgba(255,255,255,0.1);color:var(--muted)}

.speed-section{width:100%;max-width:350px;margin-bottom:20px}
.speed-options{display:flex;gap:8px;justify-content:center}
.speed-btn{flex:1;padding:12px 10px;background:var(--card);border:2px solid rgba(255,255,255,0.1);border-radius:12px;color:var(--muted);font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px;cursor:pointer;transition:all 0.2s}
.speed-btn:hover{border-color:var(--purple);transform:translateY(-2px)}
.speed-btn.selected{border-color:var(--gold);background:rgba(255,215,0,0.1);color:var(--gold)}
.speed-btn[data-speed="slow"]{color:var(--teal)}
.speed-btn[data-speed="slow"].selected{border-color:var(--teal);background:rgba(0,217,165,0.1)}
.speed-btn[data-speed="fast"]{color:var(--danger)}
.speed-btn[data-speed="fast"].selected{border-color:var(--danger);background:rgba(255,71,87,0.1)}

.start-btn{padding:18px 50px;font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:4px;background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark);border:none;border-radius:50px;cursor:pointer;box-shadow:0 5px 25px rgba(255,215,0,0.4);transition:all 0.3s}
.start-btn:hover{transform:translateY(-3px);box-shadow:0 8px 30px rgba(255,215,0,0.5)}

.stats-row{display:flex;gap:25px;margin-top:20px}
.stat-item{text-align:center}
.stat-value{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold)}
.stat-label{font-size:0.65rem;color:var(--muted);letter-spacing:1px}

/* Countdown */
.countdown-tier{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:3px;color:var(--purple-light);margin-bottom:10px}
.countdown-num{font-family:'Bebas Neue',sans-serif;font-size:8rem;color:var(--gold);text-shadow:0 0 50px rgba(255,215,0,0.5)}
.countdown-text{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:4px;color:var(--muted)}

/* Game Screen */
#gameScreen{justify-content:flex-start;padding-top:70px}
.scoreboard{width:100%;max-width:360px;background:var(--card);border:2px solid rgba(255,255,255,0.1);border-radius:15px;padding:15px;margin-bottom:15px}
.scoreboard-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.scoreboard-tier{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px;color:var(--purple-light)}
.scoreboard-score{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--gold)}
.scoreboard-round{font-size:0.8rem;color:var(--muted)}
.progress-bar{height:8px;background:rgba(255,255,255,0.1);border-radius:4px;overflow:hidden}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--purple),var(--gold));border-radius:4px;transition:width 0.3s}
.accuracy-row{display:flex;justify-content:center;gap:20px;margin-top:10px}
.accuracy-item{text-align:center}
.accuracy-value{font-family:'Bebas Neue',sans-serif;font-size:1.2rem}
.accuracy-value.perfect{color:var(--success)}
.accuracy-value.miss{color:var(--danger)}
.accuracy-label{font-size:0.65rem;color:var(--muted)}

.message-area{height:60px;display:flex;align-items:center;justify-content:center}
.game-message{font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:2px;color:var(--text);transition:all 0.3s}
.game-message.success{color:var(--success)}
.game-message.error{color:var(--danger)}
.game-message.watch{color:var(--gold)}

/* Emoji Display Area */
.emoji-area{width:100%;max-width:360px;min-height:120px;background:var(--card);border:3px solid var(--purple);border-radius:20px;padding:20px;margin-bottom:20px;display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}
.emoji-slot{width:55px;height:65px;background:rgba(255,255,255,0.05);border:2px solid rgba(255,255,255,0.1);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;transition:all 0.3s;position:relative}
.emoji-slot.highlight{border-color:var(--gold);background:rgba(255,215,0,0.1);transform:scale(1.1)}
.emoji-slot.shuffling{animation:shuffle 0.3s ease}
.emoji-slot.correct{border-color:var(--success);background:rgba(0,217,165,0.2)}
.emoji-slot.wrong{border-color:var(--danger);background:rgba(255,71,87,0.2)}
@keyframes shuffle{0%{transform:translateY(0)}25%{transform:translateY(-10px)}50%{transform:translateY(5px)}75%{transform:translateY(-5px)}100%{transform:translateY(0)}}

/* Answer Area */
.answer-area{width:100%;max-width:360px;min-height:100px;background:rgba(255,255,255,0.03);border:2px dashed rgba(255,255,255,0.2);border-radius:15px;padding:15px;margin-bottom:15px;display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap}
.answer-slot{width:55px;height:65px;background:var(--card);border:2px solid var(--purple);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;cursor:pointer;transition:all 0.2s}
.answer-slot:hover{border-color:var(--gold);transform:scale(1.05)}
.answer-slot.empty{border-style:dashed;opacity:0.5}
.answer-slot.placed{border-color:var(--gold);background:rgba(255,215,0,0.1)}

/* Emoji Choices */
.choices-area{width:100%;max-width:360px;display:flex;align-items:center;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:15px}
.choice-btn{width:55px;height:65px;background:var(--card);border:2px solid rgba(255,255,255,0.2);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2.2rem;cursor:pointer;transition:all 0.2s}
.choice-btn:hover{border-color:var(--gold);transform:scale(1.1)}
.choice-btn.used{opacity:0.3;pointer-events:none}

.action-row{display:flex;gap:10px}
.clear-btn{padding:12px 25px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:rgba(255,255,255,0.1);color:var(--muted);border:2px solid rgba(255,255,255,0.2);border-radius:25px;cursor:pointer}
.submit-btn{padding:12px 30px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:linear-gradient(135deg,var(--success),#00B389);color:var(--dark);border:none;border-radius:25px;cursor:pointer;opacity:0.5;pointer-events:none}
.submit-btn.ready{opacity:1;pointer-events:auto}

/* Halftime & Results */
.result-icon{font-size:5rem;margin-bottom:15px}
.result-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:4px;margin-bottom:10px}
.result-title.success{color:var(--success)}
.result-title.retry{color:var(--gold)}
.result-message{font-size:1rem;color:var(--muted);max-width:300px;line-height:1.5;margin-bottom:20px}
.result-stats{display:flex;gap:30px;margin-bottom:25px}
.result-stat{text-align:center}
.result-stat-value{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--text)}
.result-stat-label{font-size:0.7rem;color:var(--muted)}
.result-accuracy{font-family:'Bebas Neue',sans-serif;font-size:4rem;margin-bottom:10px}
.result-accuracy.perfect{color:var(--success)}
.result-accuracy.miss{color:var(--danger)}

.next-tier-box{background:var(--card);border:2px solid var(--success);border-radius:15px;padding:15px 25px;margin-bottom:20px}
.next-tier-label{font-size:0.75rem;color:var(--success);margin-bottom:5px}
.next-tier-name{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;color:var(--text)}

.btn-group{display:flex;flex-direction:column;gap:10px;width:100%;max-width:250px}
.continue-btn{padding:15px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;background:linear-gradient(135deg,var(--success),#00B389);color:var(--dark);border:none;border-radius:30px;cursor:pointer}
.retry-btn{padding:15px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark);border:none;border-radius:30px;cursor:pointer}
.home-btn{padding:12px 30px;font-family:'Outfit',sans-serif;font-size:0.9rem;font-weight:600;background:transparent;color:var(--muted);border:2px solid rgba(255,255,255,0.2);border-radius:30px;cursor:pointer}

/* Coach Bubble */
.coach-bubble{position:fixed;bottom:20px;right:20px;max-width:280px;background:var(--card);border:2px solid var(--purple);border-radius:20px 20px 5px 20px;padding:15px;z-index:200;opacity:0;transform:translateY(20px);transition:all 0.4s;pointer-events:none}
.coach-bubble.visible{opacity:1;transform:translateY(0)}
.coach-bubble::after{content:'';position:absolute;bottom:-8px;right:20px;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid var(--purple)}
.coach-text{font-size:0.9rem;color:var(--text);line-height:1.4}
.coach-label{font-size:0.7rem;color:var(--purple-light);margin-top:8px;font-weight:700}

/* Laugh Counter */
.laugh-counter{position:fixed;top:70px;right:20px;background:var(--card);border:2px solid var(--gold);border-radius:20px;padding:8px 15px;display:flex;align-items:center;gap:8px;z-index:100;opacity:0;transform:scale(0.8);transition:all 0.3s}
.laugh-counter.visible{opacity:1;transform:scale(1)}
.laugh-counter-icon{font-size:1.2rem}
.laugh-counter-value{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;color:var(--gold)}

/* Confetti */
.confetti{position:fixed;width:10px;height:10px;top:-10px;z-index:1000;animation:fall 3s linear forwards}
@keyframes fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}

@media(max-width:380px){.emoji-slot,.answer-slot,.choice-btn{width:48px;height:58px;font-size:1.8rem}.game-message{font-size:1.2rem}}
</style>
</head>
<body class="en">

<div class="top-bar">
<a class="back-btn" href="laugh-hub.html">â† <span class="lang-en">Back</span><span class="lang-es">Volver</span></a>
<div class="lang-toggle">
<button class="lang-btn active" data-lang="en">EN</button>
<button class="lang-btn" data-lang="es">ES</button>
</div>
</div>

<div class="coach-bubble" id="coachBubble">
<div class="coach-text" id="coachText"></div>
<div class="coach-label">â€” Coach GoTrotter AI ğŸ€</div>
</div>

<div class="laugh-counter" id="laughCounter">
<span class="laugh-counter-icon">ğŸ˜‚</span>
<span class="laugh-counter-value" id="laughValue">0</span>
</div>

<!-- WELCOME SCREEN -->
<div class="screen active" id="welcomeScreen">
<div class="logo"><span class="laugh">LAUGH</span><span class="letico">LETICO</span>â„¢</div>
<div class="game-badge">LAUGH 1 â€¢ EMOJI SHUFFLE</div>
<div class="game-icon">ğŸ”€</div>
<div class="mastery-badge">ğŸ¯ <span class="lang-en">100% ACCURACY TO ADVANCE</span><span class="lang-es">100% PARA AVANZAR</span></div>

<div class="game-desc">
<p><span class="lang-en"><strong>Watch the emojis.</strong> They shuffle. <strong>Put them back in order!</strong></span><span class="lang-es"><strong>Mira los emojis.</strong> Se mezclan. <strong>Â¡Ponlos en orden!</strong></span></p>
<p><span class="lang-en">More emojis = more laughs = bigger brain! ğŸ§ ğŸ˜‚</span><span class="lang-es">MÃ¡s emojis = mÃ¡s risas = Â¡cerebro mÃ¡s grande! ğŸ§ ğŸ˜‚</span></p>
</div>

<div class="tier-section">
<div class="section-label"><span class="lang-en">SELECT TIER</span><span class="lang-es">SELECCIONA NIVEL</span></div>
<div class="tier-grid" id="tierGrid"></div>
</div>

<div class="speed-section">
<div class="section-label"><span class="lang-en">SHUFFLE SPEED</span><span class="lang-es">VELOCIDAD</span></div>
<div class="speed-options" id="speedOptions">
<button class="speed-btn" data-speed="slow">ğŸ¢ <span class="lang-en">SLOW</span><span class="lang-es">LENTO</span></button>
<button class="speed-btn selected" data-speed="medium">ğŸƒ <span class="lang-en">MEDIUM</span><span class="lang-es">MEDIO</span></button>
<button class="speed-btn" data-speed="fast">âš¡ <span class="lang-en">FAST</span><span class="lang-es">RÃPIDO</span></button>
</div>
</div>

<button class="start-btn" id="startBtn"><span class="lang-en">LET'S SHUFFLE!</span><span class="lang-es">Â¡A MEZCLAR!</span></button>

<div class="stats-row">
<div class="stat-item"><div class="stat-value" id="statTier">1</div><div class="stat-label"><span class="lang-en">TIER</span><span class="lang-es">NIVEL</span></div></div>
<div class="stat-item"><div class="stat-value" id="statPerfect">0</div><div class="stat-label"><span class="lang-en">PERFECT</span><span class="lang-es">PERFECTOS</span></div></div>
<div class="stat-item"><div class="stat-value" id="statStars">0</div><div class="stat-label">â­</div></div>
</div>
</div>

<!-- COUNTDOWN SCREEN -->
<div class="screen" id="countdownScreen">
<div class="game-icon">ğŸ”€</div>
<div class="countdown-tier" id="countdownTier">TIER 1</div>
<div class="countdown-num" id="countdownNum">3</div>
<div class="countdown-text"><span class="lang-en">GET READY!</span><span class="lang-es">Â¡PREPÃRATE!</span></div>
</div>

<!-- GAME SCREEN -->
<div class="screen" id="gameScreen">
<div class="scoreboard">
<div class="scoreboard-top">
<div class="scoreboard-tier" id="gameTier">TIER 1</div>
<div class="scoreboard-score" id="gameScore">0</div>
</div>
<div class="scoreboard-round" id="gameRound"><span class="lang-en">Round</span><span class="lang-es">Ronda</span> 1/5</div>
<div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
<div class="accuracy-row">
<div class="accuracy-item"><div class="accuracy-value perfect" id="correctCount">0</div><div class="accuracy-label">âœ“</div></div>
<div class="accuracy-item"><div class="accuracy-value miss" id="wrongCount">0</div><div class="accuracy-label">âœ—</div></div>
</div>
</div>

<div class="message-area"><div class="game-message" id="gameMessage"></div></div>

<div class="emoji-area" id="emojiArea"></div>

<div class="answer-area" id="answerArea"></div>

<div class="choices-area" id="choicesArea"></div>

<div class="action-row">
<button class="clear-btn" id="clearBtn"><span class="lang-en">CLEAR</span><span class="lang-es">BORRAR</span></button>
<button class="submit-btn" id="submitBtn"><span class="lang-en">CHECK!</span><span class="lang-es">Â¡REVISAR!</span></button>
</div>
</div>

<!-- HALFTIME SCREEN -->
<div class="screen" id="halftimeScreen">
<div class="result-icon">â¸ï¸</div>
<div class="result-title"><span class="lang-en">HALFTIME!</span><span class="lang-es">Â¡MEDIO TIEMPO!</span></div>
<div class="result-stats">
<div class="result-stat"><div class="result-stat-value" id="htScore">0</div><div class="result-stat-label"><span class="lang-en">Score</span><span class="lang-es">Puntos</span></div></div>
<div class="result-stat"><div class="result-stat-value" id="htAccuracy">100%</div><div class="result-stat-label"><span class="lang-en">Accuracy</span><span class="lang-es">PrecisiÃ³n</span></div></div>
</div>
<div class="result-message"><span class="lang-en">Keep 100% in the 2nd half to advance!</span><span class="lang-es">Â¡MantÃ©n 100% en la 2da mitad para avanzar!</span></div>
<button class="retry-btn" id="halftimeBtn"><span class="lang-en">2ND HALF â†’</span><span class="lang-es">2DA MITAD â†’</span></button>
</div>

<!-- RESULT SCREEN -->
<div class="screen" id="resultScreen">
<div class="result-icon" id="resultIcon">ğŸ†</div>
<div class="result-title" id="resultTitle">PERFECT!</div>
<div class="result-accuracy" id="resultAccuracy">100%</div>
<div class="result-message" id="resultMessage"></div>
<div class="result-stats">
<div class="result-stat"><div class="result-stat-value" id="finalScore">0</div><div class="result-stat-label"><span class="lang-en">Score</span><span class="lang-es">Puntos</span></div></div>
<div class="result-stat"><div class="result-stat-value" id="finalCorrect">0/0</div><div class="result-stat-label"><span class="lang-en">Correct</span><span class="lang-es">Correctos</span></div></div>
</div>
<div class="next-tier-box" id="nextTierBox" style="display:none">
<div class="next-tier-label"><span class="lang-en">NEXT TIER UNLOCKED!</span><span class="lang-es">Â¡SIGUIENTE NIVEL!</span></div>
<div class="next-tier-name" id="nextTierName">TIER 2</div>
</div>
<div class="btn-group">
<button class="continue-btn" id="advanceBtn" style="display:none"><span class="lang-en">CONTINUE â†’</span><span class="lang-es">CONTINUAR â†’</span></button>
<button class="retry-btn" id="retryBtn"><span class="lang-en">PLAY AGAIN</span><span class="lang-es">JUGAR DE NUEVO</span></button>
<button class="home-btn" id="homeBtn">â† <span class="lang-en">Back to Hub</span><span class="lang-es">Volver al Hub</span></button>
</div>
</div>

<script>
(function(){
// Language
var lang = localStorage.getItem('lw-lang') || 'en';
function setLang(l) {
    lang = l;
    localStorage.setItem('lw-lang', l);
    document.body.className = l;
    document.querySelectorAll('.lang-btn').forEach(function(b) {
        b.classList.toggle('active', b.dataset.lang === l);
    });
}
setLang(lang);
document.querySelectorAll('.lang-btn').forEach(function(b) {
    b.addEventListener('click', function() { setLang(this.dataset.lang); });
});

// Audio
var audioCtx = null;
function playTone(freq, dur) {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    var osc = audioCtx.createOscillator();
    var gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + dur);
    osc.start();
    osc.stop(audioCtx.currentTime + dur);
}

// Emoji pool
var emojiPool = ['ğŸ˜‚','ğŸ¤£','ğŸ˜œ','ğŸ¤ª','ğŸ¥´','ğŸ¤¡','ğŸ‘»','ğŸ‘½','ğŸ¦†','ğŸ·','ğŸ”','ğŸ¦„','ğŸŒ­','ğŸ•','ğŸº','ğŸ›¸','ğŸ’©','ğŸª','ğŸ¥³','ğŸ¸','ğŸƒ','ğŸ¦‹','ğŸŒˆ','ğŸ©','ğŸ¸','ğŸš€','ğŸ¤–','ğŸ‘¾','ğŸ™','ğŸ¦‘'];

// Tier config (base values - modified by speed)
var tiers = [
    {name:'TIER 1', emojis:3, rounds:4, showTime:2000, shuffles:3},
    {name:'TIER 2', emojis:3, rounds:4, showTime:1800, shuffles:4},
    {name:'TIER 3', emojis:4, rounds:5, showTime:2000, shuffles:4},
    {name:'TIER 4', emojis:4, rounds:5, showTime:1800, shuffles:5},
    {name:'TIER 5', emojis:5, rounds:5, showTime:2000, shuffles:5},
    {name:'TIER 6', emojis:5, rounds:6, showTime:1800, shuffles:6},
    {name:'TIER 7', emojis:6, rounds:6, showTime:2000, shuffles:6},
    {name:'TIER 8', emojis:6, rounds:6, showTime:1500, shuffles:7},
    {name:'TIER 9', emojis:6, rounds:7, showTime:1500, shuffles:8},
    {name:'TIER 10', emojis:6, rounds:8, showTime:1200, shuffles:10}
];

// Speed settings
var speeds = {
    slow: {name: 'SLOW', nameEs: 'LENTO', showMult: 1.5, shuffleDelay: 400, icon: 'ğŸ¢'},
    medium: {name: 'MEDIUM', nameEs: 'MEDIO', showMult: 1.0, shuffleDelay: 250, icon: 'ğŸƒ'},
    fast: {name: 'FAST', nameEs: 'RÃPIDO', showMult: 0.6, shuffleDelay: 150, icon: 'âš¡'}
};
var selectedSpeed = 'medium';

// Coach messages
var coachMsgs = {
    welcome: {en:"Let's shuffle some laughs! ğŸ”€ğŸ˜‚", es:"Â¡Vamos a mezclar risas! ğŸ”€ğŸ˜‚"},
    watch: {en:"Watch closely... ğŸ‘€", es:"Mira bien... ğŸ‘€"},
    shuffle: {en:"SHUFFLE TIME! ğŸ”€", es:"Â¡A MEZCLAR! ğŸ”€"},
    yourTurn: {en:"Put them back! You got this! ğŸ’ª", es:"Â¡Ponlos en orden! Â¡TÃº puedes! ğŸ’ª"},
    correct: [
        {en:"BOOM! Perfect! ğŸ¯", es:"Â¡BOOM! Â¡Perfecto! ğŸ¯"},
        {en:"Your memory is ON FIRE! ğŸ”¥", es:"Â¡Tu memoria estÃ¡ EN LLAMAS! ğŸ”¥"},
        {en:"Brain gains! ğŸ’ªğŸ§ ", es:"Â¡Ganancias cerebrales! ğŸ’ªğŸ§ "},
        {en:"You're crushing it! ğŸ˜‚", es:"Â¡Lo estÃ¡s logrando! ğŸ˜‚"}
    ],
    wrong: [
        {en:"Almost! Shake it off! ğŸ’ª", es:"Â¡Casi! Â¡SacÃºdelo! ğŸ’ª"},
        {en:"Keep going! You got this!", es:"Â¡Sigue! Â¡TÃº puedes!"},
        {en:"The emojis are tricky! ğŸ¤ª", es:"Â¡Los emojis son traviesos! ğŸ¤ª"}
    ],
    halftime: {en:"Great first half! Stay sharp! ğŸ€", es:"Â¡Gran primera mitad! Â¡Mantente alerta! ğŸ€"},
    perfect: {en:"PERFECT GAME! You're a shuffle master! ğŸ†", es:"Â¡JUEGO PERFECTO! Â¡Eres maestro del shuffle! ğŸ†"},
    tierUp: {en:"TIER UP! Your brain is growing! ğŸ§ â¬†ï¸", es:"Â¡SUBISTE DE NIVEL! Â¡Tu cerebro crece! ğŸ§ â¬†ï¸"},
    tryAgain: {en:"Good effort! 100% unlocks the next tier! ğŸ’ª", es:"Â¡Buen esfuerzo! Â¡100% desbloquea el siguiente! ğŸ’ª"}
};

function getCoachMsg(key) {
    var msg = coachMsgs[key];
    if (Array.isArray(msg)) msg = msg[Math.floor(Math.random() * msg.length)];
    return lang === 'es' ? msg.es : msg.en;
}

var coachTimer = null;
function showCoach(key, duration) {
    if (coachTimer) clearTimeout(coachTimer);
    var bubble = document.getElementById('coachBubble');
    document.getElementById('coachText').textContent = getCoachMsg(key);
    bubble.classList.add('visible');
    if (duration) {
        coachTimer = setTimeout(function() { bubble.classList.remove('visible'); }, duration);
    }
}
function hideCoach() {
    if (coachTimer) clearTimeout(coachTimer);
    document.getElementById('coachBubble').classList.remove('visible');
}

// Laugh tracking
var sessionLaughs = 0;
function addLaugh(n) {
    n = n || 1;
    sessionLaughs += n;
    document.getElementById('laughValue').textContent = sessionLaughs;
    document.getElementById('laughCounter').classList.add('visible');
    // Save to localStorage
    var today = new Date().toISOString().split('T')[0];
    var todayData = JSON.parse(localStorage.getItem('lw-laughs-today') || '{}');
    if (todayData.date !== today) todayData = {date: today, count: 0};
    todayData.count += n;
    localStorage.setItem('lw-laughs-today', JSON.stringify(todayData));
    var total = parseInt(localStorage.getItem('lw-laughs-total') || '0') + n;
    localStorage.setItem('lw-laughs-total', String(total));
}

// Mastery storage
function getMastery() {
    try { return JSON.parse(localStorage.getItem('laugh1-mastery')) || {currentTier:1, stars:0, unlockedTiers:[1], perfectCount:0}; }
    catch(e) { return {currentTier:1, stars:0, unlockedTiers:[1], perfectCount:0}; }
}
function saveMastery(m) {
    localStorage.setItem('laugh1-mastery', JSON.stringify(m));
}

// Game state
var selectedTier = 0;
var currentRound = 0;
var currentHalf = 1;
var score = 0;
var correctCount = 0;
var wrongCount = 0;
var originalOrder = [];
var shuffledOrder = [];
var userAnswer = [];
var gameActive = false;

function showScreen(id) {
    document.querySelectorAll('.screen').forEach(function(s) { s.classList.remove('active'); });
    document.getElementById(id).classList.add('active');
}

// Build tier grid
function buildTierGrid() {
    var grid = document.getElementById('tierGrid');
    grid.innerHTML = '';
    var mastery = getMastery();
    
    tiers.forEach(function(t, i) {
        var unlocked = mastery.unlockedTiers.indexOf(i + 1) !== -1;
        var mastered = mastery.unlockedTiers.indexOf(i + 2) !== -1;
        var isCurrent = (i + 1) === mastery.currentTier;
        
        var btn = document.createElement('div');
        btn.className = 'tier-btn';
        if (i === selectedTier) btn.classList.add('selected');
        if (!unlocked) btn.classList.add('locked');
        if (mastered) btn.classList.add('mastered');
        
        var statusText = '';
        var statusClass = '';
        if (mastered) { statusText = 'âœ“'; statusClass = 'mastered'; }
        else if (!unlocked) { statusText = 'ğŸ”’'; statusClass = 'locked'; }
        else if (isCurrent) { statusText = lang === 'es' ? 'ACTUAL' : 'CURRENT'; statusClass = 'current'; }
        
        btn.innerHTML = '<span class="tier-icon">' + (mastered ? 'âœ…' : (unlocked ? 'ğŸ”€' : 'ğŸ”’')) + '</span>' +
            '<div class="tier-info"><div class="tier-name">' + t.name + '</div>' +
            '<div class="tier-desc">' + t.emojis + ' emojis</div></div>' +
            (statusText ? '<span class="tier-status ' + statusClass + '">' + statusText + '</span>' : '');
        
        if (unlocked) {
            btn.onclick = function() {
                selectedTier = i;
                buildTierGrid();
            };
        }
        
        grid.appendChild(btn);
    });
    
    // Update stats
    document.getElementById('statTier').textContent = mastery.currentTier;
    document.getElementById('statPerfect').textContent = mastery.perfectCount;
    document.getElementById('statStars').textContent = mastery.stars;
}

// Start game
function startGame() {
    currentRound = 0;
    currentHalf = 1;
    score = 0;
    correctCount = 0;
    wrongCount = 0;
    sessionLaughs = 0;
    document.getElementById('laughCounter').classList.remove('visible');
    
    var tier = tiers[selectedTier];
    var speed = speeds[selectedSpeed];
    var speedName = lang === 'es' ? speed.nameEs : speed.name;
    
    document.getElementById('countdownTier').textContent = tier.name + ' â€¢ ' + speed.icon + ' ' + speedName;
    document.getElementById('gameTier').textContent = tier.name + ' â€¢ ' + speed.icon;
    
    showScreen('countdownScreen');
    showCoach('welcome', 2500);
    countdown(3);
}

function countdown(n) {
    document.getElementById('countdownNum').textContent = n;
    if (n > 0) {
        playTone(440, 0.1);
        setTimeout(function() { countdown(n - 1); }, 1000);
    } else {
        playTone(880, 0.2);
        showScreen('gameScreen');
        addLaugh(1);
        nextRound();
    }
}

function updateScoreboard() {
    var tier = tiers[selectedTier];
    var totalRounds = tier.rounds;
    var halfRounds = Math.ceil(totalRounds / 2);
    var displayRound = currentHalf === 1 ? currentRound : (halfRounds + currentRound);
    
    document.getElementById('gameScore').textContent = score;
    document.getElementById('gameRound').innerHTML = (lang === 'es' ? 'Ronda ' : 'Round ') + displayRound + '/' + totalRounds;
    document.getElementById('progressFill').style.width = ((displayRound / totalRounds) * 100) + '%';
    document.getElementById('correctCount').textContent = correctCount;
    document.getElementById('wrongCount').textContent = wrongCount;
}

function setMessage(text, type) {
    var el = document.getElementById('gameMessage');
    el.textContent = text;
    el.className = 'game-message' + (type ? ' ' + type : '');
}

function nextRound() {
    var tier = tiers[selectedTier];
    var halfRounds = Math.ceil(tier.rounds / 2);
    
    currentRound++;
    
    if (currentRound > halfRounds) {
        if (currentHalf === 1) {
            showHalftime();
            return;
        } else {
            endGame();
            return;
        }
    }
    
    updateScoreboard();
    generateRound();
}

function generateRound() {
    var tier = tiers[selectedTier];
    var speed = speeds[selectedSpeed];
    gameActive = false;
    userAnswer = [];
    
    // Pick random emojis
    var pool = emojiPool.slice();
    originalOrder = [];
    for (var i = 0; i < tier.emojis; i++) {
        var idx = Math.floor(Math.random() * pool.length);
        originalOrder.push(pool.splice(idx, 1)[0]);
    }
    
    // Show original order
    setMessage(lang === 'es' ? 'Â¡MIRA!' : 'WATCH!', 'watch');
    showCoach('watch', 2000);
    renderEmojis(originalOrder, true);
    document.getElementById('answerArea').innerHTML = '';
    document.getElementById('choicesArea').innerHTML = '';
    document.getElementById('submitBtn').classList.remove('ready');
    
    addLaugh(1); // Laugh for seeing emojis
    
    // After show time (modified by speed), shuffle
    var showTime = Math.round(tier.showTime * speed.showMult);
    setTimeout(function() {
        setMessage(lang === 'es' ? 'ğŸ”€ MEZCLANDO...' : 'ğŸ”€ SHUFFLING...', 'watch');
        showCoach('shuffle', 1500);
        animateShuffle(tier.shuffles);
    }, showTime);
}

function renderEmojis(emojis, highlight) {
    var area = document.getElementById('emojiArea');
    area.innerHTML = '';
    emojis.forEach(function(e) {
        var slot = document.createElement('div');
        slot.className = 'emoji-slot' + (highlight ? ' highlight' : '');
        slot.textContent = e;
        area.appendChild(slot);
    });
}

function animateShuffle(times) {
    var tier = tiers[selectedTier];
    var speed = speeds[selectedSpeed];
    shuffledOrder = originalOrder.slice();
    var count = 0;
    
    function doShuffle() {
        if (count >= times) {
            // Ensure it's actually shuffled
            while (arraysEqual(shuffledOrder, originalOrder)) {
                shuffledOrder.sort(function() { return Math.random() - 0.5; });
            }
            renderEmojis(shuffledOrder, false);
            setTimeout(showChoices, 500);
            return;
        }
        
        // Fisher-Yates shuffle step
        var i = Math.floor(Math.random() * shuffledOrder.length);
        var j = Math.floor(Math.random() * shuffledOrder.length);
        var temp = shuffledOrder[i];
        shuffledOrder[i] = shuffledOrder[j];
        shuffledOrder[j] = temp;
        
        renderEmojis(shuffledOrder, false);
        document.querySelectorAll('#emojiArea .emoji-slot').forEach(function(s) {
            s.classList.add('shuffling');
        });
        playTone(300 + Math.random() * 200, 0.1);
        
        count++;
        setTimeout(doShuffle, speed.shuffleDelay);
    }
    
    doShuffle();
}

function arraysEqual(a, b) {
    if (a.length !== b.length) return false;
    for (var i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
    }
    return true;
}

function showChoices() {
    gameActive = true;
    setMessage(lang === 'es' ? 'Â¡PONLOS EN ORDEN!' : 'PUT THEM BACK!', '');
    showCoach('yourTurn', 2500);
    
    // Hide emoji area
    document.getElementById('emojiArea').innerHTML = '<div style="color:var(--muted);font-size:0.9rem;">' + 
        (lang === 'es' ? 'Â¿CuÃ¡l era el orden original?' : 'What was the original order?') + '</div>';
    
    // Build answer slots
    var answerArea = document.getElementById('answerArea');
    answerArea.innerHTML = '';
    for (var i = 0; i < originalOrder.length; i++) {
        var slot = document.createElement('div');
        slot.className = 'answer-slot empty';
        slot.dataset.index = i;
        slot.onclick = function() { removeFromAnswer(this); };
        answerArea.appendChild(slot);
    }
    
    // Build choice buttons (shuffled)
    var choices = shuffledOrder.slice();
    var choicesArea = document.getElementById('choicesArea');
    choicesArea.innerHTML = '';
    choices.forEach(function(e, i) {
        var btn = document.createElement('div');
        btn.className = 'choice-btn';
        btn.textContent = e;
        btn.dataset.emoji = e;
        btn.onclick = function() { addToAnswer(this); };
        choicesArea.appendChild(btn);
    });
}

function addToAnswer(btn) {
    if (!gameActive) return;
    if (btn.classList.contains('used')) return;
    
    var emoji = btn.dataset.emoji;
    userAnswer.push(emoji);
    btn.classList.add('used');
    playTone(500, 0.1);
    
    // Fill next empty slot
    var slots = document.querySelectorAll('#answerArea .answer-slot');
    for (var i = 0; i < slots.length; i++) {
        if (slots[i].classList.contains('empty')) {
            slots[i].textContent = emoji;
            slots[i].classList.remove('empty');
            slots[i].classList.add('placed');
            slots[i].dataset.emoji = emoji;
            break;
        }
    }
    
    // Check if ready to submit
    if (userAnswer.length === originalOrder.length) {
        document.getElementById('submitBtn').classList.add('ready');
    }
}

function removeFromAnswer(slot) {
    if (!gameActive) return;
    if (slot.classList.contains('empty')) return;
    
    var emoji = slot.dataset.emoji;
    var idx = userAnswer.indexOf(emoji);
    if (idx !== -1) userAnswer.splice(idx, 1);
    
    slot.textContent = '';
    slot.classList.add('empty');
    slot.classList.remove('placed');
    slot.dataset.emoji = '';
    playTone(300, 0.1);
    
    // Re-enable choice button
    document.querySelectorAll('#choicesArea .choice-btn').forEach(function(btn) {
        if (btn.dataset.emoji === emoji && btn.classList.contains('used')) {
            btn.classList.remove('used');
        }
    });
    
    document.getElementById('submitBtn').classList.remove('ready');
}

function clearAnswer() {
    if (!gameActive) return;
    userAnswer = [];
    document.querySelectorAll('#answerArea .answer-slot').forEach(function(s) {
        s.textContent = '';
        s.classList.add('empty');
        s.classList.remove('placed');
        s.dataset.emoji = '';
    });
    document.querySelectorAll('#choicesArea .choice-btn').forEach(function(b) {
        b.classList.remove('used');
    });
    document.getElementById('submitBtn').classList.remove('ready');
    playTone(200, 0.1);
}

function submitAnswer() {
    if (!gameActive) return;
    if (userAnswer.length !== originalOrder.length) return;
    
    gameActive = false;
    var isCorrect = arraysEqual(userAnswer, originalOrder);
    
    // Show result on slots
    var slots = document.querySelectorAll('#answerArea .answer-slot');
    slots.forEach(function(s, i) {
        if (userAnswer[i] === originalOrder[i]) {
            s.classList.add('correct');
        } else {
            s.classList.add('wrong');
        }
    });
    
    if (isCorrect) {
        correctCount++;
        var points = originalOrder.length * 25;
        score += points;
        setMessage((lang === 'es' ? 'Â¡PERFECTO! +' : 'PERFECT! +') + points, 'success');
        playTone(523, 0.15);
        setTimeout(function() { playTone(659, 0.15); }, 100);
        showCoach('correct', 2000);
        addLaugh(2);
    } else {
        wrongCount++;
        setMessage(lang === 'es' ? 'Â¡CASI!' : 'ALMOST!', 'error');
        playTone(200, 0.3);
        showCoach('wrong', 2000);
        
        // Show correct answer
        setTimeout(function() {
            renderEmojis(originalOrder, true);
        }, 800);
    }
    
    updateScoreboard();
    
    setTimeout(function() {
        nextRound();
    }, 1500);
}

function showHalftime() {
    var total = correctCount + wrongCount;
    var pct = total === 0 ? 100 : Math.round((correctCount / total) * 100);
    
    document.getElementById('htScore').textContent = score;
    document.getElementById('htAccuracy').textContent = pct + '%';
    
    showCoach('halftime', 3000);
    showScreen('halftimeScreen');
}

function continueSecondHalf() {
    currentHalf = 2;
    currentRound = 0;
    hideCoach();
    showScreen('gameScreen');
    nextRound();
}

function endGame() {
    var total = correctCount + wrongCount;
    var pct = total === 0 ? 100 : Math.round((correctCount / total) * 100);
    var isPerfect = pct === 100;
    
    // Update mastery
    var mastery = getMastery();
    if (isPerfect) {
        mastery.stars++;
        mastery.perfectCount++;
        if (selectedTier + 1 >= mastery.currentTier && selectedTier < tiers.length - 1) {
            if (mastery.unlockedTiers.indexOf(selectedTier + 2) === -1) {
                mastery.unlockedTiers.push(selectedTier + 2);
                mastery.currentTier = selectedTier + 2;
            }
        }
        addLaugh(5);
    }
    saveMastery(mastery);
    
    // Result screen
    document.getElementById('resultIcon').textContent = isPerfect ? 'ğŸ†' : 'ğŸ”€';
    document.getElementById('resultTitle').textContent = isPerfect ? 
        (lang === 'es' ? 'Â¡PERFECTO!' : 'PERFECT!') : 
        (lang === 'es' ? 'Â¡BUEN INTENTO!' : 'GOOD TRY!');
    document.getElementById('resultTitle').className = 'result-title ' + (isPerfect ? 'success' : 'retry');
    document.getElementById('resultAccuracy').textContent = pct + '%';
    document.getElementById('resultAccuracy').className = 'result-accuracy ' + (isPerfect ? 'perfect' : 'miss');
    
    var msg = isPerfect ? 
        (lang === 'es' ? 'Â¡Tu cerebro estÃ¡ en forma! ğŸ§ ğŸ’ª' : 'Your brain is in shape! ğŸ§ ğŸ’ª') :
        (lang === 'es' ? 'Â¡Necesitas 100% para avanzar!' : 'You need 100% to advance!');
    document.getElementById('resultMessage').textContent = msg;
    
    document.getElementById('finalScore').textContent = score;
    document.getElementById('finalCorrect').textContent = correctCount + '/' + total;
    
    if (isPerfect && selectedTier < tiers.length - 1) {
        document.getElementById('nextTierBox').style.display = 'block';
        document.getElementById('nextTierName').textContent = tiers[selectedTier + 1].name;
        document.getElementById('advanceBtn').style.display = 'block';
        showCoach('tierUp', 4000);
        createConfetti();
    } else {
        document.getElementById('nextTierBox').style.display = 'none';
        document.getElementById('advanceBtn').style.display = 'none';
        showCoach(isPerfect ? 'perfect' : 'tryAgain', 4000);
        if (isPerfect) createConfetti();
    }
    
    showScreen('resultScreen');
}

function createConfetti() {
    var colors = ['#FFD700', '#6B21A8', '#00D9A5', '#FF6B6B'];
    for (var i = 0; i < 50; i++) {
        setTimeout(function() {
            var conf = document.createElement('div');
            conf.className = 'confetti';
            conf.style.left = Math.random() * 100 + 'vw';
            conf.style.background = colors[Math.floor(Math.random() * colors.length)];
            conf.style.animationDuration = (Math.random() * 2 + 2) + 's';
            document.body.appendChild(conf);
            setTimeout(function() { conf.remove(); }, 4000);
        }, i * 50);
    }
}

function advanceToNext() {
    hideCoach();
    if (selectedTier < tiers.length - 1) {
        selectedTier++;
    }
    startGame();
}

function retryGame() {
    hideCoach();
    startGame();
}

function goHome() {
    hideCoach();
    buildTierGrid();
    showScreen('welcomeScreen');
}

// Event listeners
document.getElementById('startBtn').onclick = startGame;
document.getElementById('clearBtn').onclick = clearAnswer;
document.getElementById('submitBtn').onclick = submitAnswer;
document.getElementById('halftimeBtn').onclick = continueSecondHalf;
document.getElementById('advanceBtn').onclick = advanceToNext;
document.getElementById('retryBtn').onclick = retryGame;
document.getElementById('homeBtn').onclick = goHome;

// Speed selection
document.querySelectorAll('.speed-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.speed-btn').forEach(function(b) { b.classList.remove('selected'); });
        this.classList.add('selected');
        selectedSpeed = this.dataset.speed;
    });
});

// Init
buildTierGrid();

})();
</script>
</body>
</html>
