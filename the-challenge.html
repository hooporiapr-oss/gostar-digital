<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>THE CHALLENGE | LaughCourt</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --purple: #9B59B6;
    --gold: #FFD700;
    --teal: #00D9A5;
    --pink: #FF1493;
    --dark: #0a0a0f;
    --card: #111118;
    --text: #FFFFFF;
    --muted: #8892a0;
    --border: rgba(255,255,255,0.1);
}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text);touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}

.nav{position:fixed;top:0;left:0;right:0;background:var(--card);border-bottom:1px solid var(--border);padding-top:env(safe-area-inset-top);z-index:1000;height:calc(50px + env(safe-area-inset-top))}
.nav-row{display:flex;align-items:center;justify-content:space-between;height:50px;padding:0 15px}
.back-btn{padding:8px 14px;background:0;border:1px solid var(--border);color:var(--muted);border-radius:8px;font-size:0.75rem;font-weight:600;text-decoration:none}
.nav-title{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:2px;color:var(--gold)}

.game-box{width:100%;max-width:420px;height:100dvh;margin:0 auto;padding:8px 12px;padding-top:calc(58px + env(safe-area-inset-top));padding-bottom:env(safe-area-inset-bottom);display:flex;flex-direction:column}

.stats{display:flex;justify-content:center;gap:20px;padding:8px;background:var(--card);border-radius:10px;margin-bottom:6px}
.stat{text-align:center}
.stat-val{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;color:var(--gold)}
.stat-lbl{font-size:0.4rem;color:var(--muted);text-transform:uppercase}

.phases{display:flex;align-items:center;justify-content:center;gap:12px;padding:10px;background:var(--card);border-radius:10px;margin-bottom:6px}
.phase{font-size:0.75rem;font-family:'Bebas Neue',sans-serif;padding:8px 16px;border-radius:8px;opacity:0.3}
.phase.on{opacity:1}
.phase.done{opacity:0.7}
.phase.react{background:rgba(155,89,182,0.2);color:var(--purple)}
.phase.react.on{background:rgba(155,89,182,0.5)}
.phase.recall{background:rgba(0,217,165,0.2);color:var(--teal)}
.phase.recall.on{background:rgba(0,217,165,0.5)}
.arrow{color:var(--muted);font-size:0.6rem}

.msg{background:var(--card);border:2px solid var(--gold);border-radius:10px;padding:10px;margin-bottom:6px;text-align:center;min-height:44px;display:flex;align-items:center;justify-content:center}
.msg.react{border-color:var(--purple)}
.msg.recall{border-color:var(--teal)}
.msg-txt{font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px}

.court-wrap{flex:1;display:flex;align-items:center;justify-content:center;min-height:0}
.court{display:grid;grid-template-columns:repeat(5,1fr);gap:5px;padding:10px;background:#1a1a24;border-radius:16px;border:3px solid var(--gold);width:min(100%,calc(100dvh - 280px),330px);height:min(100%,calc(100dvh - 280px),330px);min-width:220px;min-height:220px;aspect-ratio:1;box-shadow:0 0 20px rgba(255,215,0,0.2)}
.court.react{border-color:var(--purple);box-shadow:0 0 25px rgba(155,89,182,0.3)}
.court.recall{border-color:var(--teal);box-shadow:0 0 25px rgba(0,217,165,0.3)}

.cell{aspect-ratio:1;border-radius:8px;cursor:pointer;background:rgba(255,255,255,0.08);border:2px solid rgba(255,255,255,0.2)}
.cell:active{transform:scale(0.95)}
.cell.lit{background:var(--purple)!important;border-color:var(--purple)!important;box-shadow:0 0 20px var(--purple);transform:scale(1.05)}
.cell.ok{background:var(--teal)!important;border-color:var(--teal)!important;box-shadow:0 0 15px var(--teal)}
.cell.bad{background:var(--pink)!important;border-color:var(--pink)!important;box-shadow:0 0 15px var(--pink)}

.info{display:flex;justify-content:space-between;padding:8px 12px;background:var(--card);border-radius:10px;margin:6px 0}
.info-txt{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;color:var(--gold)}

.btn{width:100%;min-height:54px;padding:14px;border:none;border-radius:12px;font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:4px;cursor:pointer;background:linear-gradient(135deg,var(--gold),#FFA500);color:#000}
.btn:disabled{opacity:0.4}
.btn.recall-btn{background:linear-gradient(135deg,var(--teal),#00B890);color:#000}

.emojis{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999}
.emo{position:absolute;font-size:1.8rem;animation:pop 1.2s ease-out forwards}
@keyframes pop{0%{opacity:1;transform:translate(-50%,-50%) scale(0.3)}20%{transform:translate(-50%,-50%) scale(1.2)}100%{opacity:0;transform:translate(var(--x),var(--y)) scale(0.6)}}

.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;align-items:center;justify-content:center;z-index:1100}
.overlay.show{display:flex}
.ocard{background:var(--card);border:2px solid var(--gold);border-radius:16px;padding:24px;text-align:center;max-width:280px}
.ocard h2{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold);margin:10px 0}
.ocard p{color:var(--muted);margin-bottom:15px}
.ocard button{padding:14px 28px;border:none;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:1rem;cursor:pointer;background:linear-gradient(135deg,var(--gold),#FFA500);color:#000}

.coach{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(100px);background:linear-gradient(135deg,var(--gold),#FFA500);color:#000;padding:10px 20px;border-radius:14px;font-weight:700;font-size:0.9rem;opacity:0;transition:all 0.3s;z-index:50}
.coach.show{transform:translateX(-50%) translateY(0);opacity:1}
</style>
</head>
<body>

<nav class="nav"><div class="nav-row">
<a href="/dashboard.html" class="back-btn">‚Üê BACK</a>
<div class="nav-title">üèÜ THE CHALLENGE</div>
<div></div>
</div></nav>

<div class="emojis" id="emojis"></div>

<div class="game-box">
<div class="stats">
<div class="stat"><div class="stat-val" id="sLevel">1</div><div class="stat-lbl">LEVEL</div></div>
<div class="stat"><div class="stat-val" id="sStreak">0</div><div class="stat-lbl">üî•</div></div>
<div class="stat"><div class="stat-val" id="sScore">0</div><div class="stat-lbl">SCORE</div></div>
</div>

<div class="phases">
<span class="phase react" id="phReact">‚ö° REACT</span>
<span class="arrow">‚Üí</span>
<span class="phase recall" id="phRecall">üî¢ RECALL</span>
</div>

<div class="msg" id="msgBox"><span class="msg-txt" id="msgTxt">TAP GO TO START!</span></div>

<div class="court-wrap"><div class="court" id="court"></div></div>

<div class="info">
<span class="info-txt" id="iLevel">L1 D3</span>
<span class="info-txt" id="iCount">0/5</span>
<span class="info-txt" id="iScore">0</span>
</div>

<button class="btn" id="btn">GO</button>
</div>

<div class="overlay" id="winOverlay">
<div class="ocard">
<div style="font-size:2.5rem">‚¨ÜÔ∏è</div>
<h2>LEVEL UP!</h2>
<p id="winMsg">Level 2</p>
<button id="winBtn">CONTINUE</button>
</div>
</div>

<div class="overlay" id="champOverlay">
<div class="ocard">
<div style="font-size:2.5rem">üëë</div>
<h2>CHAMPION!</h2>
<p id="champMsg">You conquered!</p>
<button id="champBtn">LEGENDARY!</button>
</div>
</div>

<div class="coach" id="coach"></div>

<script>
(function(){
    var CELLS = 25;
    var SPEEDS = {slow:1200, med:800, fast:500};
    var EMOJIS = ['üòÇ','ü§£','üòÑ','ü•≥','üèÜ','üëë','üî•','‚ö°'];
    
    var level = parseInt(localStorage.getItem('lc-challenge-level')) || 1;
    if(level > 10) level = 10;
    if(level < 1) level = 1;
    
    var score = 0;
    var streak = 0;
    var phase = 'idle';
    var seq = [];
    var seqIdx = 0;
    var curCell = -1;
    var taps = 0;
    var total = 0;
    var canTap = false;
    var timer = null;
    var timerStart = 0;
    var cells = [];
    
    var court = document.getElementById('court');
    var msgTxt = document.getElementById('msgTxt');
    var msgBox = document.getElementById('msgBox');
    var btn = document.getElementById('btn');
    var coach = document.getElementById('coach');
    var emojis = document.getElementById('emojis');
    
    function getSpeed(){ return level <= 3 ? 'slow' : level <= 6 ? 'med' : 'fast'; }
    function getDiv(){ return level <= 3 ? 'D3' : level <= 6 ? 'D2' : 'D1'; }
    function getTotal(){ return level + 4; }
    
    // Audio
    var actx = null;
    function beep(f,d){
        if(!actx) try{ actx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){return;}
        try{
            if(actx.state==='suspended') actx.resume();
            var o=actx.createOscillator(), g=actx.createGain();
            o.frequency.value=f; o.connect(g); g.connect(actx.destination);
            g.gain.setValueAtTime(0.2,actx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01,actx.currentTime+d);
            o.start(); o.stop(actx.currentTime+d);
        }catch(e){}
    }
    
    // Emojis
    function burst(n){
        var r = court.getBoundingClientRect();
        var cx = r.left + r.width/2, cy = r.top + r.height/2;
        for(var i=0; i<n; i++){
            (function(i){
                setTimeout(function(){
                    var e = document.createElement('div');
                    e.className = 'emo';
                    e.textContent = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
                    var a = Math.random()*Math.PI*2, d = 60+Math.random()*60;
                    e.style.cssText = 'left:'+cx+'px;top:'+cy+'px;--x:'+(Math.cos(a)*d)+'px;--y:'+(Math.sin(a)*d)+'px';
                    emojis.appendChild(e);
                    setTimeout(function(){ e.remove(); }, 1500);
                }, i*50);
            })(i);
        }
    }
    
    function showCoach(m){
        coach.textContent = m;
        coach.classList.add('show');
        setTimeout(function(){ coach.classList.remove('show'); }, 2000);
    }
    
    // Build grid
    function buildGrid(){
        court.innerHTML = '';
        cells = [];
        for(var i=0; i<CELLS; i++){
            var c = document.createElement('div');
            c.className = 'cell';
            c.setAttribute('data-i', i);
            court.appendChild(c);
            cells.push(c);
        }
        court.onclick = function(e){
            if(!e.target.classList.contains('cell')) return;
            var idx = parseInt(e.target.getAttribute('data-i'));
            tap(idx);
        };
    }
    
    function clearCells(){
        for(var i=0; i<cells.length; i++) cells[i].className = 'cell';
    }
    
    function updateUI(){
        document.getElementById('sLevel').textContent = level;
        document.getElementById('sStreak').textContent = streak;
        document.getElementById('sScore').textContent = score;
        document.getElementById('iLevel').textContent = 'L'+level+' '+getDiv();
        document.getElementById('iScore').textContent = score;
        
        var pr = document.getElementById('phReact');
        var pc = document.getElementById('phRecall');
        pr.className = 'phase react';
        pc.className = 'phase recall';
        court.className = 'court';
        msgBox.className = 'msg';
        
        if(phase === 'react'){
            pr.classList.add('on');
            court.classList.add('react');
            msgBox.classList.add('react');
        } else if(phase === 'recall'){
            pr.classList.add('done');
            pc.classList.add('on');
            court.classList.add('recall');
            msgBox.classList.add('recall');
        }
    }
    
    // BUTTON CLICK
    btn.onclick = function(){
        if(phase === 'idle'){
            startReact();
        } else if(phase === 'wait'){
            startRecall();
        }
    };
    
    // START REACT
    function startReact(){
        phase = 'react';
        score = 0;
        seq = [];
        seqIdx = 0;
        curCell = -1;
        taps = 0;
        total = getTotal();
        canTap = false;
        
        btn.disabled = true;
        btn.className = 'btn';
        btn.textContent = '...';
        clearCells();
        updateUI();
        document.getElementById('iCount').textContent = '0/'+total;
        
        msgTxt.textContent = 'GET READY...';
        
        setTimeout(function(){
            msgTxt.textContent = '‚ö° REACT!';
            flash();
        }, 800);
    }
    
    // FLASH
    function flash(){
        if(phase !== 'react') return;
        
        if(curCell >= 0) cells[curCell].classList.remove('lit');
        
        var next;
        do { next = Math.floor(Math.random()*CELLS); } while(next === curCell);
        
        curCell = next;
        seq.push(next);
        cells[next].classList.add('lit');
        canTap = true;
        
        beep(880, 0.12);
        
        timerStart = Date.now();
        timer = setTimeout(function(){
            if(canTap && phase === 'react'){
                canTap = false;
                fail('TOO SLOW!');
            }
        }, SPEEDS[getSpeed()]);
    }
    
    // START RECALL
    function startRecall(){
        phase = 'recall';
        seqIdx = 0;
        canTap = true;
        
        clearCells();
        btn.disabled = true;
        btn.className = 'btn';
        btn.textContent = '...';
        
        updateUI();
        document.getElementById('iCount').textContent = '0/'+seq.length;
        msgTxt.textContent = 'üî¢ RECALL THE ORDER!';
    }
    
    // TAP
    function tap(idx){
        if(!canTap) return;
        
        var cell = cells[idx];
        
        // REACT
        if(phase === 'react'){
            clearTimeout(timer);
            canTap = false;
            
            if(idx === curCell){
                beep(660, 0.1);
                cell.classList.remove('lit');
                cell.classList.add('ok');
                taps++;
                
                var rt = Date.now() - timerStart;
                var bonus = Math.floor((1 - rt/SPEEDS[getSpeed()]) * 10);
                score += 15 + bonus;
                
                document.getElementById('iCount').textContent = taps+'/'+total;
                document.getElementById('sScore').textContent = score;
                document.getElementById('iScore').textContent = score;
                
                if(taps % 3 === 0) burst(3);
                
                if(taps >= total){
                    // REACT DONE!
                    reactDone();
                } else {
                    setTimeout(function(){
                        cell.classList.remove('ok');
                        flash();
                    }, 150);
                }
            } else {
                cell.classList.add('bad');
                fail('WRONG CELL!');
            }
            return;
        }
        
        // RECALL
        if(phase === 'recall'){
            var expected = seq[seqIdx];
            
            if(idx === expected){
                beep(660, 0.1);
                cell.classList.add('ok');
                seqIdx++;
                score += 20;
                
                document.getElementById('iCount').textContent = seqIdx+'/'+seq.length;
                document.getElementById('sScore').textContent = score;
                document.getElementById('iScore').textContent = score;
                
                if(seqIdx >= seq.length){
                    canTap = false;
                    win();
                }
            } else {
                cell.classList.add('bad');
                cells[expected].classList.add('lit');
                canTap = false;
                fail('WRONG ORDER!');
            }
        }
    }
    
    // REACT DONE - show recall button
    function reactDone(){
        phase = 'wait';
        canTap = false;
        
        beep(784, 0.15);
        burst(5);
        showCoach('‚ö° REACT DONE!');
        
        msgTxt.textContent = '‚úì NOW RECALL!';
        
        // Show RECALL button
        btn.disabled = false;
        btn.className = 'btn recall-btn';
        btn.textContent = 'üî¢ RECALL ‚Üí';
    }
    
    // WIN
    function win(){
        phase = 'idle';
        streak++;
        
        beep(523, 0.1);
        setTimeout(function(){ beep(659, 0.1); }, 80);
        setTimeout(function(){ beep(784, 0.1); }, 160);
        setTimeout(function(){ beep(1047, 0.15); }, 240);
        
        burst(12);
        msgTxt.textContent = 'üèÜ CHALLENGE COMPLETE!';
        showCoach(streak >= 5 ? 'üëë LEGEND!' : streak >= 3 ? 'üî• AMAZING!' : 'üèÜ GREAT!');
        
        level++;
        localStorage.setItem('lc-challenge-level', level);
        
        if(level > 10){
            level = 10;
            localStorage.setItem('lc-challenge-champion', 'true');
            setTimeout(function(){
                document.getElementById('champMsg').textContent = 'Score: '+score;
                document.getElementById('champOverlay').classList.add('show');
            }, 1200);
        } else {
            setTimeout(function(){
                document.getElementById('winMsg').textContent = 'Now Level '+level+'!';
                document.getElementById('winOverlay').classList.add('show');
            }, 1200);
        }
    }
    
    // FAIL
    function fail(msg){
        clearTimeout(timer);
        beep(200, 0.25);
        
        if(curCell >= 0 && phase === 'react'){
            cells[curCell].classList.remove('lit');
            cells[curCell].classList.add('bad');
        }
        
        phase = 'idle';
        streak = 0;
        canTap = false;
        msgTxt.textContent = msg;
        
        setTimeout(reset, 1200);
    }
    
    // RESET
    function reset(){
        phase = 'idle';
        curCell = -1;
        clearCells();
        updateUI();
        msgTxt.textContent = 'TAP GO!';
        btn.disabled = false;
        btn.className = 'btn';
        btn.textContent = 'GO';
    }
    
    // Overlays
    document.getElementById('winBtn').onclick = function(){
        document.getElementById('winOverlay').classList.remove('show');
        reset();
    };
    
    document.getElementById('champBtn').onclick = function(){
        document.getElementById('champOverlay').classList.remove('show');
        level = 1;
        localStorage.setItem('lc-challenge-level', 1);
        reset();
    };
    
    // Init
    buildGrid();
    updateUI();
})();
</script>
</body>
</html>
