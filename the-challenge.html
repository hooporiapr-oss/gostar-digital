<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>THE CHALLENGE | LaughCourt</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B35;--gold:#FFD700;--teal:#00D9A5;--pink:#FF1493;--purple:#9B59B6;--dark:#0a0a0f;--card:#111118;--text:#FFF;--muted:#8892a0;--border:rgba(255,255,255,0.1)}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text);touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}
.nav{position:fixed;top:0;left:0;right:0;background:var(--card);border-bottom:1px solid var(--border);padding:env(safe-area-inset-top) 12px 0;z-index:1000;height:calc(50px + env(safe-area-inset-top))}
.nav-row{display:flex;align-items:center;justify-content:space-between;height:50px}
.back-btn{padding:8px 12px;background:0;border:1px solid var(--border);color:var(--muted);border-radius:8px;font-size:0.75rem;font-weight:600;text-decoration:none}
.nav-title{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--gold)}
.game-box{width:100%;max-width:420px;height:100dvh;margin:0 auto;padding:8px;padding-top:calc(58px + env(safe-area-inset-top));padding-bottom:env(safe-area-inset-bottom);display:flex;flex-direction:column}
.stats{display:flex;justify-content:center;gap:15px;padding:6px;background:var(--card);border-radius:8px;margin-bottom:5px}
.stat{text-align:center}
.stat-val{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;color:var(--gold)}
.stat-lbl{font-size:0.4rem;color:var(--muted);text-transform:uppercase}
.phases{display:flex;align-items:center;justify-content:center;gap:8px;padding:6px;background:var(--card);border-radius:8px;margin-bottom:5px}
.ph{font-size:0.6rem;font-family:'Bebas Neue',sans-serif;padding:5px 10px;border-radius:6px;opacity:0.3}
.ph.on{opacity:1}
.ph.done{opacity:0.8}
.ph-react{background:rgba(155,89,182,0.3);color:var(--purple)}
.ph-react.on{background:rgba(155,89,182,0.6)}
.ph-seq{background:rgba(0,217,165,0.3);color:var(--teal)}
.ph-seq.on{background:rgba(0,217,165,0.6)}
.ph-match{background:rgba(255,107,53,0.3);color:var(--orange)}
.ph-match.on{background:rgba(255,107,53,0.6)}
.arrow{color:var(--muted);font-size:0.5rem}
.msg{background:var(--card);border:2px solid var(--gold);border-radius:8px;padding:8px;text-align:center;margin-bottom:5px;min-height:38px;display:flex;align-items:center;justify-content:center}
.msg.react{border-color:var(--purple)}
.msg.seq{border-color:var(--teal)}
.msg.match{border-color:var(--orange)}
.msg-txt{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px}
.court-wrap{flex:1;display:flex;align-items:center;justify-content:center;min-height:0}
.court{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;padding:8px;background:#1a1a24;border-radius:16px;border:3px solid var(--gold);width:min(100%,calc(100dvh - 300px),320px);height:min(100%,calc(100dvh - 300px),320px);min-width:200px;min-height:200px;aspect-ratio:1;box-shadow:0 0 20px rgba(255,215,0,0.2)}
.court.react{border-color:var(--purple);box-shadow:0 0 20px rgba(155,89,182,0.3)}
.court.seq{border-color:var(--teal);box-shadow:0 0 20px rgba(0,217,165,0.3)}
.court.match{border-color:var(--orange);box-shadow:0 0 20px rgba(255,107,53,0.3)}
.cell{aspect-ratio:1;border-radius:6px;cursor:pointer;background:rgba(255,255,255,0.08);border:2px solid rgba(255,255,255,0.2)}
.cell:active{transform:scale(0.95)}
.cell.lit{background:var(--purple)!important;border-color:var(--purple)!important;box-shadow:0 0 15px var(--purple);transform:scale(1.05)}
.cell.ok{background:var(--teal)!important;border-color:var(--teal)!important}
.cell.bad{background:var(--pink)!important;border-color:var(--pink)!important}
.cell.found{background:var(--orange)!important;border-color:var(--orange)!important}
.info{display:flex;justify-content:space-between;padding:6px 10px;background:var(--card);border-radius:8px;margin:5px 0}
.info-txt{font-family:'Bebas Neue',sans-serif;font-size:0.85rem;color:var(--gold)}
.go-btn{width:100%;min-height:52px;padding:14px;border:none;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:1.4rem;letter-spacing:3px;cursor:pointer;background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark);position:relative;z-index:100}
.go-btn.seq-btn{background:linear-gradient(135deg,var(--teal),#00B890)}
.go-btn.match-btn{background:linear-gradient(135deg,var(--orange),#FF5500)}
.go-btn:disabled{opacity:0.4;cursor:not-allowed}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;z-index:1100}
.overlay.show{display:flex}
.ocard{background:var(--card);border:2px solid var(--gold);border-radius:14px;padding:24px;text-align:center;max-width:280px}
.ocard h2{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold);margin:10px 0}
.ocard p{color:var(--muted);margin-bottom:15px}
.ocard button{padding:12px 24px;border:none;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:1rem;cursor:pointer;background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark)}
</style>
</head>
<body>

<nav class="nav"><div class="nav-row">
<a href="/play.html" class="back-btn">‚Üê BACK</a>
<div class="nav-title">üèÜ THE CHALLENGE</div>
<div></div>
</div></nav>

<div class="game-box">
<div class="stats">
<div class="stat"><div class="stat-val" id="sLevel">1</div><div class="stat-lbl">LEVEL</div></div>
<div class="stat"><div class="stat-val" id="sStreak">0</div><div class="stat-lbl">üî•</div></div>
<div class="stat"><div class="stat-val" id="sScore">0</div><div class="stat-lbl">SCORE</div></div>
</div>

<div class="phases">
<span class="ph ph-react" id="phReact">‚ö° REACT</span>
<span class="arrow">‚Üí</span>
<span class="ph ph-seq" id="phSeq">üî¢ ORDER</span>
<span class="arrow">‚Üí</span>
<span class="ph ph-match" id="phMatch">üéØ FIND</span>
</div>

<div class="msg" id="msgBox"><span class="msg-txt" id="msgTxt">TAP GO TO START!</span></div>

<div class="court-wrap"><div class="court" id="court"></div></div>

<div class="info">
<span class="info-txt" id="iDiv">L1 D3</span>
<span class="info-txt" id="iCount">0/5</span>
<span class="info-txt" id="iScore">0</span>
</div>

<button class="go-btn" id="goBtn">GO</button>
</div>

<div class="overlay" id="winOverlay">
<div class="ocard">
<div style="font-size:2.5rem">‚¨ÜÔ∏è</div>
<h2>LEVEL UP!</h2>
<p id="winMsg">Advancing to Level 2</p>
<button id="winBtn">CONTINUE</button>
</div>
</div>

<div class="overlay" id="champOverlay">
<div class="ocard">
<div style="font-size:2.5rem">üëë</div>
<h2>CHAMPION!</h2>
<p id="champMsg">You conquered!</p>
<button id="champBtn">LEGENDARY!</button>
</div>
</div>

<script>
// Simple state: 'idle', 'react', 'sequence', 'match'
var STATE = 'idle';
var level = parseInt(localStorage.getItem('lc-challenge-level')) || 1;
var score = 0;
var streak = 0;
var seq = [];
var seqIdx = 0;
var found = [];
var curCell = -1;
var taps = 0;
var total = 0;
var canTap = false;
var timer = null;
var cells = [];

var court = document.getElementById('court');
var msgTxt = document.getElementById('msgTxt');
var msgBox = document.getElementById('msgBox');
var goBtn = document.getElementById('goBtn');

var SPEEDS = {slow:1200, med:800, fast:500};

function getSpeed(){ return level <= 3 ? 'slow' : level <= 6 ? 'med' : 'fast'; }
function getDiv(){ return level <= 3 ? 'D3' : level <= 6 ? 'D2' : 'D1'; }
function getTotal(){ return level + 4; }

// Audio
var actx = null;
function beep(f,d){
    if(!actx) try{ actx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){return;}
    try{
        if(actx.state==='suspended') actx.resume();
        var o=actx.createOscillator(), g=actx.createGain();
        o.frequency.value=f; o.connect(g); g.connect(actx.destination);
        g.gain.setValueAtTime(0.15,actx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01,actx.currentTime+d);
        o.start(); o.stop(actx.currentTime+d);
    }catch(e){}
}

// Build grid
function buildGrid(){
    court.innerHTML = '';
    cells = [];
    for(var i=0; i<25; i++){
        var c = document.createElement('div');
        c.className = 'cell';
        c.setAttribute('data-idx', i);
        court.appendChild(c);
        cells.push(c);
    }
}

// Cell tap via event delegation
court.onclick = function(e){
    var cell = e.target;
    if(!cell.classList.contains('cell')) return;
    if(!canTap) return;
    var idx = parseInt(cell.getAttribute('data-idx'));
    handleTap(idx, cell);
};

function clearCells(){
    for(var i=0; i<cells.length; i++) cells[i].className = 'cell';
}

function updateStats(){
    document.getElementById('sLevel').textContent = level;
    document.getElementById('sStreak').textContent = streak;
    document.getElementById('sScore').textContent = score;
    document.getElementById('iDiv').textContent = 'L'+level+' '+getDiv();
    document.getElementById('iScore').textContent = score;
}

// ========== BUTTON HANDLER ==========
goBtn.onclick = function(){
    if(STATE === 'idle'){
        startReact();
    } else if(STATE === 'wait-seq'){
        runSequence();
    } else if(STATE === 'wait-match'){
        runMatch();
    }
};

// ========== REACT PHASE ==========
function startReact(){
    STATE = 'react';
    score = 0;
    seq = [];
    seqIdx = 0;
    found = [];
    curCell = -1;
    taps = 0;
    total = getTotal();
    canTap = false;
    
    goBtn.disabled = true;
    goBtn.className = 'go-btn';
    goBtn.textContent = '...';
    
    clearCells();
    updateStats();
    
    document.getElementById('phReact').className = 'ph ph-react on';
    document.getElementById('phSeq').className = 'ph ph-seq';
    document.getElementById('phMatch').className = 'ph ph-match';
    court.className = 'court react';
    msgBox.className = 'msg react';
    
    document.getElementById('iCount').textContent = '0/'+total;
    msgTxt.textContent = 'GET READY...';
    
    setTimeout(function(){
        msgTxt.textContent = '‚ö° REACT!';
        flashNext();
    }, 800);
}

function flashNext(){
    if(STATE !== 'react') return;
    
    if(curCell >= 0) cells[curCell].classList.remove('lit');
    
    var next;
    do { next = Math.floor(Math.random()*25); } while(next === curCell);
    
    curCell = next;
    seq.push(next);
    cells[next].classList.add('lit');
    canTap = true;
    
    beep(880, 0.12);
    
    timer = setTimeout(function(){
        if(canTap && STATE === 'react'){
            canTap = false;
            fail('TOO SLOW!');
        }
    }, SPEEDS[getSpeed()]);
}

function reactDone(){
    STATE = 'wait-seq';
    canTap = false;
    beep(784, 0.15);
    msgTxt.textContent = '‚úì REACT DONE!';
    
    // Enable button for sequence
    goBtn.disabled = false;
    goBtn.className = 'go-btn seq-btn';
    goBtn.textContent = 'üî¢ SEQUENCE ‚Üí';
}

// ========== SEQUENCE PHASE ==========
function runSequence(){
    STATE = 'sequence';
    clearCells();
    seqIdx = 0;
    canTap = true;
    
    goBtn.disabled = true;
    goBtn.className = 'go-btn';
    goBtn.textContent = '...';
    
    document.getElementById('phReact').className = 'ph ph-react done';
    document.getElementById('phSeq').className = 'ph ph-seq on';
    court.className = 'court seq';
    msgBox.className = 'msg seq';
    
    document.getElementById('iCount').textContent = '0/'+seq.length;
    msgTxt.textContent = 'üî¢ TAP IN ORDER!';
}

function seqDone(){
    STATE = 'wait-match';
    canTap = false;
    beep(784, 0.15);
    msgTxt.textContent = '‚úì ORDER DONE!';
    
    // Enable button for match
    goBtn.disabled = false;
    goBtn.className = 'go-btn match-btn';
    goBtn.textContent = 'üéØ FIND ALL ‚Üí';
}

// ========== MATCH PHASE ==========
function runMatch(){
    STATE = 'match';
    clearCells();
    found = [];
    canTap = true;
    
    goBtn.disabled = true;
    goBtn.className = 'go-btn';
    goBtn.textContent = '...';
    
    document.getElementById('phSeq').className = 'ph ph-seq done';
    document.getElementById('phMatch').className = 'ph ph-match on';
    court.className = 'court match';
    msgBox.className = 'msg match';
    
    document.getElementById('iCount').textContent = '0/'+seq.length;
    msgTxt.textContent = 'üéØ FIND ALL '+seq.length+'!';
}

// ========== HANDLE TAP ==========
function handleTap(idx, cell){
    
    // REACT
    if(STATE === 'react'){
        clearTimeout(timer);
        canTap = false;
        
        if(idx === curCell){
            beep(660, 0.1);
            cell.classList.remove('lit');
            cell.classList.add('ok');
            taps++;
            score += 15;
            
            document.getElementById('iCount').textContent = taps+'/'+total;
            updateStats();
            
            if(taps >= total){
                reactDone();
            } else {
                setTimeout(function(){
                    cell.classList.remove('ok');
                    flashNext();
                }, 180);
            }
        } else {
            cell.classList.add('bad');
            fail('WRONG CELL!');
        }
        return;
    }
    
    // SEQUENCE
    if(STATE === 'sequence'){
        var expect = seq[seqIdx];
        
        if(idx === expect){
            beep(660, 0.1);
            cell.classList.add('ok');
            seqIdx++;
            score += 20;
            
            document.getElementById('iCount').textContent = seqIdx+'/'+seq.length;
            updateStats();
            
            if(seqIdx >= seq.length){
                seqDone();
            }
        } else {
            cell.classList.add('bad');
            cells[expect].classList.add('lit');
            canTap = false;
            fail('WRONG ORDER!');
        }
        return;
    }
    
    // MATCH
    if(STATE === 'match'){
        var inSeq = seq.indexOf(idx) !== -1;
        var already = found.indexOf(idx) !== -1;
        
        if(inSeq && !already){
            beep(660, 0.1);
            cell.classList.add('found');
            found.push(idx);
            score += 20;
            
            document.getElementById('iCount').textContent = found.length+'/'+seq.length;
            updateStats();
            
            if(found.length >= seq.length){
                canTap = false;
                win();
            }
        } else if(!inSeq){
            cell.classList.add('bad');
            canTap = false;
            fail('WRONG CELL!');
        }
    }
}

function win(){
    STATE = 'idle';
    streak++;
    
    beep(523, 0.1);
    setTimeout(function(){ beep(659, 0.1); }, 80);
    setTimeout(function(){ beep(784, 0.1); }, 160);
    setTimeout(function(){ beep(1047, 0.15); }, 240);
    
    msgTxt.textContent = 'üèÜ TRIPLE THREAT!';
    
    level++;
    localStorage.setItem('lc-challenge-level', level);
    
    if(level > 10){
        localStorage.setItem('lc-challenge-champion', 'true');
        setTimeout(function(){
            document.getElementById('champMsg').textContent = 'Score: '+score;
            document.getElementById('champOverlay').classList.add('show');
        }, 1000);
    } else {
        setTimeout(function(){
            document.getElementById('winMsg').textContent = 'Advancing to Level '+level;
            document.getElementById('winOverlay').classList.add('show');
        }, 1000);
    }
}

function fail(msg){
    STATE = 'idle';
    clearTimeout(timer);
    beep(200, 0.25);
    
    if(curCell >= 0){
        cells[curCell].classList.remove('lit');
        cells[curCell].classList.add('bad');
    }
    
    streak = 0;
    canTap = false;
    msgTxt.textContent = msg;
    
    setTimeout(reset, 1200);
}

function reset(){
    STATE = 'idle';
    curCell = -1;
    clearCells();
    updateStats();
    
    document.getElementById('phReact').className = 'ph ph-react';
    document.getElementById('phSeq').className = 'ph ph-seq';
    document.getElementById('phMatch').className = 'ph ph-match';
    court.className = 'court';
    msgBox.className = 'msg';
    
    msgTxt.textContent = 'TAP GO!';
    goBtn.disabled = false;
    goBtn.className = 'go-btn';
    goBtn.textContent = 'GO';
}

// Overlays
document.getElementById('winBtn').onclick = function(){
    document.getElementById('winOverlay').classList.remove('show');
    reset();
};

document.getElementById('champBtn').onclick = function(){
    document.getElementById('champOverlay').classList.remove('show');
    level = 1;
    localStorage.setItem('lc-challenge-level', 1);
    reset();
};

// Init
buildGrid();
updateStats();
</script>
</body>
</html>
