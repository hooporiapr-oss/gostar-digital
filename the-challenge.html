<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>THE CHALLENGE | LaughCourt</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B35;--gold:#FFD700;--teal:#00D9A5;--pink:#FF1493;--purple:#9B59B6;--fire:#FF4500;--dark:#0a0a0f;--card:#111118;--text:#FFF;--muted:#8892a0;--border:rgba(255,255,255,0.1)}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden;font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text);touch-action:manipulation;-webkit-tap-highlight-color:transparent;user-select:none}
.nav{position:fixed;top:0;left:0;right:0;background:var(--card);border-bottom:1px solid var(--border);padding:env(safe-area-inset-top) 12px 0;z-index:1000;height:calc(50px + env(safe-area-inset-top))}
.nav-row{display:flex;align-items:center;justify-content:space-between;height:50px}
.back-btn{padding:8px 12px;background:0;border:1px solid var(--border);color:var(--muted);border-radius:8px;font-size:0.75rem;font-weight:600;text-decoration:none}
.nav-title{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;letter-spacing:2px;color:var(--gold)}
.game-box{width:100%;max-width:420px;height:100dvh;margin:0 auto;padding:8px;padding-top:calc(58px + env(safe-area-inset-top));padding-bottom:env(safe-area-inset-bottom);display:flex;flex-direction:column}
.stats{display:flex;justify-content:center;gap:15px;padding:6px;background:var(--card);border-radius:8px;margin-bottom:5px}
.stat{text-align:center}
.stat-val{font-family:'Bebas Neue',sans-serif;font-size:1.1rem;color:var(--gold)}
.stat-lbl{font-size:0.4rem;color:var(--muted);text-transform:uppercase}
.phases{display:flex;align-items:center;justify-content:center;gap:8px;padding:6px;background:var(--card);border-radius:8px;margin-bottom:5px}
.ph{font-size:0.6rem;font-family:'Bebas Neue',sans-serif;padding:5px 10px;border-radius:6px;opacity:0.3}
.ph.on{opacity:1}
.ph.done{opacity:0.8}
.ph-react{background:rgba(155,89,182,0.3);color:var(--purple)}
.ph-react.on{background:rgba(155,89,182,0.6)}
.ph-seq{background:rgba(0,217,165,0.3);color:var(--teal)}
.ph-seq.on{background:rgba(0,217,165,0.6)}
.ph-match{background:rgba(255,107,53,0.3);color:var(--orange)}
.ph-match.on{background:rgba(255,107,53,0.6)}
.arrow{color:var(--muted);font-size:0.5rem}
.msg{background:var(--card);border:2px solid var(--gold);border-radius:8px;padding:8px;text-align:center;margin-bottom:5px;min-height:38px;display:flex;align-items:center;justify-content:center;transition:border-color 0.2s}
.msg.react{border-color:var(--purple)}
.msg.seq{border-color:var(--teal)}
.msg.match{border-color:var(--orange)}
.msg-txt{font-family:'Bebas Neue',sans-serif;font-size:0.9rem;letter-spacing:2px}
.court-wrap{flex:1;display:flex;align-items:center;justify-content:center;min-height:0}
.court{display:grid;grid-template-columns:repeat(5,1fr);gap:4px;padding:8px;background:#1a1a24;border-radius:16px;border:3px solid var(--gold);width:min(100%,calc(100dvh - 300px),320px);height:min(100%,calc(100dvh - 300px),320px);min-width:200px;min-height:200px;aspect-ratio:1;transition:border-color 0.2s,box-shadow 0.2s;box-shadow:0 0 20px rgba(255,215,0,0.2)}
.court.react{border-color:var(--purple);box-shadow:0 0 20px rgba(155,89,182,0.3)}
.court.seq{border-color:var(--teal);box-shadow:0 0 20px rgba(0,217,165,0.3)}
.court.match{border-color:var(--orange);box-shadow:0 0 20px rgba(255,107,53,0.3)}
.cell{aspect-ratio:1;border-radius:6px;cursor:pointer;background:rgba(255,255,255,0.08);border:2px solid rgba(255,255,255,0.2);transition:all 0.1s}
.cell:active{transform:scale(0.95)}
.cell.lit{background:var(--purple)!important;border-color:var(--purple)!important;box-shadow:0 0 15px var(--purple);transform:scale(1.05)}
.cell.ok{background:var(--teal)!important;border-color:var(--teal)!important;box-shadow:0 0 12px var(--teal)}
.cell.bad{background:var(--pink)!important;border-color:var(--pink)!important;box-shadow:0 0 12px var(--pink)}
.cell.found{background:var(--orange)!important;border-color:var(--orange)!important;box-shadow:0 0 12px var(--orange)}
.info{display:flex;justify-content:space-between;padding:6px 10px;background:var(--card);border-radius:8px;margin:5px 0}
.info-txt{font-family:'Bebas Neue',sans-serif;font-size:0.85rem;color:var(--gold)}
.go-btn{width:100%;min-height:48px;padding:12px;border:none;border-radius:10px;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:4px;cursor:pointer;background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark)}
.go-btn:disabled{opacity:0.5}
.emojis{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999}
.emo{position:absolute;font-size:1.8rem;animation:pop 1s ease-out forwards}
@keyframes pop{0%{opacity:1;transform:translate(-50%,-50%) scale(0.5)}30%{transform:translate(-50%,-50%) scale(1.2)}100%{opacity:0;transform:translate(var(--x),var(--y)) scale(0.6)}}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;z-index:1100}
.overlay.show{display:flex}
.ocard{background:var(--card);border:2px solid var(--gold);border-radius:14px;padding:24px;text-align:center;max-width:280px}
.ocard h2{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold);margin:10px 0}
.ocard p{color:var(--muted);margin-bottom:15px}
.ocard button{padding:12px 24px;border:none;border-radius:8px;font-family:'Bebas Neue',sans-serif;font-size:1rem;cursor:pointer;background:linear-gradient(135deg,var(--gold),#FFA500);color:var(--dark)}
</style>
</head>
<body>

<nav class="nav"><div class="nav-row">
<a href="/play.html" class="back-btn">‚Üê BACK</a>
<div class="nav-title">üèÜ THE CHALLENGE</div>
<div></div>
</div></nav>

<div class="emojis" id="emojis"></div>

<div class="game-box">
<div class="stats">
<div class="stat"><div class="stat-val" id="sLevel">1</div><div class="stat-lbl">LEVEL</div></div>
<div class="stat"><div class="stat-val" id="sStreak">0</div><div class="stat-lbl">üî•</div></div>
<div class="stat"><div class="stat-val" id="sScore">0</div><div class="stat-lbl">SCORE</div></div>
</div>

<div class="phases">
<span class="ph ph-react on" id="phReact">‚ö° REACT</span>
<span class="arrow">‚Üí</span>
<span class="ph ph-seq" id="phSeq">üî¢ ORDER</span>
<span class="arrow">‚Üí</span>
<span class="ph ph-match" id="phMatch">üéØ FIND</span>
</div>

<div class="msg" id="msgBox"><span class="msg-txt" id="msgTxt">TAP GO TO START!</span></div>

<div class="court-wrap"><div class="court" id="court"></div></div>

<div class="info">
<span class="info-txt" id="iDiv">L1 D3</span>
<span class="info-txt" id="iCount">0/5</span>
<span class="info-txt" id="iScore">0</span>
</div>

<button class="go-btn" id="goBtn">GO</button>
</div>

<div class="overlay" id="winOverlay">
<div class="ocard">
<div style="font-size:2.5rem">‚¨ÜÔ∏è</div>
<h2>LEVEL UP!</h2>
<p id="winMsg">Advancing to Level 2</p>
<button id="winBtn">CONTINUE</button>
</div>
</div>

<div class="overlay" id="champOverlay">
<div class="ocard">
<div style="font-size:2.5rem">üëë</div>
<h2>CHAMPION!</h2>
<p id="champMsg">You conquered!</p>
<button id="champBtn">LEGENDARY!</button>
</div>
</div>

<script>
var G = {
    phase: 'idle',
    level: parseInt(localStorage.getItem('lc-challenge-level')) || 1,
    score: 0,
    streak: 0,
    seq: [],
    seqIdx: 0,
    found: [],
    curCell: -1,
    taps: 0,
    total: 0,
    canTap: false,
    timer: null,
    cells: []
};

var court = document.getElementById('court');
var msgBox = document.getElementById('msgBox');
var msgTxt = document.getElementById('msgTxt');
var goBtn = document.getElementById('goBtn');
var emojis = document.getElementById('emojis');

var SPEEDS = {slow:1200, med:800, fast:500};
var EMOS = ['üòÇ','ü§£','üòÑ','ü•≥','üèÜ','üëë','üî•','‚ö°','üíé'];

function getSpeed(){ return G.level <= 3 ? 'slow' : G.level <= 6 ? 'med' : 'fast'; }
function getDiv(){ return G.level <= 3 ? 'D3' : G.level <= 6 ? 'D2' : 'D1'; }
function getTotal(){ return G.level + 4; }

// Audio
var actx = null;
function beep(f,d){
    if(!actx) try{ actx = new (window.AudioContext||window.webkitAudioContext)(); }catch(e){return;}
    try{
        if(actx.state==='suspended') actx.resume();
        var o=actx.createOscillator(), g=actx.createGain();
        o.frequency.value=f; o.connect(g); g.connect(actx.destination);
        g.gain.setValueAtTime(0.2,actx.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01,actx.currentTime+d);
        o.start(); o.stop(actx.currentTime+d);
    }catch(e){}
}

// Emojis
function burst(n){
    var r = court.getBoundingClientRect();
    var cx = r.left + r.width/2, cy = r.top + r.height/2;
    for(var i=0; i<n; i++){
        (function(i){
            window.setTimeout(function(){
                var e = document.createElement('div');
                e.className = 'emo';
                e.textContent = EMOS[Math.floor(Math.random()*EMOS.length)];
                var a = Math.random()*Math.PI*2, d = 50+Math.random()*70;
                e.style.cssText = 'left:'+cx+'px;top:'+cy+'px;--x:'+(Math.cos(a)*d)+'px;--y:'+(Math.sin(a)*d)+'px';
                emojis.appendChild(e);
                window.setTimeout(function(){ e.remove(); }, 1200);
            }, i*40);
        })(i);
    }
}

// Build grid
function buildGrid(){
    court.innerHTML = '';
    G.cells = [];
    for(var i=0; i<25; i++){
        var c = document.createElement('div');
        c.className = 'cell';
        (function(idx){
            c.onclick = function(){ tap(idx); };
        })(i);
        court.appendChild(c);
        G.cells.push(c);
    }
}

function clearCells(){
    G.cells.forEach(function(c){ c.className = 'cell'; });
}

function updateUI(){
    document.getElementById('sLevel').textContent = G.level;
    document.getElementById('sStreak').textContent = G.streak;
    document.getElementById('sScore').textContent = G.score;
    document.getElementById('iDiv').textContent = 'L'+G.level+' '+getDiv();
    document.getElementById('iScore').textContent = G.score;
    
    // Phases
    var pr = document.getElementById('phReact');
    var ps = document.getElementById('phSeq');
    var pm = document.getElementById('phMatch');
    pr.className = 'ph ph-react' + (G.phase==='react'?' on':G.phase==='sequence'||G.phase==='match'?' done':'');
    ps.className = 'ph ph-seq' + (G.phase==='sequence'?' on':G.phase==='match'?' done':'');
    pm.className = 'ph ph-match' + (G.phase==='match'?' on':'');
    
    // Colors
    court.className = 'court' + (G.phase==='react'?' react':G.phase==='sequence'?' seq':G.phase==='match'?' match':'');
    msgBox.className = 'msg' + (G.phase==='react'?' react':G.phase==='sequence'?' seq':G.phase==='match'?' match':'');
}

function setMsg(t){ msgTxt.textContent = t; }

// ========== GAME FLOW ==========

function startGame(){
    if(G.phase !== 'idle') return;
    
    G.score = 0;
    G.seq = [];
    G.seqIdx = 0;
    G.found = [];
    G.curCell = -1;
    G.taps = 0;
    G.total = getTotal();
    G.canTap = false;
    
    goBtn.disabled = true;
    clearCells();
    
    G.phase = 'react';
    updateUI();
    document.getElementById('iCount').textContent = '0/'+G.total;
    
    setMsg('GET READY...');
    
    window.setTimeout(function(){
        setMsg('‚ö° REACT!');
        flashNext();
    }, 800);
}

function flashNext(){
    if(G.phase !== 'react') return;
    
    if(G.curCell >= 0) G.cells[G.curCell].classList.remove('lit');
    
    var next;
    do { next = Math.floor(Math.random()*25); } while(next === G.curCell);
    
    G.curCell = next;
    G.seq.push(next);
    G.cells[next].classList.add('lit');
    G.canTap = true;
    
    beep(880, 0.12);
    
    var spd = SPEEDS[getSpeed()];
    G.timer = window.setTimeout(function(){
        if(G.canTap && G.phase === 'react'){
            G.canTap = false;
            fail('TOO SLOW!');
        }
    }, spd);
}

function tap(idx){
    if(!G.canTap) return;
    
    var cell = G.cells[idx];
    
    // === REACT ===
    if(G.phase === 'react'){
        window.clearTimeout(G.timer);
        G.canTap = false;
        
        if(idx === G.curCell){
            beep(660, 0.1);
            cell.classList.remove('lit');
            cell.classList.add('ok');
            G.taps++;
            G.score += 15;
            
            document.getElementById('iCount').textContent = G.taps+'/'+G.total;
            document.getElementById('sScore').textContent = G.score;
            document.getElementById('iScore').textContent = G.score;
            
            if(G.taps % 3 === 0) burst(3);
            
            if(G.taps >= G.total){
                // REACT DONE -> SEQUENCE
                beep(659, 0.12);
                window.setTimeout(function(){ beep(784, 0.12); }, 80);
                burst(5);
                setMsg('‚úì REACT DONE!');
                
                // TRANSITION TO SEQUENCE
                window.setTimeout(goToSequence, 1200);
            } else {
                window.setTimeout(function(){
                    cell.classList.remove('ok');
                    flashNext();
                }, 180);
            }
        } else {
            cell.classList.add('bad');
            fail('WRONG CELL!');
        }
        return;
    }
    
    // === SEQUENCE ===
    if(G.phase === 'sequence'){
        var expect = G.seq[G.seqIdx];
        
        if(idx === expect){
            beep(660, 0.1);
            cell.classList.add('ok');
            G.seqIdx++;
            G.score += 20;
            
            document.getElementById('iCount').textContent = G.seqIdx+'/'+G.seq.length;
            document.getElementById('sScore').textContent = G.score;
            document.getElementById('iScore').textContent = G.score;
            
            if(G.seqIdx >= G.seq.length){
                // SEQUENCE DONE -> MATCH
                G.canTap = false;
                beep(659, 0.12);
                window.setTimeout(function(){ beep(784, 0.12); }, 80);
                burst(5);
                setMsg('‚úì ORDER DONE!');
                
                // TRANSITION TO MATCH
                window.setTimeout(goToMatch, 1200);
            }
        } else {
            cell.classList.add('bad');
            G.cells[expect].classList.add('lit');
            G.canTap = false;
            fail('WRONG ORDER!');
        }
        return;
    }
    
    // === MATCH ===
    if(G.phase === 'match'){
        var inSeq = G.seq.indexOf(idx) !== -1;
        var already = G.found.indexOf(idx) !== -1;
        
        if(inSeq && !already){
            beep(660, 0.1);
            cell.classList.add('found');
            G.found.push(idx);
            G.score += 20;
            
            document.getElementById('iCount').textContent = G.found.length+'/'+G.seq.length;
            document.getElementById('sScore').textContent = G.score;
            document.getElementById('iScore').textContent = G.score;
            
            if(G.found.length >= G.seq.length){
                // ALL DONE!
                G.canTap = false;
                win();
            }
        } else if(!inSeq){
            cell.classList.add('bad');
            G.canTap = false;
            fail('WRONG CELL!');
        }
    }
}

// TRANSITION FUNCTIONS
function goToSequence(){
    clearCells();
    G.phase = 'sequence';
    G.seqIdx = 0;
    G.canTap = true;
    
    updateUI();
    document.getElementById('iCount').textContent = '0/'+G.seq.length;
    setMsg('üî¢ TAP IN ORDER!');
}

function goToMatch(){
    clearCells();
    G.phase = 'match';
    G.found = [];
    G.canTap = true;
    
    updateUI();
    document.getElementById('iCount').textContent = '0/'+G.seq.length;
    setMsg('üéØ FIND ALL '+G.seq.length+'!');
}

function win(){
    G.phase = 'idle';
    G.streak++;
    burst(12);
    
    beep(523, 0.12);
    window.setTimeout(function(){ beep(659, 0.12); }, 80);
    window.setTimeout(function(){ beep(784, 0.12); }, 160);
    window.setTimeout(function(){ beep(1047, 0.15); }, 240);
    
    setMsg('üèÜ TRIPLE THREAT COMPLETE!');
    
    G.level++;
    localStorage.setItem('lc-challenge-level', G.level);
    
    if(G.level > 10){
        localStorage.setItem('lc-challenge-champion', 'true');
        window.setTimeout(function(){
            document.getElementById('champMsg').textContent = 'Score: '+G.score;
            document.getElementById('champOverlay').classList.add('show');
        }, 1200);
    } else {
        window.setTimeout(function(){
            document.getElementById('winMsg').textContent = 'Advancing to Level '+G.level;
            document.getElementById('winOverlay').classList.add('show');
        }, 1200);
    }
}

function fail(msg){
    window.clearTimeout(G.timer);
    beep(200, 0.25);
    
    if(G.curCell >= 0 && G.phase === 'react'){
        G.cells[G.curCell].classList.remove('lit');
        G.cells[G.curCell].classList.add('bad');
    }
    
    G.phase = 'idle';
    G.streak = 0;
    G.canTap = false;
    
    setMsg(msg);
    
    window.setTimeout(reset, 1200);
}

function reset(){
    G.phase = 'idle';
    G.curCell = -1;
    clearCells();
    updateUI();
    setMsg('TAP GO!');
    goBtn.disabled = false;
}

// Overlay buttons
document.getElementById('winBtn').onclick = function(){
    document.getElementById('winOverlay').classList.remove('show');
    reset();
};

document.getElementById('champBtn').onclick = function(){
    document.getElementById('champOverlay').classList.remove('show');
    G.level = 1;
    localStorage.setItem('lc-challenge-level', 1);
    reset();
};

// GO button
goBtn.onclick = startGame;

// Init
buildGrid();
updateUI();
</script>
</body>
</html>
