<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solitario Boricua ‚Äî Hey Bori</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0f0a;
  --felt: #0d1f12;
  --card-white: #faf8f0;
  --card-shadow: rgba(0,0,0,0.4);
  --palma: #00C853;
  --ritmo: #FF6D00;
  --cocina: #D50000;
  --costa: #0091EA;
  --gold: #FFD700;
  --gold-dim: #b8981a;
  --text: #e8e4d9;
  --text-dim: #8a8677;
  --success: #00E676;
  --card-w: 75px;
  --card-h: 108px;
  --card-radius: 8px;
  --stack-offset: 22px;
  --face-down-offset: 8px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  background: var(--bg);
  font-family: 'Outfit', sans-serif;
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  user-select: none;
  -webkit-user-select: none;
}

/* HEADER */
.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 16px;
  background: linear-gradient(180deg, rgba(13,31,18,0.95), rgba(10,15,10,0.8));
  border-bottom: 1px solid rgba(255,215,0,0.15);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 22px;
  letter-spacing: 2px;
  background: linear-gradient(135deg, var(--gold), #FFA000);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.header-subtitle {
  font-size: 10px;
  color: var(--text-dim);
  letter-spacing: 1px;
  text-transform: uppercase;
}

.header-stats {
  display: flex;
  gap: 16px;
  align-items: center;
  font-size: 13px;
}

.stat-label { color: var(--text-dim); font-size: 10px; text-transform: uppercase; letter-spacing: 1px; }
.stat-value { color: var(--gold); font-family: 'Bebas Neue', sans-serif; font-size: 20px; }

.btn-new {
  background: linear-gradient(135deg, var(--gold), #FFA000);
  color: #000;
  border: none;
  padding: 6px 14px;
  border-radius: 20px;
  font-family: 'Outfit', sans-serif;
  font-weight: 700;
  font-size: 12px;
  cursor: pointer;
  letter-spacing: 1px;
  text-transform: uppercase;
  transition: transform 0.15s;
}
.btn-new:hover { transform: scale(1.05); }
.btn-new:active { transform: scale(0.97); }

/* GAME AREA */
.game-area {
  max-width: 680px;
  margin: 0 auto;
  padding: 12px 8px 40px;
  position: relative;
  min-height: calc(100vh - 60px);
}

/* TOP ROW: stock, waste, gap, 4 foundations */
.top-row {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
  justify-content: center;
}

.top-row .spacer { width: var(--card-w); }

/* TABLEAU */
.tableau {
  display: flex;
  gap: 8px;
  justify-content: center;
}

/* CARD SLOTS */
.slot {
  width: var(--card-w);
  height: var(--card-h);
  border-radius: var(--card-radius);
  border: 2px dashed rgba(255,215,0,0.15);
  position: relative;
  flex-shrink: 0;
}

.slot.foundation::after {
  content: attr(data-suit-icon);
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 28px;
  opacity: 0.2;
}

/* TABLEAU COLUMN */
.column {
  width: var(--card-w);
  position: relative;
  min-height: var(--card-h);
  flex-shrink: 0;
}

/* CARDS */
.card {
  width: var(--card-w);
  height: var(--card-h);
  border-radius: var(--card-radius);
  position: absolute;
  cursor: pointer;
  transition: box-shadow 0.15s, transform 0.15s;
  z-index: 1;
}

.card.face-down {
  background: linear-gradient(145deg, #1a3a20, #0f2415);
  border: 1.5px solid rgba(255,215,0,0.2);
  cursor: default;
  box-shadow: 0 2px 6px var(--card-shadow);
}

.card.face-down::before {
  content: 'üå¥';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 22px;
  opacity: 0.4;
}

.card.face-down::after {
  content: '';
  position: absolute;
  inset: 4px;
  border-radius: 4px;
  border: 1px solid rgba(255,215,0,0.1);
}

.card.face-up {
  background: var(--card-white);
  border: 1px solid #d4d0c4;
  box-shadow: 0 2px 8px var(--card-shadow);
}

.card.face-up:hover {
  box-shadow: 0 4px 16px rgba(255,215,0,0.25);
}

.card.dragging {
  box-shadow: 0 12px 32px rgba(0,0,0,0.6);
  z-index: 1000 !important;
  cursor: grabbing;
  transform: rotate(2deg);
}

.card.highlight {
  box-shadow: 0 0 0 3px var(--gold), 0 4px 16px rgba(255,215,0,0.4);
}

/* Card inner layout */
.card-inner {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  padding: 5px 6px;
  position: relative;
}

.card-corner {
  display: flex;
  flex-direction: column;
  align-items: center;
  line-height: 1;
}

.card-corner-bottom {
  position: absolute;
  bottom: 5px;
  right: 6px;
  transform: rotate(180deg);
}

.card-rank {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 18px;
  line-height: 1;
}

.card-suit-small {
  font-size: 12px;
  line-height: 1;
}

.card-center {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
}

/* Suit colors */
.suit-palma .card-rank, .suit-palma .card-suit-small { color: var(--palma); }
.suit-ritmo .card-rank, .suit-ritmo .card-suit-small { color: var(--ritmo); }
.suit-cocina .card-rank, .suit-cocina .card-suit-small { color: var(--cocina); }
.suit-costa .card-rank, .suit-costa .card-suit-small { color: var(--costa); }

/* STOCK PILE */
.stock {
  cursor: pointer;
}

.stock.empty {
  cursor: pointer;
  border-style: dashed;
}

.stock.empty::after {
  content: '‚Üª';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 28px;
  color: var(--gold-dim);
  opacity: 0.5;
}

/* WASTE */
.waste {
  border: none;
}

/* WIN SCREEN */
.win-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  z-index: 9999;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  gap: 20px;
}

.win-overlay.show { display: flex; }

.win-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 64px;
  background: linear-gradient(135deg, var(--gold), #FFA000, var(--gold));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  letter-spacing: 4px;
  animation: winPulse 1.5s ease infinite;
}

@keyframes winPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.win-stats {
  color: var(--text-dim);
  font-size: 16px;
  text-align: center;
  line-height: 2;
}

.win-stats span { color: var(--gold); font-weight: 700; }

/* FACT TOAST */
.fact-toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(100px);
  background: linear-gradient(135deg, rgba(13,31,18,0.97), rgba(0,0,0,0.95));
  border: 1px solid rgba(255,215,0,0.3);
  border-radius: 12px;
  padding: 10px 18px;
  max-width: 360px;
  text-align: center;
  font-size: 12px;
  color: var(--text);
  z-index: 200;
  transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  pointer-events: none;
}

.fact-toast.show {
  transform: translateX(-50%) translateY(0);
}

.fact-toast .fact-label {
  color: var(--gold);
  font-family: 'Bebas Neue', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  margin-bottom: 2px;
}

/* RESPONSIVE */
@media (max-width: 580px) {
  :root {
    --card-w: 46px;
    --card-h: 66px;
    --stack-offset: 18px;
    --face-down-offset: 6px;
    --card-radius: 5px;
  }
  .card-rank { font-size: 13px; }
  .card-suit-small { font-size: 9px; }
  .card-center { font-size: 18px; }
  .header-title { font-size: 17px; }
  .stat-value { font-size: 16px; }
  .header-stats { gap: 10px; }
  .top-row, .tableau { gap: 5px; }
  .card.face-down::before { font-size: 14px; }
  .fact-toast { max-width: 90vw; }
  .slot.foundation::after { font-size: 18px; }
}

@media (max-width: 380px) {
  :root {
    --card-w: 40px;
    --card-h: 58px;
    --stack-offset: 15px;
    --face-down-offset: 5px;
  }
  .game-area { padding: 8px 4px 30px; }
  .header { padding: 8px 10px; }
  .btn-new { padding: 5px 10px; font-size: 10px; }
}
</style>
</head>
<body>

<div class="header">
  <div>
    <div class="header-title">SOLITARIO BORICUA</div>
    <div class="header-subtitle">Hey Bori Games</div>
  </div>
  <div class="header-stats">
    <div>
      <div class="stat-label">Moves</div>
      <div class="stat-value" id="moveCount">0</div>
    </div>
    <div>
      <div class="stat-label">Time</div>
      <div class="stat-value" id="timer">0:00</div>
    </div>
    <button class="btn-new" onclick="newGame()">NUEVA</button>
  </div>
</div>

<div class="game-area" id="gameArea">
  <!-- Top row: stock, waste, spacer, 4 foundations -->
  <div class="top-row" id="topRow"></div>
  <!-- Tableau: 7 columns -->
  <div class="tableau" id="tableau"></div>
</div>

<div class="win-overlay" id="winOverlay">
  <div class="win-title">¬°WEPA!</div>
  <div class="win-stats">
    Moves: <span id="winMoves">0</span><br>
    Time: <span id="winTime">0:00</span>
  </div>
  <button class="btn-new" onclick="newGame()" style="font-size:16px; padding:10px 28px;">JUGAR OTRA VEZ</button>
</div>

<div class="fact-toast" id="factToast">
  <div class="fact-label">¬øSAB√çAS?</div>
  <div id="factText"></div>
</div>

<script>
// ‚ïê‚ïê‚ïê SUITS & RANKS ‚ïê‚ïê‚ïê
const SUITS = [
  { id: 'palma', icon: 'üå¥', name: 'Palma', color: 'green' },
  { id: 'ritmo', icon: 'üéµ', name: 'Ritmo', color: 'orange' },
  { id: 'cocina', icon: 'üçΩÔ∏è', name: 'Cocina', color: 'red' },
  { id: 'costa', icon: 'üèùÔ∏è', name: 'Costa', color: 'blue' }
];

// Color groups for tableau stacking (alternating colors)
const COLOR_GROUP = { palma: 'A', costa: 'A', ritmo: 'B', cocina: 'B' };

const RANKS = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];
const RANK_VALUE = {};
RANKS.forEach((r, i) => RANK_VALUE[r] = i + 1);

// ‚ïê‚ïê‚ïê PR FACTS ‚ïê‚ïê‚ïê
const FACTS = [
  "Puerto Rico has 78 municipios, each with its own flag and coat of arms.",
  "El Yunque is the only tropical rainforest in the US National Forest System.",
  "The coqu√≠ frog is found nowhere else on Earth.",
  "Ponce is known as 'La Perla del Sur' ‚Äî The Pearl of the South.",
  "Mofongo was created by enslaved Africans adapting West African fufu.",
  "Puerto Rico's first governor was Juan Ponce de Le√≥n in 1509.",
  "Arecibo once housed the world's largest radio telescope.",
  "Bomba y plena originated in Lo√≠za and Ponce respectively.",
  "San Juan is the oldest city under US jurisdiction, founded in 1521.",
  "Pi√±a colada was invented in San Juan in 1954.",
  "Puerto Rico has over 270 miles of coastline.",
  "Camuy has one of the largest cave systems in the Western Hemisphere.",
  "The Puerto Rican parrot is one of the rarest birds in the world.",
  "Barranquitas is known as 'La Cuna de Pr√≥ceres' ‚Äî Cradle of Patriots.",
  "Caf√© from Yauco is considered among the finest in the world.",
  "Vieques has Mosquito Bay ‚Äî the brightest bioluminescent bay on Earth.",
  "Roberto Clemente was the first Latino in the Baseball Hall of Fame.",
  "The vejigante mask tradition comes from Lo√≠za and Ponce festivals.",
  "Culebra's Flamenco Beach is consistently ranked among the world's best.",
  "Puerto Rico's national tree is the ceiba."
];

let factIndex = 0;
function showFact() {
  const toast = document.getElementById('factToast');
  const text = document.getElementById('factText');
  text.textContent = FACTS[factIndex % FACTS.length];
  factIndex++;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 4000);
}

// ‚ïê‚ïê‚ïê GAME STATE ‚ïê‚ïê‚ïê
let stock = [];
let waste = [];
let foundations = [[], [], [], []];
let columns = [[], [], [], [], [], [], []];
let moves = 0;
let timerInterval = null;
let seconds = 0;
let dragData = null;

// ‚ïê‚ïê‚ïê DECK ‚ïê‚ïê‚ïê
function createDeck() {
  const deck = [];
  for (const suit of SUITS) {
    for (const rank of RANKS) {
      deck.push({ suit, rank, faceUp: false });
    }
  }
  return deck;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// ‚ïê‚ïê‚ïê NEW GAME ‚ïê‚ïê‚ïê
function newGame() {
  document.getElementById('winOverlay').classList.remove('show');
  clearInterval(timerInterval);
  
  const deck = shuffle(createDeck());
  stock = [];
  waste = [];
  foundations = [[], [], [], []];
  columns = [[], [], [], [], [], [], []];
  moves = 0;
  seconds = 0;
  factIndex = 0;
  
  updateMoves(0);
  document.getElementById('timer').textContent = '0:00';
  
  // Deal tableau
  let idx = 0;
  for (let col = 0; col < 7; col++) {
    for (let row = 0; row <= col; row++) {
      const card = deck[idx++];
      card.faceUp = (row === col);
      columns[col].push(card);
    }
  }
  
  // Remaining to stock
  for (; idx < 52; idx++) {
    deck[idx].faceUp = false;
    stock.push(deck[idx]);
  }
  
  startTimer();
  render();
  
  setTimeout(showFact, 1500);
}

function startTimer() {
  timerInterval = setInterval(() => {
    seconds++;
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    document.getElementById('timer').textContent = `${m}:${s.toString().padStart(2, '0')}`;
  }, 1000);
}

function updateMoves(n) {
  moves = n;
  document.getElementById('moveCount').textContent = moves;
}

// ‚ïê‚ïê‚ïê RENDER ‚ïê‚ïê‚ïê
function render() {
  renderTopRow();
  renderTableau();
}

function renderTopRow() {
  const topRow = document.getElementById('topRow');
  topRow.innerHTML = '';
  
  // Stock
  const stockEl = document.createElement('div');
  stockEl.className = `slot stock ${stock.length === 0 ? 'empty' : ''}`;
  if (stock.length > 0) {
    const cardEl = createCardEl(stock[stock.length - 1], false);
    cardEl.style.position = 'absolute';
    cardEl.style.top = '0';
    cardEl.style.left = '0';
    stockEl.appendChild(cardEl);
  }
  stockEl.addEventListener('click', onStockClick);
  topRow.appendChild(stockEl);
  
  // Waste
  const wasteEl = document.createElement('div');
  wasteEl.className = 'slot waste';
  if (waste.length > 0) {
    const card = waste[waste.length - 1];
    const cardEl = createCardEl(card, true);
    cardEl.style.position = 'absolute';
    cardEl.style.top = '0';
    cardEl.style.left = '0';
    addDragEvents(cardEl, { source: 'waste', index: waste.length - 1 });
    wasteEl.appendChild(cardEl);
  }
  topRow.appendChild(wasteEl);
  
  // Spacer
  const spacer = document.createElement('div');
  spacer.className = 'spacer';
  topRow.appendChild(spacer);
  
  // Foundations
  for (let f = 0; f < 4; f++) {
    const fEl = document.createElement('div');
    fEl.className = 'slot foundation';
    fEl.dataset.suitIcon = SUITS[f].icon;
    fEl.dataset.foundation = f;
    
    if (foundations[f].length > 0) {
      const card = foundations[f][foundations[f].length - 1];
      const cardEl = createCardEl(card, true);
      cardEl.style.position = 'absolute';
      cardEl.style.top = '0';
      cardEl.style.left = '0';
      fEl.appendChild(cardEl);
    }
    
    addDropEvents(fEl, { target: 'foundation', index: f });
    fEl.addEventListener('click', () => {});
    topRow.appendChild(fEl);
  }
}

function renderTableau() {
  const tableau = document.getElementById('tableau');
  tableau.innerHTML = '';
  
  for (let c = 0; c < 7; c++) {
    const col = columns[c];
    const colEl = document.createElement('div');
    colEl.className = 'column';
    colEl.dataset.column = c;
    
    // Set min height
    if (col.length === 0) {
      colEl.style.minHeight = `var(--card-h)`;
    } else {
      const lastOffset = col.reduce((acc, card, i) => {
        if (i === 0) return 0;
        return acc + (col[i-1].faceUp ? parseInt(getComputedStyle(document.documentElement).getPropertyValue('--stack-offset')) : parseInt(getComputedStyle(document.documentElement).getPropertyValue('--face-down-offset')));
      }, 0);
      colEl.style.minHeight = `calc(var(--card-h) + ${lastOffset}px)`;
    }
    
    let yOffset = 0;
    for (let i = 0; i < col.length; i++) {
      const card = col[i];
      const cardEl = createCardEl(card, card.faceUp);
      cardEl.style.top = yOffset + 'px';
      cardEl.style.left = '0';
      cardEl.style.zIndex = i + 1;
      
      if (card.faceUp) {
        addDragEvents(cardEl, { source: 'column', colIndex: c, cardIndex: i });
        cardEl.addEventListener('dblclick', () => tryAutoFoundation(c, i));
      }
      
      colEl.appendChild(cardEl);
      
      if (card.faceUp) {
        yOffset += 22; // stack-offset
      } else {
        yOffset += 8; // face-down-offset
      }
    }
    
    addDropEvents(colEl, { target: 'column', index: c });
    tableau.appendChild(colEl);
  }
}

function createCardEl(card, faceUp) {
  const el = document.createElement('div');
  el.className = `card ${faceUp ? 'face-up suit-' + card.suit.id : 'face-down'}`;
  
  if (faceUp) {
    el.innerHTML = `
      <div class="card-inner">
        <div class="card-corner">
          <span class="card-rank">${card.rank}</span>
          <span class="card-suit-small">${card.suit.icon}</span>
        </div>
        <div class="card-center">${card.suit.icon}</div>
        <div class="card-corner card-corner-bottom">
          <span class="card-rank">${card.rank}</span>
          <span class="card-suit-small">${card.suit.icon}</span>
        </div>
      </div>
    `;
  }
  
  return el;
}

// ‚ïê‚ïê‚ïê STOCK CLICK ‚ïê‚ïê‚ïê
function onStockClick() {
  if (stock.length === 0) {
    // Reset stock from waste
    if (waste.length === 0) return;
    stock = waste.reverse().map(c => { c.faceUp = false; return c; });
    waste = [];
  } else {
    const card = stock.pop();
    card.faceUp = true;
    waste.push(card);
  }
  updateMoves(moves + 1);
  render();
}

// ‚ïê‚ïê‚ïê DRAG & DROP ‚ïê‚ïê‚ïê
function addDragEvents(el, data) {
  el.addEventListener('mousedown', (e) => startDrag(e, data, el));
  el.addEventListener('touchstart', (e) => startDrag(e, data, el), { passive: false });
}

function addDropEvents(el, data) {
  el.dataset.dropTarget = JSON.stringify(data);
}

let dragCards = [];
let dragEls = [];
let dragOffsetX = 0;
let dragOffsetY = 0;
let dragStartX = 0;
let dragStartY = 0;

function startDrag(e, data, el) {
  e.preventDefault();
  
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  
  dragData = data;
  dragStartX = clientX;
  dragStartY = clientY;
  
  // Gather cards being dragged
  if (data.source === 'waste') {
    dragCards = [waste[waste.length - 1]];
  } else if (data.source === 'column') {
    dragCards = columns[data.colIndex].slice(data.cardIndex);
  }
  
  // Create visual drag elements
  const rect = el.getBoundingClientRect();
  dragOffsetX = clientX - rect.left;
  dragOffsetY = clientY - rect.top;
  
  // Find all card elements to drag (for column, include all cards below)
  dragEls = [el];
  if (data.source === 'column') {
    const colEl = el.parentElement;
    const allCards = colEl.querySelectorAll('.card.face-up');
    const cardArr = Array.from(allCards);
    const startIdx = cardArr.indexOf(el);
    if (startIdx >= 0) {
      dragEls = cardArr.slice(startIdx);
    }
  }
  
  dragEls.forEach(de => de.classList.add('dragging'));
  
  document.addEventListener('mousemove', onDragMove);
  document.addEventListener('mouseup', onDragEnd);
  document.addEventListener('touchmove', onDragMove, { passive: false });
  document.addEventListener('touchend', onDragEnd);
}

function onDragMove(e) {
  e.preventDefault();
  const clientX = e.touches ? e.touches[0].clientX : e.clientX;
  const clientY = e.touches ? e.touches[0].clientY : e.clientY;
  
  const dx = clientX - dragStartX;
  const dy = clientY - dragStartY;
  
  dragEls.forEach(el => {
    el.style.transform = `translate(${dx}px, ${dy}px)`;
  });
}

function onDragEnd(e) {
  document.removeEventListener('mousemove', onDragMove);
  document.removeEventListener('mouseup', onDragEnd);
  document.removeEventListener('touchmove', onDragMove);
  document.removeEventListener('touchend', onDragEnd);
  
  const clientX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
  const clientY = e.changedTouches ? e.changedTouches[0].clientY : e.clientY;
  
  // Find drop target
  dragEls.forEach(el => {
    el.style.pointerEvents = 'none';
  });
  
  const dropEl = document.elementFromPoint(clientX, clientY);
  
  dragEls.forEach(el => {
    el.style.pointerEvents = '';
    el.classList.remove('dragging');
    el.style.transform = '';
  });
  
  if (dropEl && dragData) {
    // Find the drop target
    let targetEl = dropEl.closest('[data-drop-target]');
    if (targetEl) {
      const target = JSON.parse(targetEl.dataset.dropTarget);
      attemptMove(dragData, target);
    }
  }
  
  dragData = null;
  dragCards = [];
  dragEls = [];
}

// ‚ïê‚ïê‚ïê MOVE LOGIC ‚ïê‚ïê‚ïê
function attemptMove(from, to) {
  let cards;
  
  if (from.source === 'waste') {
    cards = [waste[waste.length - 1]];
  } else if (from.source === 'column') {
    cards = columns[from.colIndex].slice(from.cardIndex);
  } else return;
  
  if (!cards.length) return;
  
  let success = false;
  
  if (to.target === 'foundation') {
    if (cards.length === 1) {
      success = tryMoveToFoundation(cards[0], to.index);
    }
  } else if (to.target === 'column') {
    success = tryMoveToColumn(cards, to.index);
  }
  
  if (success) {
    // Remove cards from source
    if (from.source === 'waste') {
      waste.pop();
    } else if (from.source === 'column') {
      columns[from.colIndex].splice(from.cardIndex);
      // Flip new top card
      const col = columns[from.colIndex];
      if (col.length > 0 && !col[col.length - 1].faceUp) {
        col[col.length - 1].faceUp = true;
      }
    }
    
    updateMoves(moves + 1);
    
    // Show fact every 10 moves
    if (moves % 10 === 0) showFact();
    
    render();
    checkWin();
  } else {
    render();
  }
}

function tryMoveToFoundation(card, fIndex) {
  const f = foundations[fIndex];
  const suit = SUITS[fIndex];
  
  if (card.suit.id !== suit.id) return false;
  
  if (f.length === 0) {
    if (card.rank !== 'A') return false;
  } else {
    const topCard = f[f.length - 1];
    if (RANK_VALUE[card.rank] !== RANK_VALUE[topCard.rank] + 1) return false;
  }
  
  f.push(card);
  return true;
}

function tryMoveToColumn(cards, colIndex) {
  const col = columns[colIndex];
  const movingCard = cards[0];
  
  if (col.length === 0) {
    if (movingCard.rank !== 'K') return false;
  } else {
    const topCard = col[col.length - 1];
    if (!topCard.faceUp) return false;
    // Must be alternating color group and one rank lower
    if (COLOR_GROUP[movingCard.suit.id] === COLOR_GROUP[topCard.suit.id]) return false;
    if (RANK_VALUE[movingCard.rank] !== RANK_VALUE[topCard.rank] - 1) return false;
  }
  
  col.push(...cards);
  return true;
}

// ‚ïê‚ïê‚ïê DOUBLE CLICK ‚Üí AUTO FOUNDATION ‚ïê‚ïê‚ïê
function tryAutoFoundation(colIndex, cardIndex) {
  // Only top card of column
  if (cardIndex !== columns[colIndex].length - 1) return;
  
  const card = columns[colIndex][cardIndex];
  
  for (let f = 0; f < 4; f++) {
    if (tryMoveToFoundation(card, f)) {
      columns[colIndex].pop();
      const col = columns[colIndex];
      if (col.length > 0 && !col[col.length - 1].faceUp) {
        col[col.length - 1].faceUp = true;
      }
      updateMoves(moves + 1);
      if (moves % 10 === 0) showFact();
      render();
      checkWin();
      return;
    }
  }
}

// ‚ïê‚ïê‚ïê WIN CHECK ‚ïê‚ïê‚ïê
function checkWin() {
  const total = foundations.reduce((sum, f) => sum + f.length, 0);
  if (total === 52) {
    clearInterval(timerInterval);
    document.getElementById('winMoves').textContent = moves;
    document.getElementById('winTime').textContent = document.getElementById('timer').textContent;
    document.getElementById('winOverlay').classList.add('show');
  }
}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
newGame();
</script>
</body>
</html>
