<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | LaughCourtâ„¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root { --orange: #FF6B00; --teal: #00D9A5; --gold: #FFD700; --purple: #9D4EDD; --pink: #FF1493; --cyan: #00CED1; --dark: #0a0a0f; --darker: #050508; --card: #111118; --card-hover: #1a1a24; --text: #FFFFFF; --muted: #8892a0; --border: rgba(255,255,255,0.08); --danger: #FF4757; --sidebar: 260px; }
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Outfit', sans-serif; background: var(--dark); color: var(--text); min-height: 100vh; }
body.es .lang-en { display: none !important; } body.en .lang-es { display: none !important; }
.login-screen { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, var(--dark), var(--darker)); display: flex; align-items: center; justify-content: center; z-index: 9999; }
.login-screen.hidden { display: none; }
.login-card { background: var(--card); border: 1px solid var(--border); border-radius: 24px; padding: 48px 40px; width: 100%; max-width: 380px; text-align: center; }
.login-logo { font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; letter-spacing: 4px; margin-bottom: 10px; }
.login-logo .laugh { color: var(--gold); } .login-logo .court { color: var(--text); }
.login-badge { display: inline-block; font-size: 0.7rem; font-weight: 700; color: var(--dark); background: var(--gold); padding: 5px 15px; border-radius: 20px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 30px; }
.login-subtitle { font-size: 0.9rem; color: var(--muted); margin-bottom: 30px; }
.pin-input-group { display: flex; justify-content: center; gap: 12px; margin-bottom: 24px; }
.pin-input { width: 60px; height: 72px; font-size: 1.8rem; font-weight: 700; font-family: 'Bebas Neue', sans-serif; text-align: center; background: var(--darker); border: 2px solid var(--border); border-radius: 12px; color: var(--text); }
.pin-input:focus { outline: none; border-color: var(--gold); box-shadow: 0 0 20px rgba(255,215,0,0.2); }
.login-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--gold), #FFA500); color: var(--dark); border: none; border-radius: 12px; font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; cursor: pointer; font-weight: 700; }
.login-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 25px rgba(255,215,0,0.4); }
.login-error { color: var(--danger); font-size: 0.85rem; margin-top: 15px; display: none; }
.login-error.show { display: block; }
.dashboard { display: none; min-height: 100vh; } .dashboard.visible { display: flex; }
.sidebar { width: var(--sidebar); background: var(--darker); border-right: 1px solid var(--border); padding: 24px 0; display: flex; flex-direction: column; position: fixed; height: 100vh; overflow-y: auto; }
.sidebar-header { padding: 0 24px 24px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
.sidebar-logo { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 3px; margin-bottom: 5px; }
.sidebar-logo .laugh { color: var(--gold); }
.sidebar-team { font-size: 0.75rem; color: var(--muted); margin-bottom: 10px; }
.admin-badge { display: inline-block; background: linear-gradient(135deg, var(--gold), var(--orange)); color: var(--dark); padding: 4px 12px; border-radius: 20px; font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
.nav-section { padding: 0 12px; margin-bottom: 20px; }
.nav-section-title { font-size: 0.65rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; padding: 0 16px; margin-bottom: 10px; }
.nav-item { display: flex; align-items: center; gap: 12px; width: 100%; padding: 12px 16px; border: none; background: transparent; border-radius: 10px; color: var(--muted); font-family: 'Outfit', sans-serif; font-size: 0.9rem; font-weight: 500; cursor: pointer; text-align: left; margin-bottom: 4px; }
.nav-item:hover { background: var(--card); color: var(--text); }
.nav-item.active { background: var(--gold); color: var(--dark); }
.nav-item-icon { font-size: 1.1rem; width: 24px; text-align: center; }
.sidebar-footer { padding: 20px 24px; border-top: 1px solid var(--border); margin-top: auto; }
.lang-toggle { display: flex; gap: 8px; background: var(--card); padding: 4px; border-radius: 10px; margin-bottom: 15px; }
.lang-btn { flex: 1; padding: 8px; border: none; background: transparent; color: var(--muted); border-radius: 8px; font-weight: 600; font-size: 0.8rem; cursor: pointer; font-family: 'Outfit', sans-serif; }
.lang-btn.active { background: var(--gold); color: var(--dark); }
.logout-btn { width: 100%; padding: 12px; border: 1px solid var(--border); background: transparent; color: var(--muted); border-radius: 10px; font-weight: 600; font-size: 0.85rem; cursor: pointer; font-family: 'Outfit', sans-serif; }
.logout-btn:hover { border-color: var(--danger); color: var(--danger); }
.main-content { flex: 1; margin-left: var(--sidebar); padding: 30px; max-width: 1400px; }
.page-header { margin-bottom: 30px; }
.page-title { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; letter-spacing: 3px; margin-bottom: 5px; }
.page-subtitle { font-size: 0.9rem; color: var(--muted); }
.page-section { display: none; } .page-section.active { display: block; }
.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
.stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 24px; transition: all 0.3s; }
.stat-card:hover { transform: translateY(-3px); border-color: var(--gold); }
.stat-card-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; margin-bottom: 15px; }
.stat-card-icon.gold { background: rgba(255,215,0,0.15); } .stat-card-icon.teal { background: rgba(0,217,165,0.15); } .stat-card-icon.orange { background: rgba(255,107,0,0.15); } .stat-card-icon.pink { background: rgba(233,30,140,0.15); } .stat-card-icon.purple { background: rgba(157,78,221,0.15); } .stat-card-icon.cyan { background: rgba(0,206,209,0.15); }
.stat-card-value { font-family: 'Bebas Neue', sans-serif; font-size: 2.2rem; letter-spacing: 2px; margin-bottom: 5px; }
.stat-card-label { font-size: 0.8rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
.court-cards-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
@media (max-width: 900px) { .court-cards-grid { grid-template-columns: 1fr; } }
.court-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
.court-card-header { padding: 16px 20px; display: flex; align-items: center; gap: 12px; }
.court-card-header.recall { background: linear-gradient(135deg, rgba(255,107,0,0.2), transparent); border-bottom: 2px solid var(--orange); }
.court-card-header.match { background: linear-gradient(135deg, rgba(0,206,209,0.2), transparent); border-bottom: 2px solid var(--cyan); }
.court-card-header.drill { background: linear-gradient(135deg, rgba(157,78,221,0.2), transparent); border-bottom: 2px solid var(--purple); }
.court-card-icon { font-size: 1.5rem; } .court-card-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; flex: 1; }
.court-card-body { padding: 20px; } .court-card-stats { display: flex; gap: 20px; }
.court-stat { text-align: center; flex: 1; } .court-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; } .court-stat-label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; }
.table-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; margin-bottom: 30px; }
.table-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
.table-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 2px; }
.table-actions { display: flex; gap: 10px; }
.btn { padding: 10px 20px; border: none; border-radius: 10px; font-weight: 600; font-size: 0.85rem; cursor: pointer; font-family: 'Outfit', sans-serif; }
.btn-primary { background: var(--gold); color: var(--dark); } .btn-primary:hover { background: #e6c200; }
.btn-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text); } .btn-secondary:hover { border-color: var(--gold); }
.btn-danger { background: transparent; border: 1px solid var(--danger); color: var(--danger); } .btn-danger:hover { background: var(--danger); color: var(--text); }
.table-container { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 14px 16px; text-align: left; border-bottom: 1px solid var(--border); }
th { font-size: 0.75rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; background: var(--darker); }
td { font-size: 0.85rem; } tr:hover { background: var(--card-hover); }
.badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; }
.badge-trialing { background: rgba(157,78,221,0.15); color: var(--purple); }
.badge-active { background: rgba(0,217,165,0.15); color: var(--teal); }
.badge-canceled, .badge-expired { background: rgba(255,71,87,0.15); color: var(--danger); }
.action-btns { display: flex; gap: 6px; }
.action-btn { width: 32px; height: 32px; border: 1px solid var(--border); background: transparent; border-radius: 8px; color: var(--muted); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; }
.action-btn:hover { border-color: var(--gold); color: var(--gold); }
.action-btn.delete:hover { border-color: var(--danger); color: var(--danger); }
.activity-list { padding: 0; }
.aggregated-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; border-bottom: 1px solid var(--border); }
.aggregated-item:last-child { border-bottom: none; } .aggregated-item:hover { background: var(--card-hover); }
.aggregated-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; }
.aggregated-icon.recall { background: rgba(255,107,0,0.15); color: var(--orange); }
.aggregated-icon.match { background: rgba(0,206,209,0.15); color: var(--cyan); }
.aggregated-icon.drill { background: rgba(157,78,221,0.15); color: var(--purple); }
.aggregated-icon.subscription { background: rgba(255,215,0,0.15); color: var(--gold); }
.aggregated-icon.trial { background: rgba(157,78,221,0.15); color: var(--purple); }
.aggregated-content { flex: 1; } .aggregated-text { font-size: 0.9rem; } .aggregated-details { font-size: 0.75rem; color: var(--muted); margin-top: 2px; }
.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
.modal-overlay.show { display: flex; }
.modal { background: var(--card); border: 1px solid var(--border); border-radius: 20px; width: 100%; max-width: 480px; max-height: 90vh; overflow-y: auto; }
.modal-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 2px; }
.modal-close { width: 36px; height: 36px; border: none; background: var(--darker); border-radius: 10px; color: var(--muted); font-size: 1.2rem; cursor: pointer; }
.modal-close:hover { color: var(--danger); } .modal-body { padding: 24px; } .form-group { margin-bottom: 20px; }
.form-label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }
.form-input, .form-select { width: 100%; padding: 14px 16px; background: var(--darker); border: 1px solid var(--border); border-radius: 10px; color: var(--text); font-size: 0.95rem; font-family: 'Outfit', sans-serif; }
.form-input:focus, .form-select:focus { outline: none; border-color: var(--gold); }
.modal-footer { padding: 20px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }
.confirm-dialog { text-align: center; padding: 20px 0; } .confirm-dialog-icon { font-size: 3rem; margin-bottom: 15px; }
.confirm-dialog-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 2px; margin-bottom: 10px; }
.confirm-dialog-text { color: var(--muted); font-size: 0.9rem; }
.toast { position: fixed; bottom: 30px; right: 30px; background: var(--card); border: 1px solid var(--teal); border-radius: 12px; padding: 16px 24px; display: flex; align-items: center; gap: 12px; transform: translateY(100px); opacity: 0; transition: all 0.3s; z-index: 2000; }
.toast.show { transform: translateY(0); opacity: 1; } .toast.error { border-color: var(--danger); }
.toast-icon { font-size: 1.2rem; } .toast-text { font-size: 0.9rem; }
.empty-state { text-align: center; padding: 60px 20px; color: var(--muted); } .empty-state-icon { font-size: 3rem; margin-bottom: 15px; }
tr.clickable { cursor: pointer; }
.subscriber-detail-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
.subscriber-avatar { width: 60px; height: 60px; background: linear-gradient(135deg, var(--gold), var(--orange)); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--dark); font-weight: 700; }
.subscriber-info h4 { font-size: 1.2rem; margin-bottom: 5px; } .subscriber-info p { font-size: 0.85rem; color: var(--muted); }
.subscriber-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px; }
.subscriber-stat { background: var(--darker); border-radius: 12px; padding: 15px; text-align: center; }
.subscriber-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.8rem; color: var(--gold); }
.subscriber-stat-label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
.court-score-row { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background: var(--darker); border-radius: 10px; margin-bottom: 10px; }
.court-score-name { display: flex; align-items: center; gap: 10px; font-weight: 500; } .court-score-name span.icon { font-size: 1.2rem; }
.court-score-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; color: var(--text); }
.pin-display { background: var(--darker); border: 2px solid var(--gold); border-radius: 12px; padding: 20px; text-align: center; margin: 20px 0; }
.pin-display-value { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; letter-spacing: 8px; color: var(--gold); }
.pin-display-label { font-size: 0.8rem; color: var(--muted); margin-top: 5px; }
.copy-btn { margin-top: 10px; padding: 8px 20px; background: var(--gold); color: var(--dark); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; font-family: 'Outfit', sans-serif; }
.qty-badge { display: inline-block; background: rgba(255,215,0,0.2); color: var(--gold); padding: 2px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; margin-left: 5px; }
@media (max-width: 1024px) { .sidebar { width: 80px; padding: 15px 0; } .sidebar-header { padding: 0 10px 15px; } .sidebar-logo span, .sidebar-team, .nav-item span:not(.nav-item-icon), .nav-section-title, .sidebar-footer .lang-toggle, .logout-btn span { display: none; } .nav-item { justify-content: center; padding: 12px; } .main-content { margin-left: 80px; } }
@media (max-width: 768px) { .sidebar { display: none; } .main-content { margin-left: 0; } .stats-grid { grid-template-columns: 1fr 1fr; } .subscriber-stats-grid { grid-template-columns: repeat(2, 1fr); } }
</style>
</head>
<body class="en">
<div class="login-screen" id="loginScreen">
<div class="login-card">
<div class="login-logo"><span class="laugh">LAUGH</span><span class="court">COURT</span></div>
<div class="login-badge">Coach Admin Portal</div>
<p class="login-subtitle"><span class="lang-en">Enter your 4-digit admin PIN</span><span class="lang-es">Ingresa tu PIN de 4 dÃ­gitos</span></p>
<div class="pin-input-group">
<input type="password" class="pin-input" maxlength="1" id="pin1" inputmode="numeric">
<input type="password" class="pin-input" maxlength="1" id="pin2" inputmode="numeric">
<input type="password" class="pin-input" maxlength="1" id="pin3" inputmode="numeric">
<input type="password" class="pin-input" maxlength="1" id="pin4" inputmode="numeric">
</div>
<button class="login-btn" id="loginBtn"><span class="lang-en">ACCESS DASHBOARD</span><span class="lang-es">ACCEDER</span></button>
<p class="login-error" id="loginError"><span class="lang-en">Invalid PIN</span><span class="lang-es">PIN invÃ¡lido</span></p>
</div>
</div>
<div class="dashboard" id="dashboard">
<aside class="sidebar">
<div class="sidebar-header">
<div class="sidebar-logo"><span class="laugh">LAUGH</span><span class="court">COURT</span></div>
<div class="sidebar-team">Coach Admin</div>
<span class="admin-badge">ğŸ€ Admin</span>
</div>
<nav class="nav-section">
<div class="nav-section-title"><span class="lang-en">Dashboard</span><span class="lang-es">Panel</span></div>
<button class="nav-item active" data-page="overview"><span class="nav-item-icon">ğŸ“Š</span><span class="lang-en">Overview</span><span class="lang-es">Resumen</span></button>
<button class="nav-item" data-page="subscribers"><span class="nav-item-icon">ğŸ’³</span><span class="lang-en">Subscribers</span><span class="lang-es">Suscriptores</span></button>
<button class="nav-item" data-page="trials"><span class="nav-item-icon">ğŸ«</span><span class="lang-en">Trial PINs</span><span class="lang-es">PINs de Prueba</span></button>
<button class="nav-item" data-page="activity"><span class="nav-item-icon">ğŸ“‹</span><span class="lang-en">Activity</span><span class="lang-es">Actividad</span></button>
</nav>
<div class="sidebar-footer">
<div class="lang-toggle">
<button class="lang-btn active" id="btnEn">EN</button>
<button class="lang-btn" id="btnEs">ES</button>
</div>
<button class="logout-btn" id="logoutBtn">ğŸšª <span class="lang-en">Logout</span><span class="lang-es">Salir</span></button>
</div>
</aside>
<main class="main-content">
<section class="page-section active" id="page-overview">
<header class="page-header"><h1 class="page-title">LAUGHCOURT ADMIN</h1><p class="page-subtitle"><span class="lang-en">Platform Overview</span><span class="lang-es">Resumen de Plataforma</span></p></header>
<div class="stats-grid">
<div class="stat-card"><div class="stat-card-icon gold">ğŸ’³</div><div class="stat-card-value" id="totalSubscribers">0</div><div class="stat-card-label"><span class="lang-en">Subscribers</span><span class="lang-es">Suscriptores</span></div></div>
<div class="stat-card"><div class="stat-card-icon teal">ğŸ‘¥</div><div class="stat-card-value" id="totalUsers">0</div><div class="stat-card-label"><span class="lang-en">Total Users</span><span class="lang-es">Usuarios Totales</span></div></div>
<div class="stat-card"><div class="stat-card-icon purple">ğŸ«</div><div class="stat-card-value" id="activeTrials">0</div><div class="stat-card-label"><span class="lang-en">Active Trials</span><span class="lang-es">Pruebas Activas</span></div></div>
<div class="stat-card"><div class="stat-card-icon pink">ğŸ˜‚</div><div class="stat-card-value" id="totalLaughs">0</div><div class="stat-card-label"><span class="lang-en">Total Laughs</span><span class="lang-es">Risas Totales</span></div></div>
</div>
<div class="court-cards-grid">
<div class="court-card"><div class="court-card-header recall"><div class="court-card-icon">ğŸ§ </div><div class="court-card-title">THE RECALL</div></div><div class="court-card-body"><div class="court-card-stats"><div class="court-stat"><div class="court-stat-value" id="recallSessions">0</div><div class="court-stat-label">Circuits</div></div><div class="court-stat"><div class="court-stat-value" id="recallBestTier">0</div><div class="court-stat-label">Best Tier</div></div><div class="court-stat"><div class="court-stat-value" id="recallLaughs">0</div><div class="court-stat-label">ğŸ˜‚</div></div></div></div></div>
<div class="court-card"><div class="court-card-header match"><div class="court-card-icon">ğŸ¯</div><div class="court-card-title">THE MATCH</div></div><div class="court-card-body"><div class="court-card-stats"><div class="court-stat"><div class="court-stat-value" id="matchSessions">0</div><div class="court-stat-label">Circuits</div></div><div class="court-stat"><div class="court-stat-value" id="matchBestTier">0</div><div class="court-stat-label">Best Tier</div></div><div class="court-stat"><div class="court-stat-value" id="matchLaughs">0</div><div class="court-stat-label">ğŸ˜‚</div></div></div></div></div>
<div class="court-card"><div class="court-card-header drill"><div class="court-card-icon">ğŸ€</div><div class="court-card-title">THE DRILL</div></div><div class="court-card-body"><div class="court-card-stats"><div class="court-stat"><div class="court-stat-value" id="drillSessions">0</div><div class="court-stat-label">Circuits</div></div><div class="court-stat"><div class="court-stat-value" id="drillBestTier">0</div><div class="court-stat-label">Best Tier</div></div><div class="court-stat"><div class="court-stat-value" id="drillLaughs">0</div><div class="court-stat-label">ğŸ˜‚</div></div></div></div></div>
</div>
<div class="table-card"><div class="table-header"><h3 class="table-title"><span class="lang-en">RECENT ACTIVITY</span><span class="lang-es">ACTIVIDAD RECIENTE</span></h3></div><div class="activity-list" id="overviewActivity"></div></div>
</section>
<section class="page-section" id="page-subscribers">
<header class="page-header"><h1 class="page-title"><span class="lang-en">SUBSCRIBERS</span><span class="lang-es">SUSCRIPTORES</span></h1><p class="page-subtitle"><span class="lang-en">$5/user â€¢ Promo codes enabled</span><span class="lang-es">$5/usuario â€¢ CÃ³digos promocionales habilitados</span></p></header>
<div class="stats-grid">
<div class="stat-card"><div class="stat-card-icon teal">âœ…</div><div class="stat-card-value" id="activeCount">0</div><div class="stat-card-label">Active</div></div>
<div class="stat-card"><div class="stat-card-icon gold">ğŸ‘¥</div><div class="stat-card-value" id="totalUsersPaid">0</div><div class="stat-card-label">Users (Qty)</div></div>
<div class="stat-card"><div class="stat-card-icon orange">ğŸ”¥</div><div class="stat-card-value" id="streakLeader">0</div><div class="stat-card-label">Best Streak</div></div>
<div class="stat-card"><div class="stat-card-icon pink">ğŸ˜‚</div><div class="stat-card-value" id="laughLeader">0</div><div class="stat-card-label">Most Laughs</div></div>
</div>
<div class="table-card">
<div class="table-header"><h3 class="table-title">ALL SUBSCRIBERS</h3><button class="btn btn-secondary" id="refreshSubscribersBtn">ğŸ”„</button></div>
<div class="table-container"><table><thead><tr><th>Email</th><th>PIN</th><th>Qty</th><th>Status</th><th>ğŸ˜‚</th><th>ğŸ§ </th><th>ğŸ¯</th><th>ğŸ€</th><th>ğŸ”¥</th><th>Actions</th></tr></thead><tbody id="subscribersTable"></tbody></table></div>
</div>
</section>
<section class="page-section" id="page-trials">
<header class="page-header"><h1 class="page-title">ğŸ« <span class="lang-en">TRIAL PINS</span><span class="lang-es">PINS DE PRUEBA</span></h1><p class="page-subtitle"><span class="lang-en">Generate facility trial PINs (1-100 users, 7 days)</span><span class="lang-es">Genera PINs de prueba para instalaciones</span></p></header>
<div class="stats-grid">
<div class="stat-card"><div class="stat-card-icon teal">âœ…</div><div class="stat-card-value" id="trialsActive">0</div><div class="stat-card-label">Active</div></div>
<div class="stat-card"><div class="stat-card-icon orange">â°</div><div class="stat-card-value" id="trialsExpired">0</div><div class="stat-card-label">Expired</div></div>
<div class="stat-card"><div class="stat-card-icon purple">ğŸ¢</div><div class="stat-card-value" id="trialsFacilities">0</div><div class="stat-card-label">Facilities</div></div>
<div class="stat-card"><div class="stat-card-icon gold">ğŸ‘¥</div><div class="stat-card-value" id="trialsCapacity">0</div><div class="stat-card-label">Capacity</div></div>
</div>
<div class="table-card">
<div class="table-header"><h3 class="table-title">FACILITY TRIALS</h3><div class="table-actions"><button class="btn btn-secondary" id="refreshTrialsBtn">ğŸ”„</button><button class="btn btn-primary" id="newTrialBtn">+ New Trial</button></div></div>
<div class="table-container"><table><thead><tr><th>PIN</th><th>Facility</th><th>Status</th><th>Users</th><th>Expires</th><th>Actions</th></tr></thead><tbody id="trialsTable"></tbody></table></div>
</div>
</section>
<section class="page-section" id="page-activity">
<header class="page-header"><h1 class="page-title"><span class="lang-en">ACTIVITY LOG</span><span class="lang-es">REGISTRO</span></h1></header>
<div class="stats-grid">
<div class="stat-card"><div class="stat-card-icon orange">ğŸ€</div><div class="stat-card-value" id="courtsToday">0</div><div class="stat-card-label"><span class="lang-en">Courts Today</span><span class="lang-es">Canchas Hoy</span></div></div>
<div class="stat-card"><div class="stat-card-icon teal">ğŸ“…</div><div class="stat-card-value" id="courtsWeek">0</div><div class="stat-card-label"><span class="lang-en">This Week</span><span class="lang-es">Esta Semana</span></div></div>
<div class="stat-card"><div class="stat-card-icon gold">ğŸ†•</div><div class="stat-card-value" id="newSubsWeek">0</div><div class="stat-card-label">New Subs</div></div>
<div class="stat-card"><div class="stat-card-icon pink">ğŸ˜‚</div><div class="stat-card-value" id="laughsToday">0</div><div class="stat-card-label"><span class="lang-en">Laughs Today</span><span class="lang-es">Risas Hoy</span></div></div>
</div>
<div class="table-card">
<div class="table-header"><h3 class="table-title">ALL ACTIVITY</h3><div class="table-actions"><button class="btn btn-secondary" id="refreshActivityBtn">ğŸ”„</button><button class="btn btn-danger" id="clearAllActivityBtn">ğŸ—‘ï¸ Clear</button></div></div>
<div class="activity-list" id="activityList"></div>
</div>
</section>
</main>
</div>
<div class="modal-overlay" id="createTrialModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">ğŸ« NEW FACILITY TRIAL</h3><button class="modal-close" data-close="createTrialModal">Ã—</button></div><div class="modal-body"><div class="form-group"><label class="form-label">Facility Name</label><input type="text" class="form-input" id="trialFacility" placeholder="RehabilitaciÃ³n y Risas"></div><div class="form-group"><label class="form-label">Max Users (1-100)</label><input type="number" class="form-input" id="trialMaxUsers" value="50" min="1" max="100"></div><div class="form-group"><label class="form-label">Trial Days</label><input type="number" class="form-input" id="trialDays" value="7" min="1" max="30"></div><div class="form-group"><label class="form-label">Notes (optional)</label><input type="text" class="form-input" id="trialNotes" placeholder="Contact info"></div></div><div class="modal-footer"><button class="btn btn-secondary" data-close="createTrialModal">Cancel</button><button class="btn btn-primary" id="createTrialBtn">Generate PIN</button></div></div></div>
<div class="modal-overlay" id="trialCreatedModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">âœ… TRIAL CREATED</h3><button class="modal-close" data-close="trialCreatedModal">Ã—</button></div><div class="modal-body"><p style="text-align:center;color:var(--muted)" id="trialCreatedFacility"></p><div class="pin-display"><div class="pin-display-value" id="trialCreatedPin">0000</div><div class="pin-display-label">Share this PIN with the facility</div><button class="copy-btn" id="copyTrialPinBtn">ğŸ“‹ Copy PIN</button></div><p style="text-align:center;font-size:0.85rem;color:var(--muted)" id="trialCreatedInfo"></p></div><div class="modal-footer"><button class="btn btn-primary" data-close="trialCreatedModal">Done</button></div></div></div>
<div class="modal-overlay" id="extendTrialModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">â° EXTEND TRIAL</h3><button class="modal-close" data-close="extendTrialModal">Ã—</button></div><div class="modal-body"><input type="hidden" id="extendTrialId"><p style="margin-bottom:20px">Add days to <strong id="extendTrialFacility"></strong></p><div class="form-group"><label class="form-label">Days to Add</label><input type="number" class="form-input" id="extendTrialDays" value="7" min="1" max="30"></div></div><div class="modal-footer"><button class="btn btn-secondary" data-close="extendTrialModal">Cancel</button><button class="btn btn-primary" id="confirmExtendBtn">Extend</button></div></div></div>
<div class="modal-overlay" id="deleteTrialModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">DELETE TRIAL</h3><button class="modal-close" data-close="deleteTrialModal">Ã—</button></div><div class="modal-body"><input type="hidden" id="deleteTrialId"><div class="confirm-dialog"><div class="confirm-dialog-icon">âš ï¸</div><div class="confirm-dialog-text" id="deleteTrialText"></div></div></div><div class="modal-footer"><button class="btn btn-secondary" data-close="deleteTrialModal">Cancel</button><button class="btn btn-danger" id="confirmDeleteTrialBtn">Delete</button></div></div></div>
<div class="modal-overlay" id="subscriberModal"><div class="modal" style="max-width:560px"><div class="modal-header"><h3 class="modal-title">SUBSCRIBER</h3><button class="modal-close" data-close="subscriberModal">Ã—</button></div><div class="modal-body" id="subscriberModalBody"></div></div></div>
<div class="modal-overlay" id="editSubscriberModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">EDIT SUBSCRIBER</h3><button class="modal-close" data-close="editSubscriberModal">Ã—</button></div><div class="modal-body"><input type="hidden" id="editSubPin"><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="editSubEmail"></div><div class="form-group"><label class="form-label">Quantity (Users)</label><input type="number" class="form-input" id="editSubQty" min="1" max="50"></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="editSubStatus"><option value="active">Active</option><option value="trialing">Trialing</option><option value="canceled">Canceled</option></select></div></div><div class="modal-footer"><button class="btn btn-secondary" data-close="editSubscriberModal">Cancel</button><button class="btn btn-primary" id="saveSubscriberBtn">Save</button></div></div></div>
<div class="modal-overlay" id="deleteSubscriberModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">DELETE SUBSCRIBER</h3><button class="modal-close" data-close="deleteSubscriberModal">Ã—</button></div><div class="modal-body"><input type="hidden" id="deleteSubPin"><div class="confirm-dialog"><div class="confirm-dialog-icon">âš ï¸</div><div class="confirm-dialog-text" id="deleteSubscriberText"></div></div></div><div class="modal-footer"><button class="btn btn-secondary" data-close="deleteSubscriberModal">Cancel</button><button class="btn btn-danger" id="confirmDeleteSubscriberBtn">Delete</button></div></div></div>
<div class="modal-overlay" id="clearActivityModal"><div class="modal"><div class="modal-header"><h3 class="modal-title">CLEAR ACTIVITY</h3><button class="modal-close" data-close="clearActivityModal">Ã—</button></div><div class="modal-body"><div class="confirm-dialog"><div class="confirm-dialog-icon">ğŸ—‘ï¸</div><div class="confirm-dialog-text">Delete all activity logs?</div></div></div><div class="modal-footer"><button class="btn btn-secondary" data-close="clearActivityModal">Cancel</button><button class="btn btn-danger" id="confirmClearActivityBtn">Delete All</button></div></div></div>
<div class="toast" id="toast"><span class="toast-icon" id="toastIcon">âœ“</span><span class="toast-text" id="toastText">Saved</span></div>
<script>
(function() {
var authToken = null, subscribers = [], activities = [], trials = [], currentLang = localStorage.getItem('lc-lang') || 'en';
function init() { setLang(currentLang); setupPinInputs(); setupEvents(); var t = sessionStorage.getItem('lc-token'); if (t) verifyToken(t); }
function setLang(l) { currentLang = l; localStorage.setItem('lc-lang', l); document.body.className = l; document.getElementById('btnEn').className = l === 'en' ? 'lang-btn active' : 'lang-btn'; document.getElementById('btnEs').className = l === 'es' ? 'lang-btn active' : 'lang-btn'; }
function setupPinInputs() { var pins = [document.getElementById('pin1'), document.getElementById('pin2'), document.getElementById('pin3'), document.getElementById('pin4')]; pins.forEach(function(inp, i) { inp.addEventListener('input', function() { if (this.value.length === 1 && i < 3) pins[i+1].focus(); }); inp.addEventListener('keydown', function(e) { if (e.key === 'Backspace' && this.value === '' && i > 0) pins[i-1].focus(); if (e.key === 'Enter') attemptLogin(); }); }); pins[0].focus(); }
function attemptLogin() { var pin = ''; for (var i = 1; i <= 4; i++) pin += document.getElementById('pin' + i).value; if (pin.length !== 4) return; fetch('/api/admin/verify', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ pin: pin }) }).then(function(r) { return r.json(); }).then(function(d) { if (d.success && d.token) { authToken = d.token; sessionStorage.setItem('lc-token', authToken); showDashboard(); } else showLoginError(); }).catch(showLoginError); }
function verifyToken(t) { fetch('/api/admin/verify-token', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ token: t }) }).then(function(r) { return r.json(); }).then(function(d) { if (d.success) { authToken = t; showDashboard(); } else sessionStorage.removeItem('lc-token'); }).catch(function() { sessionStorage.removeItem('lc-token'); }); }
function showLoginError() { document.getElementById('loginError').classList.add('show'); for (var i = 1; i <= 4; i++) document.getElementById('pin' + i).value = ''; document.getElementById('pin1').focus(); setTimeout(function() { document.getElementById('loginError').classList.remove('show'); }, 3000); }
function showDashboard() { document.getElementById('loginScreen').classList.add('hidden'); document.getElementById('dashboard').classList.add('visible'); loadAllData(); }
function logout() { authToken = null; sessionStorage.removeItem('lc-token'); document.getElementById('dashboard').classList.remove('visible'); document.getElementById('loginScreen').classList.remove('hidden'); for (var i = 1; i <= 4; i++) document.getElementById('pin' + i).value = ''; document.getElementById('pin1').focus(); }
function setupEvents() {
document.getElementById('loginBtn').addEventListener('click', attemptLogin);
document.getElementById('logoutBtn').addEventListener('click', logout);
document.getElementById('btnEn').addEventListener('click', function() { setLang('en'); });
document.getElementById('btnEs').addEventListener('click', function() { setLang('es'); });
document.querySelectorAll('.nav-item').forEach(function(b) { b.addEventListener('click', function() { showPage(this.getAttribute('data-page')); document.querySelectorAll('.nav-item').forEach(function(n) { n.classList.remove('active'); }); this.classList.add('active'); }); });
document.querySelectorAll('[data-close]').forEach(function(b) { b.addEventListener('click', function() { closeModal(this.getAttribute('data-close')); }); });
document.querySelectorAll('.modal-overlay').forEach(function(o) { o.addEventListener('click', function(e) { if (e.target === o) o.classList.remove('show'); }); });
document.getElementById('refreshSubscribersBtn').addEventListener('click', loadSubscribers);
document.getElementById('refreshActivityBtn').addEventListener('click', loadActivity);
document.getElementById('refreshTrialsBtn').addEventListener('click', loadTrials);
document.getElementById('clearAllActivityBtn').addEventListener('click', function() { openModal('clearActivityModal'); });
document.getElementById('confirmClearActivityBtn').addEventListener('click', clearAllActivity);
document.getElementById('saveSubscriberBtn').addEventListener('click', saveSubscriber);
document.getElementById('confirmDeleteSubscriberBtn').addEventListener('click', confirmDeleteSubscriber);
document.getElementById('newTrialBtn').addEventListener('click', function() { openModal('createTrialModal'); });
document.getElementById('createTrialBtn').addEventListener('click', createTrial);
document.getElementById('copyTrialPinBtn').addEventListener('click', copyTrialPin);
document.getElementById('confirmExtendBtn').addEventListener('click', extendTrial);
document.getElementById('confirmDeleteTrialBtn').addEventListener('click', deleteTrial);
}
function showPage(p) { document.querySelectorAll('.page-section').forEach(function(s) { s.classList.remove('active'); }); document.getElementById('page-' + p).classList.add('active'); }
function openModal(id) { document.getElementById(id).classList.add('show'); }
function closeModal(id) { document.getElementById(id).classList.remove('show'); }
function showToast(msg, err) { var t = document.getElementById('toast'); document.getElementById('toastText').textContent = msg; document.getElementById('toastIcon').textContent = err ? 'âœ—' : 'âœ“'; t.classList.toggle('error', err); t.classList.add('show'); setTimeout(function() { t.classList.remove('show'); }, 3000); }
function api(endpoint, opts) { opts = opts || {}; opts.headers = opts.headers || {}; opts.headers['Authorization'] = 'Bearer ' + authToken; if (opts.body && typeof opts.body === 'object') { opts.headers['Content-Type'] = 'application/json'; opts.body = JSON.stringify(opts.body); } return fetch(endpoint, opts).then(function(r) { return r.json(); }); }
function loadAllData() { loadSubscribers(); loadActivity(); loadTrials(); }
function loadSubscribers() { api('/api/admin/subscribers').then(function(d) { subscribers = d.success ? d.subscribers || [] : []; renderSubscribers(); updateStats(); }).catch(function() { subscribers = []; renderSubscribers(); }); }
function loadActivity() { api('/api/admin/activity').then(function(d) { activities = d.success ? d.activities || [] : []; renderActivity(); renderOverviewActivity(); updateActivityStats(); }).catch(function() { activities = []; renderActivity(); }); }
function loadTrials() { api('/api/admin/trial-pins').then(function(d) { trials = d.success ? d.trials || [] : []; renderTrials(); updateTrialStats(); }).catch(function() { trials = []; renderTrials(); }); }
function updateStats() {
var total = subscribers.length, active = 0, totalUsers = 0, totalLaughs = 0;
var recallSessions = 0, matchSessions = 0, drillSessions = 0;
var recallLaughs = 0, matchLaughs = 0, drillLaughs = 0;
var bestStreak = 0, mostLaughs = 0;
var bestRecallTier = 0, bestMatchTier = 0, bestDrillTier = 0;
subscribers.forEach(function(s) {
var qty = s.quantity || 1;
if (s.status === 'active') { active++; totalUsers += qty; }
totalLaughs += s.totalLaughs || 0;
if ((s.totalLaughs || 0) > mostLaughs) mostLaughs = s.totalLaughs;
if ((s.streak || 0) > bestStreak) bestStreak = s.streak;
if (s.courts) {
if (s.courts.therecall) { recallSessions += s.courts.therecall.sessions || 0; recallLaughs += s.courts.therecall.laughs || 0; if ((s.courts.therecall.bestTier || 0) > bestRecallTier) bestRecallTier = s.courts.therecall.bestTier; }
if (s.courts.thematch) { matchSessions += s.courts.thematch.sessions || 0; matchLaughs += s.courts.thematch.laughs || 0; if ((s.courts.thematch.bestTier || 0) > bestMatchTier) bestMatchTier = s.courts.thematch.bestTier; }
if (s.courts.thedrill) { drillSessions += s.courts.thedrill.sessions || 0; drillLaughs += s.courts.thedrill.laughs || 0; if ((s.courts.thedrill.bestTier || 0) > bestDrillTier) bestDrillTier = s.courts.thedrill.bestTier; }
}
if (s.games) {
if (s.games.laughtrail || s.games.therecall) { var g = s.games.therecall || s.games.laughtrail; recallSessions += g.sessions || 0; recallLaughs += g.laughs || 0; if ((g.bestTier || g.bestRound || 0) > bestRecallTier) bestRecallTier = g.bestTier || g.bestRound || 0; }
if (s.games.thematch) { matchSessions += s.games.thematch.sessions || 0; matchLaughs += s.games.thematch.laughs || 0; if ((s.games.thematch.bestTier || 0) > bestMatchTier) bestMatchTier = s.games.thematch.bestTier; }
if (s.games.thedrill) { drillSessions += s.games.thedrill.sessions || 0; drillLaughs += s.games.thedrill.laughs || 0; if ((s.games.thedrill.bestTier || 0) > bestDrillTier) bestDrillTier = s.games.thedrill.bestTier; }
}
});
document.getElementById('totalSubscribers').textContent = total;
document.getElementById('totalUsers').textContent = totalUsers;
document.getElementById('totalLaughs').textContent = totalLaughs;
document.getElementById('recallSessions').textContent = recallSessions;
document.getElementById('recallBestTier').textContent = bestRecallTier;
document.getElementById('recallLaughs').textContent = recallLaughs;
document.getElementById('matchSessions').textContent = matchSessions;
document.getElementById('matchBestTier').textContent = bestMatchTier;
document.getElementById('matchLaughs').textContent = matchLaughs;
document.getElementById('drillSessions').textContent = drillSessions;
document.getElementById('drillBestTier').textContent = bestDrillTier;
document.getElementById('drillLaughs').textContent = drillLaughs;
document.getElementById('activeCount').textContent = active;
document.getElementById('totalUsersPaid').textContent = totalUsers;
document.getElementById('streakLeader').textContent = bestStreak;
document.getElementById('laughLeader').textContent = mostLaughs;
}
function updateTrialStats() { var active = trials.filter(function(t) { return t.status === 'active'; }).length; var expired = trials.filter(function(t) { return t.status === 'expired'; }).length; var capacity = trials.reduce(function(sum, t) { return sum + (t.maxUsers || 0); }, 0); document.getElementById('trialsActive').textContent = active; document.getElementById('trialsExpired').textContent = expired; document.getElementById('trialsFacilities').textContent = trials.length; document.getElementById('trialsCapacity').textContent = capacity; document.getElementById('activeTrials').textContent = active; }
function updateActivityStats() { var now = new Date(), todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime(), weekStart = todayStart - (now.getDay() * 86400000); var courtsToday = 0, courtsWeek = 0, newSubsWeek = 0, laughsToday = 0; activities.forEach(function(a) { var ts = new Date(a.timestamp).getTime(); if (ts >= todayStart) { if (a.type === 'court_session' || a.type === 'game_session') courtsToday++; laughsToday += a.laughs || 0; } if (ts >= weekStart) { if (a.type === 'court_session' || a.type === 'game_session') courtsWeek++; if (a.type && a.type.includes('subscription_created')) newSubsWeek++; } }); document.getElementById('courtsToday').textContent = courtsToday; document.getElementById('courtsWeek').textContent = courtsWeek; document.getElementById('newSubsWeek').textContent = newSubsWeek; document.getElementById('laughsToday').textContent = laughsToday; }
function formatTimeAgo(ts) { if (!ts) return '-'; var diff = Math.floor((new Date() - new Date(ts)) / 1000); if (diff < 60) return diff + 's'; if (diff < 3600) return Math.floor(diff/60) + 'm'; if (diff < 86400) return Math.floor(diff/3600) + 'h'; return Math.floor(diff/86400) + 'd'; }
function formatDate(ts) { if (!ts) return '-'; return new Date(ts).toLocaleDateString(); }
function renderSubscribers() {
var tb = document.getElementById('subscribersTable');
if (!subscribers.length) { tb.innerHTML = '<tr><td colspan="10" style="text-align:center;padding:40px;color:var(--muted)">No subscribers</td></tr>'; return; }
var html = '';
subscribers.forEach(function(s) {
var recall = 0, match = 0, drill = 0;
if (s.courts) { recall = s.courts.therecall ? s.courts.therecall.bestTier || 0 : 0; match = s.courts.thematch ? s.courts.thematch.bestTier || 0 : 0; drill = s.courts.thedrill ? s.courts.thedrill.bestTier || 0 : 0; }
if (s.games) { if (!recall && (s.games.therecall || s.games.laughtrail)) { var g = s.games.therecall || s.games.laughtrail; recall = g.bestTier || g.bestRound || 0; } if (!match && s.games.thematch) { match = s.games.thematch.bestTier || 0; } if (!drill && s.games.thedrill) { drill = s.games.thedrill.bestTier || 0; } }
var qty = s.quantity || 1;
var qtyBadge = qty > 1 ? '<span class="qty-badge">x' + qty + '</span>' : '';
html += '<tr class="clickable" onclick="viewSub(\'' + s.pin + '\')"><td>' + (s.email || '-') + '</td><td><strong style="color:var(--gold)">' + s.pin + '</strong></td><td>' + qty + qtyBadge + '</td><td><span class="badge badge-' + s.status + '">' + s.status + '</span></td><td>' + (s.totalLaughs || 0) + '</td><td>T' + recall + '</td><td>T' + match + '</td><td>T' + drill + '</td><td>ğŸ”¥' + (s.streak || 0) + '</td><td><div class="action-btns"><button class="action-btn" onclick="event.stopPropagation();editSub(\'' + s.pin + '\')">âœï¸</button><button class="action-btn delete" onclick="event.stopPropagation();delSub(\'' + s.pin + '\',\'' + s.email + '\')">ğŸ—‘ï¸</button></div></td></tr>';
});
tb.innerHTML = html;
}
function renderTrials() { var tb = document.getElementById('trialsTable'); if (!trials.length) { tb.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--muted)">No trial PINs yet</td></tr>'; return; } var html = ''; trials.forEach(function(t) { html += '<tr><td><strong style="color:var(--gold);font-size:1.2rem;letter-spacing:2px">' + t.pin + '</strong></td><td>' + t.facility + (t.notes ? '<br><small style="color:var(--muted)">' + t.notes + '</small>' : '') + '</td><td><span class="badge badge-' + t.status + '">' + t.status + '</span></td><td>' + (t.currentUsers || 0) + '/' + t.maxUsers + '</td><td>' + formatDate(t.expiresAt) + '</td><td><div class="action-btns"><button class="action-btn" onclick="copyPin(\'' + t.pin + '\')" title="Copy">ğŸ“‹</button><button class="action-btn" onclick="extendTrialModal(\'' + t.id + '\',\'' + t.facility + '\')" title="Extend">â°</button><button class="action-btn delete" onclick="deleteTrialModal(\'' + t.id + '\',\'' + t.facility + '\')" title="Delete">ğŸ—‘ï¸</button></div></td></tr>'; }); tb.innerHTML = html; }
function renderActivity() { var c = document.getElementById('activityList'); if (!activities.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“‹</div><div class="empty-state-text">No activity</div></div>'; return; } var html = ''; activities.slice(0, 50).forEach(function(a) { var icon = 'ğŸ€', iconClass = 'recall'; if (a.type && a.type.includes('subscription')) { icon = 'ğŸ’³'; iconClass = 'subscription'; } else if (a.type && a.type.includes('trial')) { icon = 'ğŸ«'; iconClass = 'trial'; } else if (a.court === 'therecall' || a.game === 'laughtrail' || a.game === 'therecall') { icon = 'ğŸ§ '; iconClass = 'recall'; } else if (a.court === 'thematch' || a.game === 'thematch') { icon = 'ğŸ¯'; iconClass = 'match'; } else if (a.court === 'thedrill' || a.game === 'thedrill') { icon = 'ğŸ€'; iconClass = 'drill'; } html += '<div class="aggregated-item"><div class="aggregated-icon ' + iconClass + '">' + icon + '</div><div class="aggregated-content"><div class="aggregated-text">' + (a.username || a.email ? '<strong>' + (a.username || a.email) + '</strong> - ' : '') + (a.details || a.type || 'Activity') + (a.laughs ? ' <span style="color:var(--pink)">ğŸ˜‚+' + a.laughs + '</span>' : '') + '</div><div class="aggregated-details">' + formatTimeAgo(a.timestamp) + '</div></div></div>'; }); c.innerHTML = html; }
function renderOverviewActivity() { var c = document.getElementById('overviewActivity'); if (!activities.length) { c.innerHTML = '<div class="empty-state"><div class="empty-state-icon">ğŸ“‹</div><div class="empty-state-text">No activity</div></div>'; return; } var html = ''; activities.slice(0, 5).forEach(function(a) { var icon = 'ğŸ€', iconClass = 'recall'; if (a.type && a.type.includes('subscription')) { icon = 'ğŸ’³'; iconClass = 'subscription'; } else if (a.type && a.type.includes('trial')) { icon = 'ğŸ«'; iconClass = 'trial'; } else if (a.court === 'therecall' || a.game === 'laughtrail' || a.game === 'therecall') { icon = 'ğŸ§ '; iconClass = 'recall'; } else if (a.court === 'thematch' || a.game === 'thematch') { icon = 'ğŸ¯'; iconClass = 'match'; } else if (a.court === 'thedrill' || a.game === 'thedrill') { icon = 'ğŸ€'; iconClass = 'drill'; } html += '<div class="aggregated-item"><div class="aggregated-icon ' + iconClass + '">' + icon + '</div><div class="aggregated-content"><div class="aggregated-text">' + (a.username ? '<strong>' + a.username + '</strong> - ' : '') + (a.details || a.type) + '</div><div class="aggregated-details">' + formatTimeAgo(a.timestamp) + '</div></div></div>'; }); c.innerHTML = html; }
window.viewSub = function(pin) {
var s = subscribers.find(function(x) { return x.pin === pin; }); if (!s) return;
var recall = {}, match = {}, drill = {};
if (s.courts) { recall = s.courts.therecall || {}; match = s.courts.thematch || {}; drill = s.courts.thedrill || {}; }
if (s.games) { if (!recall.sessions && (s.games.therecall || s.games.laughtrail)) recall = s.games.therecall || s.games.laughtrail; if (!match.sessions && s.games.thematch) match = s.games.thematch; if (!drill.sessions && s.games.thedrill) drill = s.games.thedrill; }
var qty = s.quantity || 1;
var totalSessions = (recall.sessions||0) + (match.sessions||0) + (drill.sessions||0);
var html = '<div class="subscriber-detail-header"><div class="subscriber-avatar">' + (s.email ? s.email.charAt(0).toUpperCase() : '?') + '</div><div class="subscriber-info" style="flex:1"><h4>' + s.email + '</h4><p>PIN: <strong style="color:var(--gold)">' + s.pin + '</strong>' + (qty > 1 ? ' <span class="qty-badge">x' + qty + ' users</span>' : '') + '</p></div></div>';
html += '<div class="subscriber-stats-grid"><div class="subscriber-stat"><div class="subscriber-stat-value">ğŸ‘¥' + qty + '</div><div class="subscriber-stat-label">Users</div></div><div class="subscriber-stat"><div class="subscriber-stat-value">ğŸ˜‚' + (s.totalLaughs || 0) + '</div><div class="subscriber-stat-label">Laughs</div></div><div class="subscriber-stat"><div class="subscriber-stat-value">ğŸ”¥' + (s.streak || 0) + '</div><div class="subscriber-stat-label">Streak</div></div><div class="subscriber-stat"><div class="subscriber-stat-value">' + totalSessions + '</div><div class="subscriber-stat-label">Circuits</div></div></div>';
html += '<div class="court-score-row"><div class="court-score-name"><span class="icon">ğŸ§ </span> THE RECALL</div><div class="court-score-value">T' + (recall.bestTier || recall.bestRound || 0) + '</div></div>';
html += '<div class="court-score-row"><div class="court-score-name"><span class="icon">ğŸ¯</span> THE MATCH</div><div class="court-score-value">T' + (match.bestTier || 0) + '</div></div>';
html += '<div class="court-score-row"><div class="court-score-name"><span class="icon">ğŸ€</span> THE DRILL</div><div class="court-score-value">T' + (drill.bestTier || 0) + '</div></div>';
html += '<p style="text-align:center;margin-top:20px;font-size:0.8rem;color:var(--muted)">$' + (qty * 5) + '/mo subscription</p>';
document.getElementById('subscriberModalBody').innerHTML = html;
openModal('subscriberModal');
};
window.editSub = function(pin) { var s = subscribers.find(function(x) { return x.pin === pin; }); if (!s) return; document.getElementById('editSubPin').value = pin; document.getElementById('editSubEmail').value = s.email || ''; document.getElementById('editSubQty').value = s.quantity || 1; document.getElementById('editSubStatus').value = s.status || 'active'; openModal('editSubscriberModal'); };
window.delSub = function(pin, email) { document.getElementById('deleteSubPin').value = pin; document.getElementById('deleteSubscriberText').innerHTML = 'Delete <strong style="color:var(--gold)">' + email + '</strong>?'; openModal('deleteSubscriberModal'); };
function saveSubscriber() { var pin = document.getElementById('editSubPin').value; api('/api/admin/subscriber/' + pin, { method: 'PUT', body: { email: document.getElementById('editSubEmail').value, quantity: parseInt(document.getElementById('editSubQty').value) || 1, status: document.getElementById('editSubStatus').value } }).then(function(d) { if (d.success) { closeModal('editSubscriberModal'); loadSubscribers(); showToast('Saved'); } else showToast(d.error || 'Error', true); }); }
function confirmDeleteSubscriber() { var pin = document.getElementById('deleteSubPin').value; if (!pin) return; api('/api/admin/subscriber/' + pin, { method: 'DELETE' }).then(function(d) { if (d.success) { closeModal('deleteSubscriberModal'); loadSubscribers(); showToast('Deleted'); } else showToast('Error', true); }); }
function createTrial() { var facility = document.getElementById('trialFacility').value.trim(), maxUsers = parseInt(document.getElementById('trialMaxUsers').value) || 50, days = parseInt(document.getElementById('trialDays').value) || 7, notes = document.getElementById('trialNotes').value.trim(); if (!facility) { showToast('Facility name required', true); return; } api('/api/admin/trial-pin', { method: 'POST', body: { facility: facility, maxUsers: maxUsers, trialDays: days, notes: notes } }).then(function(d) { if (d.success && d.trial) { closeModal('createTrialModal'); document.getElementById('trialFacility').value = ''; document.getElementById('trialNotes').value = ''; document.getElementById('trialCreatedFacility').textContent = d.trial.facility; document.getElementById('trialCreatedPin').textContent = d.trial.pin; document.getElementById('trialCreatedInfo').textContent = maxUsers + ' users â€¢ ' + days + ' days â€¢ Expires ' + formatDate(d.trial.expiresAt); openModal('trialCreatedModal'); loadTrials(); } else showToast(d.error || 'Error', true); }); }
function copyTrialPin() { navigator.clipboard.writeText(document.getElementById('trialCreatedPin').textContent).then(function() { showToast('PIN copied!'); }); }
window.copyPin = function(pin) { navigator.clipboard.writeText(pin).then(function() { showToast('PIN ' + pin + ' copied!'); }); };
window.extendTrialModal = function(id, facility) { document.getElementById('extendTrialId').value = id; document.getElementById('extendTrialFacility').textContent = facility; openModal('extendTrialModal'); };
function extendTrial() { var id = document.getElementById('extendTrialId').value, days = parseInt(document.getElementById('extendTrialDays').value) || 7; api('/api/admin/trial-pin/' + id + '/extend', { method: 'POST', body: { days: days } }).then(function(d) { if (d.success) { closeModal('extendTrialModal'); loadTrials(); showToast('Extended by ' + days + ' days'); } else showToast(d.error || 'Error', true); }); }
window.deleteTrialModal = function(id, facility) { document.getElementById('deleteTrialId').value = id; document.getElementById('deleteTrialText').innerHTML = 'Delete trial for <strong style="color:var(--gold)">' + facility + '</strong>?'; openModal('deleteTrialModal'); };
function deleteTrial() { var id = document.getElementById('deleteTrialId').value; api('/api/admin/trial-pin/' + id, { method: 'DELETE' }).then(function(d) { if (d.success) { closeModal('deleteTrialModal'); loadTrials(); showToast('Trial deleted'); } else showToast(d.error || 'Error', true); }); }
function clearAllActivity() { api('/api/admin/activity/all', { method: 'DELETE' }).then(function() { closeModal('clearActivityModal'); loadActivity(); showToast('Activity cleared'); }); }
init();
})();
</script>
</body>
</html>
