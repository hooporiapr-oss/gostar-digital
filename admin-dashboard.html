<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | LaughCourt‚Ñ¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
    --orange: #FF6B00;
    --teal: #00D9A5;
    --gold: #FFD700;
    --purple: #9D4EDD;
    --pink: #FF1493;
    --cyan: #00CED1;
    --green: #00E676;
    --lime: #C6FF00;
    --red: #FF1744;
    --dark: #0a0a0f;
    --darker: #050508;
    --card: #111118;
    --card-hover: #1a1a24;
    --text: #FFFFFF;
    --muted: #8892a0;
    --border: rgba(255,255,255,0.08);
    --danger: #FF4757;
    --sidebar: 260px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Outfit', sans-serif; background: var(--dark); color: var(--text); min-height: 100vh; }
body.es .lang-en { display: none !important; }
body.en .lang-es { display: none !important; }

/* ==================== LOGIN SCREEN ==================== */
.login-screen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, var(--dark), var(--darker));
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}
.login-screen.hidden { display: none; }

.login-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 48px 40px;
    width: 100%;
    max-width: 380px;
    text-align: center;
}

.login-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.5rem;
    letter-spacing: 4px;
    margin-bottom: 10px;
}
.login-logo .laugh { color: var(--gold); }
.login-logo .court { color: var(--text); }

.login-badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--dark);
    background: var(--gold);
    padding: 5px 15px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 30px;
}

.login-subtitle {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 30px;
}

.pin-input-group {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 24px;
}

.pin-input {
    width: 60px;
    height: 72px;
    font-size: 1.8rem;
    font-weight: 700;
    font-family: 'Bebas Neue', sans-serif;
    text-align: center;
    background: var(--darker);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--text);
}
.pin-input:focus {
    outline: none;
    border-color: var(--gold);
    box-shadow: 0 0 20px rgba(255,215,0,0.2);
}

.login-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--gold), #FFA500);
    color: var(--dark);
    border: none;
    border-radius: 12px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
    cursor: pointer;
    font-weight: 700;
    transition: all 0.3s;
}
.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 25px rgba(255,215,0,0.4);
}

.login-error {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 15px;
    display: none;
}
.login-error.show { display: block; }

/* ==================== DASHBOARD LAYOUT ==================== */
.dashboard { display: none; min-height: 100vh; }
.dashboard.visible { display: flex; }

/* ==================== SIDEBAR ==================== */
.sidebar {
    width: var(--sidebar);
    background: var(--darker);
    border-right: 1px solid var(--border);
    padding: 24px 0;
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
}

.sidebar-header {
    padding: 0 24px 24px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 20px;
}

.sidebar-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    letter-spacing: 3px;
    margin-bottom: 5px;
}
.sidebar-logo .laugh { color: var(--gold); }

.sidebar-team {
    font-size: 0.65rem;
    color: var(--muted);
    margin-bottom: 10px;
    line-height: 1.4;
}

.admin-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--gold), var(--orange));
    color: var(--dark);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.nav-section {
    padding: 0 12px;
    margin-bottom: 20px;
}

.nav-section-title {
    font-size: 0.65rem;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0 16px;
    margin-bottom: 10px;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    padding: 12px 16px;
    border: none;
    background: transparent;
    border-radius: 10px;
    color: var(--muted);
    font-family: 'Outfit', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    text-align: left;
    margin-bottom: 4px;
    transition: all 0.2s;
}
.nav-item:hover {
    background: var(--card);
    color: var(--text);
}
.nav-item.active {
    background: var(--gold);
    color: var(--dark);
}
.nav-item-icon {
    font-size: 1.1rem;
    width: 24px;
    text-align: center;
}

.nav-item-badge {
    background: var(--red);
    color: white;
    font-size: 0.65rem;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    margin-left: auto;
}

.sidebar-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border);
    margin-top: auto;
}

.lang-toggle {
    display: flex;
    gap: 8px;
    background: var(--card);
    padding: 4px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.lang-btn {
    flex: 1;
    padding: 8px;
    border: none;
    background: transparent;
    color: var(--muted);
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    transition: all 0.2s;
}
.lang-btn.active {
    background: var(--gold);
    color: var(--dark);
}

.logout-btn {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    transition: all 0.2s;
}
.logout-btn:hover {
    border-color: var(--danger);
    color: var(--danger);
}

/* ==================== MAIN CONTENT ==================== */
.main-content {
    flex: 1;
    margin-left: var(--sidebar);
    padding: 30px;
    max-width: 1400px;
}

.page-header { margin-bottom: 30px; }

.page-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    letter-spacing: 3px;
    margin-bottom: 5px;
}

.page-subtitle {
    font-size: 0.9rem;
    color: var(--muted);
}

.page-section { display: none; }
.page-section.active { display: block; }

/* ==================== STATS GRID ==================== */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s;
}
.stat-card:hover {
    transform: translateY(-3px);
    border-color: var(--gold);
}

.stat-card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 15px;
}
.stat-card-icon.gold { background: rgba(255,215,0,0.15); }
.stat-card-icon.teal { background: rgba(0,217,165,0.15); }
.stat-card-icon.orange { background: rgba(255,107,0,0.15); }
.stat-card-icon.pink { background: rgba(233,30,140,0.15); }
.stat-card-icon.purple { background: rgba(157,78,221,0.15); }
.stat-card-icon.cyan { background: rgba(0,206,209,0.15); }
.stat-card-icon.green { background: rgba(0,230,118,0.15); }
.stat-card-icon.red { background: rgba(255,23,68,0.15); }

.stat-card-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.2rem;
    letter-spacing: 2px;
    margin-bottom: 5px;
}

.stat-card-label {
    font-size: 0.8rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* ==================== COURT CARDS - 5 WORKOUTS ==================== */
.court-cards-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 15px;
    margin-bottom: 30px;
}

@media (max-width: 1200px) {
    .court-cards-grid { grid-template-columns: repeat(3, 1fr); }
}
@media (max-width: 800px) {
    .court-cards-grid { grid-template-columns: repeat(2, 1fr); }
}
@media (max-width: 500px) {
    .court-cards-grid { grid-template-columns: 1fr; }
}

.court-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s;
}
.court-card:hover {
    transform: translateY(-3px);
    border-color: var(--gold);
}

.court-card-header {
    padding: 14px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.court-card-header.recall {
    background: linear-gradient(135deg, rgba(255,107,0,0.2), transparent);
    border-bottom: 2px solid var(--orange);
}
.court-card-header.match {
    background: linear-gradient(135deg, rgba(0,206,209,0.2), transparent);
    border-bottom: 2px solid var(--cyan);
}
.court-card-header.drill {
    background: linear-gradient(135deg, rgba(157,78,221,0.2), transparent);
    border-bottom: 2px solid var(--purple);
}
.court-card-header.reflex {
    background: linear-gradient(135deg, rgba(0,230,118,0.2), transparent);
    border-bottom: 2px solid var(--green);
}
.court-card-header.ritmo {
    background: linear-gradient(135deg, rgba(255,23,68,0.2), transparent);
    border-bottom: 2px solid var(--red);
}

.court-card-icon { font-size: 1.3rem; }
.court-card-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 0.95rem;
    letter-spacing: 2px;
    flex: 1;
}

.court-card-body { padding: 16px; }
.court-card-stats { display: flex; gap: 12px; }
.court-stat { text-align: center; flex: 1; }
.court-stat-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
}
.court-stat-label {
    font-size: 0.6rem;
    color: var(--muted);
    text-transform: uppercase;
}

/* ==================== TABLE STYLES ==================== */
.table-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 30px;
}

.table-header {
    padding: 20px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.table-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.2rem;
    letter-spacing: 2px;
}

.table-actions { display: flex; gap: 10px; flex-wrap: wrap; }

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    transition: all 0.2s;
}
.btn-primary { background: var(--gold); color: var(--dark); }
.btn-primary:hover { background: #e6c200; }
.btn-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text); }
.btn-secondary:hover { border-color: var(--gold); }
.btn-danger { background: transparent; border: 1px solid var(--danger); color: var(--danger); }
.btn-danger:hover { background: var(--danger); color: var(--text); }
.btn-teal { background: var(--teal); color: var(--dark); }
.btn-teal:hover { background: #00c49a; }
.btn-purple { background: var(--purple); color: var(--text); }
.btn-purple:hover { background: #8a3fcc; }

.table-container { overflow-x: auto; }

table { width: 100%; border-collapse: collapse; }
th, td {
    padding: 12px 10px;
    text-align: left;
    border-bottom: 1px solid var(--border);
}
th {
    font-size: 0.65rem;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    background: var(--darker);
    white-space: nowrap;
}
td { font-size: 0.8rem; }
tr:hover { background: var(--card-hover); }

.badge {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
}
.badge-trialing { background: rgba(157,78,221,0.15); color: var(--purple); }
.badge-active { background: rgba(0,217,165,0.15); color: var(--teal); }
.badge-canceled, .badge-expired { background: rgba(255,71,87,0.15); color: var(--danger); }
.badge-update { background: rgba(0,206,209,0.15); color: var(--cyan); }
.badge-announcement { background: rgba(255,215,0,0.15); color: var(--gold); }
.badge-maintenance { background: rgba(255,107,0,0.15); color: var(--orange); }
.badge-promotion { background: rgba(0,230,118,0.15); color: var(--green); }

.action-btns { display: flex; gap: 6px; }

.action-btn {
    width: 32px;
    height: 32px;
    border: 1px solid var(--border);
    background: transparent;
    border-radius: 8px;
    color: var(--muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    transition: all 0.2s;
}
.action-btn:hover { border-color: var(--gold); color: var(--gold); }
.action-btn.delete:hover { border-color: var(--danger); color: var(--danger); }

/* ==================== ACTIVITY LIST ==================== */
.activity-list { padding: 0; }

.aggregated-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    transition: background 0.2s;
}
.aggregated-item:last-child { border-bottom: none; }
.aggregated-item:hover { background: var(--card-hover); }

.aggregated-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}
.aggregated-icon.recall { background: rgba(255,107,0,0.15); color: var(--orange); }
.aggregated-icon.match { background: rgba(0,206,209,0.15); color: var(--cyan); }
.aggregated-icon.drill { background: rgba(157,78,221,0.15); color: var(--purple); }
.aggregated-icon.reflex { background: rgba(0,230,118,0.15); color: var(--green); }
.aggregated-icon.ritmo { background: rgba(255,23,68,0.15); color: var(--red); }
.aggregated-icon.subscription { background: rgba(255,215,0,0.15); color: var(--gold); }
.aggregated-icon.trial { background: rgba(157,78,221,0.15); color: var(--purple); }
.aggregated-icon.notification { background: rgba(0,206,209,0.15); color: var(--cyan); }

.aggregated-content { flex: 1; }
.aggregated-text { font-size: 0.9rem; }
.aggregated-details { font-size: 0.75rem; color: var(--muted); margin-top: 2px; }

/* ==================== NOTIFICATION CARDS ==================== */
.notification-card {
    background: var(--darker);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    transition: all 0.2s;
}
.notification-card:hover {
    border-color: var(--gold);
}
.notification-card.expired {
    opacity: 0.6;
}

.notification-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.notification-card-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 1px;
}

.notification-card-meta {
    display: flex;
    gap: 8px;
    align-items: center;
}

.notification-card-body {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 15px;
    line-height: 1.5;
}

.notification-card-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.notification-card-stats {
    display: flex;
    gap: 15px;
    font-size: 0.75rem;
    color: var(--muted);
}

.notification-card-stat {
    display: flex;
    align-items: center;
    gap: 5px;
}

.notification-card-stat strong {
    color: var(--text);
}

/* ==================== CHECKBOX TOGGLE ==================== */
.checkbox-group {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    background: var(--darker);
    border-radius: 10px;
    margin-bottom: 15px;
}

.checkbox-toggle {
    position: relative;
    width: 50px;
    height: 26px;
    flex-shrink: 0;
}

.checkbox-toggle input {
    opacity: 0;
    width: 0;
    height: 0;
}

.checkbox-slider {
    position: absolute;
    cursor: pointer;
    top: 0; left: 0; right: 0; bottom: 0;
    background: var(--border);
    border-radius: 26px;
    transition: 0.3s;
}

.checkbox-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background: white;
    border-radius: 50%;
    transition: 0.3s;
}

.checkbox-toggle input:checked + .checkbox-slider {
    background: var(--teal);
}

.checkbox-toggle input:checked + .checkbox-slider:before {
    transform: translateX(24px);
}

.checkbox-label {
    flex: 1;
}

.checkbox-label-title {
    font-weight: 600;
    font-size: 0.9rem;
    margin-bottom: 2px;
}

.checkbox-label-desc {
    font-size: 0.75rem;
    color: var(--muted);
}

/* ==================== MODALS ==================== */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}
.modal-overlay.show { display: flex; }

.modal {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    padding: 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    letter-spacing: 2px;
}

.modal-close {
    width: 36px;
    height: 36px;
    border: none;
    background: var(--darker);
    border-radius: 10px;
    color: var(--muted);
    font-size: 1.2rem;
    cursor: pointer;
    transition: color 0.2s;
}
.modal-close:hover { color: var(--danger); }

.modal-body { padding: 24px; }
.form-group { margin-bottom: 20px; }

.form-label {
    display: block;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--muted);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.form-input, .form-select, .form-textarea {
    width: 100%;
    padding: 14px 16px;
    background: var(--darker);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-size: 0.95rem;
    font-family: 'Outfit', sans-serif;
    transition: border-color 0.2s;
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
    outline: none;
    border-color: var(--gold);
}

.form-textarea {
    min-height: 100px;
    resize: vertical;
}

.form-row {
    display: flex;
    gap: 15px;
}

.form-row .form-group {
    flex: 1;
}

.modal-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border);
    display: flex;
    justify-content: flex-end;
    gap: 12px;
}

.confirm-dialog { text-align: center; padding: 20px 0; }
.confirm-dialog-icon { font-size: 3rem; margin-bottom: 15px; }
.confirm-dialog-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    letter-spacing: 2px;
    margin-bottom: 10px;
}
.confirm-dialog-text { color: var(--muted); font-size: 0.9rem; }

/* ==================== TOAST ==================== */
.toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--card);
    border: 1px solid var(--teal);
    border-radius: 12px;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s;
    z-index: 2000;
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast.error { border-color: var(--danger); }
.toast-icon { font-size: 1.2rem; }
.toast-text { font-size: 0.9rem; }

/* ==================== EMPTY STATE ==================== */
.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
}
.empty-state-icon { font-size: 3rem; margin-bottom: 15px; }

/* ==================== SUBSCRIBER DETAIL ==================== */
tr.clickable { cursor: pointer; }

.subscriber-detail-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
}

.subscriber-avatar {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--gold), var(--orange));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--dark);
    font-weight: 700;
}

.subscriber-info h4 { font-size: 1.2rem; margin-bottom: 5px; }
.subscriber-info p { font-size: 0.85rem; color: var(--muted); }

.subscriber-stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-bottom: 25px;
}

.subscriber-stat {
    background: var(--darker);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
}
.subscriber-stat-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    color: var(--gold);
}
.subscriber-stat-label {
    font-size: 0.7rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.court-score-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    background: var(--darker);
    border-radius: 10px;
    margin-bottom: 10px;
}
.court-score-name {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
}
.court-score-name span.icon { font-size: 1.2rem; }
.court-score-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    color: var(--text);
}

/* ==================== PIN DISPLAY ==================== */
.pin-display {
    background: var(--darker);
    border: 2px solid var(--gold);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    margin: 20px 0;
}
.pin-display-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 3rem;
    letter-spacing: 8px;
    color: var(--gold);
}
.pin-display-label {
    font-size: 0.8rem;
    color: var(--muted);
    margin-top: 5px;
}
.copy-btn {
    margin-top: 10px;
    padding: 8px 20px;
    background: var(--gold);
    color: var(--dark);
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
    transition: all 0.2s;
}
.copy-btn:hover { background: #e6c200; }

.qty-badge {
    display: inline-block;
    background: rgba(255,215,0,0.2);
    color: var(--gold);
    padding: 2px 8px;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 700;
    margin-left: 5px;
}

/* ==================== VERSION BANNER ==================== */
.version-banner {
    background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(0,217,165,0.1));
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 15px 20px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.version-info {
    display: flex;
    align-items: center;
    gap: 12px;
}

.version-badge {
    background: var(--gold);
    color: var(--dark);
    padding: 5px 12px;
    border-radius: 20px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 0.9rem;
    letter-spacing: 1px;
}

.version-name {
    font-size: 0.9rem;
    color: var(--muted);
}

/* ==================== UPDATE HISTORY ==================== */
.update-history {
    margin-top: 30px;
}

.update-history-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1rem;
    letter-spacing: 2px;
    color: var(--muted);
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
}

.update-history-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
}
.update-history-item:last-child { border-bottom: none; }

.update-history-icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    background: rgba(0,206,209,0.15);
    color: var(--cyan);
    flex-shrink: 0;
}

.update-history-content { flex: 1; }
.update-history-text { font-size: 0.85rem; }
.update-history-meta { font-size: 0.7rem; color: var(--muted); margin-top: 2px; }

.update-history-badge {
    background: rgba(0,217,165,0.15);
    color: var(--teal);
    padding: 3px 8px;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 700;
}

/* ==================== FOOTER ==================== */
.admin-footer {
    margin-top: 40px;
    padding: 25px;
    text-align: center;
    border-top: 1px solid var(--border);
}
.admin-footer .footer-brand { margin-bottom: 10px; }
.admin-footer .ritnome-tm {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.6rem;
    letter-spacing: 4px;
    background: linear-gradient(135deg, #FF1744, #FFD700);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    display: block;
}
.admin-footer .footer-tagline {
    font-size: 0.6rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    display: block;
    margin-top: 3px;
}
.admin-footer .footer-company {
    font-size: 0.75rem;
    color: var(--muted);
    margin: 10px 0;
}
.admin-footer .footer-company a {
    color: #FFD700;
    text-decoration: none;
}
.admin-footer .footer-copyright {
    font-size: 0.55rem;
    color: var(--muted);
    opacity: 0.6;
}

/* ==================== RESPONSIVE ==================== */
@media (max-width: 1024px) {
    .sidebar {
        width: 80px;
        padding: 15px 0;
    }
    .sidebar-header { padding: 0 10px 15px; }
    .sidebar-logo span,
    .sidebar-team,
    .nav-item span:not(.nav-item-icon),
    .nav-section-title,
    .sidebar-footer .lang-toggle,
    .logout-btn span { display: none; }
    .nav-item { justify-content: center; padding: 12px; }
    .nav-item-badge { display: none; }
    .main-content { margin-left: 80px; }
}

@media (max-width: 768px) {
    .sidebar { display: none; }
    .main-content { margin-left: 0; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .subscriber-stats-grid { grid-template-columns: repeat(2, 1fr); }
    .form-row { flex-direction: column; gap: 0; }
}
</style>
</head>
<body class="en">

<!-- ==================== LOGIN SCREEN ==================== -->
<div class="login-screen" id="loginScreen">
    <div class="login-card">
        <div class="login-logo"><span class="laugh">LAUGH</span><span class="court">COURT</span></div>
        <div class="login-badge">Coach Admin Portal</div>
        <p class="login-subtitle">
            <span class="lang-en">Enter your 4-digit admin PIN</span>
            <span class="lang-es">Ingresa tu PIN de 4 d√≠gitos</span>
        </p>
        <div class="pin-input-group">
            <input type="password" class="pin-input" maxlength="1" id="pin1" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin2" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin3" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin4" inputmode="numeric">
        </div>
        <button class="login-btn" id="loginBtn">
            <span class="lang-en">ACCESS DASHBOARD</span>
            <span class="lang-es">ACCEDER</span>
        </button>
        <p class="login-error" id="loginError">
            <span class="lang-en">Invalid PIN</span>
            <span class="lang-es">PIN inv√°lido</span>
        </p>
    </div>
</div>

<!-- ==================== DASHBOARD ==================== -->
<div class="dashboard" id="dashboard">
    
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo"><span class="laugh">LAUGH</span><span class="court">COURT</span></div>
            <div class="sidebar-team">RECALL ‚Ä¢ MATCH ‚Ä¢ DRILL ‚Ä¢ REFLEX ‚Ä¢ RITMO</div>
            <span class="admin-badge">üèÄ Admin</span>
        </div>
        <nav class="nav-section">
            <div class="nav-section-title">
                <span class="lang-en">Dashboard</span>
                <span class="lang-es">Panel</span>
            </div>
            <button class="nav-item active" data-page="overview">
                <span class="nav-item-icon">üìä</span>
                <span class="lang-en">Overview</span>
                <span class="lang-es">Resumen</span>
            </button>
            <button class="nav-item" data-page="subscribers">
                <span class="nav-item-icon">üí≥</span>
                <span class="lang-en">Subscribers</span>
                <span class="lang-es">Suscriptores</span>
            </button>
            <button class="nav-item" data-page="trials">
                <span class="nav-item-icon">üé´</span>
                <span class="lang-en">Trial PINs</span>
                <span class="lang-es">PINs de Prueba</span>
            </button>
            <button class="nav-item" data-page="notifications">
                <span class="nav-item-icon">üì¢</span>
                <span class="lang-en">Notifications</span>
                <span class="lang-es">Notificaciones</span>
                <span class="nav-item-badge" id="notifBadge" style="display:none">0</span>
            </button>
            <button class="nav-item" data-page="activity">
                <span class="nav-item-icon">üìã</span>
                <span class="lang-en">Activity</span>
                <span class="lang-es">Actividad</span>
            </button>
        </nav>
        <div class="sidebar-footer">
            <div class="lang-toggle">
                <button class="lang-btn active" id="btnEn">EN</button>
                <button class="lang-btn" id="btnEs">ES</button>
            </div>
            <button class="logout-btn" id="logoutBtn">
                üö™ <span class="lang-en">Logout</span><span class="lang-es">Salir</span>
            </button>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        
        <!-- ========== OVERVIEW PAGE ========== -->
        <section class="page-section active" id="page-overview">
            <header class="page-header">
                <h1 class="page-title">LAUGHCOURT ADMIN</h1>
                <p class="page-subtitle">
                    <span class="lang-en">5 Workouts ‚Ä¢ 10 Tiers ‚Ä¢ 3 Circuits Each ‚Ä¢ Ritnome‚Ñ¢ Powered</span>
                    <span class="lang-es">5 Entrenamientos ‚Ä¢ 10 Niveles ‚Ä¢ 3 Circuitos ‚Ä¢ Powered by Ritnome‚Ñ¢</span>
                </p>
            </header>

            <div class="version-banner">
                <div class="version-info">
                    <span class="version-badge" id="platformVersion">v2.0.0</span>
                    <span class="version-name" id="platformVersionName">LaughCourt 5-Court Edition</span>
                </div>
                <button class="btn btn-primary" onclick="showPage('notifications');document.querySelector('[data-page=notifications]').click();">
                    üì¢ Send Update
                </button>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon gold">üí≥</div>
                    <div class="stat-card-value" id="totalSubscribers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Subscribers</span>
                        <span class="lang-es">Suscriptores</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon teal">üë•</div>
                    <div class="stat-card-value" id="totalUsers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Total Users</span>
                        <span class="lang-es">Usuarios</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon purple">üé´</div>
                    <div class="stat-card-value" id="activeTrials">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Active Trials</span>
                        <span class="lang-es">Pruebas</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon pink">üòÇ</div>
                    <div class="stat-card-value" id="totalLaughs">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Total Laughs</span>
                        <span class="lang-es">Risas</span>
                    </div>
                </div>
            </div>

            <!-- 5 WORKOUT CARDS -->
            <div class="court-cards-grid">
                <div class="court-card">
                    <div class="court-card-header recall">
                        <div class="court-card-icon">üß†</div>
                        <div class="court-card-title">THE RECALL</div>
                    </div>
                    <div class="court-card-body">
                        <div class="court-card-stats">
                            <div class="court-stat">
                                <div class="court-stat-value" id="recallSessions">0</div>
                                <div class="court-stat-label">Circuits</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="recallBestTier">0</div>
                                <div class="court-stat-label">Best</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="recallLaughs">0</div>
                                <div class="court-stat-label">üòÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="court-card">
                    <div class="court-card-header match">
                        <div class="court-card-icon">üéØ</div>
                        <div class="court-card-title">THE MATCH</div>
                    </div>
                    <div class="court-card-body">
                        <div class="court-card-stats">
                            <div class="court-stat">
                                <div class="court-stat-value" id="matchSessions">0</div>
                                <div class="court-stat-label">Circuits</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="matchBestTier">0</div>
                                <div class="court-stat-label">Best</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="matchLaughs">0</div>
                                <div class="court-stat-label">üòÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="court-card">
                    <div class="court-card-header drill">
                        <div class="court-card-icon">üèÄ</div>
                        <div class="court-card-title">THE DRILL</div>
                    </div>
                    <div class="court-card-body">
                        <div class="court-card-stats">
                            <div class="court-stat">
                                <div class="court-stat-value" id="drillSessions">0</div>
                                <div class="court-stat-label">Circuits</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="drillBestTier">0</div>
                                <div class="court-stat-label">Best</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="drillLaughs">0</div>
                                <div class="court-stat-label">üòÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="court-card">
                    <div class="court-card-header reflex">
                        <div class="court-card-icon">‚ö°</div>
                        <div class="court-card-title">THE REFLEX</div>
                    </div>
                    <div class="court-card-body">
                        <div class="court-card-stats">
                            <div class="court-stat">
                                <div class="court-stat-value" id="reflexSessions">0</div>
                                <div class="court-stat-label">Circuits</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="reflexBestTier">0</div>
                                <div class="court-stat-label">Best</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="reflexLaughs">0</div>
                                <div class="court-stat-label">üòÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="court-card">
                    <div class="court-card-header ritmo">
                        <div class="court-card-icon">üéµ</div>
                        <div class="court-card-title">THE RITMO</div>
                    </div>
                    <div class="court-card-body">
                        <div class="court-card-stats">
                            <div class="court-stat">
                                <div class="court-stat-value" id="ritmoSessions">0</div>
                                <div class="court-stat-label">Circuits</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="ritmoBestTier">0</div>
                                <div class="court-stat-label">Best</div>
                            </div>
                            <div class="court-stat">
                                <div class="court-stat-value" id="ritmoLaughs">0</div>
                                <div class="court-stat-label">üòÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">
                        <span class="lang-en">RECENT ACTIVITY</span>
                        <span class="lang-es">ACTIVIDAD RECIENTE</span>
                    </h3>
                </div>
                <div class="activity-list" id="overviewActivity"></div>
            </div>
        </section>

        <!-- ========== SUBSCRIBERS PAGE ========== -->
        <section class="page-section" id="page-subscribers">
            <header class="page-header">
                <h1 class="page-title">
                    <span class="lang-en">SUBSCRIBERS</span>
                    <span class="lang-es">SUSCRIPTORES</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">$5/user ‚Ä¢ 5 LaughCourt Workouts ‚Ä¢ Full Ritnome‚Ñ¢ Access</span>
                    <span class="lang-es">$5/usuario ‚Ä¢ 5 Entrenamientos ‚Ä¢ Acceso Ritnome‚Ñ¢ Completo</span>
                </p>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon teal">‚úÖ</div>
                    <div class="stat-card-value" id="activeCount">0</div>
                    <div class="stat-card-label">Active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon gold">üë•</div>
                    <div class="stat-card-value" id="totalUsersPaid">0</div>
                    <div class="stat-card-label">Users (Qty)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon orange">üî•</div>
                    <div class="stat-card-value" id="streakLeader">0</div>
                    <div class="stat-card-label">Best Streak</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon pink">üòÇ</div>
                    <div class="stat-card-value" id="laughLeader">0</div>
                    <div class="stat-card-label">Most Laughs</div>
                </div>
            </div>

            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">ALL SUBSCRIBERS</h3>
                    <button class="btn btn-secondary" id="refreshSubscribersBtn">üîÑ</button>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>PIN</th>
                                <th>Qty</th>
                                <th>Status</th>
                                <th>üòÇ</th>
                                <th>üß†</th>
                                <th>üéØ</th>
                                <th>üèÄ</th>
                                <th>‚ö°</th>
                                <th>üéµ</th>
                                <th>üî•</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="subscribersTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ========== TRIAL PINS PAGE ========== -->
        <section class="page-section" id="page-trials">
            <header class="page-header">
                <h1 class="page-title">
                    üé´ <span class="lang-en">TRIAL PINS</span>
                    <span class="lang-es">PINS DE PRUEBA</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">Generate facility trial PINs (1-100 users, 7 days, 60 BPM only)</span>
                    <span class="lang-es">Genera PINs de prueba para instalaciones (1-100 usuarios, 7 d√≠as, solo 60 BPM)</span>
                </p>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon teal">‚úÖ</div>
                    <div class="stat-card-value" id="trialsActive">0</div>
                    <div class="stat-card-label">Active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon orange">‚è∞</div>
                    <div class="stat-card-value" id="trialsExpired">0</div>
                    <div class="stat-card-label">Expired</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon purple">üè¢</div>
                    <div class="stat-card-value" id="trialsFacilities">0</div>
                    <div class="stat-card-label">Facilities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon gold">üë•</div>
                    <div class="stat-card-value" id="trialsCapacity">0</div>
                    <div class="stat-card-label">Capacity</div>
                </div>
            </div>

            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">FACILITY TRIALS</h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refreshTrialsBtn">üîÑ</button>
                        <button class="btn btn-primary" id="newTrialBtn">+ New Trial</button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>PIN</th>
                                <th>Facility</th>
                                <th>Status</th>
                                <th>Users</th>
                                <th>Bonus</th>
                                <th>Expires</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trialsTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ========== NOTIFICATIONS PAGE ========== -->
        <section class="page-section" id="page-notifications">
            <header class="page-header">
                <h1 class="page-title">
                    üì¢ <span class="lang-en">PLATFORM UPDATES</span>
                    <span class="lang-es">ACTUALIZACIONES</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">Send updates to all users ‚Ä¢ Auto-extend active trials by 3 days</span>
                    <span class="lang-es">Env√≠a actualizaciones a todos ‚Ä¢ Auto-extensi√≥n de 3 d√≠as para pruebas</span>
                </p>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon cyan">üì¢</div>
                    <div class="stat-card-value" id="totalNotifications">0</div>
                    <div class="stat-card-label">Total Sent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon teal">‚úÖ</div>
                    <div class="stat-card-value" id="activeNotifications">0</div>
                    <div class="stat-card-label">Active</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon gold">üëÅÔ∏è</div>
                    <div class="stat-card-value" id="totalSeen">0</div>
                    <div class="stat-card-label">Total Views</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon purple">üéÅ</div>
                    <div class="stat-card-value" id="totalExtended">0</div>
                    <div class="stat-card-label">Trials Extended</div>
                </div>
            </div>

            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">SEND NEW UPDATE</h3>
                    <button class="btn btn-primary" id="newNotificationBtn">+ New Update</button>
                </div>
                <div style="padding: 20px;">
                    <p style="color: var(--muted); font-size: 0.9rem; margin-bottom: 15px;">
                        Send platform updates that users see on their next login. Optionally extend all active trials by 3 days as a goodwill gesture.
                    </p>
                </div>
            </div>

            <!-- Update History -->
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">üìã UPDATE HISTORY</h3>
                    <button class="btn btn-secondary" id="refreshNotificationsBtn">üîÑ</button>
                </div>
                <div id="notificationsList" style="padding: 20px;"></div>
            </div>
        </section>

        <!-- ========== ACTIVITY PAGE ========== -->
        <section class="page-section" id="page-activity">
            <header class="page-header">
                <h1 class="page-title">
                    <span class="lang-en">ACTIVITY LOG</span>
                    <span class="lang-es">REGISTRO DE ACTIVIDAD</span>
                </h1>
            </header>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon orange">üèÄ</div>
                    <div class="stat-card-value" id="courtsToday">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Workouts Today</span>
                        <span class="lang-es">Hoy</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon teal">üìÖ</div>
                    <div class="stat-card-value" id="courtsWeek">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">This Week</span>
                        <span class="lang-es">Semana</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon gold">üÜï</div>
                    <div class="stat-card-value" id="newSubsWeek">0</div>
                    <div class="stat-card-label">New Subs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon pink">üòÇ</div>
                    <div class="stat-card-value" id="laughsToday">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Laughs Today</span>
                        <span class="lang-es">Risas Hoy</span>
                    </div>
                </div>
            </div>

            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">ALL ACTIVITY</h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refreshActivityBtn">üîÑ</button>
                        <button class="btn btn-danger" id="clearAllActivityBtn">üóëÔ∏è Clear</button>
                    </div>
                </div>
                <div class="activity-list" id="activityList"></div>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="admin-footer">
            <div class="footer-brand">
                <span class="ritnome-tm">Ritnome‚Ñ¢</span>
                <span class="footer-tagline">Rhythm-Based Cognitive Training</span>
            </div>
            <div class="footer-company">by <a href="https://gostar.digital">GoStar Digital LLC</a> üáµüá∑</div>
            <div class="footer-copyright">¬© 2025 GoStar Digital LLC. All rights reserved.</div>
        </footer>
    </main>
</div>

<!-- ==================== MODALS ==================== -->

<!-- Create Trial Modal -->
<div class="modal-overlay" id="createTrialModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">üé´ NEW FACILITY TRIAL</h3>
            <button class="modal-close" data-close="createTrialModal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Facility Name</label>
                <input type="text" class="form-input" id="trialFacility" placeholder="Rehabilitaci√≥n y Risas">
            </div>
            <div class="form-group">
                <label class="form-label">Max Users (1-100)</label>
                <input type="number" class="form-input" id="trialMaxUsers" value="50" min="1" max="100">
            </div>
            <div class="form-group">
                <label class="form-label">Trial Days</label>
                <input type="number" class="form-input" id="trialDays" value="7" min="1" max="30">
            </div>
            <div class="form-group">
                <label class="form-label">Notes (optional)</label>
                <input type="text" class="form-input" id="trialNotes" placeholder="Contact info, phone, etc.">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="createTrialModal">Cancel</button>
            <button class="btn btn-primary" id="createTrialBtn">Generate PIN</button>
        </div>
    </div>
</div>

<!-- Trial Created Modal -->
<div class="modal-overlay" id="trialCreatedModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">‚úÖ TRIAL CREATED</h3>
            <button class="modal-close" data-close="trialCreatedModal">√ó</button>
        </div>
        <div class="modal-body">
            <p style="text-align:center;color:var(--muted)" id="trialCreatedFacility"></p>
            <div class="pin-display">
                <div class="pin-display-value" id="trialCreatedPin">0000</div>
                <div class="pin-display-label">Share this PIN with the facility</div>
                <button class="copy-btn" id="copyTrialPinBtn">üìã Copy PIN</button>
            </div>
            <p style="text-align:center;font-size:0.85rem;color:var(--muted)" id="trialCreatedInfo"></p>
            <p style="text-align:center;font-size:0.75rem;color:var(--gold);margin-top:10px">
                ‚ö†Ô∏è Trial users get 60 BPM only. Upgrade unlocks 90 & 120 BPM.
            </p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" data-close="trialCreatedModal">Done</button>
        </div>
    </div>
</div>

<!-- Extend Trial Modal -->
<div class="modal-overlay" id="extendTrialModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">‚è∞ EXTEND TRIAL</h3>
            <button class="modal-close" data-close="extendTrialModal">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="extendTrialId">
            <p style="margin-bottom:20px">Add days to <strong id="extendTrialFacility"></strong></p>
            <div class="form-group">
                <label class="form-label">Days to Add</label>
                <input type="number" class="form-input" id="extendTrialDays" value="7" min="1" max="30">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="extendTrialModal">Cancel</button>
            <button class="btn btn-primary" id="confirmExtendBtn">Extend</button>
        </div>
    </div>
</div>

<!-- Delete Trial Modal -->
<div class="modal-overlay" id="deleteTrialModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">DELETE TRIAL</h3>
            <button class="modal-close" data-close="deleteTrialModal">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="deleteTrialId">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">‚ö†Ô∏è</div>
                <div class="confirm-dialog-text" id="deleteTrialText"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="deleteTrialModal">Cancel</button>
            <button class="btn btn-danger" id="confirmDeleteTrialBtn">Delete</button>
        </div>
    </div>
</div>

<!-- Subscriber Detail Modal -->
<div class="modal-overlay" id="subscriberModal">
    <div class="modal" style="max-width:560px">
        <div class="modal-header">
            <h3 class="modal-title">SUBSCRIBER DETAILS</h3>
            <button class="modal-close" data-close="subscriberModal">√ó</button>
        </div>
        <div class="modal-body" id="subscriberModalBody"></div>
    </div>
</div>

<!-- Edit Subscriber Modal -->
<div class="modal-overlay" id="editSubscriberModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">EDIT SUBSCRIBER</h3>
            <button class="modal-close" data-close="editSubscriberModal">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="editSubPin">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="editSubEmail">
            </div>
            <div class="form-group">
                <label class="form-label">Quantity (Users)</label>
                <input type="number" class="form-input" id="editSubQty" min="1" max="50">
            </div>
            <div class="form-group">
                <label class="form-label">Status</label>
                <select class="form-select" id="editSubStatus">
                    <option value="active">Active</option>
                    <option value="trialing">Trialing</option>
                    <option value="canceled">Canceled</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="editSubscriberModal">Cancel</button>
            <button class="btn btn-primary" id="saveSubscriberBtn">Save</button>
        </div>
    </div>
</div>

<!-- Delete Subscriber Modal -->
<div class="modal-overlay" id="deleteSubscriberModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">DELETE SUBSCRIBER</h3>
            <button class="modal-close" data-close="deleteSubscriberModal">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="deleteSubPin">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">‚ö†Ô∏è</div>
                <div class="confirm-dialog-text" id="deleteSubscriberText"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="deleteSubscriberModal">Cancel</button>
            <button class="btn btn-danger" id="confirmDeleteSubscriberBtn">Delete</button>
        </div>
    </div>
</div>

<!-- Clear Activity Modal -->
<div class="modal-overlay" id="clearActivityModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">CLEAR ACTIVITY</h3>
            <button class="modal-close" data-close="clearActivityModal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">üóëÔ∏è</div>
                <div class="confirm-dialog-text">Delete all activity logs? This cannot be undone.</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="clearActivityModal">Cancel</button>
            <button class="btn btn-danger" id="confirmClearActivityBtn">Delete All</button>
        </div>
    </div>
</div>

<!-- Create Notification Modal -->
<div class="modal-overlay" id="createNotificationModal">
    <div class="modal" style="max-width:560px">
        <div class="modal-header">
            <h3 class="modal-title">üì¢ NEW PLATFORM UPDATE</h3>
            <button class="modal-close" data-close="createNotificationModal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Title</label>
                <input type="text" class="form-input" id="notifTitle" placeholder="LaughCourt v2.0 ‚Äî 5 Workouts!">
            </div>
            <div class="form-group">
                <label class="form-label">Message</label>
                <textarea class="form-textarea" id="notifMessage" placeholder="We've added 2 new workouts! Enjoy THE REFLEX and THE RITMO..."></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="notifType">
                        <option value="update">üöÄ Update</option>
                        <option value="announcement">üì£ Announcement</option>
                        <option value="maintenance">üîß Maintenance</option>
                        <option value="promotion">üéÅ Promotion</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Expires In</label>
                    <select class="form-select" id="notifExpires">
                        <option value="7">7 days</option>
                        <option value="14">14 days</option>
                        <option value="30" selected>30 days</option>
                        <option value="60">60 days</option>
                    </select>
                </div>
            </div>
            
            <div class="checkbox-group">
                <label class="checkbox-toggle">
                    <input type="checkbox" id="notifExtendTrials">
                    <span class="checkbox-slider"></span>
                </label>
                <div class="checkbox-label">
                    <div class="checkbox-label-title">üéÅ Extend Active Trials (+3 days)</div>
                    <div class="checkbox-label-desc">Add 3 bonus days to ALL active trial PINs as a goodwill gesture</div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="createNotificationModal">Cancel</button>
            <button class="btn btn-primary" id="createNotificationBtn">üì¢ Send Update</button>
        </div>
    </div>
</div>

<!-- Notification Sent Modal -->
<div class="modal-overlay" id="notificationSentModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">‚úÖ UPDATE SENT!</h3>
            <button class="modal-close" data-close="notificationSentModal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">üéâ</div>
                <div class="confirm-dialog-title" id="notifSentTitle">Update Published!</div>
                <div class="confirm-dialog-text" id="notifSentText">Users will see this modal on their next login.</div>
                <div id="notifSentExtendInfo" style="margin-top:15px;padding:15px;background:var(--darker);border-radius:10px;display:none;">
                    <div style="color:var(--teal);font-weight:600;margin-bottom:5px;">üéÅ Trials Extended!</div>
                    <div id="notifSentExtendDetails" style="color:var(--muted);font-size:0.85rem;"></div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" data-close="notificationSentModal">Got It!</button>
        </div>
    </div>
</div>

<!-- Delete Notification Modal -->
<div class="modal-overlay" id="deleteNotificationModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">DELETE NOTIFICATION</h3>
            <button class="modal-close" data-close="deleteNotificationModal">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="deleteNotifId">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">‚ö†Ô∏è</div>
                <div class="confirm-dialog-text" id="deleteNotifText">Delete this notification?</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="deleteNotificationModal">Cancel</button>
            <button class="btn btn-danger" id="confirmDeleteNotifBtn">Delete</button>
        </div>
    </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">
    <span class="toast-icon" id="toastIcon">‚úì</span>
    <span class="toast-text" id="toastText">Saved</span>
</div>

<script>
(function() {
    'use strict';
    
    // ==================== STATE ====================
    let authToken = null;
    let subscribers = [];
    let activities = [];
    let trials = [];
    let notifications = [];
    let platformVersion = { version: '2.0.0', versionName: 'LaughCourt 5-Court Edition' };
    let currentLang = localStorage.getItem('lc-lang') || 'en';

    // ==================== INITIALIZATION ====================
    function init() {
        setLang(currentLang);
        setupPinInputs();
        setupEvents();
        
        const savedToken = sessionStorage.getItem('lc-token');
        if (savedToken) {
            verifyToken(savedToken);
        }
    }

    // ==================== LANGUAGE ====================
    function setLang(lang) {
        currentLang = lang;
        localStorage.setItem('lc-lang', lang);
        document.body.className = lang;
        document.getElementById('btnEn').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('btnEs').className = lang === 'es' ? 'lang-btn active' : 'lang-btn';
    }

    // ==================== LOGIN ====================
    function setupPinInputs() {
        const pins = ['pin1', 'pin2', 'pin3', 'pin4'].map(id => document.getElementById(id));
        
        pins.forEach((inp, i) => {
            inp.addEventListener('input', function() {
                if (this.value.length === 1 && i < 3) pins[i + 1].focus();
            });
            inp.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value === '' && i > 0) pins[i - 1].focus();
                if (e.key === 'Enter') attemptLogin();
            });
        });
        pins[0].focus();
    }

    function attemptLogin() {
        const pin = ['pin1', 'pin2', 'pin3', 'pin4']
            .map(id => document.getElementById(id).value)
            .join('');
        
        if (pin.length !== 4) return;

        fetch('/api/admin/verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pin })
        })
        .then(r => r.json())
        .then(d => {
            if (d.success && d.token) {
                authToken = d.token;
                sessionStorage.setItem('lc-token', authToken);
                showDashboard();
            } else {
                showLoginError();
            }
        })
        .catch(showLoginError);
    }

    function verifyToken(token) {
        fetch('/api/admin/verify-token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token })
        })
        .then(r => r.json())
        .then(d => {
            if (d.success) {
                authToken = token;
                showDashboard();
            } else {
                sessionStorage.removeItem('lc-token');
            }
        })
        .catch(() => sessionStorage.removeItem('lc-token'));
    }

    function showLoginError() {
        document.getElementById('loginError').classList.add('show');
        ['pin1', 'pin2', 'pin3', 'pin4'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('pin1').focus();
        setTimeout(() => document.getElementById('loginError').classList.remove('show'), 3000);
    }

    function showDashboard() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.add('visible');
        loadAllData();
    }

    function logout() {
        authToken = null;
        sessionStorage.removeItem('lc-token');
        document.getElementById('dashboard').classList.remove('visible');
        document.getElementById('loginScreen').classList.remove('hidden');
        ['pin1', 'pin2', 'pin3', 'pin4'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('pin1').focus();
    }

    // ==================== EVENTS ====================
    function setupEvents() {
        document.getElementById('loginBtn').addEventListener('click', attemptLogin);
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('btnEn').addEventListener('click', () => setLang('en'));
        document.getElementById('btnEs').addEventListener('click', () => setLang('es'));

        // Navigation
        document.querySelectorAll('.nav-item').forEach(btn => {
            btn.addEventListener('click', function() {
                showPage(this.dataset.page);
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // Modal closes
        document.querySelectorAll('[data-close]').forEach(btn => {
            btn.addEventListener('click', function() {
                closeModal(this.dataset.close);
            });
        });

        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === overlay) overlay.classList.remove('show');
            });
        });

        // Actions
        document.getElementById('refreshSubscribersBtn').addEventListener('click', loadSubscribers);
        document.getElementById('refreshActivityBtn').addEventListener('click', loadActivity);
        document.getElementById('refreshTrialsBtn').addEventListener('click', loadTrials);
        document.getElementById('clearAllActivityBtn').addEventListener('click', () => openModal('clearActivityModal'));
        document.getElementById('confirmClearActivityBtn').addEventListener('click', clearAllActivity);
        document.getElementById('saveSubscriberBtn').addEventListener('click', saveSubscriber);
        document.getElementById('confirmDeleteSubscriberBtn').addEventListener('click', confirmDeleteSubscriber);
        document.getElementById('newTrialBtn').addEventListener('click', () => openModal('createTrialModal'));
        document.getElementById('createTrialBtn').addEventListener('click', createTrial);
        document.getElementById('copyTrialPinBtn').addEventListener('click', copyTrialPin);
        document.getElementById('confirmExtendBtn').addEventListener('click', extendTrial);
        document.getElementById('confirmDeleteTrialBtn').addEventListener('click', deleteTrial);
        
        // Notification events
        document.getElementById('refreshNotificationsBtn').addEventListener('click', loadNotifications);
        document.getElementById('newNotificationBtn').addEventListener('click', () => openModal('createNotificationModal'));
        document.getElementById('createNotificationBtn').addEventListener('click', createNotification);
        document.getElementById('confirmDeleteNotifBtn').addEventListener('click', deleteNotification);
    }

    // ==================== UI HELPERS ====================
    function showPage(page) {
        document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
        document.getElementById('page-' + page).classList.add('active');
    }
    
    // Make showPage globally accessible
    window.showPage = showPage;

    function openModal(id) {
        document.getElementById(id).classList.add('show');
    }

    function closeModal(id) {
        document.getElementById(id).classList.remove('show');
    }

    function showToast(msg, isError) {
        const toast = document.getElementById('toast');
        document.getElementById('toastText').textContent = msg;
        document.getElementById('toastIcon').textContent = isError ? '‚úó' : '‚úì';
        toast.classList.toggle('error', isError);
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function formatTimeAgo(ts) {
        if (!ts) return '-';
        const diff = Math.floor((Date.now() - new Date(ts).getTime()) / 1000);
        if (diff < 60) return diff + 's';
        if (diff < 3600) return Math.floor(diff / 60) + 'm';
        if (diff < 86400) return Math.floor(diff / 3600) + 'h';
        return Math.floor(diff / 86400) + 'd';
    }

    function formatDate(ts) {
        if (!ts) return '-';
        return new Date(ts).toLocaleDateString();
    }
    
    function formatDateTime(ts) {
        if (!ts) return '-';
        const d = new Date(ts);
        return d.toLocaleDateString() + ' ' + d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }

    // ==================== API ====================
    function api(endpoint, opts = {}) {
        opts.headers = opts.headers || {};
        opts.headers['Authorization'] = 'Bearer ' + authToken;
        if (opts.body && typeof opts.body === 'object') {
            opts.headers['Content-Type'] = 'application/json';
            opts.body = JSON.stringify(opts.body);
        }
        return fetch(endpoint, opts).then(r => r.json());
    }

    function loadAllData() {
        loadPlatformVersion();
        loadSubscribers();
        loadActivity();
        loadTrials();
        loadNotifications();
    }

    // ==================== PLATFORM VERSION ====================
    function loadPlatformVersion() {
        fetch('/api/platform/version')
            .then(r => r.json())
            .then(d => {
                platformVersion = d;
                document.getElementById('platformVersion').textContent = 'v' + d.version;
                document.getElementById('platformVersionName').textContent = d.versionName;
            })
            .catch(() => {});
    }

    // ==================== SUBSCRIBERS ====================
    function loadSubscribers() {
        api('/api/admin/subscribers').then(d => {
            subscribers = d.success ? d.subscribers || [] : [];
            renderSubscribers();
            updateStats();
        }).catch(() => {
            subscribers = [];
            renderSubscribers();
        });
    }

    function updateStats() {
        let total = subscribers.length;
        let active = 0, totalUsers = 0, totalLaughs = 0;
        let recallSessions = 0, matchSessions = 0, drillSessions = 0, reflexSessions = 0, ritmoSessions = 0;
        let recallLaughs = 0, matchLaughs = 0, drillLaughs = 0, reflexLaughs = 0, ritmoLaughs = 0;
        let bestStreak = 0, mostLaughs = 0;
        let bestRecallTier = 0, bestMatchTier = 0, bestDrillTier = 0, bestReflexTier = 0, bestRitmoTier = 0;

        subscribers.forEach(s => {
            const qty = s.quantity || 1;
            if (s.status === 'active') {
                active++;
                totalUsers += qty;
            }
            totalLaughs += s.totalLaughs || 0;
            if ((s.totalLaughs || 0) > mostLaughs) mostLaughs = s.totalLaughs;
            if ((s.streak || 0) > bestStreak) bestStreak = s.streak;

            // Courts data (new format)
            if (s.courts) {
                if (s.courts.therecall) {
                    recallSessions += s.courts.therecall.sessions || 0;
                    recallLaughs += s.courts.therecall.laughs || 0;
                    if ((s.courts.therecall.bestTier || 0) > bestRecallTier) bestRecallTier = s.courts.therecall.bestTier;
                }
                if (s.courts.thematch) {
                    matchSessions += s.courts.thematch.sessions || 0;
                    matchLaughs += s.courts.thematch.laughs || 0;
                    if ((s.courts.thematch.bestTier || 0) > bestMatchTier) bestMatchTier = s.courts.thematch.bestTier;
                }
                if (s.courts.thedrill) {
                    drillSessions += s.courts.thedrill.sessions || 0;
                    drillLaughs += s.courts.thedrill.laughs || 0;
                    if ((s.courts.thedrill.bestTier || 0) > bestDrillTier) bestDrillTier = s.courts.thedrill.bestTier;
                }
                if (s.courts.thereflex) {
                    reflexSessions += s.courts.thereflex.sessions || 0;
                    reflexLaughs += s.courts.thereflex.laughs || 0;
                    if ((s.courts.thereflex.bestTier || 0) > bestReflexTier) bestReflexTier = s.courts.thereflex.bestTier;
                }
                if (s.courts.theritmo) {
                    ritmoSessions += s.courts.theritmo.sessions || 0;
                    ritmoLaughs += s.courts.theritmo.laughs || 0;
                    if ((s.courts.theritmo.bestTier || 0) > bestRitmoTier) bestRitmoTier = s.courts.theritmo.bestTier;
                }
            }

            // Legacy games data
            if (s.games) {
                if (s.games.therecall || s.games.laughtrail) {
                    const g = s.games.therecall || s.games.laughtrail;
                    recallSessions += g.sessions || 0;
                    recallLaughs += g.laughs || 0;
                    const tier = g.bestTier || g.bestRound || 0;
                    if (tier > bestRecallTier) bestRecallTier = tier;
                }
                if (s.games.thematch) {
                    matchSessions += s.games.thematch.sessions || 0;
                    matchLaughs += s.games.thematch.laughs || 0;
                    if ((s.games.thematch.bestTier || 0) > bestMatchTier) bestMatchTier = s.games.thematch.bestTier;
                }
                if (s.games.thedrill) {
                    drillSessions += s.games.thedrill.sessions || 0;
                    drillLaughs += s.games.thedrill.laughs || 0;
                    if ((s.games.thedrill.bestTier || 0) > bestDrillTier) bestDrillTier = s.games.thedrill.bestTier;
                }
                if (s.games.thereflex) {
                    reflexSessions += s.games.thereflex.sessions || 0;
                    reflexLaughs += s.games.thereflex.laughs || 0;
                    if ((s.games.thereflex.bestTier || 0) > bestReflexTier) bestReflexTier = s.games.thereflex.bestTier;
                }
                if (s.games.theritmo) {
                    ritmoSessions += s.games.theritmo.sessions || 0;
                    ritmoLaughs += s.games.theritmo.laughs || 0;
                    if ((s.games.theritmo.bestTier || 0) > bestRitmoTier) bestRitmoTier = s.games.theritmo.bestTier;
                }
            }
        });

        // Overview stats
        document.getElementById('totalSubscribers').textContent = total;
        document.getElementById('totalUsers').textContent = totalUsers;
        document.getElementById('totalLaughs').textContent = totalLaughs;

        // Court cards - all 5 workouts
        document.getElementById('recallSessions').textContent = recallSessions;
        document.getElementById('recallBestTier').textContent = bestRecallTier;
        document.getElementById('recallLaughs').textContent = recallLaughs;

        document.getElementById('matchSessions').textContent = matchSessions;
        document.getElementById('matchBestTier').textContent = bestMatchTier;
        document.getElementById('matchLaughs').textContent = matchLaughs;

        document.getElementById('drillSessions').textContent = drillSessions;
        document.getElementById('drillBestTier').textContent = bestDrillTier;
        document.getElementById('drillLaughs').textContent = drillLaughs;

        document.getElementById('reflexSessions').textContent = reflexSessions;
        document.getElementById('reflexBestTier').textContent = bestReflexTier;
        document.getElementById('reflexLaughs').textContent = reflexLaughs;

        document.getElementById('ritmoSessions').textContent = ritmoSessions;
        document.getElementById('ritmoBestTier').textContent = bestRitmoTier;
        document.getElementById('ritmoLaughs').textContent = ritmoLaughs;

        // Subscriber stats
        document.getElementById('activeCount').textContent = active;
        document.getElementById('totalUsersPaid').textContent = totalUsers;
        document.getElementById('streakLeader').textContent = bestStreak;
        document.getElementById('laughLeader').textContent = mostLaughs;
    }

    function renderSubscribers() {
        const tb = document.getElementById('subscribersTable');
        
        if (!subscribers.length) {
            tb.innerHTML = '<tr><td colspan="12" style="text-align:center;padding:40px;color:var(--muted)">No subscribers yet</td></tr>';
            return;
        }

        let html = '';
        subscribers.forEach(s => {
            // Get tier data for all 5 workouts
            let recall = 0, match = 0, drill = 0, reflex = 0, ritmo = 0;

            if (s.courts) {
                recall = s.courts.therecall?.bestTier || 0;
                match = s.courts.thematch?.bestTier || 0;
                drill = s.courts.thedrill?.bestTier || 0;
                reflex = s.courts.thereflex?.bestTier || 0;
                ritmo = s.courts.theritmo?.bestTier || 0;
            }

            if (s.games) {
                if (!recall) recall = s.games.therecall?.bestTier || s.games.laughtrail?.bestTier || s.games.laughtrail?.bestRound || 0;
                if (!match) match = s.games.thematch?.bestTier || 0;
                if (!drill) drill = s.games.thedrill?.bestTier || 0;
                if (!reflex) reflex = s.games.thereflex?.bestTier || 0;
                if (!ritmo) ritmo = s.games.theritmo?.bestTier || 0;
            }

            const qty = s.quantity || 1;
            const qtyBadge = qty > 1 ? `<span class="qty-badge">x${qty}</span>` : '';

            html += `
                <tr class="clickable" onclick="viewSub('${s.pin}')">
                    <td>${s.email || '-'}</td>
                    <td><strong style="color:var(--gold)">${s.pin}</strong></td>
                    <td>${qty}${qtyBadge}</td>
                    <td><span class="badge badge-${s.status}">${s.status}</span></td>
                    <td>${s.totalLaughs || 0}</td>
                    <td>T${recall}</td>
                    <td>T${match}</td>
                    <td>T${drill}</td>
                    <td>T${reflex}</td>
                    <td>T${ritmo}</td>
                    <td>üî•${s.streak || 0}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn" onclick="event.stopPropagation();editSub('${s.pin}')">‚úèÔ∏è</button>
                            <button class="action-btn delete" onclick="event.stopPropagation();delSub('${s.pin}','${s.email}')">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `;
        });
        tb.innerHTML = html;
    }

    // Global subscriber functions
    window.viewSub = function(pin) {
        const s = subscribers.find(x => x.pin === pin);
        if (!s) return;

        // Get data for all 5 workouts
        let recall = {}, match = {}, drill = {}, reflex = {}, ritmo = {};

        if (s.courts) {
            recall = s.courts.therecall || {};
            match = s.courts.thematch || {};
            drill = s.courts.thedrill || {};
            reflex = s.courts.thereflex || {};
            ritmo = s.courts.theritmo || {};
        }

        if (s.games) {
            if (!recall.sessions) recall = s.games.therecall || s.games.laughtrail || {};
            if (!match.sessions) match = s.games.thematch || {};
            if (!drill.sessions) drill = s.games.thedrill || {};
            if (!reflex.sessions) reflex = s.games.thereflex || {};
            if (!ritmo.sessions) ritmo = s.games.theritmo || {};
        }

        const qty = s.quantity || 1;
        const totalSessions = (recall.sessions || 0) + (match.sessions || 0) + (drill.sessions || 0) + (reflex.sessions || 0) + (ritmo.sessions || 0);

        let html = `
            <div class="subscriber-detail-header">
                <div class="subscriber-avatar">${s.email ? s.email.charAt(0).toUpperCase() : '?'}</div>
                <div class="subscriber-info" style="flex:1">
                    <h4>${s.email}</h4>
                    <p>PIN: <strong style="color:var(--gold)">${s.pin}</strong>${qty > 1 ? ` <span class="qty-badge">x${qty} users</span>` : ''}</p>
                </div>
            </div>
            <div class="subscriber-stats-grid">
                <div class="subscriber-stat">
                    <div class="subscriber-stat-value">üë•${qty}</div>
                    <div class="subscriber-stat-label">Users</div>
                </div>
                <div class="subscriber-stat">
                    <div class="subscriber-stat-value">üòÇ${s.totalLaughs || 0}</div>
                    <div class="subscriber-stat-label">Laughs</div>
                </div>
                <div class="subscriber-stat">
                    <div class="subscriber-stat-value">üî•${s.streak || 0}</div>
                    <div class="subscriber-stat-label">Streak</div>
                </div>
                <div class="subscriber-stat">
                    <div class="subscriber-stat-value">${totalSessions}</div>
                    <div class="subscriber-stat-label">Circuits</div>
                </div>
            </div>
            <div class="court-score-row"><div class="court-score-name"><span class="icon">üß†</span> THE RECALL</div><div class="court-score-value">T${recall.bestTier || recall.bestRound || 0}</div></div>
            <div class="court-score-row"><div class="court-score-name"><span class="icon">üéØ</span> THE MATCH</div><div class="court-score-value">T${match.bestTier || 0}</div></div>
            <div class="court-score-row"><div class="court-score-name"><span class="icon">üèÄ</span> THE DRILL</div><div class="court-score-value">T${drill.bestTier || 0}</div></div>
            <div class="court-score-row"><div class="court-score-name"><span class="icon">‚ö°</span> THE REFLEX</div><div class="court-score-value">T${reflex.bestTier || 0}</div></div>
            <div class="court-score-row"><div class="court-score-name"><span class="icon">üéµ</span> THE RITMO</div><div class="court-score-value">T${ritmo.bestTier || 0}</div></div>
            <p style="text-align:center;margin-top:20px;font-size:0.8rem;color:var(--muted)">$${qty * 5}/mo subscription ‚Ä¢ Full Ritnome‚Ñ¢ Access</p>
        `;

        document.getElementById('subscriberModalBody').innerHTML = html;
        openModal('subscriberModal');
    };

    window.editSub = function(pin) {
        const s = subscribers.find(x => x.pin === pin);
        if (!s) return;
        document.getElementById('editSubPin').value = pin;
        document.getElementById('editSubEmail').value = s.email || '';
        document.getElementById('editSubQty').value = s.quantity || 1;
        document.getElementById('editSubStatus').value = s.status || 'active';
        openModal('editSubscriberModal');
    };

    window.delSub = function(pin, email) {
        document.getElementById('deleteSubPin').value = pin;
        document.getElementById('deleteSubscriberText').innerHTML = `Delete <strong style="color:var(--gold)">${email}</strong>?`;
        openModal('deleteSubscriberModal');
    };

    function saveSubscriber() {
        const pin = document.getElementById('editSubPin').value;
        api('/api/admin/subscriber/' + pin, {
            method: 'PUT',
            body: {
                email: document.getElementById('editSubEmail').value,
                quantity: parseInt(document.getElementById('editSubQty').value) || 1,
                status: document.getElementById('editSubStatus').value
            }
        }).then(d => {
            if (d.success) {
                closeModal('editSubscriberModal');
                loadSubscribers();
                showToast('Saved');
            } else {
                showToast(d.error || 'Error', true);
            }
        });
    }

    function confirmDeleteSubscriber() {
        const pin = document.getElementById('deleteSubPin').value;
        if (!pin) return;
        api('/api/admin/subscriber/' + pin, { method: 'DELETE' }).then(d => {
            if (d.success) {
                closeModal('deleteSubscriberModal');
                loadSubscribers();
                showToast('Deleted');
            } else {
                showToast('Error', true);
            }
        });
    }

    // ==================== TRIALS ====================
    function loadTrials() {
        api('/api/admin/trial-pins').then(d => {
            trials = d.success ? d.trials || [] : [];
            renderTrials();
            updateTrialStats();
        }).catch(() => {
            trials = [];
            renderTrials();
        });
    }

    function updateTrialStats() {
        const active = trials.filter(t => t.status === 'active').length;
        const expired = trials.filter(t => t.status === 'expired').length;
        const capacity = trials.reduce((sum, t) => sum + (t.maxUsers || 0), 0);

        document.getElementById('trialsActive').textContent = active;
        document.getElementById('trialsExpired').textContent = expired;
        document.getElementById('trialsFacilities').textContent = trials.length;
        document.getElementById('trialsCapacity').textContent = capacity;
        document.getElementById('activeTrials').textContent = active;
    }

    function renderTrials() {
        const tb = document.getElementById('trialsTable');

        if (!trials.length) {
            tb.innerHTML = '<tr><td colspan="7" style="text-align:center;padding:40px;color:var(--muted)">No trial PINs yet</td></tr>';
            return;
        }

        let html = '';
        trials.forEach(t => {
            const bonusDays = t.bonusDaysReceived || 0;
            const bonusBadge = bonusDays > 0 ? `<span style="color:var(--teal);font-size:0.75rem">+${bonusDays}d</span>` : '-';
            
            html += `
                <tr>
                    <td><strong style="color:var(--gold);font-size:1.2rem;letter-spacing:2px">${t.pin}</strong></td>
                    <td>${t.facility}${t.notes ? `<br><small style="color:var(--muted)">${t.notes}</small>` : ''}</td>
                    <td><span class="badge badge-${t.status}">${t.status}</span></td>
                    <td>${t.currentUsers || 0}/${t.maxUsers}</td>
                    <td>${bonusBadge}</td>
                    <td>${formatDate(t.expiresAt)}</td>
                    <td>
                        <div class="action-btns">
                            <button class="action-btn" onclick="copyPin('${t.pin}')" title="Copy">üìã</button>
                            <button class="action-btn" onclick="extendTrialModal('${t.id}','${t.facility}')" title="Extend">‚è∞</button>
                            <button class="action-btn delete" onclick="deleteTrialModal('${t.id}','${t.facility}')" title="Delete">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `;
        });
        tb.innerHTML = html;
    }

    function createTrial() {
        const facility = document.getElementById('trialFacility').value.trim();
        const maxUsers = parseInt(document.getElementById('trialMaxUsers').value) || 50;
        const days = parseInt(document.getElementById('trialDays').value) || 7;
        const notes = document.getElementById('trialNotes').value.trim();

        if (!facility) {
            showToast('Facility name required', true);
            return;
        }

        api('/api/admin/trial-pin', {
            method: 'POST',
            body: { facility, maxUsers, trialDays: days, notes }
        }).then(d => {
            if (d.success && d.trial) {
                closeModal('createTrialModal');
                document.getElementById('trialFacility').value = '';
                document.getElementById('trialNotes').value = '';
                document.getElementById('trialCreatedFacility').textContent = d.trial.facility;
                document.getElementById('trialCreatedPin').textContent = d.trial.pin;
                document.getElementById('trialCreatedInfo').textContent = `${maxUsers} users ‚Ä¢ ${days} days ‚Ä¢ Expires ${formatDate(d.trial.expiresAt)}`;
                openModal('trialCreatedModal');
                loadTrials();
            } else {
                showToast(d.error || 'Error', true);
            }
        });
    }

    function copyTrialPin() {
        navigator.clipboard.writeText(document.getElementById('trialCreatedPin').textContent)
            .then(() => showToast('PIN copied!'));
    }

    window.copyPin = function(pin) {
        navigator.clipboard.writeText(pin).then(() => showToast('PIN ' + pin + ' copied!'));
    };

    window.extendTrialModal = function(id, facility) {
        document.getElementById('extendTrialId').value = id;
        document.getElementById('extendTrialFacility').textContent = facility;
        openModal('extendTrialModal');
    };

    function extendTrial() {
        const id = document.getElementById('extendTrialId').value;
        const days = parseInt(document.getElementById('extendTrialDays').value) || 7;

        api('/api/admin/trial-pin/' + id + '/extend', {
            method: 'POST',
            body: { days }
        }).then(d => {
            if (d.success) {
                closeModal('extendTrialModal');
                loadTrials();
                showToast('Extended by ' + days + ' days');
            } else {
                showToast(d.error || 'Error', true);
            }
        });
    }

    window.deleteTrialModal = function(id, facility) {
        document.getElementById('deleteTrialId').value = id;
        document.getElementById('deleteTrialText').innerHTML = `Delete trial for <strong style="color:var(--gold)">${facility}</strong>?`;
        openModal('deleteTrialModal');
    };

    function deleteTrial() {
        const id = document.getElementById('deleteTrialId').value;
        api('/api/admin/trial-pin/' + id, { method: 'DELETE' }).then(d => {
            if (d.success) {
                closeModal('deleteTrialModal');
                loadTrials();
                showToast('Trial deleted');
            } else {
                showToast(d.error || 'Error', true);
            }
        });
    }

    // ==================== NOTIFICATIONS ====================
    function loadNotifications() {
        api('/api/admin/notifications').then(d => {
            notifications = d.success ? d.notifications || [] : [];
            renderNotifications();
            updateNotificationStats();
        }).catch(() => {
            notifications = [];
            renderNotifications();
        });
    }

    function updateNotificationStats() {
        const total = notifications.length;
        const active = notifications.filter(n => n.status === 'active').length;
        const totalSeen = notifications.reduce((sum, n) => sum + (n.totalSeen || 0), 0);
        const totalExtended = notifications.reduce((sum, n) => sum + (n.trialsExtendedCount || 0), 0);

        document.getElementById('totalNotifications').textContent = total;
        document.getElementById('activeNotifications').textContent = active;
        document.getElementById('totalSeen').textContent = totalSeen;
        document.getElementById('totalExtended').textContent = totalExtended;

        // Update sidebar badge
        const badge = document.getElementById('notifBadge');
        if (active > 0) {
            badge.textContent = active;
            badge.style.display = 'inline';
        } else {
            badge.style.display = 'none';
        }
    }

    function renderNotifications() {
        const container = document.getElementById('notificationsList');

        if (!notifications.length) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üì¢</div>
                    <div class="empty-state-text">No updates sent yet</div>
                    <p style="color:var(--muted);font-size:0.85rem;margin-top:10px">Click "+ New Update" to send your first platform announcement!</p>
                </div>
            `;
            return;
        }

        let html = '';
        notifications.forEach(n => {
            const typeIcons = {
                update: 'üöÄ',
                announcement: 'üì£',
                maintenance: 'üîß',
                promotion: 'üéÅ'
            };
            const icon = typeIcons[n.type] || 'üì¢';
            const isExpired = n.status === 'expired';
            const extendedInfo = n.extendedTrials && n.trialsExtendedCount > 0 
                ? `<span class="update-history-badge">+3d ‚Üí ${n.trialsExtendedCount} trials</span>` 
                : '';
            
            html += `
                <div class="notification-card ${isExpired ? 'expired' : ''}">
                    <div class="notification-card-header">
                        <div class="notification-card-title">${icon} ${n.title}</div>
                        <div class="notification-card-meta">
                            <span class="badge badge-${n.type}">${n.type}</span>
                            <span class="badge badge-${n.status}">${n.status}</span>
                        </div>
                    </div>
                    <div class="notification-card-body">${n.message}</div>
                    <div class="notification-card-footer">
                        <div class="notification-card-stats">
                            <div class="notification-card-stat">
                                üëÅÔ∏è <strong>${n.totalSeen || 0}</strong> views
                            </div>
                            <div class="notification-card-stat">
                                üí≥ <strong>${n.seenBySubscribers || 0}</strong> subs
                            </div>
                            <div class="notification-card-stat">
                                üé´ <strong>${n.seenByTrials || 0}</strong> trials
                            </div>
                            ${n.extendedTrials && n.trialsExtendedCount > 0 ? `
                                <div class="notification-card-stat" style="color:var(--teal)">
                                    üéÅ <strong>+3d</strong> ‚Üí ${n.trialsExtendedCount} trials
                                </div>
                            ` : ''}
                        </div>
                        <div class="action-btns">
                            <button class="action-btn delete" onclick="deleteNotifModal('${n.id}','${n.title.replace(/'/g, "\\'")}')">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div style="font-size:0.7rem;color:var(--muted);margin-top:10px;padding-top:10px;border-top:1px solid var(--border);">
                        Sent: ${formatDateTime(n.createdAt)} ‚Ä¢ Expires: ${formatDate(n.expiresAt)}
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    function createNotification() {
        const title = document.getElementById('notifTitle').value.trim();
        const message = document.getElementById('notifMessage').value.trim();
        const type = document.getElementById('notifType').value;
        const expiresInDays = parseInt(document.getElementById('notifExpires').value) || 30;
        const extendTrials = document.getElementById('notifExtendTrials').checked;

        if (!title || !message) {
            showToast('Title and message required', true);
            return;
        }

        api('/api/admin/notifications', {
            method: 'POST',
            body: {
                title,
                message,
                type,
                expiresInDays,
                extendTrials,
                extendDays: 3  // Always 3 days
            }
        }).then(d => {
            if (d.success) {
                closeModal('createNotificationModal');
                
                // Clear form
                document.getElementById('notifTitle').value = '';
                document.getElementById('notifMessage').value = '';
                document.getElementById('notifExtendTrials').checked = false;

                // Show success modal
                document.getElementById('notifSentTitle').textContent = title;
                document.getElementById('notifSentText').textContent = 'Users will see this modal on their next login.';
                
                // Show extension info if applicable
                const extendInfo = document.getElementById('notifSentExtendInfo');
                const extendDetails = document.getElementById('notifSentExtendDetails');
                if (d.trialsExtended > 0) {
                    extendInfo.style.display = 'block';
                    extendDetails.textContent = `+3 bonus days added to ${d.trialsExtended} active trial${d.trialsExtended > 1 ? 's' : ''}!`;
                } else if (extendTrials) {
                    extendInfo.style.display = 'block';
                    extendDetails.textContent = 'No active trials to extend at this time.';
                } else {
                    extendInfo.style.display = 'none';
                }
                
                openModal('notificationSentModal');

                loadNotifications();
                loadTrials();
                loadActivity();
            } else {
                showToast(d.error || 'Error', true);
            }
        });
    }

    window.deleteNotifModal = function(id, title) {
        document.getElementById('deleteNotifId').value = id;
        document.getElementById('deleteNotifText').innerHTML = `Delete update <strong style="color:var(--gold)">"${title}"</strong>?`;
        openModal('deleteNotificationModal');
    };

    function deleteNotification() {
        const id = document.getElementById('deleteNotifId').value;
        api('/api/admin/notifications/' + id, { method: 'DELETE' }).then(d => {
            if (d.success) {
                closeModal('deleteNotificationModal');
                loadNotifications();
                showToast('Notification deleted');
            } else {
                showToast(d.error || 'Error', true);
            }
        });
    }

    // ==================== ACTIVITY ====================
    function loadActivity() {
        api('/api/admin/activity').then(d => {
            activities = d.success ? d.activities || [] : [];
            renderActivity();
            renderOverviewActivity();
            updateActivityStats();
        }).catch(() => {
            activities = [];
            renderActivity();
        });
    }

    function updateActivityStats() {
        const now = Date.now();
        const todayStart = new Date().setHours(0, 0, 0, 0);
        const weekStart = todayStart - (new Date().getDay() * 86400000);

        let courtsToday = 0, courtsWeek = 0, newSubsWeek = 0, laughsToday = 0;

        activities.forEach(a => {
            const ts = new Date(a.timestamp).getTime();
            if (ts >= todayStart) {
                if (a.type === 'court_session' || a.type === 'game_session') courtsToday++;
                laughsToday += a.laughs || 0;
            }
            if (ts >= weekStart) {
                if (a.type === 'court_session' || a.type === 'game_session') courtsWeek++;
                if (a.type && a.type.includes('subscription_created')) newSubsWeek++;
            }
        });

        document.getElementById('courtsToday').textContent = courtsToday;
        document.getElementById('courtsWeek').textContent = courtsWeek;
        document.getElementById('newSubsWeek').textContent = newSubsWeek;
        document.getElementById('laughsToday').textContent = laughsToday;
    }

    function getActivityIcon(a) {
        if (a.type && a.type.includes('notification')) return { icon: 'üì¢', cls: 'notification' };
        if (a.type && a.type.includes('subscription')) return { icon: 'üí≥', cls: 'subscription' };
        if (a.type && a.type.includes('trial')) return { icon: 'üé´', cls: 'trial' };
        
        const court = a.court || a.game || '';
        if (court === 'therecall' || court === 'laughtrail') return { icon: 'üß†', cls: 'recall' };
        if (court === 'thematch') return { icon: 'üéØ', cls: 'match' };
        if (court === 'thedrill') return { icon: 'üèÄ', cls: 'drill' };
        if (court === 'thereflex') return { icon: '‚ö°', cls: 'reflex' };
        if (court === 'theritmo') return { icon: 'üéµ', cls: 'ritmo' };
        
        return { icon: 'üèÄ', cls: 'recall' };
    }

    function renderActivity() {
        const container = document.getElementById('activityList');

        if (!activities.length) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text">No activity yet</div></div>';
            return;
        }

        let html = '';
        activities.slice(0, 50).forEach(a => {
            const { icon, cls } = getActivityIcon(a);
            html += `
                <div class="aggregated-item">
                    <div class="aggregated-icon ${cls}">${icon}</div>
                    <div class="aggregated-content">
                        <div class="aggregated-text">
                            ${a.username || a.email ? `<strong>${a.username || a.email}</strong> - ` : ''}
                            ${a.details || a.type || 'Activity'}
                            ${a.laughs ? ` <span style="color:var(--pink)">üòÇ+${a.laughs}</span>` : ''}
                        </div>
                        <div class="aggregated-details">${formatTimeAgo(a.timestamp)}</div>
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    function renderOverviewActivity() {
        const container = document.getElementById('overviewActivity');

        if (!activities.length) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text">No activity yet</div></div>';
            return;
        }

        let html = '';
        activities.slice(0, 5).forEach(a => {
            const { icon, cls } = getActivityIcon(a);
            html += `
                <div class="aggregated-item">
                    <div class="aggregated-icon ${cls}">${icon}</div>
                    <div class="aggregated-content">
                        <div class="aggregated-text">
                            ${a.username ? `<strong>${a.username}</strong> - ` : ''}
                            ${a.details || a.type}
                        </div>
                        <div class="aggregated-details">${formatTimeAgo(a.timestamp)}</div>
                    </div>
                </div>
            `;
        });
        container.innerHTML = html;
    }

    function clearAllActivity() {
        api('/api/admin/activity/all', { method: 'DELETE' }).then(() => {
            closeModal('clearActivityModal');
            loadActivity();
            showToast('Activity cleared');
        });
    }

    // ==================== INIT ====================
    init();
})();
</script>
</body>
</html>
