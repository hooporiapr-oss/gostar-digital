<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | LaughCourt‚Ñ¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
    --orange: #FF6B00;
    --orange-dark: #CC5500;
    --teal: #00D9A5;
    --gold: #FFD700;
    --purple: #6B21A8;
    --pink: #E91E8C;
    --blue: #3B82F6;
    --dark: #0a0a0f;
    --darker: #050508;
    --card: #111118;
    --card-hover: #1a1a24;
    --text: #FFFFFF;
    --muted: #8892a0;
    --border: rgba(255,255,255,0.08);
    --success: #00D9A5;
    --danger: #FF4757;
    --trail: #FF6B00;
    --hunt: #E91E8C;
    --sidebar: 260px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Outfit', sans-serif;
    background: var(--dark);
    color: var(--text);
    min-height: 100vh;
}

body.es .lang-en { display: none !important; }
body.en .lang-es { display: none !important; }

.login-screen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.login-screen.hidden { display: none; }

.login-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 48px 40px;
    width: 100%;
    max-width: 380px;
    text-align: center;
}

.login-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.5rem;
    letter-spacing: 4px;
    margin-bottom: 10px;
}

.login-logo .laugh { color: var(--gold); }
.login-logo .court { color: var(--text); }

.login-badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--dark);
    background: var(--gold);
    padding: 5px 15px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 30px;
}

.login-subtitle {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 30px;
}

.pin-input-group {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 24px;
}

.pin-input {
    width: 60px;
    height: 72px;
    font-size: 1.8rem;
    font-weight: 700;
    font-family: 'Bebas Neue', sans-serif;
    text-align: center;
    background: var(--darker);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    transition: all 0.2s;
}

.pin-input:focus {
    outline: none;
    border-color: var(--gold);
    box-shadow: 0 0 20px rgba(255,215,0,0.2);
}

.login-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--gold), #FFA500);
    color: var(--dark);
    border: none;
    border-radius: 12px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.3s;
    font-weight: 700;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 25px rgba(255,215,0,0.4);
}

.login-error {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 15px;
    display: none;
}

.login-error.show { display: block; }

.dashboard { display: none; min-height: 100vh; }
.dashboard.visible { display: flex; }

.sidebar {
    width: var(--sidebar);
    background: var(--darker);
    border-right: 1px solid var(--border);
    padding: 24px 0;
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
}

.sidebar-header {
    padding: 0 24px 24px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 20px;
}

.sidebar-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    letter-spacing: 3px;
    margin-bottom: 5px;
}

.sidebar-logo .laugh { color: var(--gold); }
.sidebar-logo .court { color: var(--text); }

.sidebar-team {
    font-size: 0.75rem;
    color: var(--muted);
    margin-bottom: 10px;
}

.admin-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--gold), var(--orange));
    color: var(--dark);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.nav-section { padding: 0 12px; margin-bottom: 20px; }

.nav-section-title {
    font-size: 0.65rem;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0 16px;
    margin-bottom: 10px;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    padding: 12px 16px;
    border: none;
    background: transparent;
    border-radius: 10px;
    color: var(--muted);
    font-family: 'Outfit', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    margin-bottom: 4px;
}

.nav-item:hover { background: var(--card); color: var(--text); }
.nav-item.active { background: var(--gold); color: var(--dark); }
.nav-item-icon { font-size: 1.1rem; width: 24px; text-align: center; }

.sidebar-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border);
    margin-top: auto;
}

.lang-toggle {
    display: flex;
    gap: 8px;
    background: var(--card);
    padding: 4px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.lang-btn {
    flex: 1;
    padding: 8px;
    border: none;
    background: transparent;
    color: var(--muted);
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
}

.lang-btn.active { background: var(--gold); color: var(--dark); }

.logout-btn {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Outfit', sans-serif;
}

.logout-btn:hover { border-color: var(--danger); color: var(--danger); }

.main-content { flex: 1; margin-left: var(--sidebar); padding: 30px; max-width: 1400px; }
.page-header { margin-bottom: 30px; }
.page-title { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; letter-spacing: 3px; margin-bottom: 5px; }
.page-subtitle { font-size: 0.9rem; color: var(--muted); }
.page-section { display: none; }
.page-section.active { display: block; }

.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }

.stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s;
}

.stat-card:hover { transform: translateY(-3px); border-color: var(--gold); }

.stat-card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 15px;
}

.stat-card-icon.gold { background: rgba(255,215,0,0.15); }
.stat-card-icon.teal { background: rgba(0,217,165,0.15); }
.stat-card-icon.orange { background: rgba(255,107,0,0.15); }
.stat-card-icon.pink { background: rgba(233,30,140,0.15); }
.stat-card-icon.purple { background: rgba(107,33,168,0.15); }
.stat-card-value { font-family: 'Bebas Neue', sans-serif; font-size: 2.2rem; letter-spacing: 2px; margin-bottom: 5px; }
.stat-card-label { font-size: 0.8rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }

.game-cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }

.game-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s;
}

.game-card:hover { transform: translateY(-3px); }

.game-card-header { padding: 16px 20px; display: flex; align-items: center; gap: 12px; }
.game-card-header.trail { background: linear-gradient(135deg, rgba(255,107,0,0.2), transparent); border-bottom: 2px solid var(--trail); }
.game-card-header.hunt { background: linear-gradient(135deg, rgba(233,30,140,0.2), transparent); border-bottom: 2px solid var(--hunt); }
.game-card-icon { font-size: 1.5rem; }
.game-card-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; flex: 1; }

.game-card-body { padding: 20px; }
.game-card-stats { display: flex; gap: 20px; }
.game-stat { text-align: center; flex: 1; }
.game-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; }
.game-stat-label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; }

.table-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; margin-bottom: 30px; }
.table-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
.table-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 2px; }
.table-actions { display: flex; gap: 10px; }
.btn { padding: 10px 20px; border: none; border-radius: 10px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; font-family: 'Outfit', sans-serif; }
.btn-primary { background: var(--gold); color: var(--dark); }
.btn-primary:hover { background: #e6c200; }
.btn-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text); }
.btn-secondary:hover { border-color: var(--gold); }
.btn-danger { background: transparent; border: 1px solid var(--danger); color: var(--danger); }
.btn-danger:hover { background: var(--danger); color: var(--text); }

.table-container { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 14px 20px; text-align: left; border-bottom: 1px solid var(--border); }
th { font-size: 0.75rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; background: var(--darker); }
td { font-size: 0.9rem; }
tr:hover { background: var(--card-hover); }

.badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
.badge-trial, .badge-trialing { background: rgba(107,33,168,0.15); color: var(--purple); }
.badge-paid, .badge-active { background: rgba(0,217,165,0.15); color: var(--teal); }
.badge-canceled { background: rgba(255,71,87,0.15); color: var(--danger); }
.badge-past_due { background: rgba(255,215,0,0.15); color: var(--gold); }

.tier-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; border-radius: 6px; font-size: 0.65rem; font-weight: 700; }
.tier-badge.tier-1, .tier-badge.tier-2, .tier-badge.tier-3 { background: rgba(107,33,168,0.2); color: #b57edc; }
.tier-badge.tier-4, .tier-badge.tier-5 { background: rgba(255,215,0,0.2); color: var(--gold); }
.tier-badge.tier-6, .tier-badge.tier-7 { background: rgba(255,107,0,0.2); color: var(--orange); }
.tier-badge.tier-8, .tier-badge.tier-9 { background: rgba(0,217,165,0.2); color: var(--teal); }
.tier-badge.tier-10 { background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,107,0,0.3)); color: var(--gold); }

.action-btns { display: flex; gap: 6px; }

.action-btn {
    width: 32px;
    height: 32px;
    border: 1px solid var(--border);
    background: transparent;
    border-radius: 8px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

.action-btn:hover { border-color: var(--gold); color: var(--gold); }
.action-btn.delete:hover { border-color: var(--danger); color: var(--danger); }

.activity-list { padding: 0; }

.activity-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    transition: background 0.2s;
}

.activity-item:last-child { border-bottom: none; }
.activity-item:hover { background: var(--card-hover); }

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.activity-icon.subscription { background: rgba(255,215,0,0.15); color: var(--gold); }
.activity-icon.game { background: rgba(255,107,0,0.15); color: var(--orange); }
.activity-icon.milestone { background: rgba(0,217,165,0.15); color: var(--teal); }
.activity-content { flex: 1; }
.activity-text { font-size: 0.9rem; margin-bottom: 3px; }
.activity-time { font-size: 0.75rem; color: var(--muted); }

.modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}

.modal-overlay.show { display: flex; }

.modal {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 2px; }

.modal-close {
    width: 36px;
    height: 36px;
    border: none;
    background: var(--darker);
    border-radius: 10px;
    color: var(--muted);
    font-size: 1.2rem;
    cursor: pointer;
}

.modal-close:hover { color: var(--danger); }
.modal-body { padding: 24px; }
.form-group { margin-bottom: 20px; }
.form-label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }

.form-input, .form-select {
    width: 100%;
    padding: 14px 16px;
    background: var(--darker);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-size: 0.95rem;
    font-family: 'Outfit', sans-serif;
}

.form-input:focus, .form-select:focus { outline: none; border-color: var(--gold); }
.modal-footer { padding: 20px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }
.confirm-dialog { text-align: center; padding: 20px 0; }
.confirm-dialog-icon { font-size: 3rem; margin-bottom: 15px; }
.confirm-dialog-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 2px; margin-bottom: 10px; }
.confirm-dialog-text { color: var(--muted); font-size: 0.9rem; margin-bottom: 5px; }

.toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--card);
    border: 1px solid var(--teal);
    border-radius: 12px;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s;
    z-index: 2000;
}

.toast.show { transform: translateY(0); opacity: 1; }
.toast.error { border-color: var(--danger); }
.toast-icon { font-size: 1.2rem; }
.toast-text { font-size: 0.9rem; }

.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid var(--muted);
    border-top-color: var(--gold);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
}

.empty-state-icon { font-size: 3rem; margin-bottom: 15px; }
.empty-state-text { font-size: 1rem; }

tr.clickable { cursor: pointer; transition: background 0.2s; }
tr.clickable:hover { background: var(--card-hover); }

.subscriber-detail-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
}

.subscriber-avatar {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, var(--gold), var(--orange));
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: var(--dark);
    font-weight: 700;
}

.subscriber-info h4 { font-size: 1.2rem; margin-bottom: 5px; }
.subscriber-info p { font-size: 0.85rem; color: var(--muted); }

.subscriber-stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
    margin-bottom: 25px;
}

.subscriber-stat {
    background: var(--darker);
    border-radius: 12px;
    padding: 15px;
    text-align: center;
}

.subscriber-stat-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    color: var(--gold);
}

.subscriber-stat-label {
    font-size: 0.7rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.game-scores-section h5 {
    font-size: 0.85rem;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 15px;
}

.game-score-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 15px;
    background: var(--darker);
    border-radius: 10px;
    margin-bottom: 10px;
}

.game-score-name {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
}

.game-score-name span.icon { font-size: 1.2rem; }

.game-score-stats {
    display: flex;
    align-items: center;
    gap: 15px;
}

.game-score-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.3rem;
    color: var(--text);
}

.aggregated-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    transition: background 0.2s;
}

.aggregated-item:last-child { border-bottom: none; }
.aggregated-item:hover { background: var(--card-hover); }

.aggregated-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.aggregated-icon.game { background: rgba(255,107,0,0.15); color: var(--orange); }
.aggregated-icon.subscription { background: rgba(255,215,0,0.15); color: var(--gold); }
.aggregated-icon.milestone { background: rgba(0,217,165,0.15); color: var(--teal); }
.aggregated-icon.laugh { background: rgba(233,30,140,0.15); color: var(--pink); }

.aggregated-content { flex: 1; }
.aggregated-text { font-size: 0.9rem; }
.aggregated-details { font-size: 0.75rem; color: var(--muted); margin-top: 2px; }

.milestone-badge {
    background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,107,0,0.2));
    color: var(--gold);
    padding: 3px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 700;
}

@media (max-width: 1024px) {
    .sidebar { width: 80px; padding: 15px 0; }
    .sidebar-header { padding: 0 10px 15px; }
    .sidebar-logo span, .sidebar-team, .nav-item span:not(.nav-item-icon), .nav-section-title, .sidebar-footer .lang-toggle, .logout-btn span { display: none; }
    .nav-item { justify-content: center; padding: 12px; }
    .nav-item-icon { margin: 0; }
    .main-content { margin-left: 80px; }
}

@media (max-width: 768px) {
    .sidebar { display: none; }
    .main-content { margin-left: 0; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
}
</style>
</head>
<body class="en">

<div class="login-screen" id="loginScreen">
    <div class="login-card">
        <div class="login-logo"><span class="laugh">LAUGH</span><span class="court">COURT</span></div>
        <div class="login-badge">Coach Admin Portal</div>
        <p class="login-subtitle">
            <span class="lang-en">Enter your 4-digit admin PIN</span>
            <span class="lang-es">Ingresa tu PIN de 4 d√≠gitos</span>
        </p>
        <div class="pin-input-group">
            <input type="password" class="pin-input" maxlength="1" id="pin1" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin2" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin3" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin4" inputmode="numeric">
        </div>
        <button class="login-btn" id="loginBtn">
            <span class="lang-en">ACCESS DASHBOARD</span>
            <span class="lang-es">ACCEDER</span>
        </button>
        <p class="login-error" id="loginError">
            <span class="lang-en">Invalid PIN</span>
            <span class="lang-es">PIN inv√°lido</span>
        </p>
    </div>
</div>

<div class="dashboard" id="dashboard">
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo"><span class="laugh">LAUGH</span><span class="court">COURT</span></div>
            <div class="sidebar-team">Coach Admin</div>
            <span class="admin-badge">üèÄ Admin</span>
        </div>
        <nav class="nav-section">
            <div class="nav-section-title">
                <span class="lang-en">Dashboard</span>
                <span class="lang-es">Panel</span>
            </div>
            <button class="nav-item active" data-page="overview">
                <span class="nav-item-icon">üìä</span>
                <span class="lang-en">Overview</span>
                <span class="lang-es">Resumen</span>
            </button>
            <button class="nav-item" data-page="subscribers">
                <span class="nav-item-icon">üí≥</span>
                <span class="lang-en">Subscribers</span>
                <span class="lang-es">Suscriptores</span>
            </button>
            <button class="nav-item" data-page="activity">
                <span class="nav-item-icon">üìã</span>
                <span class="lang-en">Activity</span>
                <span class="lang-es">Actividad</span>
            </button>
        </nav>
        <div class="sidebar-footer">
            <div class="lang-toggle">
                <button class="lang-btn active" id="btnEn">EN</button>
                <button class="lang-btn" id="btnEs">ES</button>
            </div>
            <button class="logout-btn" id="logoutBtn">üö™ 
                <span class="lang-en">Logout</span>
                <span class="lang-es">Salir</span>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <!-- OVERVIEW PAGE -->
        <section class="page-section active" id="page-overview">
            <header class="page-header">
                <h1 class="page-title">LAUGHCOURT ADMIN</h1>
                <p class="page-subtitle">
                    <span class="lang-en">Platform Overview ‚Ä¢ Subscribers & Games</span>
                    <span class="lang-es">Resumen de Plataforma ‚Ä¢ Suscriptores y Juegos</span>
                </p>
            </header>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon gold">üí≥</div>
                    <div class="stat-card-value" id="totalSubscribers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Subscribers</span>
                        <span class="lang-es">Suscriptores</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon teal">‚úÖ</div>
                    <div class="stat-card-value" id="activeSubscribers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Active</span>
                        <span class="lang-es">Activos</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon purple">üÜì</div>
                    <div class="stat-card-value" id="trialingSubscribers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Trialing</span>
                        <span class="lang-es">En Prueba</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon pink">üòÇ</div>
                    <div class="stat-card-value" id="totalLaughs">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Total Laughs</span>
                        <span class="lang-es">Risas Totales</span>
                    </div>
                </div>
            </div>
            
            <div class="game-cards-grid">
                <div class="game-card">
                    <div class="game-card-header trail">
                        <div class="game-card-icon">üõ§Ô∏è</div>
                        <div class="game-card-title">LAUGH TRAIL</div>
                    </div>
                    <div class="game-card-body">
                        <div class="game-card-stats">
                            <div class="game-stat">
                                <div class="game-stat-value" id="trailSessions">0</div>
                                <div class="game-stat-label"><span class="lang-en">Sessions</span><span class="lang-es">Sesiones</span></div>
                            </div>
                            <div class="game-stat">
                                <div class="game-stat-value" id="trailBestRound">0</div>
                                <div class="game-stat-label"><span class="lang-en">Best Round</span><span class="lang-es">Mejor Ronda</span></div>
                            </div>
                            <div class="game-stat">
                                <div class="game-stat-value" id="trailLaughs">0</div>
                                <div class="game-stat-label">üòÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="game-card">
                    <div class="game-card-header hunt">
                        <div class="game-card-icon">üîç</div>
                        <div class="game-card-title">LAUGH HUNT</div>
                    </div>
                    <div class="game-card-body">
                        <div class="game-card-stats">
                            <div class="game-stat">
                                <div class="game-stat-value" id="huntSessions">0</div>
                                <div class="game-stat-label"><span class="lang-en">Sessions</span><span class="lang-es">Sesiones</span></div>
                            </div>
                            <div class="game-stat">
                                <div class="game-stat-value" id="huntBestTier">0</div>
                                <div class="game-stat-label"><span class="lang-en">Best Tier</span><span class="lang-es">Mejor Nivel</span></div>
                            </div>
                            <div class="game-stat">
                                <div class="game-stat-value" id="huntLaughs">0</div>
                                <div class="game-stat-label">üòÇ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">
                        <span class="lang-en">RECENT ACTIVITY</span>
                        <span class="lang-es">ACTIVIDAD RECIENTE</span>
                    </h3>
                </div>
                <div class="activity-list" id="overviewActivity"></div>
            </div>
        </section>

        <!-- SUBSCRIBERS PAGE -->
        <section class="page-section" id="page-subscribers">
            <header class="page-header">
                <h1 class="page-title">
                    <span class="lang-en">SUBSCRIBERS</span>
                    <span class="lang-es">SUSCRIPTORES</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">Stripe subscription management ‚Ä¢ Click user for details</span>
                    <span class="lang-es">Gesti√≥n de suscripciones Stripe ‚Ä¢ Haz clic en usuario para detalles</span>
                </p>
            </header>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon teal">‚úÖ</div>
                    <div class="stat-card-value" id="activeCount">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Active</span>
                        <span class="lang-es">Activos</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon purple">üÜì</div>
                    <div class="stat-card-value" id="trialCount">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Trialing</span>
                        <span class="lang-es">En Prueba</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon orange">üî•</div>
                    <div class="stat-card-value" id="streakLeader">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Best Streak</span>
                        <span class="lang-es">Mejor Racha</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon pink">üòÇ</div>
                    <div class="stat-card-value" id="laughLeader">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Most Laughs</span>
                        <span class="lang-es">M√°s Risas</span>
                    </div>
                </div>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">ALL SUBSCRIBERS</h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refreshSubscribersBtn">üîÑ 
                            <span class="lang-en">Refresh</span>
                            <span class="lang-es">Actualizar</span>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>PIN</th>
                                <th><span class="lang-en">Status</span><span class="lang-es">Estado</span></th>
                                <th>üòÇ <span class="lang-en">Laughs</span><span class="lang-es">Risas</span></th>
                                <th>üõ§Ô∏è Trail</th>
                                <th>üîç Hunt</th>
                                <th><span class="lang-en">Streak</span><span class="lang-es">Racha</span></th>
                                <th><span class="lang-en">Last Active</span><span class="lang-es">√öltima Vez</span></th>
                            </tr>
                        </thead>
                        <tbody id="subscribersTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ACTIVITY PAGE -->
        <section class="page-section" id="page-activity">
            <header class="page-header">
                <h1 class="page-title">
                    <span class="lang-en">ACTIVITY LOG</span>
                    <span class="lang-es">REGISTRO DE ACTIVIDAD</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">Platform activity ‚Ä¢ Games & Subscriptions</span>
                    <span class="lang-es">Actividad de la plataforma ‚Ä¢ Juegos y Suscripciones</span>
                </p>
            </header>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon orange">üéÆ</div>
                    <div class="stat-card-value" id="gamesToday">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Games Today</span>
                        <span class="lang-es">Juegos Hoy</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon teal">üìÖ</div>
                    <div class="stat-card-value" id="gamesWeek">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">This Week</span>
                        <span class="lang-es">Esta Semana</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon gold">üÜï</div>
                    <div class="stat-card-value" id="newSubsWeek">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">New Subs</span>
                        <span class="lang-es">Nuevos Subs</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon pink">üòÇ</div>
                    <div class="stat-card-value" id="laughsToday">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Laughs Today</span>
                        <span class="lang-es">Risas Hoy</span>
                    </div>
                </div>
            </div>
            
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">
                        <span class="lang-en">ALL ACTIVITY</span>
                        <span class="lang-es">TODA LA ACTIVIDAD</span>
                    </h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refreshActivityBtn">üîÑ 
                            <span class="lang-en">Refresh</span>
                            <span class="lang-es">Actualizar</span>
                        </button>
                        <button class="btn btn-danger" id="clearAllActivityBtn">üóëÔ∏è 
                            <span class="lang-en">Clear All</span>
                            <span class="lang-es">Limpiar Todo</span>
                        </button>
                    </div>
                </div>
                <div class="activity-list" id="activityList"></div>
            </div>
        </section>
    </main>
</div>

<div class="modal-overlay" id="subscriberModal">
    <div class="modal" style="max-width:560px">
        <div class="modal-header">
            <h3 class="modal-title" id="subscriberModalTitle">SUBSCRIBER DETAILS</h3>
            <button class="modal-close" data-close="subscriberModal">√ó</button>
        </div>
        <div class="modal-body" id="subscriberModalBody">
            <div class="loading-spinner"></div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="editSubscriberModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">EDIT SUBSCRIBER</h3>
            <button class="modal-close" data-close="editSubscriberModal">√ó</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="editSubPin">
            <div class="form-group">
                <label class="form-label">Email</label>
                <input type="email" class="form-input" id="editSubEmail" placeholder="email@example.com">
            </div>
            <div class="form-group">
                <label class="form-label">PIN</label>
                <input type="text" class="form-input" id="editSubNewPin" maxlength="4" placeholder="4-digit PIN">
            </div>
            <div class="form-group">
                <label class="form-label"><span class="lang-en">Status</span><span class="lang-es">Estado</span></label>
                <select class="form-select" id="editSubStatus">
                    <option value="active">Active</option>
                    <option value="trialing">Trialing</option>
                    <option value="canceled">Canceled</option>
                    <option value="past_due">Past Due</option>
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="editSubscriberModal"><span class="lang-en">Cancel</span><span class="lang-es">Cancelar</span></button>
            <button class="btn btn-primary" id="saveSubscriberBtn"><span class="lang-en">Save</span><span class="lang-es">Guardar</span></button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="deleteSubscriberModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title"><span class="lang-en">DELETE SUBSCRIBER</span><span class="lang-es">ELIMINAR SUSCRIPTOR</span></h3>
            <button class="modal-close" data-close="deleteSubscriberModal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">‚ö†Ô∏è</div>
                <div class="confirm-dialog-title"><span class="lang-en">ARE YOU SURE?</span><span class="lang-es">¬øEST√ÅS SEGURO?</span></div>
                <div class="confirm-dialog-text" id="deleteSubscriberText"></div>
                <p style="color:var(--danger);font-size:0.85rem;margin-top:15px">
                    <span class="lang-en">This action cannot be undone.</span>
                    <span class="lang-es">Esta acci√≥n no se puede deshacer.</span>
                </p>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="deleteSubscriberModal"><span class="lang-en">Cancel</span><span class="lang-es">Cancelar</span></button>
            <button class="btn btn-danger" id="confirmDeleteSubscriberBtn"><span class="lang-en">Delete</span><span class="lang-es">Eliminar</span></button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="clearActivityModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title"><span class="lang-en">CLEAR ALL ACTIVITY</span><span class="lang-es">LIMPIAR ACTIVIDAD</span></h3>
            <button class="modal-close" data-close="clearActivityModal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">üóëÔ∏è</div>
                <div class="confirm-dialog-title"><span class="lang-en">DELETE ALL ACTIVITY?</span><span class="lang-es">¬øELIMINAR TODA LA ACTIVIDAD?</span></div>
                <div class="confirm-dialog-text">
                    <span class="lang-en">This will permanently delete all activity logs.</span>
                    <span class="lang-es">Esto eliminar√° permanentemente todos los registros.</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="clearActivityModal"><span class="lang-en">Cancel</span><span class="lang-es">Cancelar</span></button>
            <button class="btn btn-danger" id="confirmClearActivityBtn"><span class="lang-en">Delete All</span><span class="lang-es">Eliminar Todo</span></button>
        </div>
    </div>
</div>

<div class="toast" id="toast">
    <span class="toast-icon" id="toastIcon">‚úì</span>
    <span class="toast-text" id="toastText">Saved</span>
</div>

<script>
(function() {
    'use strict';

    var authToken = null;
    var subscribers = [];
    var activities = [];
    var currentLang = localStorage.getItem('lc-admin-lang') || 'en';

    function init() {
        setLang(currentLang);
        setupPinInputs();
        setupEventListeners();
        
        var savedToken = sessionStorage.getItem('laughcourt-admin-token');
        if (savedToken) {
            verifyToken(savedToken);
        }
    }

    function setLang(lang) {
        currentLang = lang;
        localStorage.setItem('lc-admin-lang', lang);
        document.body.className = lang;
        document.getElementById('btnEn').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('btnEs').className = lang === 'es' ? 'lang-btn active' : 'lang-btn';
    }

    function setupPinInputs() {
        var pins = [document.getElementById('pin1'), document.getElementById('pin2'), document.getElementById('pin3'), document.getElementById('pin4')];
        pins.forEach(function(input, idx) {
            input.addEventListener('input', function() { 
                if (this.value.length === 1 && idx < 3) pins[idx + 1].focus(); 
            });
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value === '' && idx > 0) pins[idx - 1].focus();
                if (e.key === 'Enter') attemptLogin();
            });
        });
        pins[0].focus();
    }

    function attemptLogin() {
        var pin = '';
        for (var i = 1; i <= 4; i++) pin += document.getElementById('pin' + i).value;
        
        if (pin.length !== 4) return;
        
        fetch('/api/admin/verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pin: pin })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success && data.token) {
                authToken = data.token;
                sessionStorage.setItem('laughcourt-admin-token', authToken);
                showDashboard();
            } else {
                showLoginError();
            }
        })
        .catch(function(err) {
            console.error('Login error:', err);
            showLoginError();
        });
    }

    function verifyToken(token) {
        fetch('/api/admin/verify-token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: token })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success) {
                authToken = token;
                showDashboard();
            } else {
                sessionStorage.removeItem('laughcourt-admin-token');
            }
        })
        .catch(function() {
            sessionStorage.removeItem('laughcourt-admin-token');
        });
    }

    function showLoginError() {
        document.getElementById('loginError').classList.add('show');
        for (var i = 1; i <= 4; i++) document.getElementById('pin' + i).value = '';
        document.getElementById('pin1').focus();
        setTimeout(function() { document.getElementById('loginError').classList.remove('show'); }, 3000);
    }

    function showDashboard() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.add('visible');
        loadAllData();
    }

    function logout() {
        authToken = null;
        sessionStorage.removeItem('laughcourt-admin-token');
        document.getElementById('dashboard').classList.remove('visible');
        document.getElementById('loginScreen').classList.remove('hidden');
        for (var i = 1; i <= 4; i++) document.getElementById('pin' + i).value = '';
        document.getElementById('pin1').focus();
    }

    function setupEventListeners() {
        document.getElementById('loginBtn').addEventListener('click', attemptLogin);
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('btnEn').addEventListener('click', function() { setLang('en'); });
        document.getElementById('btnEs').addEventListener('click', function() { setLang('es'); });

        document.querySelectorAll('.nav-item').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var page = this.getAttribute('data-page');
                showPage(page);
                document.querySelectorAll('.nav-item').forEach(function(n) { n.classList.remove('active'); });
                this.classList.add('active');
            });
        });

        document.querySelectorAll('[data-close]').forEach(function(btn) {
            btn.addEventListener('click', function() { closeModal(this.getAttribute('data-close')); });
        });

        document.getElementById('refreshSubscribersBtn').addEventListener('click', loadSubscribers);
        document.getElementById('refreshActivityBtn').addEventListener('click', loadActivity);
        document.getElementById('clearAllActivityBtn').addEventListener('click', function() { openModal('clearActivityModal'); });
        document.getElementById('confirmClearActivityBtn').addEventListener('click', clearAllActivity);
        document.getElementById('saveSubscriberBtn').addEventListener('click', saveSubscriber);
        document.getElementById('confirmDeleteSubscriberBtn').addEventListener('click', confirmDeleteSubscriber);

        document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
            overlay.addEventListener('click', function(e) { if (e.target === overlay) overlay.classList.remove('show'); });
        });
    }

    function showPage(page) {
        document.querySelectorAll('.page-section').forEach(function(s) { s.classList.remove('active'); });
        document.getElementById('page-' + page).classList.add('active');
    }

    function openModal(id) { document.getElementById(id).classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    function showToast(message, isError) {
        var toast = document.getElementById('toast');
        document.getElementById('toastText').textContent = message;
        document.getElementById('toastIcon').textContent = isError ? '‚úó' : '‚úì';
        toast.classList.toggle('error', isError);
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 3000);
    }

    function apiGet(endpoint) {
        return fetch(endpoint, {
            headers: { 'Authorization': 'Bearer ' + authToken }
        }).then(function(res) { return res.json(); });
    }

    function loadAllData() {
        loadSubscribers();
        loadActivity();
    }

    function loadSubscribers() {
        apiGet('/api/admin/subscribers')
            .then(function(data) {
                if (data.success) {
                    subscribers = data.subscribers || [];
                    renderSubscribers();
                    updateStats();
                }
            })
            .catch(function(err) {
                console.error('Error loading subscribers:', err);
                subscribers = [];
                renderSubscribers();
            });
    }

    function loadActivity() {
        apiGet('/api/admin/activity')
            .then(function(data) {
                if (data.success) {
                    activities = data.activities || [];
                    renderActivity();
                    renderOverviewActivity();
                    updateActivityStats();
                }
            })
            .catch(function(err) {
                console.error('Error loading activity:', err);
                activities = [];
                renderActivity();
            });
    }

    function updateStats() {
        var total = subscribers.length;
        var active = subscribers.filter(function(s) { return s.status === 'active'; }).length;
        var trialing = subscribers.filter(function(s) { return s.status === 'trialing'; }).length;
        
        var totalLaughs = 0;
        var trailSessions = 0;
        var huntSessions = 0;
        var trailLaughs = 0;
        var huntLaughs = 0;
        var bestStreak = 0;
        var mostLaughs = 0;
        var bestTrailRound = 0;
        var bestHuntTier = 0;
        
        subscribers.forEach(function(s) {
            var laughs = s.totalLaughs || 0;
            totalLaughs += laughs;
            if (laughs > mostLaughs) mostLaughs = laughs;
            if ((s.streak || 0) > bestStreak) bestStreak = s.streak;
            
            if (s.games) {
                if (s.games.laughtrail) {
                    trailSessions += s.games.laughtrail.sessions || 0;
                    trailLaughs += s.games.laughtrail.laughs || 0;
                    if ((s.games.laughtrail.bestRound || 0) > bestTrailRound) bestTrailRound = s.games.laughtrail.bestRound;
                }
                if (s.games.laughhunt) {
                    huntSessions += s.games.laughhunt.sessions || 0;
                    huntLaughs += s.games.laughhunt.laughs || 0;
                    if ((s.games.laughhunt.bestTier || 0) > bestHuntTier) bestHuntTier = s.games.laughhunt.bestTier;
                }
            }
        });

        document.getElementById('totalSubscribers').textContent = total;
        document.getElementById('activeSubscribers').textContent = active;
        document.getElementById('trialingSubscribers').textContent = trialing;
        document.getElementById('totalLaughs').textContent = totalLaughs;
        
        document.getElementById('trailSessions').textContent = trailSessions;
        document.getElementById('trailBestRound').textContent = bestTrailRound;
        document.getElementById('trailLaughs').textContent = trailLaughs;
        
        document.getElementById('huntSessions').textContent = huntSessions;
        document.getElementById('huntBestTier').textContent = bestHuntTier;
        document.getElementById('huntLaughs').textContent = huntLaughs;
        
        document.getElementById('activeCount').textContent = active;
        document.getElementById('trialCount').textContent = trialing;
        document.getElementById('streakLeader').textContent = bestStreak;
        document.getElementById('laughLeader').textContent = mostLaughs;
    }

    function updateActivityStats() {
        var now = new Date();
        var todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
        var weekStart = todayStart - (now.getDay() * 86400000);
        
        var gamesToday = 0;
        var gamesWeek = 0;
        var newSubsWeek = 0;
        var laughsToday = 0;
        
        activities.forEach(function(act) {
            var ts = new Date(act.timestamp).getTime();
            var isGame = act.type === 'game_session';
            var isSub = act.type && act.type.includes('subscription_created');
            
            if (ts >= todayStart) {
                if (isGame) gamesToday++;
                if (act.laughs) laughsToday += act.laughs;
            }
            if (ts >= weekStart) {
                if (isGame) gamesWeek++;
                if (isSub) newSubsWeek++;
            }
        });
        
        document.getElementById('gamesToday').textContent = gamesToday;
        document.getElementById('gamesWeek').textContent = gamesWeek;
        document.getElementById('newSubsWeek').textContent = newSubsWeek;
        document.getElementById('laughsToday').textContent = laughsToday;
    }

    function formatTimeAgo(timestamp) {
        if (!timestamp) return '-';
        var date = new Date(timestamp);
        var now = new Date();
        var diff = Math.floor((now - date) / 1000);
        
        if (diff < 60) return currentLang === 'es' ? 'hace ' + diff + 's' : diff + 's ago';
        if (diff < 3600) return currentLang === 'es' ? 'hace ' + Math.floor(diff/60) + 'm' : Math.floor(diff/60) + 'm ago';
        if (diff < 86400) return currentLang === 'es' ? 'hace ' + Math.floor(diff/3600) + 'h' : Math.floor(diff/3600) + 'h ago';
        return currentLang === 'es' ? 'hace ' + Math.floor(diff/86400) + 'd' : Math.floor(diff/86400) + 'd ago';
    }

    function renderSubscribers() {
        var tbody = document.getElementById('subscribersTable');
        
        if (subscribers.length === 0) {
            tbody.innerHTML = '<tr><td colspan="8" style="text-align:center;padding:40px;color:var(--muted)"><span class="lang-en">No subscribers yet</span><span class="lang-es">A√∫n no hay suscriptores</span></td></tr>';
            return;
        }

        var html = '';
        subscribers.forEach(function(sub) {
            var statusClass = 'badge-' + (sub.status || 'unknown');
            var totalLaughs = sub.totalLaughs || 0;
            var trailTier = sub.games && sub.games.laughtrail ? (sub.games.laughtrail.bestRound || 0) : 0;
            var huntTier = sub.games && sub.games.laughhunt ? (sub.games.laughhunt.bestTier || 0) : 0;
            var lastActive = sub.lastActive ? formatTimeAgo(sub.lastActive) : '-';
            
            html += '<tr class="clickable" onclick="window.viewSubscriber(\'' + sub.pin + '\')">';
            html += '<td>' + (sub.email || '-') + '</td>';
            html += '<td><strong style="color:var(--gold)">' + (sub.pin || '-') + '</strong></td>';
            html += '<td><span class="badge ' + statusClass + '">' + (sub.status || 'unknown') + '</span></td>';
            html += '<td>üòÇ ' + totalLaughs + '</td>';
            html += '<td>' + (trailTier > 0 ? 'R' + trailTier : '-') + '</td>';
            html += '<td>' + (huntTier > 0 ? 'T' + huntTier : '-') + '</td>';
            html += '<td>üî• ' + (sub.streak || 0) + '</td>';
            html += '<td>' + lastActive + '</td>';
            html += '</tr>';
        });
        
        tbody.innerHTML = html;
    }

    window.viewSubscriber = function(pin) {
        var sub = subscribers.find(function(s) { return s.pin === pin; });
        if (!sub) return;
        
        window.currentSubscriberData = sub;
        
        var initial = sub.email ? sub.email.charAt(0).toUpperCase() : '?';
        var trailData = sub.games && sub.games.laughtrail ? sub.games.laughtrail : {};
        var huntData = sub.games && sub.games.laughhunt ? sub.games.laughhunt : {};
        
        var html = '<div class="subscriber-detail-header">';
        html += '<div class="subscriber-avatar">' + initial + '</div>';
        html += '<div class="subscriber-info" style="flex:1">';
        html += '<h4>' + (sub.email || 'Unknown') + '</h4>';
        html += '<p>PIN: <strong style="color:var(--gold)">' + sub.pin + '</strong> ‚Ä¢ ' + (sub.status || 'unknown') + '</p>';
        html += '</div>';
        html += '<div class="action-btns">';
        html += '<button class="action-btn" onclick="window.editSubscriber(\'' + sub.pin + '\')" title="Edit">‚úèÔ∏è</button>';
        html += '<button class="action-btn delete" onclick="window.deleteSubscriber(\'' + sub.pin + '\', \'' + (sub.email || sub.pin) + '\')" title="Delete">üóëÔ∏è</button>';
        html += '</div>';
        html += '</div>';
        
        html += '<div class="subscriber-stats-grid">';
        html += '<div class="subscriber-stat"><div class="subscriber-stat-value">üòÇ ' + (sub.totalLaughs || 0) + '</div><div class="subscriber-stat-label">Total Laughs</div></div>';
        html += '<div class="subscriber-stat"><div class="subscriber-stat-value">üî• ' + (sub.streak || 0) + '</div><div class="subscriber-stat-label">Streak</div></div>';
        html += '<div class="subscriber-stat"><div class="subscriber-stat-value">' + ((trailData.sessions || 0) + (huntData.sessions || 0)) + '</div><div class="subscriber-stat-label">Sessions</div></div>';
        html += '</div>';
        
        html += '<div class="game-scores-section">';
        html += '<h5>' + (currentLang === 'es' ? 'Progreso por Juego' : 'Game Progress') + '</h5>';
        
        html += '<div class="game-score-row">';
        html += '<div class="game-score-name"><span class="icon">üõ§Ô∏è</span> LAUGH TRAIL</div>';
        html += '<div class="game-score-stats">';
        html += '<span style="color:var(--muted);font-size:0.8rem">' + (trailData.sessions || 0) + ' sessions</span>';
        html += '<div class="game-score-value">R' + (trailData.bestRound || 0) + '</div>';
        html += '</div></div>';
        
        html += '<div class="game-score-row">';
        html += '<div class="game-score-name"><span class="icon">üîç</span> LAUGH HUNT</div>';
        html += '<div class="game-score-stats">';
        html += '<span style="color:var(--muted);font-size:0.8rem">' + (huntData.sessions || 0) + ' sessions</span>';
        html += '<div class="game-score-value">T' + (huntData.bestTier || 0) + '</div>';
        html += '</div></div>';
        
        html += '</div>';
        
        document.getElementById('subscriberModalBody').innerHTML = html;
        openModal('subscriberModal');
    };

    var deleteSubscriberPin = null;

    window.editSubscriber = function(pin) {
        closeModal('subscriberModal');
        
        var sub = window.currentSubscriberData;
        if (!sub) return;
        
        document.getElementById('editSubPin').value = pin;
        document.getElementById('editSubEmail').value = sub.email || '';
        document.getElementById('editSubNewPin').value = pin;
        document.getElementById('editSubStatus').value = sub.status || 'active';
        
        openModal('editSubscriberModal');
    };

    window.deleteSubscriber = function(pin, name) {
        deleteSubscriberPin = pin;
        document.getElementById('deleteSubscriberText').innerHTML = (currentLang === 'es' ? 'Eliminar ' : 'Delete ') + '<strong style="color:var(--gold)">' + name + '</strong>?';
        closeModal('subscriberModal');
        openModal('deleteSubscriberModal');
    };

    function saveSubscriber() {
        var pin = document.getElementById('editSubPin').value;
        var newPin = document.getElementById('editSubNewPin').value;
        
        var body = {
            email: document.getElementById('editSubEmail').value,
            pin: newPin,
            status: document.getElementById('editSubStatus').value
        };
        
        fetch('/api/admin/subscriber/' + pin, {
            method: 'PUT',
            headers: { 
                'Content-Type': 'application/json',
                'Authorization': 'Bearer ' + authToken 
            },
            body: JSON.stringify(body)
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success) {
                closeModal('editSubscriberModal');
                loadSubscribers();
                showToast(currentLang === 'es' ? 'Guardado' : 'Saved');
            } else {
                showToast(data.error || 'Error', true);
            }
        })
        .catch(function(err) {
            console.error('Error saving subscriber:', err);
            showToast('Error', true);
        });
    }

    function confirmDeleteSubscriber() {
        if (!deleteSubscriberPin) return;
        
        fetch('/api/admin/subscriber/' + deleteSubscriberPin, {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + authToken }
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success) {
                closeModal('deleteSubscriberModal');
                loadSubscribers();
                showToast(currentLang === 'es' ? 'Eliminado' : 'Deleted');
            } else {
                showToast(data.error || 'Error', true);
            }
        })
        .catch(function(err) {
            console.error('Error deleting subscriber:', err);
            showToast('Error', true);
        });
        
        deleteSubscriberPin = null;
    }

    function renderActivity() {
        var container = document.getElementById('activityList');
        
        if (activities.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text"><span class="lang-en">No activity yet</span><span class="lang-es">A√∫n no hay actividad</span></div></div>';
            return;
        }

        var html = '';
        activities.slice(0, 50).forEach(function(act) {
            var iconClass = 'game';
            var icon = 'üéÆ';
            
            if (act.type && act.type.includes('subscription')) {
                iconClass = 'subscription';
                icon = 'üí≥';
            } else if (act.game === 'laughtrail') {
                icon = 'üõ§Ô∏è';
            } else if (act.game === 'laughhunt') {
                icon = 'üîç';
            }
            
            var description = act.details || act.type || 'Activity';
            
            html += '<div class="aggregated-item">';
            html += '<div class="aggregated-icon ' + iconClass + '">' + icon + '</div>';
            html += '<div class="aggregated-content">';
            html += '<div class="aggregated-text">';
            if (act.username || act.email) html += '<strong>' + (act.username || act.email) + '</strong> - ';
            html += description;
            if (act.laughs) html += ' <span style="color:var(--pink)">üòÇ +' + act.laughs + '</span>';
            html += '</div>';
            html += '<div class="aggregated-details">' + formatTimeAgo(act.timestamp) + '</div>';
            html += '</div></div>';
        });
        
        container.innerHTML = html;
    }

    function renderOverviewActivity() {
        var container = document.getElementById('overviewActivity');
        
        if (activities.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text"><span class="lang-en">No activity yet</span><span class="lang-es">A√∫n no hay actividad</span></div></div>';
            return;
        }

        var html = '';
        activities.slice(0, 5).forEach(function(act) {
            var iconClass = 'game';
            var icon = 'üéÆ';
            
            if (act.type && act.type.includes('subscription')) {
                iconClass = 'subscription';
                icon = 'üí≥';
            } else if (act.game === 'laughtrail') {
                icon = 'üõ§Ô∏è';
            } else if (act.game === 'laughhunt') {
                icon = 'üîç';
            }
            
            var description = act.details || act.type || 'Activity';
            
            html += '<div class="aggregated-item">';
            html += '<div class="aggregated-icon ' + iconClass + '">' + icon + '</div>';
            html += '<div class="aggregated-content">';
            html += '<div class="aggregated-text">';
            if (act.username || act.email) html += '<strong>' + (act.username || act.email) + '</strong> - ';
            html += description;
            if (act.laughs) html += ' <span style="color:var(--pink)">üòÇ +' + act.laughs + '</span>';
            html += '</div>';
            html += '<div class="aggregated-details">' + formatTimeAgo(act.timestamp) + '</div>';
            html += '</div></div>';
        });
        
        container.innerHTML = html;
    }

    function clearAllActivity() {
        fetch('/api/admin/activity/all', {
            method: 'DELETE',
            headers: { 'Authorization': 'Bearer ' + authToken }
        })
        .then(function(res) {
            if (res.ok) {
                closeModal('clearActivityModal');
                showToast(currentLang === 'es' ? 'Actividad eliminada' : 'Activity cleared');
                loadActivity();
            } else {
                throw new Error('Delete failed');
            }
        })
        .catch(function(err) {
            showToast(currentLang === 'es' ? 'Error' : 'Error', true);
        });
    }

    init();
})();
</script>
</body>
</html>
