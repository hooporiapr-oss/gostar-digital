<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard - Team GoTrotters | GoStar Digital</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
    --orange: #FF6B00;
    --orange-dark: #CC5500;
    --teal: #00D9A5;
    --gold: #FFD700;
    --purple: #9B59B6;
    --blue: #3B82F6;
    --dark: #0a0a0f;
    --darker: #050508;
    --card: #111118;
    --card-hover: #1a1a24;
    --text: #FFFFFF;
    --muted: #8892a0;
    --border: rgba(255,255,255,0.08);
    --success: #00D9A5;
    --danger: #FF4757;
    --sidebar: 260px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: 'Outfit', sans-serif;
    background: var(--dark);
    color: var(--text);
    min-height: 100vh;
}

body.es .lang-en { display: none !important; }
body.en .lang-es { display: none !important; }

.login-screen {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.login-screen.hidden { display: none; }

.login-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 24px;
    padding: 48px 40px;
    width: 100%;
    max-width: 380px;
    text-align: center;
}

.login-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.5rem;
    letter-spacing: 4px;
    margin-bottom: 10px;
}

.login-logo .go { color: var(--orange); }
.login-logo .trotters { color: var(--teal); }

.login-badge {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 700;
    color: var(--dark);
    background: var(--gold);
    padding: 5px 15px;
    border-radius: 20px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 30px;
}

.login-subtitle {
    font-size: 0.9rem;
    color: var(--muted);
    margin-bottom: 30px;
}

.pin-input-group {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 24px;
}

.pin-input {
    width: 60px;
    height: 72px;
    font-size: 1.8rem;
    font-weight: 700;
    font-family: 'Bebas Neue', sans-serif;
    text-align: center;
    background: var(--darker);
    border: 2px solid var(--border);
    border-radius: 12px;
    color: var(--text);
    transition: all 0.2s;
}

.pin-input:focus {
    outline: none;
    border-color: var(--orange);
    box-shadow: 0 0 20px rgba(255,107,0,0.2);
}

.login-btn {
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--orange), var(--orange-dark));
    color: var(--text);
    border: none;
    border-radius: 12px;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.1rem;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.3s;
}

.login-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 25px rgba(255,107,0,0.4);
}

.login-error {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 15px;
    display: none;
}

.login-error.show { display: block; }

.dashboard { display: none; min-height: 100vh; }
.dashboard.visible { display: flex; }

.sidebar {
    width: var(--sidebar);
    background: var(--darker);
    border-right: 1px solid var(--border);
    padding: 24px 0;
    display: flex;
    flex-direction: column;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
}

.sidebar-header {
    padding: 0 24px 24px;
    border-bottom: 1px solid var(--border);
    margin-bottom: 20px;
}

.sidebar-logo {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    letter-spacing: 3px;
    margin-bottom: 5px;
}

.sidebar-logo .go { color: var(--orange); }
.sidebar-logo .trotters { color: var(--teal); }

.sidebar-team {
    font-size: 0.75rem;
    color: var(--muted);
    margin-bottom: 10px;
}

.admin-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--danger), #cc3344);
    color: var(--text);
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.nav-section { padding: 0 12px; margin-bottom: 20px; }

.nav-section-title {
    font-size: 0.65rem;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 0 16px;
    margin-bottom: 10px;
}

.nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    width: 100%;
    padding: 12px 16px;
    border: none;
    background: transparent;
    border-radius: 10px;
    color: var(--muted);
    font-family: 'Outfit', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
    margin-bottom: 4px;
}

.nav-item:hover { background: var(--card); color: var(--text); }
.nav-item.active { background: var(--orange); color: var(--text); }
.nav-item-icon { font-size: 1.1rem; width: 24px; text-align: center; }

.sidebar-footer {
    padding: 20px 24px;
    border-top: 1px solid var(--border);
    margin-top: auto;
}

.lang-toggle {
    display: flex;
    gap: 8px;
    background: var(--card);
    padding: 4px;
    border-radius: 10px;
    margin-bottom: 15px;
}

.lang-btn {
    flex: 1;
    padding: 8px;
    border: none;
    background: transparent;
    color: var(--muted);
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    font-family: 'Outfit', sans-serif;
}

.lang-btn.active { background: var(--orange); color: var(--text); }

.logout-btn {
    width: 100%;
    padding: 12px;
    border: 1px solid var(--border);
    background: transparent;
    color: var(--muted);
    border-radius: 10px;
    font-weight: 600;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Outfit', sans-serif;
}

.logout-btn:hover { border-color: var(--danger); color: var(--danger); }

.main-content { flex: 1; margin-left: var(--sidebar); padding: 30px; max-width: 1400px; }
.page-header { margin-bottom: 30px; }
.page-title { font-family: 'Bebas Neue', sans-serif; font-size: 2rem; letter-spacing: 3px; margin-bottom: 5px; }
.page-subtitle { font-size: 0.9rem; color: var(--muted); }
.page-section { display: none; }
.page-section.active { display: block; }

.team-banner {
    background: linear-gradient(135deg, rgba(255,107,0,0.15), rgba(0,217,165,0.15));
    border: 1px solid var(--orange);
    border-radius: 16px;
    padding: 20px 24px;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.team-banner-text { font-size: 1rem; }
.team-banner-text strong { color: var(--orange); font-size: 1.2rem; }
.team-banner-badge { background: var(--teal); color: var(--dark); padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 0.85rem; }

.stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }

.stat-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    transition: all 0.3s;
}

.stat-card:hover { transform: translateY(-3px); border-color: var(--orange); }

.stat-card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    margin-bottom: 15px;
}

.stat-card-icon.orange { background: rgba(255,107,0,0.15); }
.stat-card-icon.teal { background: rgba(0,217,165,0.15); }
.stat-card-icon.gold { background: rgba(255,215,0,0.15); }
.stat-card-icon.purple { background: rgba(155,89,182,0.15); }
.stat-card-value { font-family: 'Bebas Neue', sans-serif; font-size: 2.2rem; letter-spacing: 2px; margin-bottom: 5px; }
.stat-card-label { font-size: 0.8rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }

.gear-cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }

.gear-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    transition: all 0.3s;
}

.gear-card:hover { transform: translateY(-3px); }

.gear-card-header { padding: 16px 20px; display: flex; align-items: center; gap: 12px; }
.gear-card-header.g1 { background: linear-gradient(135deg, rgba(255,107,0,0.2), transparent); border-bottom: 2px solid var(--orange); }
.gear-card-header.g2 { background: linear-gradient(135deg, rgba(0,217,165,0.2), transparent); border-bottom: 2px solid var(--teal); }
.gear-card-header.g3 { background: linear-gradient(135deg, rgba(255,215,0,0.2), transparent); border-bottom: 2px solid var(--gold); }
.gear-card-icon { font-size: 1.5rem; }
.gear-card-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.1rem; letter-spacing: 2px; flex: 1; }
.gear-card-num { font-size: 0.7rem; color: var(--muted); }

.gear-card-edit {
    background: transparent;
    border: 1px solid var(--border);
    color: var(--muted);
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s;
}

.gear-card-edit:hover { border-color: var(--orange); color: var(--orange); }
.gear-card-body { padding: 20px; }
.gear-card-stats { display: flex; gap: 20px; }
.gear-stat { text-align: center; flex: 1; }
.gear-stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; }
.gear-stat-label { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; }

.table-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; margin-bottom: 30px; }
.table-header { padding: 20px 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
.table-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.2rem; letter-spacing: 2px; }
.table-actions { display: flex; gap: 10px; }
.btn { padding: 10px 20px; border: none; border-radius: 10px; font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.2s; font-family: 'Outfit', sans-serif; }
.btn-primary { background: var(--orange); color: var(--text); }
.btn-primary:hover { background: var(--orange-dark); }
.btn-secondary { background: var(--card); border: 1px solid var(--border); color: var(--text); }
.btn-secondary:hover { border-color: var(--orange); }
.btn-danger { background: transparent; border: 1px solid var(--danger); color: var(--danger); }
.btn-danger:hover { background: var(--danger); color: var(--text); }

.table-container { overflow-x: auto; }
table { width: 100%; border-collapse: collapse; }
th, td { padding: 14px 20px; text-align: left; border-bottom: 1px solid var(--border); }
th { font-size: 0.75rem; font-weight: 700; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; background: var(--darker); }
td { font-size: 0.9rem; }
tr:hover { background: var(--card-hover); }

.badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; }
.badge-trial, .badge-trialing { background: rgba(155,89,182,0.15); color: var(--purple); }
.badge-paid, .badge-active { background: rgba(0,217,165,0.15); color: var(--teal); }
.badge-canceled { background: rgba(255,71,87,0.15); color: var(--danger); }
.badge-past_due { background: rgba(255,215,0,0.15); color: var(--gold); }

.shift-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; border-radius: 6px; font-size: 0.65rem; font-weight: 700; }
.shift-badge.practice { background: rgba(155,89,182,0.2); color: #b57edc; }
.shift-badge.level3 { background: rgba(255,215,0,0.2); color: var(--gold); }
.shift-badge.level4 { background: rgba(255,107,0,0.2); color: var(--orange); }
.shift-badge.level5 { background: rgba(0,217,165,0.2); color: var(--teal); }
.shift-badge.level6 { background: rgba(52,152,219,0.2); color: var(--blue); }
.shift-badge.level7 { background: rgba(155,89,182,0.2); color: var(--purple); }
.shift-badge.level8 { background: rgba(255,215,0,0.2); color: var(--gold); }
.shift-badge.level9 { background: rgba(255,107,0,0.2); color: var(--orange); }
.shift-badge.master { background: linear-gradient(135deg, rgba(255,215,0,0.3), rgba(255,107,0,0.3)); color: var(--gold); }

.action-btns { display: flex; gap: 6px; }

.action-btn {
    width: 32px;
    height: 32px;
    border: 1px solid var(--border);
    background: transparent;
    border-radius: 8px;
    color: var(--muted);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

.action-btn:hover { border-color: var(--orange); color: var(--orange); }
.action-btn.delete:hover { border-color: var(--danger); color: var(--danger); }

.activity-list { padding: 0; }

.activity-item {
    display: flex;
    align-items: flex-start;
    gap: 15px;
    padding: 16px 20px;
    border-bottom: 1px solid var(--border);
    transition: background 0.2s;
}

.activity-item:last-child { border-bottom: none; }
.activity-item:hover { background: var(--card-hover); }

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.activity-icon.user { background: rgba(0,217,165,0.15); color: var(--teal); }
.activity-icon.gear { background: rgba(155,89,182,0.15); color: var(--purple); }
.activity-icon.subscription { background: rgba(255,107,0,0.15); color: var(--orange); }
.activity-icon.game { background: rgba(59,130,246,0.15); color: var(--blue); }
.activity-icon.facility { background: rgba(255,215,0,0.15); color: var(--gold); }
.activity-content { flex: 1; }
.activity-text { font-size: 0.9rem; margin-bottom: 3px; }
.activity-time { font-size: 0.75rem; color: var(--muted); }
.activity-actions { display: flex; gap: 6px; opacity: 0; transition: opacity 0.2s; }
.activity-item:hover .activity-actions { opacity: 1; }

.shift-dist-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
.shift-dist-table th, .shift-dist-table td { padding: 10px 12px; text-align: center; border: 1px solid var(--border); font-size: 0.8rem; }
.shift-dist-table th { background: var(--darker); font-weight: 600; color: var(--muted); }
.shift-dist-table td { background: var(--card); }

.modal-overlay {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
}

.modal-overlay.show { display: flex; }

.modal {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 20px;
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
.modal-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.3rem; letter-spacing: 2px; }

.modal-close {
    width: 36px;
    height: 36px;
    border: none;
    background: var(--darker);
    border-radius: 10px;
    color: var(--muted);
    font-size: 1.2rem;
    cursor: pointer;
}

.modal-close:hover { color: var(--danger); }
.modal-body { padding: 24px; }
.form-group { margin-bottom: 20px; }
.form-label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }

.form-input, .form-select {
    width: 100%;
    padding: 14px 16px;
    background: var(--darker);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-size: 0.95rem;
    font-family: 'Outfit', sans-serif;
}

.form-input:focus, .form-select:focus { outline: none; border-color: var(--orange); }
.form-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
.modal-footer { padding: 20px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 12px; }
.confirm-dialog { text-align: center; padding: 20px 0; }
.confirm-dialog-icon { font-size: 3rem; margin-bottom: 15px; }
.confirm-dialog-title { font-family: 'Bebas Neue', sans-serif; font-size: 1.5rem; letter-spacing: 2px; margin-bottom: 10px; }
.confirm-dialog-text { color: var(--muted); font-size: 0.9rem; margin-bottom: 5px; }

.toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: var(--card);
    border: 1px solid var(--teal);
    border-radius: 12px;
    padding: 16px 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    transform: translateY(100px);
    opacity: 0;
    transition: all 0.3s;
    z-index: 2000;
}

.toast.show { transform: translateY(0); opacity: 1; }
.toast.error { border-color: var(--danger); }
.toast-icon { font-size: 1.2rem; }
.toast-text { font-size: 0.9rem; }

.loading-spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid var(--muted);
    border-top-color: var(--orange);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin { to { transform: rotate(360deg); } }

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--muted);
}

.empty-state-icon { font-size: 3rem; margin-bottom: 15px; }
.empty-state-text { font-size: 1rem; }

@media (max-width: 1024px) {
    .sidebar { width: 80px; padding: 15px 0; }
    .sidebar-header { padding: 0 10px 15px; }
    .sidebar-logo span, .sidebar-team, .nav-item span:not(.nav-item-icon), .nav-section-title, .sidebar-footer .lang-toggle, .logout-btn span { display: none; }
    .nav-item { justify-content: center; padding: 12px; }
    .nav-item-icon { margin: 0; }
    .main-content { margin-left: 80px; }
}

@media (max-width: 768px) {
    .sidebar { display: none; }
    .main-content { margin-left: 0; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .team-banner { flex-direction: column; text-align: center; }
    .form-row { grid-template-columns: 1fr; }
}
</style>
</head>
<body class="en">

<div class="login-screen" id="loginScreen">
    <div class="login-card">
        <div class="login-logo"><span class="go">Go</span><span class="trotters">Trotters</span></div>
        <div class="login-badge">Coach Admin Portal</div>
        <p class="login-subtitle">
            <span class="lang-en">Enter your 4-digit admin PIN</span>
            <span class="lang-es">Ingresa tu PIN de 4 d√≠gitos</span>
        </p>
        <div class="pin-input-group">
            <input type="password" class="pin-input" maxlength="1" id="pin1" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin2" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin3" inputmode="numeric">
            <input type="password" class="pin-input" maxlength="1" id="pin4" inputmode="numeric">
        </div>
        <button class="login-btn" id="loginBtn">
            <span class="lang-en">ACCESS DASHBOARD</span>
            <span class="lang-es">ACCEDER</span>
        </button>
        <p class="login-error" id="loginError">
            <span class="lang-en">Invalid PIN</span>
            <span class="lang-es">PIN inv√°lido</span>
        </p>
    </div>
</div>

<div class="dashboard" id="dashboard">
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo"><span class="go">Go</span><span class="trotters">Trotters</span></div>
            <div class="sidebar-team">Team GoTrotters</div>
            <span class="admin-badge">Coach Admin</span>
        </div>
        <nav class="nav-section">
            <div class="nav-section-title">
                <span class="lang-en">Dashboard</span>
                <span class="lang-es">Panel</span>
            </div>
            <button class="nav-item active" data-page="overview">
                <span class="nav-item-icon">üìä</span>
                <span class="lang-en">Overview</span>
                <span class="lang-es">Resumen</span>
            </button>
            <button class="nav-item" data-page="subscribers">
                <span class="nav-item-icon">üí≥</span>
                <span class="lang-en">Subscribers</span>
                <span class="lang-es">Suscriptores</span>
            </button>
            <button class="nav-item" data-page="facilities">
                <span class="nav-item-icon">üè¢</span>
                <span class="lang-en">Facilities</span>
                <span class="lang-es">Centros</span>
            </button>
            <button class="nav-item" data-page="activity">
                <span class="nav-item-icon">üìã</span>
                <span class="lang-en">Activity</span>
                <span class="lang-es">Actividad</span>
            </button>
        </nav>
        <div class="sidebar-footer">
            <div class="lang-toggle">
                <button class="lang-btn active" id="btnEn">EN</button>
                <button class="lang-btn" id="btnEs">ES</button>
            </div>
            <button class="logout-btn" id="logoutBtn">üö™ 
                <span class="lang-en">Logout</span>
                <span class="lang-es">Salir</span>
            </button>
        </div>
    </aside>

    <main class="main-content">
        <!-- OVERVIEW PAGE -->
        <section class="page-section active" id="page-overview">
            <header class="page-header">
                <h1 class="page-title">GOTROTTERS ADMIN</h1>
                <p class="page-subtitle">
                    <span class="lang-en">Platform Overview ‚Ä¢ Subscribers & Facilities</span>
                    <span class="lang-es">Resumen de Plataforma ‚Ä¢ Suscriptores y Centros</span>
                </p>
            </header>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon teal">üí≥</div>
                    <div class="stat-card-value" id="totalSubscribers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Subscribers</span>
                        <span class="lang-es">Suscriptores</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon orange">üè¢</div>
                    <div class="stat-card-value" id="totalFacilities">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Facilities</span>
                        <span class="lang-es">Centros</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon gold">üë•</div>
                    <div class="stat-card-value" id="totalUsers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Facility Users</span>
                        <span class="lang-es">Usuarios de Centros</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon purple">üéÆ</div>
                    <div class="stat-card-value" id="totalSessions">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Total Sessions</span>
                        <span class="lang-es">Sesiones Totales</span>
                    </div>
                </div>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">
                        <span class="lang-en">RECENT ACTIVITY</span>
                        <span class="lang-es">ACTIVIDAD RECIENTE</span>
                    </h3>
                </div>
                <div class="activity-list" id="overviewActivity"></div>
            </div>
        </section>

        <!-- SUBSCRIBERS PAGE -->
        <section class="page-section" id="page-subscribers">
            <header class="page-header">
                <h1 class="page-title">
                    <span class="lang-en">SUBSCRIBERS</span>
                    <span class="lang-es">SUSCRIPTORES</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">Stripe subscription management</span>
                    <span class="lang-es">Gesti√≥n de suscripciones Stripe</span>
                </p>
            </header>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-icon teal">‚úÖ</div>
                    <div class="stat-card-value" id="activeSubscribers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Active</span>
                        <span class="lang-es">Activos</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon purple">üÜì</div>
                    <div class="stat-card-value" id="trialingSubscribers">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Trialing</span>
                        <span class="lang-es">En Prueba</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon gold">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="stat-card-value" id="familyPlans">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Family Plans</span>
                        <span class="lang-es">Planes Familiares</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon orange">üë§</div>
                    <div class="stat-card-value" id="individualPlans">0</div>
                    <div class="stat-card-label">
                        <span class="lang-en">Individual Plans</span>
                        <span class="lang-es">Planes Individuales</span>
                    </div>
                </div>
            </div>
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">ALL SUBSCRIBERS</h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refreshSubscribersBtn">üîÑ 
                            <span class="lang-en">Refresh</span>
                            <span class="lang-es">Actualizar</span>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Email</th>
                                <th>PIN</th>
                                <th><span class="lang-en">Plan</span><span class="lang-es">Plan</span></th>
                                <th><span class="lang-en">Status</span><span class="lang-es">Estado</span></th>
                                <th><span class="lang-en">Family</span><span class="lang-es">Familia</span></th>
                                <th><span class="lang-en">Created</span><span class="lang-es">Creado</span></th>
                            </tr>
                        </thead>
                        <tbody id="subscribersTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- FACILITIES PAGE -->
        <section class="page-section" id="page-facilities">
            <header class="page-header">
                <h1 class="page-title">
                    <span class="lang-en">FACILITIES</span>
                    <span class="lang-es">CENTROS</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">Nursing homes & facilities</span>
                    <span class="lang-es">Hogares de ancianos y centros</span>
                </p>
            </header>
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">ALL FACILITIES</h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refreshFacilitiesBtn">üîÑ 
                            <span class="lang-en">Refresh</span>
                            <span class="lang-es">Actualizar</span>
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th><span class="lang-en">Name</span><span class="lang-es">Nombre</span></th>
                                <th><span class="lang-en">License</span><span class="lang-es">Licencia</span></th>
                                <th><span class="lang-en">Users</span><span class="lang-es">Usuarios</span></th>
                                <th><span class="lang-en">Sessions</span><span class="lang-es">Sesiones</span></th>
                                <th><span class="lang-en">Status</span><span class="lang-es">Estado</span></th>
                                <th><span class="lang-en">Expires</span><span class="lang-es">Expira</span></th>
                            </tr>
                        </thead>
                        <tbody id="facilitiesTable"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ACTIVITY PAGE -->
        <section class="page-section" id="page-activity">
            <header class="page-header">
                <h1 class="page-title">
                    <span class="lang-en">ACTIVITY LOG</span>
                    <span class="lang-es">REGISTRO DE ACTIVIDAD</span>
                </h1>
                <p class="page-subtitle">
                    <span class="lang-en">All platform activity</span>
                    <span class="lang-es">Toda la actividad de la plataforma</span>
                </p>
            </header>
            <div class="table-card">
                <div class="table-header">
                    <h3 class="table-title">
                        <span class="lang-en">ALL ACTIVITY</span>
                        <span class="lang-es">TODA LA ACTIVIDAD</span>
                    </h3>
                    <div class="table-actions">
                        <button class="btn btn-secondary" id="refreshActivityBtn">üîÑ 
                            <span class="lang-en">Refresh</span>
                            <span class="lang-es">Actualizar</span>
                        </button>
                    </div>
                </div>
                <div class="activity-list" id="activityList"></div>
            </div>
        </section>
    </main>
</div>

<div class="modal-overlay" id="deleteModal">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title"><span class="lang-en">CONFIRM</span><span class="lang-es">CONFIRMAR</span></h3>
            <button class="modal-close" data-close="deleteModal">√ó</button>
        </div>
        <div class="modal-body">
            <div class="confirm-dialog">
                <div class="confirm-dialog-icon">‚ö†Ô∏è</div>
                <div class="confirm-dialog-title"><span class="lang-en">ARE YOU SURE?</span><span class="lang-es">¬øEST√ÅS SEGURO?</span></div>
                <div class="confirm-dialog-text" id="deleteText"></div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" data-close="deleteModal"><span class="lang-en">Cancel</span><span class="lang-es">Cancelar</span></button>
            <button class="btn btn-danger" id="confirmDeleteBtn"><span class="lang-en">Delete</span><span class="lang-es">Eliminar</span></button>
        </div>
    </div>
</div>

<div class="toast" id="toast">
    <span class="toast-icon" id="toastIcon">‚úì</span>
    <span class="toast-text" id="toastText">Saved</span>
</div>

<script>
(function() {
    'use strict';

    var authToken = null;
    var subscribers = [];
    var facilities = [];
    var users = [];
    var activities = [];
    var currentLang = localStorage.getItem('gt-admin-lang') || 'en';

    function init() {
        setLang(currentLang);
        setupPinInputs();
        setupEventListeners();
        
        // Check existing session
        var savedToken = sessionStorage.getItem('gostar-admin-token');
        if (savedToken) {
            verifyToken(savedToken);
        }
    }

    function setLang(lang) {
        currentLang = lang;
        localStorage.setItem('gt-admin-lang', lang);
        document.body.className = lang;
        document.getElementById('btnEn').className = lang === 'en' ? 'lang-btn active' : 'lang-btn';
        document.getElementById('btnEs').className = lang === 'es' ? 'lang-btn active' : 'lang-btn';
    }

    function setupPinInputs() {
        var pins = [document.getElementById('pin1'), document.getElementById('pin2'), document.getElementById('pin3'), document.getElementById('pin4')];
        pins.forEach(function(input, idx) {
            input.addEventListener('input', function() { 
                if (this.value.length === 1 && idx < 3) pins[idx + 1].focus(); 
            });
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && this.value === '' && idx > 0) pins[idx - 1].focus();
                if (e.key === 'Enter') attemptLogin();
            });
        });
        pins[0].focus();
    }

    function attemptLogin() {
        var pin = '';
        for (var i = 1; i <= 4; i++) pin += document.getElementById('pin' + i).value;
        
        if (pin.length !== 4) return;
        
        fetch('/api/admin/verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ pin: pin })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success && data.token) {
                authToken = data.token;
                sessionStorage.setItem('gostar-admin-token', authToken);
                showDashboard();
            } else {
                showLoginError();
            }
        })
        .catch(function(err) {
            console.error('Login error:', err);
            showLoginError();
        });
    }

    function verifyToken(token) {
        fetch('/api/admin/verify-token', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: token })
        })
        .then(function(res) { return res.json(); })
        .then(function(data) {
            if (data.success) {
                authToken = token;
                showDashboard();
            } else {
                sessionStorage.removeItem('gostar-admin-token');
            }
        })
        .catch(function() {
            sessionStorage.removeItem('gostar-admin-token');
        });
    }

    function showLoginError() {
        document.getElementById('loginError').classList.add('show');
        for (var i = 1; i <= 4; i++) document.getElementById('pin' + i).value = '';
        document.getElementById('pin1').focus();
        setTimeout(function() { document.getElementById('loginError').classList.remove('show'); }, 3000);
    }

    function showDashboard() {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('dashboard').classList.add('visible');
        loadAllData();
    }

    function logout() {
        fetch('/api/admin/logout', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token: authToken })
        });
        authToken = null;
        sessionStorage.removeItem('gostar-admin-token');
        document.getElementById('dashboard').classList.remove('visible');
        document.getElementById('loginScreen').classList.remove('hidden');
        for (var i = 1; i <= 4; i++) document.getElementById('pin' + i).value = '';
        document.getElementById('pin1').focus();
    }

    function setupEventListeners() {
        document.getElementById('loginBtn').addEventListener('click', attemptLogin);
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('btnEn').addEventListener('click', function() { setLang('en'); });
        document.getElementById('btnEs').addEventListener('click', function() { setLang('es'); });

        document.querySelectorAll('.nav-item').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var page = this.getAttribute('data-page');
                showPage(page);
                document.querySelectorAll('.nav-item').forEach(function(n) { n.classList.remove('active'); });
                this.classList.add('active');
            });
        });

        document.querySelectorAll('[data-close]').forEach(function(btn) {
            btn.addEventListener('click', function() { closeModal(this.getAttribute('data-close')); });
        });

        document.getElementById('refreshSubscribersBtn').addEventListener('click', loadSubscribers);
        document.getElementById('refreshFacilitiesBtn').addEventListener('click', loadFacilities);
        document.getElementById('refreshActivityBtn').addEventListener('click', loadActivity);

        document.querySelectorAll('.modal-overlay').forEach(function(overlay) {
            overlay.addEventListener('click', function(e) { if (e.target === overlay) overlay.classList.remove('show'); });
        });
    }

    function showPage(page) {
        document.querySelectorAll('.page-section').forEach(function(s) { s.classList.remove('active'); });
        document.getElementById('page-' + page).classList.add('active');
    }

    function openModal(id) { document.getElementById(id).classList.add('show'); }
    function closeModal(id) { document.getElementById(id).classList.remove('show'); }

    function showToast(message, isError) {
        var toast = document.getElementById('toast');
        document.getElementById('toastText').textContent = message;
        document.getElementById('toastIcon').textContent = isError ? '‚úó' : '‚úì';
        toast.classList.toggle('error', isError);
        toast.classList.add('show');
        setTimeout(function() { toast.classList.remove('show'); }, 3000);
    }

    function apiGet(endpoint) {
        return fetch(endpoint, {
            headers: { 'Authorization': 'Bearer ' + authToken }
        }).then(function(res) { return res.json(); });
    }

    function loadAllData() {
        loadSubscribers();
        loadFacilities();
        loadActivity();
    }

    function loadSubscribers() {
        apiGet('/api/admin/subscribers')
            .then(function(data) {
                if (data.success) {
                    subscribers = data.subscribers || [];
                    renderSubscribers();
                    updateOverviewStats();
                }
            })
            .catch(function(err) {
                console.error('Error loading subscribers:', err);
                subscribers = [];
                renderSubscribers();
            });
    }

    function loadFacilities() {
        apiGet('/api/admin/facilities')
            .then(function(data) {
                if (data.success) {
                    facilities = data.facilities || [];
                    renderFacilities();
                    updateOverviewStats();
                }
            })
            .catch(function(err) {
                console.error('Error loading facilities:', err);
                facilities = [];
                renderFacilities();
            });

        apiGet('/api/admin/users')
            .then(function(data) {
                if (data.success) {
                    users = data.users || [];
                    updateOverviewStats();
                }
            })
            .catch(function(err) {
                console.error('Error loading users:', err);
                users = [];
            });
    }

    function loadActivity() {
        apiGet('/api/admin/activity')
            .then(function(data) {
                if (data.success) {
                    activities = data.activities || [];
                    renderActivity();
                    renderOverviewActivity();
                }
            })
            .catch(function(err) {
                console.error('Error loading activity:', err);
                activities = [];
                renderActivity();
            });
    }

    function updateOverviewStats() {
        document.getElementById('totalSubscribers').textContent = subscribers.length;
        document.getElementById('totalFacilities').textContent = facilities.length;
        document.getElementById('totalUsers').textContent = users.length;
        
        var totalSessions = facilities.reduce(function(sum, f) { return sum + (f.total_sessions || 0); }, 0);
        document.getElementById('totalSessions').textContent = totalSessions;

        // Subscriber stats
        var active = subscribers.filter(function(s) { return s.status === 'active'; }).length;
        var trialing = subscribers.filter(function(s) { return s.status === 'trialing'; }).length;
        var family = subscribers.filter(function(s) { return s.plan_type && s.plan_type.includes('family'); }).length;
        var individual = subscribers.filter(function(s) { return s.plan_type && s.plan_type.includes('individual'); }).length;

        document.getElementById('activeSubscribers').textContent = active;
        document.getElementById('trialingSubscribers').textContent = trialing;
        document.getElementById('familyPlans').textContent = family;
        document.getElementById('individualPlans').textContent = individual;
    }

    function renderSubscribers() {
        var tbody = document.getElementById('subscribersTable');
        
        if (subscribers.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--muted)"><span class="lang-en">No subscribers yet</span><span class="lang-es">A√∫n no hay suscriptores</span></td></tr>';
            return;
        }

        var html = '';
        subscribers.forEach(function(sub) {
            var statusClass = 'badge-' + (sub.status || 'unknown');
            var planDisplay = (sub.plan_type || 'unknown').replace('_', ' ');
            var createdDate = sub.created_at ? new Date(sub.created_at).toLocaleDateString() : '-';
            
            html += '<tr>';
            html += '<td>' + (sub.email || '-') + '</td>';
            html += '<td><strong style="color:var(--orange)">' + (sub.pin || '-') + '</strong></td>';
            html += '<td>' + planDisplay + '</td>';
            html += '<td><span class="badge ' + statusClass + '">' + (sub.status || 'unknown') + '</span></td>';
            html += '<td>' + (sub.family_members_count || 0) + ' members</td>';
            html += '<td>' + createdDate + '</td>';
            html += '</tr>';
        });
        
        tbody.innerHTML = html;
    }

    function renderFacilities() {
        var tbody = document.getElementById('facilitiesTable');
        
        if (facilities.length === 0) {
            tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:40px;color:var(--muted)"><span class="lang-en">No facilities yet</span><span class="lang-es">A√∫n no hay centros</span></td></tr>';
            return;
        }

        var html = '';
        facilities.forEach(function(fac) {
            var statusClass = fac.status === 'active' ? 'badge-active' : (fac.status === 'expired' ? 'badge-canceled' : 'badge-trialing');
            var expiresDate = fac.expires_at ? new Date(fac.expires_at).toLocaleDateString() : '-';
            
            html += '<tr>';
            html += '<td><strong>' + (fac.name || '-') + '</strong></td>';
            html += '<td><code style="background:var(--darker);padding:4px 8px;border-radius:4px">' + (fac.license_key || '-') + '</code></td>';
            html += '<td>' + (fac.user_count || 0) + ' / ' + (fac.user_limit || 0) + '</td>';
            html += '<td>' + (fac.total_sessions || 0) + '</td>';
            html += '<td><span class="badge ' + statusClass + '">' + (fac.status || 'unknown') + '</span></td>';
            html += '<td>' + expiresDate + '</td>';
            html += '</tr>';
        });
        
        tbody.innerHTML = html;
    }

    function getActivityIcon(type) {
        var icons = {
            'subscription_created': { icon: 'üí≥', class: 'subscription' },
            'subscription_updated': { icon: 'üí≥', class: 'subscription' },
            'subscription_canceled': { icon: '‚ùå', class: 'subscription' },
            'subscriber_login': { icon: 'üîë', class: 'subscription' },
            'user_register': { icon: 'üë§', class: 'user' },
            'user_login': { icon: 'üîë', class: 'user' },
            'game_session': { icon: 'üéÆ', class: 'game' },
            'facility_login': { icon: 'üè¢', class: 'facility' },
            'family_member_added': { icon: 'üë®‚Äçüë©‚Äçüëß', class: 'subscription' },
            'family_member_removed': { icon: 'üë§', class: 'subscription' }
        };
        return icons[type] || { icon: 'üìã', class: 'gear' };
    }

    function formatTimeAgo(timestamp) {
        if (!timestamp) return '-';
        var date = new Date(timestamp);
        var now = new Date();
        var diff = Math.floor((now - date) / 1000);
        
        if (diff < 60) return currentLang === 'es' ? 'hace ' + diff + 's' : diff + 's ago';
        if (diff < 3600) return currentLang === 'es' ? 'hace ' + Math.floor(diff/60) + 'm' : Math.floor(diff/60) + 'm ago';
        if (diff < 86400) return currentLang === 'es' ? 'hace ' + Math.floor(diff/3600) + 'h' : Math.floor(diff/3600) + 'h ago';
        return currentLang === 'es' ? 'hace ' + Math.floor(diff/86400) + 'd' : Math.floor(diff/86400) + 'd ago';
    }

    function renderActivity() {
        var container = document.getElementById('activityList');
        
        if (activities.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text"><span class="lang-en">No activity yet</span><span class="lang-es">A√∫n no hay actividad</span></div></div>';
            return;
        }

        var html = '';
        activities.slice(0, 50).forEach(function(act) {
            var iconInfo = getActivityIcon(act.type);
            var description = act.details || act.type || 'Activity';
            if (act.username) description = '<strong>' + act.username + '</strong> - ' + description;
            if (act.facility) description += ' (' + act.facility + ')';
            
            html += '<div class="activity-item">';
            html += '<div class="activity-icon ' + iconInfo.class + '">' + iconInfo.icon + '</div>';
            html += '<div class="activity-content">';
            html += '<div class="activity-text">' + description + '</div>';
            html += '<div class="activity-time">' + formatTimeAgo(act.timestamp) + '</div>';
            html += '</div>';
            html += '</div>';
        });
        
        container.innerHTML = html;
    }

    function renderOverviewActivity() {
        var container = document.getElementById('overviewActivity');
        
        if (activities.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üìã</div><div class="empty-state-text"><span class="lang-en">No activity yet</span><span class="lang-es">A√∫n no hay actividad</span></div></div>';
            return;
        }

        var html = '';
        activities.slice(0, 10).forEach(function(act) {
            var iconInfo = getActivityIcon(act.type);
            var description = act.details || act.type || 'Activity';
            if (act.username) description = '<strong>' + act.username + '</strong> - ' + description;
            
            html += '<div class="activity-item">';
            html += '<div class="activity-icon ' + iconInfo.class + '">' + iconInfo.icon + '</div>';
            html += '<div class="activity-content">';
            html += '<div class="activity-text">' + description + '</div>';
            html += '<div class="activity-time">' + formatTimeAgo(act.timestamp) + '</div>';
            html += '</div>';
            html += '</div>';
        });
        
        container.innerHTML = html;
    }

    init();
})();
</script>
</body>
</html>
