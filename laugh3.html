<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>LAUGH 3: Wacky Walks | Laughletico‚Ñ¢</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
:root{--orange:#FF6B00;--teal:#00D9A5;--gold:#FFD700;--purple:#9B59B6;--pink:#FF69B4;--dark:#0a0a0f;--card:#111118;--text:#FFFFFF;--muted:#8892a0;--success:#00D9A5;--danger:#FF4757}
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{font-family:'Outfit',sans-serif;background:var(--dark);color:var(--text)}
body.es .lang-en{display:none!important}
body.en .lang-es{display:none!important}
.game-header{padding:15px 20px;background:linear-gradient(135deg,rgba(155,89,182,0.2),rgba(255,105,180,0.1));border-bottom:2px solid rgba(155,89,182,0.3);display:flex;align-items:center;justify-content:space-between}
.header-left{display:flex;align-items:center;gap:12px}
.coach-header-avatar{width:40px;height:40px;border-radius:50%;overflow:hidden}
.coach-header-img{width:100%;height:100%;object-fit:cover}
.coach-label{font-size:0.65rem;color:var(--muted);letter-spacing:1px}
.back-btn{width:40px;height:40px;background:rgba(255,255,255,0.1);border:none;border-radius:50%;color:var(--text);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center}
.game-title{font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:2px}
.game-title .laugh-title{color:var(--pink)}
.game-title .num{color:var(--gold)}
.tier-badge{background:linear-gradient(135deg,var(--purple),var(--pink));padding:6px 14px;border-radius:20px;font-weight:700;font-size:0.8rem}
.lang-toggle{display:flex;gap:5px}
.lang-btn{padding:6px 12px;border:2px solid var(--purple);background:transparent;color:var(--purple);border-radius:15px;font-weight:700;font-size:0.7rem;cursor:pointer}
.lang-btn.active{background:var(--purple);color:var(--text)}
.game-container{height:calc(100vh - 80px);display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;position:relative}
.intro-screen{text-align:center;max-width:400px}
.intro-coach{margin-bottom:15px}
.intro-coach-img{width:100px;height:100px;border-radius:50%;object-fit:cover;border:4px solid var(--purple);animation:wiggle 1s infinite}
@keyframes wiggle{0%,100%{transform:rotate(-5deg)}50%{transform:rotate(5deg)}}
.intro-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:4px;margin-bottom:5px}
.intro-title .laugh-title{color:var(--pink)}
.intro-title .num{color:var(--gold)}
.intro-circuit{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:3px;margin-bottom:10px}
.intro-subtitle{color:var(--gold);font-family:'Bebas Neue',sans-serif;letter-spacing:2px;margin-bottom:20px}
.intro-desc{color:var(--muted);line-height:1.6;margin-bottom:30px}
.intro-desc strong{color:var(--text)}
.intro-coach-name{margin-top:20px;color:var(--muted);font-size:0.9rem}
.start-btn{padding:18px 50px;font-family:'Bebas Neue',sans-serif;font-size:1.5rem;letter-spacing:4px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;box-shadow:0 8px 30px rgba(155,89,182,0.5)}
.watch-screen{text-align:center;width:100%}
.phase-label{font-family:'Bebas Neue',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--gold);margin-bottom:20px}
.stage{background:var(--card);border:3px solid var(--purple);border-radius:30px;padding:40px 20px;margin:0 auto 20px;max-width:320px;min-height:200px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden}
.walker{font-size:5rem;position:relative}
.walker.walking{animation:walk 0.6s ease-in-out}
@keyframes walk{0%{transform:translateX(-100px) rotate(-10deg);opacity:0}20%{opacity:1}50%{transform:translateX(0) rotate(5deg)}80%{opacity:1}100%{transform:translateX(100px) rotate(-10deg);opacity:0}}
.walker.bounce{animation:bounce 0.6s ease}
@keyframes bounce{0%,100%{transform:translateY(0)}25%{transform:translateY(-30px) rotate(-10deg)}50%{transform:translateY(0) rotate(10deg)}75%{transform:translateY(-20px) rotate(-5deg)}}
.walker.spin{animation:spin 0.6s ease}
@keyframes spin{0%{transform:rotate(0) scale(1)}50%{transform:rotate(180deg) scale(1.2)}100%{transform:rotate(360deg) scale(1)}}
.walker.wobble{animation:wobble 0.6s ease}
@keyframes wobble{0%,100%{transform:rotate(0)}25%{transform:rotate(-20deg) translateX(-10px)}50%{transform:rotate(20deg) translateX(10px)}75%{transform:rotate(-10deg) translateX(-5px)}}
.walker.jump{animation:jump 0.6s ease}
@keyframes jump{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-50px) scale(1.1)}}
.walker.shake{animation:shakeWalk 0.6s ease}
@keyframes shakeWalk{0%,100%{transform:translateX(0)}20%{transform:translateX(-15px)}40%{transform:translateX(15px)}60%{transform:translateX(-10px)}80%{transform:translateX(10px)}}
.walk-name{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--pink);margin-top:15px;letter-spacing:2px}
.sequence-dots{display:flex;justify-content:center;gap:8px;margin-top:15px}
.seq-dot{width:12px;height:12px;border-radius:50%;background:rgba(255,255,255,0.2)}
.seq-dot.active{background:var(--gold)}
.seq-dot.done{background:var(--purple)}
.repeat-screen{text-align:center;width:100%}
.walker-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;max-width:320px;margin:20px auto}
.walker-btn{background:var(--card);border:3px solid rgba(255,255,255,0.1);border-radius:20px;padding:15px;cursor:pointer;transition:all 0.15s;text-align:center}
.walker-btn:active{transform:scale(0.9)}
.walker-btn .emoji{font-size:2.8rem;display:block;margin-bottom:5px}
.walker-btn .label{font-size:0.7rem;color:var(--muted)}
.walker-btn.correct{border-color:var(--success);background:rgba(0,217,165,0.2)}
.walker-btn.wrong{border-color:var(--danger);background:rgba(255,71,87,0.2)}
.walker-btn.highlight{border-color:var(--gold);background:rgba(255,215,0,0.2)}
.progress-bar{display:flex;justify-content:center;gap:8px;margin:20px 0}
.prog-dot{width:20px;height:20px;border-radius:50%;background:rgba(255,255,255,0.1);display:flex;align-items:center;justify-content:center;font-size:0.7rem}
.prog-dot.filled{background:var(--success)}
.prog-dot.current{background:var(--gold);animation:pulse 0.5s infinite}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.2)}}
.score-display{position:absolute;top:100px;right:20px;text-align:right}
.score-label{font-size:0.7rem;color:var(--muted)}
.score-value{font-family:'Bebas Neue',sans-serif;font-size:2rem;color:var(--pink)}
.streak-display{margin-top:5px}
.streak-value{color:var(--gold);font-weight:700}
.laugh-counter{position:absolute;top:100px;left:20px;text-align:left}
.laugh-counter-label{font-size:0.7rem;color:var(--muted);letter-spacing:1px}
.laugh-counter-value{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;color:var(--gold)}
.gameover-screen{text-align:center;max-width:400px}
.gameover-emoji{font-size:5rem;margin-bottom:20px}
.gameover-title{font-family:'Bebas Neue',sans-serif;font-size:2.5rem;letter-spacing:3px;margin-bottom:10px}
.gameover-score{font-family:'Bebas Neue',sans-serif;font-size:4rem;color:var(--pink);margin:20px 0}
.gameover-stats{color:var(--gold);margin-bottom:30px;font-size:1.2rem}
.retry-btn{padding:16px 40px;font-family:'Bebas Neue',sans-serif;font-size:1.3rem;letter-spacing:3px;background:linear-gradient(135deg,var(--purple),var(--pink));color:var(--text);border:none;border-radius:50px;cursor:pointer;margin-bottom:15px;display:block;width:100%}
.home-btn{padding:14px 30px;font-family:'Bebas Neue',sans-serif;font-size:1rem;letter-spacing:2px;background:transparent;color:var(--muted);border:2px solid var(--muted);border-radius:50px;cursor:pointer;display:block;width:100%}
.coach-bubble{position:fixed;bottom:20px;left:20px;right:20px;background:var(--card);border:2px solid var(--purple);border-radius:20px;padding:15px;display:flex;align-items:center;gap:15px;z-index:50}
.coach-avatar{width:50px;height:50px;border-radius:50%;overflow:hidden}
.coach-avatar img{width:100%;height:100%;object-fit:cover}
.coach-text{font-size:0.95rem;line-height:1.4}
.confetti-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1000}
.confetti{position:absolute;width:10px;height:10px;top:-10px;animation:fall 3s linear forwards}
@keyframes fall{to{transform:translateY(100vh) rotate(720deg);opacity:0}}
.laugh-pop{position:fixed;pointer-events:none;font-size:2rem;animation:laughFloat 1s ease-out forwards;z-index:999}
@keyframes laughFloat{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-50px) scale(1.5)}}
.hidden{display:none!important}
</style>
</head>
<body class="en">
<div class="confetti-container" id="confettiContainer"></div>

<div class="game-header">
<div class="header-left">
<button class="back-btn" id="backBtn">‚Üê</button>
<div class="coach-header-avatar"><img src="go_chat.png" alt="Coach" class="coach-header-img"></div>
<div>
<div class="game-title"><span class="laugh-title">LAUGH</span> <span class="num">3</span></div>
<div class="coach-label">w/ Coach GoTrotter AI</div>
</div>
<div class="tier-badge" id="tierBadge">TIER 1</div>
</div>
<div class="lang-toggle">
<button class="lang-btn active" data-lang="en">EN</button>
<button class="lang-btn" data-lang="es">ES</button>
</div>
</div>

<div class="game-container">

<div class="intro-screen" id="introScreen">
<div class="intro-coach"><img src="go_chat.png" alt="Coach" class="intro-coach-img"></div>
<div class="intro-title"><span class="laugh-title">LAUGH</span> <span class="num">3</span></div>
<div class="intro-circuit">WACKY WALKS üö∂</div>
<div class="intro-subtitle">
<span class="lang-en">SEQUENCE & MEMORY</span>
<span class="lang-es">SECUENCIA Y MEMORIA</span>
</div>
<div class="intro-desc">
<span class="lang-en">Watch <strong>silly characters</strong> do their wacky moves!<br><br>Then repeat the sequence! üß†<br><br>The moves are TOO funny! üòÇ</span>
<span class="lang-es">¬°Mira a <strong>personajes tontos</strong> hacer sus movimientos!<br><br>¬°Luego repite la secuencia! üß†<br><br>¬°Los movimientos son MUY graciosos! üòÇ</span>
</div>
<button class="start-btn" id="startBtn">
<span class="lang-en">LET'S WALK! üö∂</span>
<span class="lang-es">¬°A CAMINAR! üö∂</span>
</button>
<div class="intro-coach-name">
<span class="lang-en">with Coach GoTrotter AI üèÄ</span>
<span class="lang-es">con Coach GoTrotter AI üèÄ</span>
</div>
</div>

<div class="watch-screen hidden" id="watchScreen">
<div class="phase-label">
<span class="lang-en">üëÄ WATCH THE WACKY WALKS!</span>
<span class="lang-es">üëÄ ¬°MIRA LOS PASOS LOCOS!</span>
</div>
<div class="stage">
<div class="walker" id="stageWalker">üêß</div>
<div class="walk-name" id="walkName">PENGUIN WADDLE</div>
</div>
<div class="sequence-dots" id="sequenceDots"></div>
</div>

<div class="repeat-screen hidden" id="repeatScreen">
<div class="phase-label">
<span class="lang-en">ü§î REPEAT THE SEQUENCE!</span>
<span class="lang-es">ü§î ¬°REPITE LA SECUENCIA!</span>
</div>
<div class="progress-bar" id="progressBar"></div>
<div class="walker-grid" id="walkerGrid"></div>
</div>

<div class="gameover-screen hidden" id="gameoverScreen">
<div class="gameover-emoji" id="gameoverEmoji">üö∂</div>
<div class="gameover-title">
<span class="lang-en">CIRCUIT COMPLETE!</span>
<span class="lang-es">¬°CIRCUITO COMPLETO!</span>
</div>
<div class="gameover-score" id="finalScore">0</div>
<div class="gameover-stats" id="gameStats">üòÇ Laugh Moments: 0</div>
<button class="retry-btn" id="retryBtn">
<span class="lang-en">PLAY AGAIN üö∂</span>
<span class="lang-es">JUGAR DE NUEVO üö∂</span>
</button>
<button class="home-btn" id="homeBtn">
<span class="lang-en">‚Üê BACK</span>
<span class="lang-es">‚Üê VOLVER</span>
</button>
</div>

<div class="score-display hidden" id="scoreDisplay">
<div class="score-label">SCORE</div>
<div class="score-value" id="currentScore">0</div>
<div class="streak-display">
<span class="lang-en">üî• Streak: </span>
<span class="lang-es">üî• Racha: </span>
<span class="streak-value" id="streakValue">0</span>
</div>
</div>

<div class="laugh-counter hidden" id="laughCounter">
<div class="laugh-counter-label">üòÇ LAUGHS</div>
<div class="laugh-counter-value" id="laughCounterValue">0</div>
</div>

</div>

<div class="coach-bubble hidden" id="coachBubble">
<div class="coach-avatar"><img src="go_chat.png" alt="Coach"></div>
<div class="coach-text" id="coachText">Great!</div>
</div>

<script>
(function(){
var lang = localStorage.getItem('lw-lang') || 'en';
function setLang(l){
    lang = l;
    localStorage.setItem('lw-lang', l);
    document.body.className = l;
    document.querySelectorAll('.lang-btn').forEach(function(b){
        b.classList.toggle('active', b.dataset.lang === l);
    });
}
setLang(lang);
document.querySelectorAll('.lang-btn').forEach(function(b){
    b.addEventListener('click', function(e){
        e.preventDefault();
        setLang(this.dataset.lang);
    });
});

// ============ LAUGH TRACKING SYSTEM ============
var circuitLaughs = 0;

function getDateString(date) {
    return date.toISOString().split('T')[0];
}

function getWeekStart(date) {
    var d = new Date(date);
    var day = d.getDay();
    var diff = d.getDate() - day + (day === 0 ? -6 : 1);
    d.setDate(diff);
    return getDateString(d);
}

function addLaughs(count) {
    circuitLaughs += count;
    updateLaughDisplay();
    
    var today = getDateString(new Date());
    var weekStart = getWeekStart(new Date());
    
    // Update today's laughs
    var todayData = JSON.parse(localStorage.getItem('lw-laughs-today') || '{}');
    if (todayData.date !== today) {
        todayData = { date: today, count: 0 };
    }
    todayData.count += count;
    localStorage.setItem('lw-laughs-today', JSON.stringify(todayData));
    
    // Update week's laughs
    var weekData = JSON.parse(localStorage.getItem('lw-laughs-week') || '{}');
    if (weekData.weekStart !== weekStart) {
        weekData = { weekStart: weekStart, count: 0 };
    }
    weekData.count += count;
    localStorage.setItem('lw-laughs-week', JSON.stringify(weekData));
    
    // Update total laughs
    var total = parseInt(localStorage.getItem('lw-laughs-total') || '0');
    total += count;
    localStorage.setItem('lw-laughs-total', total.toString());
    
    // Show floating laugh emoji
    showLaughPop(count);
}

function updateLaughDisplay() {
    document.getElementById('laughCounterValue').textContent = circuitLaughs;
}

function showLaughPop(count) {
    for (var i = 0; i < Math.min(count, 3); i++) {
        setTimeout(function() {
            var pop = document.createElement('div');
            pop.className = 'laugh-pop';
            pop.textContent = 'üòÇ';
            pop.style.left = (20 + Math.random() * 60) + '%';
            pop.style.top = (30 + Math.random() * 40) + '%';
            document.body.appendChild(pop);
            setTimeout(function() {
                if (pop.parentNode) pop.parentNode.removeChild(pop);
            }, 1000);
        }, i * 150);
    }
}

// ============ WALKERS DATABASE ============
var walkers = [
    {emoji:'üêß',anim:'wobble',en:'Penguin Waddle',es:'Ping√ºino Tambaleante'},
    {emoji:'ü§ñ',anim:'shake',en:'Robot Walk',es:'Paso de Robot'},
    {emoji:'üëµ',anim:'bounce',en:'Grandma Hop',es:'Salto de Abuela'},
    {emoji:'ü¶Ä',anim:'walk',en:'Crab Scuttle',es:'Cangrejo Lateral'},
    {emoji:'üßü',anim:'wobble',en:'Zombie Shuffle',es:'Arrastre Zombi'},
    {emoji:'üë∂',anim:'bounce',en:'Baby Bounce',es:'Beb√© Saltar√≠n'},
    {emoji:'ü¶Ü',anim:'wobble',en:'Duck Waddle',es:'Pato Tambaleante'},
    {emoji:'üßô',anim:'spin',en:'Wizard Twirl',es:'Giro de Mago'},
    {emoji:'ü§°',anim:'jump',en:'Clown Jump',es:'Salto de Payaso'},
    {emoji:'üëª',anim:'walk',en:'Ghost Float',es:'Fantasma Flotante'},
    {emoji:'ü¶ò',anim:'jump',en:'Kangaroo Hop',es:'Salto Canguro'},
    {emoji:'üê¢',anim:'shake',en:'Turtle Crawl',es:'Tortuga Lenta'},
    {emoji:'üíÉ',anim:'spin',en:'Dancer Spin',es:'Giro Bailarina'},
    {emoji:'ü§†',anim:'bounce',en:'Cowboy Strut',es:'Paso Vaquero'},
    {emoji:'üëΩ',anim:'wobble',en:'Alien Glide',es:'Desliz Alien'},
    {emoji:'üéÖ',anim:'bounce',en:'Santa Jiggle',es:'Santa Saltar√≠n'},
    {emoji:'üê∏',anim:'jump',en:'Frog Leap',es:'Salto de Rana'},
    {emoji:'ü¶©',anim:'wobble',en:'Flamingo Step',es:'Paso Flamenco'}
];

var coachMsgs = {
    start:{en:"Watch these WACKY walks! üö∂üòÇ",es:"¬°Mira estos pasos LOCOS! üö∂üòÇ"},
    watch:[
        {en:"Haha! Look at THAT walk! üòÇ",es:"¬°Jaja! ¬°Mira ese paso! üòÇ"},
        {en:"So silly! ü§£",es:"¬°Muy tonto! ü§£"},
        {en:"Can you remember this? üß†",es:"¬øPuedes recordar esto? üß†"}
    ],
    repeat:[
        {en:"Your turn! Repeat the sequence! ü§î",es:"¬°Tu turno! ¬°Repite la secuencia! ü§î"},
        {en:"Show me those moves! üí™",es:"¬°Mu√©strame esos movimientos! üí™"}
    ],
    correct:[
        {en:"YES! You got it! üéâ",es:"¬°S√ç! ¬°Lo tienes! üéâ"},
        {en:"Perfect sequence! üí™",es:"¬°Secuencia perfecta! üí™"},
        {en:"Memory champion! üèÜ",es:"¬°Campe√≥n de memoria! üèÜ"}
    ],
    streak:[
        {en:"STREAK! On fire! üî•",es:"¬°RACHA! ¬°En fuego! üî•"},
        {en:"Unstoppable! üî•üî•",es:"¬°Imparable! üî•üî•"}
    ],
    wrong:[
        {en:"Oops! Those walks are tricky! üòÖ",es:"¬°Ups! ¬°Esos pasos son dif√≠ciles! üòÖ"},
        {en:"Keep practicing! üëÄ",es:"¬°Sigue practicando! üëÄ"}
    ],
    tierUp:{en:"TIER UP! Longer sequences! üö∂‚ö°",es:"¬°SUBISTE! ¬°Secuencias m√°s largas! üö∂‚ö°"},
    gameOver:{en:"Great circuit! üö∂üß†",es:"¬°Gran circuito! üö∂üß†"}
};

var tier=1,score=0,streak=0,maxStreak=0,round=0,sequencesCompleted=0;
var sequence=[],playerIndex=0;
var showingSequence=false;

var tierSettings=[
    {length:2,showTime:1200,walkerCount:4},
    {length:2,showTime:1100,walkerCount:4},
    {length:3,showTime:1100,walkerCount:5},
    {length:3,showTime:1000,walkerCount:5},
    {length:4,showTime:1000,walkerCount:6},
    {length:4,showTime:900,walkerCount:6},
    {length:5,showTime:900,walkerCount:6},
    {length:5,showTime:800,walkerCount:6},
    {length:6,showTime:800,walkerCount:6},
    {length:6,showTime:700,walkerCount:6}
];

var introScreen=document.getElementById('introScreen');
var watchScreen=document.getElementById('watchScreen');
var repeatScreen=document.getElementById('repeatScreen');
var gameoverScreen=document.getElementById('gameoverScreen');
var scoreDisplay=document.getElementById('scoreDisplay');
var laughCounter=document.getElementById('laughCounter');
var coachBubble=document.getElementById('coachBubble');
var coachText=document.getElementById('coachText');

function shuffle(a){
    var arr=a.slice();
    for(var i=arr.length-1;i>0;i--){
        var j=Math.floor(Math.random()*(i+1));
        var t=arr[i];arr[i]=arr[j];arr[j]=t;
    }
    return arr;
}

function showScreen(s){
    introScreen.classList.add('hidden');
    watchScreen.classList.add('hidden');
    repeatScreen.classList.add('hidden');
    gameoverScreen.classList.add('hidden');
    s.classList.remove('hidden');
}

function updateScore(){
    document.getElementById('currentScore').textContent=score;
    document.getElementById('streakValue').textContent=streak;
}

function updateTier(){
    document.getElementById('tierBadge').textContent='TIER '+tier;
}

function showCoach(msg,dur){
    coachText.textContent=msg;
    coachBubble.classList.remove('hidden');
    setTimeout(function(){coachBubble.classList.add('hidden');},dur||2500);
}

function confetti(){
    var c=document.getElementById('confettiContainer');
    for(var i=0;i<40;i++){
        setTimeout(function(){
            var p=document.createElement('div');
            p.className='confetti';
            p.style.left=Math.random()*100+'vw';
            p.style.background=['#9B59B6','#FF69B4','#FFD700','#00D9A5'][Math.floor(Math.random()*4)];
            p.style.animationDuration=(2+Math.random()*2)+'s';
            c.appendChild(p);
            setTimeout(function(){if(p.parentNode)p.remove();},4000);
        },i*40);
    }
}

var roundWalkers=[];

function startGame(){
    tier=1;score=0;streak=0;maxStreak=0;round=0;sequencesCompleted=0;
    circuitLaughs=0;
    updateScore();updateTier();updateLaughDisplay();
    scoreDisplay.classList.remove('hidden');
    laughCounter.classList.remove('hidden');
    var m=coachMsgs.start;
    showCoach(lang==='es'?m.es:m.en,2500);
    setTimeout(startRound,2000);
}

function startRound(){
    round++;
    var s=tierSettings[tier-1];
    roundWalkers=shuffle(walkers).slice(0,s.walkerCount);
    sequence=[];
    for(var i=0;i<s.length;i++){
        sequence.push(roundWalkers[Math.floor(Math.random()*roundWalkers.length)]);
    }
    showSequence();
}

function showSequence(){
    showScreen(watchScreen);
    showingSequence=true;
    var s=tierSettings[tier-1];
    
    var dots=document.getElementById('sequenceDots');
    dots.innerHTML='';
    for(var i=0;i<sequence.length;i++){
        var dot=document.createElement('div');
        dot.className='seq-dot';
        dots.appendChild(dot);
    }
    
    var idx=0;
    function showNext(){
        if(idx>=sequence.length){
            showingSequence=false;
            setTimeout(startRepeat,500);
            return;
        }
        
        var w=sequence[idx];
        var walker=document.getElementById('stageWalker');
        var name=document.getElementById('walkName');
        
        // +1 laugh for seeing wacky walk
        addLaughs(1);
        
        walker.textContent=w.emoji;
        walker.className='walker '+w.anim;
        name.textContent=lang==='es'?w.es:w.en;
        
        dots.children[idx].classList.add('active');
        if(idx>0)dots.children[idx-1].classList.remove('active');
        if(idx>0)dots.children[idx-1].classList.add('done');
        
        if(idx===0){
            var msg=coachMsgs.watch[Math.floor(Math.random()*coachMsgs.watch.length)];
            showCoach(lang==='es'?msg.es:msg.en,s.showTime*sequence.length);
        }
        
        idx++;
        setTimeout(showNext,s.showTime);
    }
    showNext();
}

function startRepeat(){
    showScreen(repeatScreen);
    playerIndex=0;
    
    var msg=coachMsgs.repeat[Math.floor(Math.random()*coachMsgs.repeat.length)];
    showCoach(lang==='es'?msg.es:msg.en,2000);
    
    var prog=document.getElementById('progressBar');
    prog.innerHTML='';
    for(var i=0;i<sequence.length;i++){
        var dot=document.createElement('div');
        dot.className='prog-dot';
        dot.textContent=i+1;
        if(i===0)dot.classList.add('current');
        prog.appendChild(dot);
    }
    
    var grid=document.getElementById('walkerGrid');
    grid.innerHTML='';
    roundWalkers.forEach(function(w){
        var btn=document.createElement('div');
        btn.className='walker-btn';
        btn.innerHTML='<span class="emoji">'+w.emoji+'</span><span class="label">'+(lang==='es'?w.es:w.en)+'</span>';
        btn.dataset.emoji=w.emoji;
        btn.onclick=function(){handleWalkerClick(btn,w);};
        grid.appendChild(btn);
    });
}

function handleWalkerClick(btn,walker){
    if(showingSequence)return;
    
    var correct=sequence[playerIndex];
    var prog=document.getElementById('progressBar');
    
    if(walker.emoji===correct.emoji){
        btn.classList.add('correct');
        setTimeout(function(){btn.classList.remove('correct');},300);
        
        prog.children[playerIndex].classList.remove('current');
        prog.children[playerIndex].classList.add('filled');
        
        playerIndex++;
        
        if(playerIndex>=sequence.length){
            sequencesCompleted++;
            score+=sequence.length*5;
            streak++;
            if(streak>maxStreak)maxStreak=streak;
            updateScore();
            
            // +1 laugh for completing sequence
            addLaughs(1);
            
            // +2 extra laughs for streak of 3+
            if(streak>=3){
                addLaughs(2);
            }
            
            var msg;
            if(streak>=3){
                msg=coachMsgs.streak[Math.floor(Math.random()*coachMsgs.streak.length)];
            }else{
                msg=coachMsgs.correct[Math.floor(Math.random()*coachMsgs.correct.length)];
            }
            showCoach(lang==='es'?msg.es:msg.en,1500);
            
            setTimeout(endRound,1500);
        }else{
            prog.children[playerIndex].classList.add('current');
        }
    }else{
        btn.classList.add('wrong');
        setTimeout(function(){btn.classList.remove('wrong');},500);
        
        document.querySelectorAll('.walker-btn').forEach(function(b){
            if(b.dataset.emoji===correct.emoji)b.classList.add('highlight');
        });
        
        streak=0;
        updateScore();
        
        var msg=coachMsgs.wrong[Math.floor(Math.random()*coachMsgs.wrong.length)];
        showCoach(lang==='es'?msg.es:msg.en,1500);
        
        setTimeout(endRound,1500);
    }
}

function endRound(){
    document.querySelectorAll('.walker-btn').forEach(function(b){
        b.classList.remove('highlight','correct','wrong');
    });
    
    if(round>=5){
        if(tier>=10){
            endGame();
        }else{
            tier++;round=0;
            updateTier();
            confetti();
            // +3 laughs for tier up
            addLaughs(3);
            var m=coachMsgs.tierUp;
            showCoach(lang==='es'?m.es:m.en,2500);
            setTimeout(startRound,3000);
        }
    }else{
        setTimeout(startRound,1000);
    }
}

function endGame(){
    // +5 laughs for circuit complete
    addLaughs(5);
    
    showScreen(gameoverScreen);
    scoreDisplay.classList.add('hidden');
    laughCounter.classList.add('hidden');
    confetti();
    document.getElementById('finalScore').textContent=score;
    
    // Show laugh moments
    var laughText = lang === 'es' ? 
        'üòÇ Momentos de Risa: ' + circuitLaughs : 
        'üòÇ Laugh Moments: ' + circuitLaughs;
    document.getElementById('gameStats').textContent = laughText;
    
    var m=coachMsgs.gameOver;
    showCoach(lang==='es'?m.es:m.en,3000);
}

document.getElementById('startBtn').onclick=startGame;
document.getElementById('retryBtn').onclick=startGame;
document.getElementById('homeBtn').onclick=function(){
    window.location.href='laugh-hub.html';
};
document.getElementById('backBtn').onclick=function(){
    if(confirm(lang==='es'?'¬øSalir?':'Exit?')){
        window.location.href='laugh-hub.html';
    }
};
})();
</script>
</body>
</html>
